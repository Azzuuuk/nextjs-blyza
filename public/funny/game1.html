<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess The Price - Blyza Game Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- START: BRAND IDENTITY & ROOT VARIABLES --- */
        :root {
            --blyza-orange-primary: #FF8833;
            --blyza-purple-secondary: #cb7ae1;
            --blyza-keppel-accent: #00BFA6;
            --blyza-sunny-yellow: #FFDF00;
            --blyza-quickfire-red: #EA2027;

            --darker-grey-bg: #4A4A4A;
            --text-light: #FDFEFE;
            --text-dark: #2C3A47;
            --text-medium: #535c68;
            --black-stroke: #1A1A1A;

            --font-logo: "Luckiest Guy", cursive;
            --font-heading-alt: "Bungee", cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-radius-game: 12px;
            --shadow-chunky: 4px 4px 0px var(--black-stroke);
        }
        /* --- END: BRAND IDENTITY & ROOT VARIABLES --- */

        /* --- Basic Reset & Body --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        
        /* --- CUSTOM SCROLLING BODY --- */
        body {
            font-family: var(--font-body);
            color: var(--text-light);
            background: linear-gradient(135deg, var(--blyza-orange-primary) 0%, var(--blyza-purple-secondary) 100%);
            line-height: 1.6;
            overflow: hidden; /* Body does not scroll */
            position: relative;
            height: var(--app-height, 100vh); /* Full screen height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- Floating Background Elements --- */
        .hero-background-elements { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
        .bg-game-element {
            position: absolute; opacity: 0.1; color: var(--text-light);
            animation: floatSimple 20s infinite ease-in-out alternate;
            user-select: none;
        }
        .bg-dollar-1 { font-size: 150px; top: 10%; left: 5%; --initial-rotate: -15deg; animation-duration: 22s; }
        .bg-tag-1 { font-size: 100px; top: 65%; right: 8%; --initial-rotate: 10deg; animation-duration: 18s; }
        .bg-cart-1 { font-size: 120px; top: 70%; left: 15%; --initial-rotate: 5deg; animation-duration: 25s; opacity: 0.08; }
        .bg-cash-1 { font-size: 130px; top: 15%; right: 10%; --initial-rotate: 20deg; animation-duration: 16s; transform: scaleX(-1); }
        .bg-dollar-2 { font-size: 80px; top: 80%; right: 25%; --initial-rotate: 25deg; animation-duration: 15s; }
        .bg-tag-2 { font-size: 120px; bottom: 5%; left: 3%; --initial-rotate: -5deg; animation-duration: 28s; }
        .bg-cart-2 { font-size: 90px; top: 20%; left: 20%; --initial-rotate: 15deg; animation-duration: 20s; }
        .bg-gift-1 { font-size: 70px; top: 5%; right: 30%; --initial-rotate: -10deg; animation-duration: 24s; }
        .bg-money-1 { font-size: 110px; bottom: 10%; right: 4%; --initial-rotate: 12deg; animation-duration: 19s; }
        .bg-tag-3 { font-size: 60px; top: 50%; left: 1%; --initial-rotate: 20deg; animation-duration: 26s; }


        @keyframes floatSimple {
            0% { transform: translateY(0px) rotate(var(--initial-rotate, 0deg)); }
            50% { transform: translateY(-25px) rotate(calc(var(--initial-rotate, 0deg) + 8deg)); }
            100% { transform: translateY(0px) rotate(calc(var(--initial-rotate, 0deg) - 8deg)); }
        }
        
        /* --- CUSTOM SCROLLING CONTAINER --- */
        .game-container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(145deg, #fdfefe, #e9ecef);
            color: var(--text-dark);
            border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke);
            box-shadow: 8px 8px 0px var(--black-stroke);
            padding: 30px; 
            text-align: center;
            position: relative;
            z-index: 2;
            max-height: calc(var(--app-height, 100vh) - 40px); /* Make container scrollable */
            overflow-y: auto;
        }

        .brand-logo { object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .brand-logo-prominent { display: block; margin: 0 auto 15px; max-height: 80px; }
        
        h1 {
            font-family: var(--font-logo);
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
            text-shadow: 3px 3px 0px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            line-height: 1.1;
        }
        
        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .active { display: block; }
        
        .instructions, .team-inputs {
            background: rgba(0,0,0, 0.04);
            padding: 20px; border-radius: 10px; margin: 25px 0;
            border: 2px dashed var(--text-medium);
        }
        .instructions p { font-size: 1.1rem; margin-bottom: 15px; font-weight: 600; }
        .instructions ul { list-style-type: none; text-align: left; padding: 0 10px; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: center; }
        .instructions i { margin-right: 15px; font-size: 1.3em; color: var(--blyza-purple-secondary); }
        
        button, .btn-primary, .btn-secondary, .btn-success, .btn-danger, .btn-info {
            font-family: var(--font-heading-alt); font-size: 1.1rem; padding: 0.7em 1.5em;
            border: 3px solid var(--black-stroke); border-radius: 8px;
            text-transform: uppercase; text-decoration: none; display: inline-flex;
            align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            letter-spacing: 1px; cursor: pointer; color: var(--text-dark);
            margin: 8px 5px;
        }
        button:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        button:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        button:disabled { background: var(--text-medium); color: var(--text-light); cursor: not-allowed; opacity: 0.7; box-shadow: var(--shadow-chunky); }

        .btn-primary, #start-game-btn, #reveal-price-btn, #next-round-btn, #five-rounds-btn, #infinite-mode-btn { background-color: var(--blyza-sunny-yellow); box-shadow: var(--shadow-chunky); }
        .btn-secondary, #add-team-btn, #new-game-btn { background-color: var(--blyza-purple-secondary); color: var(--text-light); box-shadow: var(--shadow-chunky); }
        .btn-success, #play-again-btn { background-color: var(--blyza-keppel-accent); color: var(--text-light); box-shadow: var(--shadow-chunky); }
        .btn-info, #visit-store-btn { background-color: #4ECDC4; color: var(--text-dark); box-shadow: var(--shadow-chunky); }

        .game-mode-selection { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .mode-option {
            background: var(--text-light); padding: 20px; border-radius: var(--border-radius-game);
            cursor: pointer; transition: all 0.3s ease; border: 3px solid var(--black-stroke);
            box-shadow: var(--shadow-chunky); flex: 1; min-width: 250px; max-width: 300px;
        }
        .mode-option:hover { transform: translateY(-5px) scale(1.02); box-shadow: 6px 6px 0 var(--blyza-orange-primary); }
        .mode-option.selected {
            background: var(--blyza-keppel-accent); color: var(--text-light); border-color: var(--black-stroke);
            transform: scale(1.02); box-shadow: 6px 6px 0 var(--black-stroke);
        }
        .mode-option.selected i, .mode-option.selected h3, .mode-option.selected p { color: var(--text-light); }
        .mode-option i { font-size: 2.5rem; margin-bottom: 10px; color: var(--blyza-orange-primary); transition: all 0.3s ease; }
        .mode-option h3 { font-family: var(--font-heading-alt); margin-bottom: 8px; font-size: 1.3rem; }
        .mode-option p { color: var(--text-medium); font-size: 0.9rem; }

        .team-inputs h3 { font-family: var(--font-heading-alt); margin-bottom: 15px; }
        .team-input-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .team-input-wrapper input, .price-input {
            width: 100%; padding: 12px 18px; border-radius: 8px;
            border: 3px solid var(--black-stroke); background: var(--text-light);
            color: var(--text-dark); font-size: 1rem; transition: all 0.3s ease;
            font-family: var(--font-body); font-weight: 600;
        }
        .team-input-wrapper input:focus, .price-input:focus { outline: none; border-color: var(--blyza-orange-primary); box-shadow: 0 0 0 3px var(--blyza-sunny-yellow); }
        .remove-team-btn {
            background: var(--blyza-quickfire-red); color: var(--text-light); border: 2px solid var(--black-stroke);
            border-radius: 8px; padding: 8px 12px; font-size: 0.8rem; cursor: pointer;
            transition: all 0.2s ease; margin: 0; box-shadow: 2px 2px 0 var(--black-stroke);
        }
        .remove-team-btn:hover { background: #c0392b; }
        .remove-team-btn:disabled { background: var(--text-medium); cursor: not-allowed; opacity: 0.7; }

        .game-info {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 20px;
            padding: 12px 15px;
            background: rgba(0,0,0,0.1);
            border-radius: 8px;
            font-size: 1.1rem;
            font-family: var(--font-heading-alt);
            color: var(--text-dark);
            border: 2px solid var(--black-stroke);
        }
        .item-stage-container {
            background: var(--darker-grey-bg); padding: 20px; border-radius: var(--border-radius-game);
            margin-bottom: 30px; border: 3px solid var(--black-stroke);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        }
        .stage-curtains {
            position: absolute; top: 0; width: 51%; height: 100%;
            background-color: var(--text-dark);
            background-image: repeating-linear-gradient(90deg, transparent, transparent 20px, rgba(255,255,255,0.03) 20px, rgba(255,255,255,0.03) 40px);
            box-shadow: 0 0 25px rgba(0,0,0,0.6);
            transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1);
            z-index: 5;
        }
        .stage-curtains.left { left: 0; border-right: 6px solid var(--blyza-orange-primary); }
        .stage-curtains.right { right: 0; border-left: 6px solid var(--blyza-orange-primary); }
        .stage-curtains.open.left { transform: translateX(-105%) skewX(-10deg); }
        .stage-curtains.open.right { transform: translateX(105%) skewX(10deg); }
        
        .tv-screen-container {
            background: #111; border: 10px solid #333; border-radius: 15px; padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative; z-index: 1; min-height: 250px; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .tv-screen-container h3 { font-family: var(--font-logo); color: var(--blyza-sunny-yellow); -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke); font-size: 1.6rem; margin-bottom: 15px; }
        .item-image { max-height: 250px; max-width: 90%; object-fit: contain; border-radius: 8px; margin: 10px 0; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        .category-display { font-family: var(--font-heading-alt); color: var(--blyza-orange-primary); margin: 10px 0; font-size: 1.2rem; }
        
        .guess-inputs { display: grid; gap: 15px; margin: 30px 0; }
        .guess-input-group { background: rgba(0,0,0,0.04); padding: 15px; border-radius: 10px; }
        .guess-label { margin-bottom: 10px; font-weight: 600; font-family: var(--font-heading-alt); }
        .guess-input-container { display: flex; }
        .dollar-sign {
            background: var(--text-dark); padding: 12px 18px; border-radius: 8px 0 0 8px;
            font-weight: bold; color: var(--blyza-sunny-yellow); display: flex; align-items: center;
            font-family: var(--font-heading-alt); font-size: 1.1rem; border: 3px solid var(--black-stroke); border-right: none;
        }
        .price-input { border-radius: 0 8px 8px 0; }
        .price-input.error { border-color: var(--blyza-quickfire-red) !important; box-shadow: 0 0 0 3px var(--blyza-quickfire-red) !important; }

        .result-item { padding: 20px; border-radius: var(--border-radius-game); margin-bottom: 25px; border: 3px solid var(--black-stroke); background: rgba(0,0,0,0.1); }
        .price-display { font-size: 2.2rem; color: var(--blyza-keppel-accent); margin: 10px 0; font-family: var(--font-logo); -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke); }
        .price-display span { animation: pricePulse 1.5s infinite; display: inline-block; }
        @keyframes pricePulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        #item-description-text { font-size: 0.9rem; color: var(--text-medium); margin-top: 10px; max-width: 90%; margin-left: auto; margin-right: auto; font-weight: 500; }
        
        .guess-result {
            background: var(--text-light); padding: 15px; border-radius: 10px;
            margin-bottom: 15px; text-align: left; border: 3px solid var(--black-stroke);
            transition: all 0.3s ease; font-weight: 600;
        }
        .guess-result.closest-guess {
            border-color: var(--blyza-keppel-accent); background: #e0f8f5;
            box-shadow: var(--shadow-chunky); transform: scale(1.03);
        }
        .winner-badge {
            color: var(--blyza-keppel-accent); font-weight: bold; margin-top: 8px;
            font-family: var(--font-heading-alt); text-shadow: none; font-size: 0.9rem;
        }
        .difference-display { color: var(--blyza-purple-secondary); font-size: 0.9rem; margin-top: 5px; font-weight: 700; }

        .score-display, #final-scores-area { display: grid; gap: 20px; margin: 30px 0; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        .score-card { background: rgba(0,0,0,0.05); padding: 20px; border-radius: 10px; border: 3px solid var(--black-stroke); transition: all 0.3s ease; box-shadow: var(--shadow-chunky); }
        .score-card h4 { font-family: var(--font-heading-alt); color: var(--blyza-orange-primary); }
        .score-card .text-2xl, .score-card .text-3xl { font-family: var(--font-heading-alt); font-size: 2rem; }
        .score-card.winner-glow { animation: winnerGlow 1.5s infinite alternate; border-color: var(--blyza-keppel-accent); }
        @keyframes winnerGlow { from { box-shadow: 4px 4px 0 var(--blyza-keppel-accent); } to { box-shadow: 4px 4px 15px var(--blyza-keppel-accent); } }
        
        .progress-bar { height: 12px; background: rgba(0,0,0,0.2); border-radius: 50px; margin-top: 15px; overflow: hidden; border: 2px solid var(--black-stroke); }
        .progress-fill { height: 100%; background: var(--blyza-sunny-yellow); border-radius: 50px; transition: width 0.5s ease; }

        .winner-trophy { font-size: 6rem; margin: 20px 0; animation: bounce 1.5s infinite ease-in-out; color: var(--blyza-sunny-yellow); text-shadow: 0 0 20px var(--blyza-orange-primary), 3px 3px 0 var(--black-stroke); }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }
        .win-message {
            font-family: var(--font-logo); font-size: 3rem; margin: 20px 0; color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke); text-stroke: 2px var(--black-stroke);
        }

        .icon-btn {
            position: absolute; background-color: var(--blyza-purple-secondary);
            color: var(--text-light); border-radius: 50%; width: 55px; height: 55px;
            font-size: 1.2rem; cursor: pointer; transition: all 0.1s ease;
            display: flex; justify-content: center; align-items: center; z-index: 100;
            text-decoration: none; border: 3px solid var(--black-stroke);
            box-shadow: 4px 4px 0px var(--black-stroke);
        }
        .icon-btn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        .icon-btn:active { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        #settings-btn { top: 20px; right: 20px; }
        #highscore-btn { top: 20px; right: 85px; background-color: var(--blyza-sunny-yellow); }
        #home-menu-btn, #back-btn { top: 20px; left: 20px; }
        #back-btn { display: none; }
        
        .modal {
            position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); 
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
            animation: fadeInModal 0.3s ease;
        }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }

        .modal-content {
            background-color: var(--darker-grey-bg); margin: auto; padding: 25px;
            border: 3px solid var(--black-stroke); border-radius: var(--border-radius-game);
            width: 90%; max-width: 450px; box-shadow: 8px 8px 0px rgba(0,0,0,0.4);
            position: relative; color: var(--text-light);
            text-align: center;
        }
        .modal-content h2 {
            font-family: var(--font-logo); color: var(--blyza-orange-primary);
            -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke);
            text-align: center; margin-bottom: 25px; font-size: 2rem;
        }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; }
        .setting-item label { margin-bottom: 10px; font-weight: 600; font-size: 1rem; }
        .close-modal-btn { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-modal-btn:hover { color: var(--text-light); }
        .modal-content button#sfx-toggle-btn { font-size: 1rem; padding: 10px 20px; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: rgba(0,0,0,0.3); border-radius: 5px; border: 2px solid var(--black-stroke); }
        input[type=range]::-webkit-slider-thumb { border: 2px solid var(--black-stroke); height: 22px; width: 22px; border-radius: 50%; background: var(--blyza-orange-primary); cursor: pointer; -webkit-appearance: none; margin-top: -9px; }

        #audio-consent-modal .modal-content p {
            font-family: var(--font-body);
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 25px;
            color: var(--text-light);
        }
        #audio-consent-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .feedback-popup {
            position: fixed; top: 50%; left: 50%;
            background-color: var(--text-dark); color: white;
            padding: 25px 40px; border-radius: var(--border-radius-game);
            font-size: 2.5rem; font-family: var(--font-logo); text-align: center;
            z-index: 2000; box-shadow: 8px 8px 0px rgba(0,0,0,0.5);
            opacity: 0; transform: translate(-50%, -50%) scale(0.7);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none; border: 3px solid var(--black-stroke);
            display: none;
        }
        .feedback-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); display: block; }
        .feedback-popup.correct { color: var(--blyza-keppel-accent); }
        .feedback-popup.wrong { color: var(--blyza-quickfire-red); }
        .feedback-popup.winner { color: var(--blyza-sunny-yellow); }

        .confetti-piece { position: fixed; width: 10px; height: 20px; background-color: var(--blyza-orange-primary); opacity: 0; animation-timing-function: linear; animation-fill-mode: forwards; pointer-events: none; z-index: 3000; }
        @keyframes fallAndFade { 0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(120vh) rotate(720deg); opacity: 0; } }
        
        .game-over-buttons-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .game-over-button-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
        .treat-yourself-callout {
            margin-bottom: 8px; background-color: var(--blyza-sunny-yellow); color: var(--text-dark);
            padding: 8px 15px; border-radius: 20px; font-family: var(--font-heading-alt);
            font-size: 0.9rem; white-space: nowrap; box-shadow: var(--shadow-chunky);
            display: none; align-items: center; gap: 8px; z-index: 10;
            border: 2px solid var(--black-stroke);
        }
        .treat-yourself-callout i { font-size: 1.2em; animation: bounceArrow 1s infinite; }
        @keyframes bounceArrow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
                align-items: flex-start; /* Align game to top on mobile */
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .game-container { 
                padding: 45px 15px 15px; 
                max-height: calc(var(--app-height, 100vh) - 40px);
            } 
            h1 { font-size: 2.2rem; margin-top: 5px; }
            .game-mode-selection { flex-direction: column; align-items: center; }
            .mode-option { max-width: 100%; min-width: unset; }
            .instructions { padding: 15px; }
            .guess-inputs, .score-display { grid-template-columns: 1fr; }
            .icon-btn { width: 48px; height: 48px; }
            #settings-btn { top: 12px; right: 12px; }
            #highscore-btn { top: 12px; right: 70px; }
            #home-menu-btn, #back-btn { top: 12px; left: 12px; }
            .feedback-popup { font-size: 2rem; padding: 20px 30px; width: 90%; }
            .modal-content { padding: 20px; }
            .game-over-buttons-container { flex-direction: column; align-items: center; }
            .game-over-buttons-container .game-over-button-wrapper { width: 90%; }
            .game-over-buttons-container .game-over-button-wrapper button { width: 100%; }
            .item-image { max-height: 200px; }
            .tv-screen-container h3 { font-size: 1.5rem; }
            .price-display { font-size: 2rem; }
            .win-message { font-size: 2.2rem; }
            .bg-game-element { display: none; }
        }
    </style>
</head>
<body>
    <div class="hero-background-elements">
        <div class="bg-game-element bg-dollar-1"><i class="fas fa-dollar-sign"></i></div>
        <div class="bg-game-element bg-tag-1"><i class="fas fa-tag"></i></div>
        <div class="bg-game-element bg-cart-1"><i class="fas fa-shopping-cart"></i></div>
        <div class="bg-game-element bg-cash-1"><i class="fas fa-cash-register"></i></div>
        <div class="bg-game-element bg-dollar-2"><i class="fas fa-dollar-sign"></i></div>
        <div class="bg-game-element bg-tag-2"><i class="fas fa-tag"></i></div>
        <div class="bg-game-element bg-cart-2"><i class="fas fa-shopping-cart"></i></div>
        <div class="bg-game-element bg-gift-1"><i class="fas fa-gift"></i></div>
        <div class="bg-game-element bg-money-1"><i class="fas fa-money-bill-wave"></i></div>
        <div class="bg-game-element bg-tag-3"><i class="fas fa-tag"></i></div>
    </div>
    
    <script>
        // THIS SCRIPT MUST RUN FIRST
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>

    <div class="game-container">
        <!-- MODIFIED: The home button now links directly to your main site. -->
       <a href="https://www.playblyza.com/" id="home-menu-btn" class="icon-btn" aria-label="Back to Blyza Home">
            <i class="fas fa-home"></i>
        </a>
        <button id="back-btn" class="icon-btn" aria-label="Go Back">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="highscore-btn" class="icon-btn" aria-label="Show High Score">
            <i class="fas fa-star"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- NEW: Mode Selection Screen -->
        <div id="mode-selection-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Guess The Price</h1>
            <p class="instructions" style="border-style: solid; border-width: 2px;">Choose how you want to play!</p>
            <div class="game-mode-selection">
                <div id="local-play-btn" class="mode-option">
                    <i class="fas fa-couch"></i>
                    <h3>Local Play</h3>
                    <p>Play with friends on the same device.</p>
                </div>
                <div id="online-play-btn" class="mode-option">
                    <i class="fas fa-globe"></i>
                    <h3>Online Multiplayer</h3>
                    <p>Play with friends on different devices.</p>
                </div>
            </div>
        </div>

        <!-- This is the original start screen, now hidden by default -->
        <div id="start-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Guess The Price</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY (LOCAL):</strong></p>
                <ul>
                    <li><i class="fas fa-tag"></i> Guess the price of the displayed item</li>
                    <li><i class="fas fa-users"></i> Play with friends (up to 4 teams) or solo</li>
                    <li><i class="fas fa-trophy"></i> Closest guess gets a point - first to 5 wins!</li>
                    <li><i class="fas fa-user"></i> In single player, you get a point if your guess is within 15% of the actual price!</li>
                </ul>
            </div>
            <div class="game-mode-selection">
                <div class="mode-option selected" data-mode="single">
                    <i class="fas fa-user"></i>
                    <h3>Single Player</h3>
                    <p>5 rounds or infinite mode</p>
                </div>
                <div class="mode-option" data-mode="multi">
                    <i class="fas fa-users"></i>
                    <h3>Multiplayer</h3>
                    <p>Play with friends</p>
                </div>
            </div>
            <div id="single-player-sub-options" style="margin-top: 20px;">
                <button id="five-rounds-btn" class="btn-primary"><i class="fas fa-list-ol"></i> 5 Rounds</button>
                <button id="infinite-mode-btn" class="btn-primary"><i class="fas fa-infinity"></i> Infinite Mode</button>
            </div>
            <div id="multiplayer-start-area" style="display: none;">
                <div id="team-inputs-container">
                    <div class="team-inputs">
                        <h3>Enter Team Names</h3>
                        <div id="team-names-list">
                            <div class="team-input-wrapper">
                                <input type="text" class="team-name-input" placeholder="Team 1">
                            </div>
                            <div class="team-input-wrapper">
                                <input type="text" class="team-name-input" placeholder="Team 2">
                            </div>
                        </div>
                        <button id="add-team-btn">Add Team</button>
                    </div>
                </div>
                <button id="start-game-btn"><i class="fas fa-play"></i> Start Game</button>
            </div>
        </div>

        <!-- The rest of your game screens remain the same -->
        <div id="game-screen" class="screen">
            <div class="game-info">
                <div>
                    <span id="round-type-text">Round</span> <span id="round-number-text">1</span>
                    <span id="round-total-text">/5</span>
                </div>
                <div id="current-score-display" style="display:block;">
                    Score: <span id="current-score-value">0</span>/5
                </div>
            </div>
            <div class="item-stage-container">
                <div class="stage-curtains left"></div>
                <div class="stage-curtains right"></div>
                <div class="tv-screen-container">
                    <h3>What's the price of this item?</h3>
                    <div id="item-category-text" class="category-display"></div>
                    <img id="item-image-display" src="" alt="Item to guess price" class="item-image">
                </div>
            </div>
            <div id="guess-inputs-area" class="guess-inputs"></div>
            <button id="reveal-price-btn">Reveal Price <i class="fas fa-eye"></i></button>
        </div>
        <div id="results-screen" class="screen">
            <div class="result-item">
                <img id="result-item-image-display" src="" alt="Item" class="item-image">
                <div class="price-display">Actual Price: $<span id="actual-price-value">0</span></div>
                <div id="item-description-text"></div>
            </div>
            <div id="guess-results-area"></div>
            <div id="score-display-area" class="score-display"></div>
            <button id="next-round-btn">Next Round <i class="fas fa-arrow-right"></i></button>
        </div>
        <div id="game-over-screen" class="screen">
             <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1 id="game-over-title-text">Guess The Price</h1>
            <div class="win-message" id="win-message-text">Team Wins!</div>
            <div id="winner-trophy-display" class="winner-trophy">🏆</div>
            <div id="winner-details-text"></div>
            <div id="final-scores-area" class="score-display"></div>
            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                    <button id="play-again-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                </div>
                <div class="game-over-button-wrapper">
                     <button id="new-game-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper-id"> 
                    <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>
    <div id="audio-consent-modal" class="modal">
        <div class="modal-content">
            <h2>Enable Audio?</h2>
            <p>This game has background music and sound effects. Would you like to enable them for the best experience?</p>
            <div id="audio-consent-buttons">
                <button id="audio-consent-yes-btn" class="btn-success"><i class="fas fa-volume-up"></i> Yes, please!</button>
                <button id="audio-consent-no-btn" class="btn-secondary"><i class="fas fa-volume-mute"></i> No, thanks</button>
            </div>
        </div>
    </div>
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">×</span>
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="bgm-volume-slider">Background Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.3">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>
    <div id="feedback-popup" class="feedback-popup">
        <span id="feedback-message-text-el"></span>
    </div>

    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="reveal-correct-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="reveal-wrong-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="curtain-sound" src="https://static.wixstatic.com/mp3/9ce3e5_ccd36cdf98bf4e1594cf2e52d5296c51.wav"></audio>

        <script>
        const gameState = {
            players: [], currentRound: 1, scores: {}, gameMode: 'single', currentItem: null,
            singlePlayerSubType: '5rounds', // '5rounds' or 'infinite'
            items: [
            { name: "Smartphone", category: "iPhone 16 Pro Max 256GB", price: 1199, image: "https://static.wixstatic.com/media/9ce3e5_9686ddc0bdfe431e8f8a0ec574da5879~mv2.jpg", description: "The latest flagship smartphone from Apple with A18 Pro chip and titanium design." },
                { name: "Electric Car", category: "Tesla Cybertuck - Long Range", price: 69990, image: "https://static.wixstatic.com/media/9ce3e5_4cb87b6f65204052a9039c012f4dad19~mv2.jpg", description: "The Tesla Cybertruck Long Range is a rear-wheel-drive electric truck with 362 miles of range and a 0–60 mph time of 6.2 seconds." },
                { name: "Luxury Watch", category: "Rolex Submariner", price: 10200, image: "https://static.wixstatic.com/media/9ce3e5_effb6b5486004ab19eecb54c5bbe4f39~mv2.png", description: "Iconic dive watch with 300m water resistance and chronometer certification." },
                { name: "Gaming Console", category: "PlayStation 5", price: 499, image: "https://static.wixstatic.com/media/9ce3e5_8fa6c5a5016545deaa4ae3eaef4811d7~mv2.jpg", description: "Next-gen gaming console with ultra-high speed SSD and 4K graphics." },
                { name: "Beverage", category: "Starbucks Coffee", price: 4.95, image: "https://static.wixstatic.com/media/9ce3e5_5aa78f26264e445f9762b8782dad8f51~mv2.jpg", description: "Grande Caffè Latte from Starbucks coffee chain." },
                { name: "Sneakers", category: "Jordan 1 Retro Low OG SP 'Travis Scott Medium Olive - Retail Price", price: 150, image: "https://static.wixstatic.com/media/9ce3e5_93af5177c9ee492597563200a0b9ad55~mv2.jpg", description: "The infamous collaboration." },
                { name: "Laptop", category: "MacBook Pro 14-inch M4", price: 1599, image: "https://static.wixstatic.com/media/9ce3e5_72600804f6c34c0f9774a6d0b4cc7ed3~mv2.jpeg", description: "Powerful laptop with M4 max chip and Liquid Retina XDR display." },
                { name: "Fashion", category: "Gucci Women's slide sandal with Horsebit", price: 890, image: "https://static.wixstatic.com/media/9ce3e5_c8d7315c976d469b8294ea89b411ea01~mv2.png", description: "Cmon it's Gucci slides." },
                { name: "Fast Food", category: "Big Mac - USA", price: 5.29, image: "https://static.wixstatic.com/media/9ce3e5_9d8ffe7cc7614429b96b9c4c0bdbbf0d~mv2.jpg", description: "McDonald's signature burger without fries or a drink." },
                { name: "Event Ticket", category: "World Cup 2026 Finals Ticket", price: 3500, image: "https://static.wixstatic.com/media/9ce3e5_b09525c12a79463b9071b6261a2856e2~mv2.jpg", description: "Average price for a ticket to the grandest stage of them all." },
                { name: "Real Estate", category: "Villa in Nepal", price: 473000, image: "https://static.wixstatic.com/media/9ce3e5_6ed5214556b34acaa0207e7a1e2fb9ee~mv2.jpg", description: "A 2.5 storied House with 6 aana 5 paisa of land is for sale at Basundhara." },
                { name: "Trading Card", category: "PSA 10 CHARIZARD 1999 Pokemon Base Holo", price: 40000, image: "https://static.wixstatic.com/media/9ce3e5_e9bf7ac0e4ec40d88b71be7e495c704a~mv2.jpg", description: "Do you get the hype?." },
                { name: "Streaming", category: "Netflix Subscription - Standard", price: 17.99, image: "https://static.wixstatic.com/media/9ce3e5_00218da70cc043d7ab864312f2a2a468~mv2.jpg", description: "Standard monthly subscription with HD streaming." },
                { name: "Fashion", category: "Hermès Please Hold The Line scarf 90", price: 590, image: "https://static.wixstatic.com/media/9ce3e5_c91181b41abe4815900bc6f9de8bca49~mv2.png", description: "90cm x 90cm silk twill scarf in signature Hermès design." },
                { name: "Shopping", category: "1 week Groceries - Canada", price: 99, image: "https://static.wixstatic.com/media/9ce3e5_2bbcb25f21254dd291f567b2cddf19f8~mv2.jpg", description: "Rough times." },
                { name: "Advertisement", category: "NYC Billboard Advert - 1 Month", price: 20000, image: "https://static.wixstatic.com/media/9ce3e5_52b89f523f614aa1a79bc2bc6056f15a~mv2.jpg", description: "Is this worth it?" },
                { name: "Music", category: "Snoop Dog song feature", price: 250000, image: "https://static.wixstatic.com/media/9ce3e5_68b406be69df4b0fb611b3d933a548ee~mv2.jpg", description: "Don't smoke kids." },
                { name: "Scooter", category: "Bugatti 9.0 Electric Scooter", price: 1200, image: "https://static.wixstatic.com/media/9ce3e5_72c9919152b1450fa25d617595099ef8~mv2.png", description: "What color is your Bgatti?" },
                { name: "Planes", category: "Boeing 747-8", price: 386000000, image: "https://static.wixstatic.com/media/9ce3e5_0ac131e88f3e49049e8144baa3476c54~mv2.jpg", description: "Carries atleat 5 people." },
                { name: "MCU", category: "MARVEL Franchise Worth", price: 53000000000, image: "https://static.wixstatic.com/media/9ce3e5_1ac5f683a4cd4e768facbb16fd8f57cf~mv2.jpeg", description: "New mask, same task." },
                { name: "Storage", category: "100mb Floppy Disc at launch", price: 12.95, image: "https://static.wixstatic.com/media/9ce3e5_c520bd0d02e84b8e9e916e4c11786b92~mv2.jpg", description: "thats like 20 pictures." },
                { name: "Animals", category: "Cow in Australia", price: 2000, image: "https://static.wixstatic.com/media/9ce3e5_527cdab942cc4c8189b03d4623efc5c9~mv2.jpg", description: "MOOOOOOOOOO." },
                { name: "Painting", category: "Van Gogh Self potrait", price: 7200000, image: "https://static.wixstatic.com/media/9ce3e5_4e05a15e4a264361ad4648b8c60ecb9c~mv2.png", description: "Handsome lad." },
                { name: "Wages", category: "Japanese Minimum Hourly Wage", price: 7.35, image: "https://static.wixstatic.com/media/9ce3e5_580ca1edd33047e7a2a55a3047c5938c~mv2.jpg", description: "Its tough out there." },
                { name: "Product", category: "Pet Rock - The Original by Gary Dahl", price: 29.99, image: "https://static.wixstatic.com/media/9ce3e5_a4a18ed8e72e4aeda8ab3a740a6f55e1~mv2.png", description: "It's a cool rock tbf." },
                { name: "Product", category: "World's smallest Violin", price: 9, image: "https://static.wixstatic.com/media/9ce3e5_36aee2205e914dcfbe81dc3858290be3~mv2.png", description: "Probably has a good personality." },
                { name: "Product", category: "Pickle flavour Cotton Candy", price: 7.15, image: "https://static.wixstatic.com/media/9ce3e5_489ba2159b6f49a199eb12df9c291fab~mv2.png", description: "I HATE pickles!" },
                { name: "Product", category: "Emergency Underpants", price: 5.50, image: "https://static.wixstatic.com/media/9ce3e5_6fd4933a22d24030b20aa75c1d2e7dc0~mv2.png", description: "Could come in handy ngl." },
                { name: "Product", category: "Bacon flavoured Mints", price: 7.99, image: "https://static.wixstatic.com/media/9ce3e5_085d61d3b6184abbab7e7cd6990106e3~mv2.png", description: "Oink Oink!" },
                { name: "Experience", category: "Zero Gravity flight experience", price: 8500, image: "https://static.wixstatic.com/media/9ce3e5_10514695214d4417b458f530706ff8ba~mv2.png", description: "WFH moon." },
                { name: "Experience", category: "1 Hour Cuddle Therapy session", price: 150, image: "https://static.wixstatic.com/media/9ce3e5_0feabf7b66014205af62af01a979cb03~mv2.png", description: "I need this so badddd." },
                { name: "Tech", category: "Samsung Smart fridge with AI & 32 inch screen", price: 3199, image: "https://static.wixstatic.com/media/9ce3e5_45b612532a774ae590df332ea80968ac~mv2.png", description: "Absolutely no need of this." },
                { name: "Product", category: "Gold plated Toilet roll holder", price: 296, image: "https://static.wixstatic.com/media/9ce3e5_9e4e98ab8ce4417d84a1a248a9a8f978~mv2.png", description: "Bidet better" },
                { name: "History", category: "Dinosaur Poop Fossil", price: 34.99, image: "https://static.wixstatic.com/media/9ce3e5_f4b6b1b4e8664ef3a881d979d72e6203~mv2.png", description: "How is this a thing?" },
                { name: "Army", category: "Average yearly USA Military budget", price: 825000000000, image: "https://static.wixstatic.com/media/9ce3e5_353cb2c4e6754336a3eb5b922eaff87b~mv2.png", description: "Could buy so many Burgers with that!" },
                { name: "Country", category: "GDP of Uruguay", price: 80000000000, image: "https://static.wixstatic.com/media/9ce3e5_264a05dc2d2045db95de65448a4121b0~mv2.png", description: "Suarez is my favourite player" },
                { name: "Games", category: "GTA 5 total production budget", price: 265000000, image: "https://static.wixstatic.com/media/9ce3e5_f1e0494716af4f728b1a44193e7b0dc6~mv2.png", description: "GTA 5 before GTA 6 is crazy." },
                { name: "Product", category: "Ninja Backyard Pizaa oven", price: 299, image: "https://static.wixstatic.com/media/9ce3e5_9789582189794e2ca8071c46785b1cce~mv2.png", description: "Pepperoni is the best topping." },
                { name: "History", category: "Titanic construction cost", price: 7500000, image: "https://static.wixstatic.com/media/9ce3e5_2046e5ccdcf14a2db8006555eda5631d~mv2.png", description: "RIP." },
                { name: "Toys", category: "Eiffel Tower Lego set", price: 750, image: "https://static.wixstatic.com/media/9ce3e5_09b2496bae1043b3827d498662f1b495~mv2.png", description: "Could go to France for that much." },
                { name: "Food", category: "Private Chef - 1 Week average price", price: 400, image: "https://static.wixstatic.com/media/9ce3e5_0c5d7a09e1e24db289cf6a1b5e62b732~mv2.png", description: "Cooking is such a chore." },
                { name: "Experience", category: "Dubai Skydive Experience", price: 760, image: "https://static.wixstatic.com/media/9ce3e5_8434298381e546b18fbb4be4a0ebdeff~mv2.png", description: "Love the palm." },
                { name: "Furniture", category: "This table from Ikea", price: 520, image: "https://static.wixstatic.com/media/9ce3e5_c5a9b178e21f47b4b1d66a6bab5de036~mv2.png", description: "Joe Rogan's table" },
                { name: "Animal", category: "Chihuahua average purchase price", price: 850, image: "https://static.wixstatic.com/media/9ce3e5_6c51f9a5493a426dabe30036597720ec~mv2.png", description: "Ugly ahh" },
                { name: "Online", category: "Temu average product price", price: 13, image: "https://static.wixstatic.com/media/9ce3e5_42c7fbc95ec043fda69990d76b712418~mv2.png", description: "Goated site." },
                { name: "Money", category: "How much Jeff Bezos makes every Minute", price: 30000, image: "https://static.wixstatic.com/media/9ce3e5_3afa5a8ac7904e349eff3944fa5b6c9a~mv2.png", description: "Money is not real." },
                { name: "Money", category: "100 Pakistani Rupees in USD", price: 0.32, image: "https://static.wixstatic.com/media/9ce3e5_57e922e9ac0f4754b47f472a3125abaa~mv2.png", description: "My pledge is that I will be pilot." },],
            usedItems: [], currentGuesses: {}
        };
        
        let sfxEnabled = true, musicVolume = 0.3, audioContextStarted = false, infiniteHighScore = 0;
        
        // MODIFIED: Added the new mode selection screen to the list of screens
        const screens = {
            modeSelection: document.getElementById('mode-selection-screen'),
            start: document.getElementById('start-screen'),
            game: document.getElementById('game-screen'),
            results: document.getElementById('results-screen'),
            gameOver: document.getElementById('game-over-screen')
        };
        
        // Get all other DOM elements
        const modeOptions = document.querySelectorAll('.mode-option'), teamNamesList = document.getElementById('team-names-list'), addTeamBtn = document.getElementById('add-team-btn'), startGameBtn = document.getElementById('start-game-btn'), roundTypeText = document.getElementById('round-type-text'), roundNumberText = document.getElementById('round-number-text'), roundTotalText = document.getElementById('round-total-text'), currentScoreDisplay = document.getElementById('current-score-display'), currentScoreValue = document.getElementById('current-score-value'), leftCurtain = document.querySelector('.stage-curtains.left'), rightCurtain = document.querySelector('.stage-curtains.right'), itemCategoryText = document.getElementById('item-category-text'), itemImageDisplay = document.getElementById('item-image-display'), guessInputsArea = document.getElementById('guess-inputs-area'), revealPriceBtn = document.getElementById('reveal-price-btn'), resultItemImageDisplay = document.getElementById('result-item-image-display'), actualPriceValueEl = document.getElementById('actual-price-value'), itemDescriptionText = document.getElementById('item-description-text'), guessResultsArea = document.getElementById('guess-results-area'), scoreDisplayArea = document.getElementById('score-display-area'), nextRoundBtn = document.getElementById('next-round-btn'), gameOverTitleText = document.getElementById('game-over-title-text'), winMessageText = document.getElementById('win-message-text'), winnerTrophyDisplay = document.getElementById('winner-trophy-display'), winnerDetailsText = document.getElementById('winner-details-text'), finalScoresArea = document.getElementById('final-scores-area'), playAgainBtn = document.getElementById('play-again-btn'), newGameBtn = document.getElementById('new-game-btn'), visitStoreBtn = document.getElementById('visit-store-btn'), storeButtonWrapper = document.getElementById('store-button-wrapper-id'), settingsBtn = document.getElementById('settings-btn'), homeMenuBtn = document.getElementById('home-menu-btn'), backBtn = document.getElementById('back-btn'), settingsModal = document.getElementById('settings-modal'), closeModalBtn = document.getElementById('close-modal-btn'), bgmVolumeSlider = document.getElementById('bgm-volume-slider'), sfxToggleBtn = document.getElementById('sfx-toggle-btn'), backgroundMusic = document.getElementById('background-game-music');
        const allSfx = [document.getElementById('start-game-sound'), document.getElementById('interaction-sound'), document.getElementById('reveal-correct-sound'), document.getElementById('reveal-wrong-sound'), document.getElementById('curtain-sound')];
        const feedbackPopup = document.getElementById('feedback-popup'), feedbackMessageTextEl = document.getElementById('feedback-message-text-el');
        const highscoreBtn = document.getElementById('highscore-btn');
        const singlePlayerSubOptions = document.getElementById('single-player-sub-options');
        const multiplayerStartArea = document.getElementById('multiplayer-start-area');
        const fiveRoundsBtn = document.getElementById('five-rounds-btn');
        const infiniteModeBtn = document.getElementById('infinite-mode-btn');
        let treatYourselfElement = null;
        const audioConsentModal = document.getElementById('audio-consent-modal');
        const audioConsentYesBtn = document.getElementById('audio-consent-yes-btn');
        const audioConsentNoBtn = document.getElementById('audio-consent-no-btn');

        // NEW: Get the mode selection buttons
        const localPlayBtn = document.getElementById('local-play-btn');
        const onlinePlayBtn = document.getElementById('online-play-btn');

        function initAudio() {
            if (audioContextStarted) return;
            backgroundMusic.play().then(() => {
                audioContextStarted = true;
                if (musicVolume <= 0 || document.hidden) {
                    backgroundMusic.pause();
                }
            }).catch(e => {
                console.warn("Audio autoplay was blocked by the browser. Waiting for user interaction.", e);
            });
        }
        
        function playSound(audioElement) { 
            if (sfxEnabled && audioElement && audioContextStarted) { 
                audioElement.pause();
                audioElement.currentTime = 0; 
                audioElement.play().catch(e => {}); 
            } 
        }

        function playSoundWithCallback(audioElement, callback, ...args) { 
            if (sfxEnabled && audioElement && audioContextStarted) {
                audioElement.pause();
                audioElement.currentTime = 0;
                let cbExecuted = false;
                const execCb = () => {
                    if (!cbExecuted) {
                        cbExecuted = true;
                        audioElement.removeEventListener('ended', execCb);
                        if (callback) callback(...args);
                    }
                };
                audioElement.addEventListener('ended', execCb);
                audioElement.play().catch(e => { execCb(); });
            } else { 
                if (callback) callback(...args);
            }
        }
        
        let feedbackTimeout; function showFeedbackMessage(message, type = '', duration = 2500) { feedbackMessageTextEl.textContent = message; feedbackPopup.className = 'feedback-popup'; if (type) feedbackPopup.classList.add(type); feedbackPopup.classList.add('show'); clearTimeout(feedbackTimeout); feedbackTimeout = setTimeout(() => { feedbackPopup.classList.remove('show'); }, duration); }
        function triggerConfetti() { const colors = ['var(--blyza-orange-primary)', 'var(--blyza-purple-secondary)', 'var(--blyza-keppel-accent)', 'var(--blyza-sunny-yellow)']; for (let i = 0; i < 100; i++) { const confetti = document.createElement('div'); confetti.classList.add('confetti-piece'); confetti.style.left = Math.random() * 100 + 'vw'; confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]; const animDuration = Math.random() * 3 + 2; confetti.style.animationName = 'fallAndFade'; confetti.style.animationDuration = animDuration + 's'; confetti.style.animationDelay = Math.random() * 1 + 's'; document.body.appendChild(confetti); setTimeout(() => confetti.remove(), (animDuration + 1) * 1000); } }
        
        function loadAudioSettings() { 
            const savedVol = localStorage.getItem('musicVolume');
            const savedSfx = localStorage.getItem('sfxEnabled');
            if (savedVol !== null) musicVolume = parseFloat(savedVol); 
            if (savedSfx !== null) sfxEnabled = savedSfx === 'true'; 
            backgroundMusic.volume = musicVolume; 
            bgmVolumeSlider.value = musicVolume; 
            sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`; 
        }

        function loadHighScore() { const savedScore = localStorage.getItem('gtp_infinite_highscore'); infiniteHighScore = savedScore ? parseInt(savedScore, 10) : 0; }
        function saveHighScore(score) { if (score > infiniteHighScore) { infiniteHighScore = score; localStorage.setItem('gtp_infinite_highscore', infiniteHighScore); } }
        function showHighScore() { playSound(allSfx[1]); showFeedbackMessage(`Infinite High Score: ${infiniteHighScore}`, 'winner', 3000); }

        function handleVisibilityChange() {
            if (!audioContextStarted) return;
            if (document.hidden) {
                backgroundMusic.pause();
            } else if (musicVolume > 0) {
                backgroundMusic.play().catch(e => {});
            }
        }
        
        function handlePageShow(event) {
            if (event.persisted) {
                setAppHeight(); 
                newGame();
            }
        }

        // MODIFIED: This function now takes the user back to the mode selection screen.
        function newGame() { 
            playSound(allSfx[1]);
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens.modeSelection.classList.add('active'); 
            
            backBtn.style.display = 'none'; 
            homeMenuBtn.style.display = 'flex'; 
            highscoreBtn.style.display = 'none'; // Hide high score button on main menu
            if (treatYourselfElement) treatYourselfElement.style.display = 'none'; 
        }
        
        settingsBtn.addEventListener('click', () => { playSound(allSfx[1]); settingsModal.style.display = 'flex'; });
        closeModalBtn.addEventListener('click', () => { playSound(allSfx[1]); settingsModal.style.display = 'none'; });
        
        bgmVolumeSlider.addEventListener('input', (e) => { 
            musicVolume = parseFloat(e.target.value); 
            backgroundMusic.volume = musicVolume; 
            localStorage.setItem('musicVolume', musicVolume); 
            if (musicVolume > 0 && !document.hidden && audioContextStarted) { backgroundMusic.play(); } else { backgroundMusic.pause(); } 
        });
        
        sfxToggleBtn.addEventListener('click', () => { 
            sfxEnabled = !sfxEnabled; 
            sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`; 
            playSound(allSfx[1]); 
            localStorage.setItem('sfxEnabled', sfxEnabled); 
        });
        
        // --- NEW: Event listeners for the new mode selection buttons ---
        localPlayBtn.addEventListener('click', () => {
            playSound(allSfx[1]);
            initAudio(); // Initialize audio context on first interaction
            screens.modeSelection.classList.remove('active');
            screens.start.classList.add('active');
            highscoreBtn.style.display = 'flex'; // Show high score button for local play
        });

        onlinePlayBtn.addEventListener('click', () => {
            playSound(allSfx[1]);
            window.location.href = 'https://blyzatest.vercel.app/games/guess-the-price';
        });

        // --- OLD EVENT LISTENERS (still needed for local play) ---
        modeOptions.forEach(option => { option.addEventListener('click', function() { playSound(allSfx[1]); selectGameMode.call(this); }); });
        addTeamBtn.addEventListener('click', () => { playSound(allSfx[1]); addTeamInputField(); });
        startGameBtn.addEventListener('click', () => { playSoundWithCallback(allSfx[0], actualStartGame); });
        revealPriceBtn.addEventListener('click', revealPrice);
        playAgainBtn.addEventListener('click', () => { playSoundWithCallback(allSfx[0], playAgain); });
        newGameBtn.addEventListener('click', newGame);
        backBtn.addEventListener('click', newGame);
        visitStoreBtn.addEventListener('click', () => { playSound(allSfx[1]); window.location.href = '/store'; }); 
        highscoreBtn.addEventListener('click', showHighScore);
        fiveRoundsBtn.addEventListener('click', () => startSinglePlayerGame('5rounds'));
        infiniteModeBtn.addEventListener('click', () => startSinglePlayerGame('infinite'));

        document.addEventListener('DOMContentLoaded', () => { 
            loadAudioSettings(); 
            loadHighScore(); 
            // MODIFIED: No need to initialize local game stuff here anymore. newGame() handles the screen.
            newGame();

            audioConsentModal.style.display = 'flex';
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('pageshow', handlePageShow);
        });

        audioConsentYesBtn.addEventListener('click', () => {
            audioConsentModal.style.display = 'none';
            // We only *try* to init audio here. It won't play until a real click happens on a game button.
            initAudio();
            playSound(allSfx[1]);
        });

        audioConsentNoBtn.addEventListener('click', () => {
            audioConsentModal.style.display = 'none';
            sfxEnabled = false;
            musicVolume = 0;
            backgroundMusic.volume = 0;
            bgmVolumeSlider.value = 0;
            sfxToggleBtn.textContent = 'SFX: OFF';
            localStorage.setItem('sfxEnabled', 'false');
            localStorage.setItem('musicVolume', '0');
            initAudio();
        });

        // --- ALL YOUR EXISTING LOCAL GAME LOGIC FUNCTIONS BELOW, UNCHANGED ---
        function startSinglePlayerGame(subType) {
            gameState.singlePlayerSubType = subType;
            playSoundWithCallback(allSfx[0], actualStartGame);
        }

        function selectGameMode() { modeOptions.forEach(o => o.classList.remove('selected')); this.classList.add('selected'); gameState.gameMode = this.dataset.mode; const isMulti = gameState.gameMode === 'multi'; multiplayerStartArea.style.display = isMulti ? 'block' : 'none'; singlePlayerSubOptions.style.display = isMulti ? 'none' : 'block'; if (isMulti) updateTeamRemoveButtonsState(); }
        function addTeamInputField() { if (teamNamesList.querySelectorAll('.team-input-wrapper').length >= 4) return; const w = document.createElement('div'); w.className = 'team-input-wrapper'; const i = document.createElement('input'); i.type = 'text'; i.className = 'team-name-input'; i.placeholder = `Team ${teamNamesList.children.length + 1}`; const r = document.createElement('button'); r.className = 'remove-team-btn'; r.innerHTML = '<i class="fas fa-times"></i>'; r.onclick = () => { playSound(allSfx[1]); w.remove(); updateTeamRemoveButtonsState(); }; w.append(i, r); teamNamesList.appendChild(w); updateTeamRemoveButtonsState(); }
        function updateTeamRemoveButtonsState() { const wrappers = teamNamesList.querySelectorAll('.team-input-wrapper'); addTeamBtn.disabled = wrappers.length >= 4; wrappers.forEach((w, i) => { let r = w.querySelector('.remove-team-btn'); if(i < 2 && r) r.remove(); else if(i >= 2 && !r){ const nr = document.createElement('button'); nr.className='remove-team-btn'; nr.innerHTML='<i class="fas fa-times"></i>'; nr.onclick=()=>{playSound(allSfx[1]); w.remove(); updateTeamRemoveButtonsState();}; w.appendChild(nr); r = nr; } if(r) r.disabled = wrappers.length <= 2; }); }
        
        function actualStartGame() {
            if (gameState.gameMode === 'single') {
                gameState.players = ['You'];
                gameState.scores = { 'You': 0 };
                if (gameState.singlePlayerSubType === 'infinite') {
                    roundTypeText.textContent = 'Score';
                    roundNumberText.textContent = '0';
                    roundTotalText.textContent = '';
                    currentScoreDisplay.style.display = 'none';
                } else {
                    roundTypeText.textContent = 'Round';
                    roundTotalText.textContent = '/5';
                    currentScoreDisplay.style.display = 'block';
                }
            } else { 
                gameState.players = Array.from(teamNamesList.querySelectorAll('.team-name-input')).map((i, idx) => i.value.trim() || `Team ${idx + 1}`);
                if (gameState.players.length < 2) return alert('You need at least 2 teams for multiplayer!');
                gameState.scores = {};
                gameState.players.forEach(p => gameState.scores[p] = 0);
                roundTypeText.textContent = 'Round';
                roundTotalText.textContent = '';
                currentScoreDisplay.style.display = 'none';
            }
            gameState.currentRound = 1; gameState.usedItems = []; gameState.currentGuesses = {};
            screens.start.classList.remove('active'); screens.game.classList.add('active');
            homeMenuBtn.style.display = 'none'; backBtn.style.display = 'flex';
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            setupRound();
        }

        function setupRound() {
            leftCurtain.classList.remove('open'); rightCurtain.classList.remove('open');
            itemImageDisplay.style.opacity = 0; itemCategoryText.style.opacity = 0;
            let available = gameState.items.filter(i => !gameState.usedItems.includes(i.name));
            if (available.length === 0) { gameState.usedItems = []; available = [...gameState.items]; }
            gameState.currentItem = available[Math.floor(Math.random() * available.length)];
            gameState.usedItems.push(gameState.currentItem.name);

            if (gameState.gameMode === 'single') {
                if (gameState.singlePlayerSubType === 'infinite') {
                    roundNumberText.textContent = gameState.scores['You'];
                } else {
                    roundNumberText.textContent = gameState.currentRound;
                    currentScoreValue.textContent = gameState.scores['You'];
                }
            } else {
                roundNumberText.textContent = gameState.currentRound;
            }
            
            itemCategoryText.textContent = gameState.currentItem.category;
            itemImageDisplay.src = gameState.currentItem.image;
            itemImageDisplay.alt = gameState.currentItem.name;
            guessInputsArea.innerHTML = '';
            gameState.players.forEach((p, i) => { const ig = document.createElement('div'); ig.className = 'guess-input-group'; ig.innerHTML = `<div class="guess-label">${(gameState.gameMode === 'single' ? 'Your' : p + "'s")} guess:</div><div class="guess-input-container"><div class="dollar-sign">$</div><input type="number" class="price-input" placeholder="0.00" min="0" step="0.01" data-player-index="${i}"></div>`; guessInputsArea.appendChild(ig); });
            document.querySelectorAll('.price-input').forEach(i => i.addEventListener('focus', () => playSound(allSfx[1])));
            
            nextRoundBtn.textContent = 'Next Round';
            nextRoundBtn.onclick = () => { playSound(allSfx[1]); nextRound(); };

            setTimeout(() => { playSound(allSfx[4]); leftCurtain.classList.add('open'); rightCurtain.classList.add('open'); setTimeout(() => { itemImageDisplay.style.transition = 'opacity 0.5s ease'; itemCategoryText.style.transition = 'opacity 0.5s ease'; itemImageDisplay.style.opacity = 1; itemCategoryText.style.opacity = 1; }, 700); }, 500);
        }

        function revealPrice() { gameState.currentGuesses = {}; let valid = true; document.querySelectorAll('.price-input').forEach(i => { const pName = gameState.players[i.dataset.playerIndex], val = parseFloat(i.value); if (isNaN(val) || val < 0) { valid = false; i.classList.add('error'); } else { i.classList.remove('error'); gameState.currentGuesses[pName] = val; } }); if (!valid) return alert('Please enter valid price guesses for all players!'); screens.game.classList.remove('active'); screens.results.classList.add('active'); backBtn.style.display = 'flex'; showResults(); }
        
        function showResults() {
            resultItemImageDisplay.src = gameState.currentItem.image;
            actualPriceValueEl.textContent = gameState.currentItem.price.toLocaleString('en-US', { style: 'decimal', minimumFractionDigits: 2, maximumFractionDigits: 2 });
            itemDescriptionText.textContent = `${gameState.currentItem.name}: ${gameState.currentItem.description}`;
            guessResultsArea.innerHTML = '';

            let isGameOver = false;
            let beatTheGame = false;
            let playerWasCorrect = false;

            if (gameState.gameMode === 'single') {
                const guess = gameState.currentGuesses['You'];
                const diff = Math.abs(guess - gameState.currentItem.price);
                const card = document.createElement('div');
                card.className = 'guess-result';
                card.innerHTML = `<div><b>You</b></div><div>Guessed: $${guess.toLocaleString(undefined, {minimumFractionDigits: 2})}</div><div class="difference-display">Difference: $${diff.toLocaleString(undefined, {minimumFractionDigits: 2})}</div>`;
                guessResultsArea.appendChild(card);
                
                playerWasCorrect = (diff / gameState.currentItem.price) <= 0.15;
                if (playerWasCorrect) {
                    gameState.scores['You']++;
                    card.classList.add('closest-guess');
                    card.innerHTML += `<div class="winner-badge"><i class="fas fa-trophy"></i> Within 15%! +1 point</div>`;
                    playSound(allSfx[2]);
                    showFeedbackMessage("Correct!", "correct");
                    if (gameState.singlePlayerSubType === 'infinite' && gameState.usedItems.length >= gameState.items.length) {
                        isGameOver = true;
                        beatTheGame = true;
                    }
                } else {
                    playSound(allSfx[3]);
                    showFeedbackMessage("Incorrect!", "wrong");
                    if (gameState.singlePlayerSubType === 'infinite') {
                        isGameOver = true;
                    }
                }
                currentScoreValue.textContent = gameState.scores['You'];
            } else { // Multiplayer logic
                let closestPlayer = null, smallestDiff = Infinity;
                Object.entries(gameState.currentGuesses).forEach(([p, g]) => { const diff = Math.abs(g - gameState.currentItem.price); if (diff < smallestDiff) { smallestDiff = diff; closestPlayer = p; } else if (diff === smallestDiff) { closestPlayer = null; } const card = document.createElement('div'); card.className = 'guess-result'; card.innerHTML = `<div><b>${p}</b></div><div>Guessed: $${g.toLocaleString(undefined, {minimumFractionDigits: 2})}</div><div class="difference-display">Difference: $${diff.toLocaleString(undefined, {minimumFractionDigits: 2})}</div>`; guessResultsArea.appendChild(card); });
                if (closestPlayer) { const idx = gameState.players.indexOf(closestPlayer); if(idx !== -1) { guessResultsArea.children[idx].classList.add('closest-guess'); guessResultsArea.children[idx].innerHTML += `<div class="winner-badge"><i class="fas fa-trophy"></i> Closest Guess! +1 point</div>`; gameState.scores[closestPlayer]++; playSound(allSfx[2]); showFeedbackMessage(`${closestPlayer} is Closest!`, "winner"); } } else { showFeedbackMessage("It's a Close Call!", "", 2000); }
            }
            
            updateScoreDisplay();

            if (isGameOver || (gameState.singlePlayerSubType === '5rounds' && gameState.currentRound >= 5) || (gameState.gameMode === 'multi' && Math.max(...Object.values(gameState.scores)) >= 5)) {
                isGameOver = true;
            }
            
            if (isGameOver) {
                if (beatTheGame) {
                    nextRoundBtn.textContent = 'You Beat The Game!';
                } else if (gameState.singlePlayerSubType === 'infinite') {
                    nextRoundBtn.textContent = 'See Final Score';
                } else {
                    nextRoundBtn.textContent = 'See Final Results';
                }
                nextRoundBtn.onclick = () => { playSound(allSfx[1]); showGameOver(); };
            }
        }
        function updateScoreDisplay() { scoreDisplayArea.innerHTML = ''; Object.entries(gameState.scores).forEach(([n, s]) => { const card = document.createElement('div'); card.className = 'score-card'; card.innerHTML = `<h4>${n}</h4><div class="text-2xl font-bold">${s}</div><div class="progress-bar"><div class="progress-fill" style="width: ${s/5*100}%"></div></div>`; scoreDisplayArea.appendChild(card); }); }
        
        function nextRound() {
            gameState.currentRound++;
            screens.results.classList.remove('active');
            screens.game.classList.add('active');
            backBtn.style.display = 'flex';
            setupRound();
        }
        
        function showGameOver() {
            screens.results.classList.remove('active');
            screens.gameOver.classList.add('active');
            backBtn.style.display = 'none';
            homeMenuBtn.style.display = 'flex';
            triggerConfetti();
            if (!treatYourselfElement) { treatYourselfElement = document.createElement('div'); treatYourselfElement.className = 'treat-yourself-callout'; treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`; storeButtonWrapper.insertBefore(treatYourselfElement, visitStoreBtn); } treatYourselfElement.style.display = 'flex';
            
            const score = gameState.scores['You'];
            if (gameState.gameMode === 'single') {
                if (gameState.singlePlayerSubType === 'infinite') {
                    const beatTheGame = (gameState.usedItems.length >= gameState.items.length) && ((Math.abs(gameState.currentGuesses['You'] - gameState.currentItem.price) / gameState.currentItem.price) <= 0.15);
                    saveHighScore(score);
                    let isNewHighScore = score > infiniteHighScore && score === parseInt(localStorage.getItem('gtp_infinite_highscore'), 10);
                    
                    if (beatTheGame) {
                        winMessageText.textContent = "You Beat The Game!";
                        winnerDetailsText.innerHTML = `You correctly guessed all ${gameState.items.length} items! <br> Final Score: ${score}. ${isNewHighScore ? '<strong>New High Score!</strong>' : ''}`;
                        winnerTrophyDisplay.textContent = '👑';
                    } else {
                        winMessageText.textContent = "Game Over!";
                        winnerDetailsText.innerHTML = `Your Score: ${score}. ${isNewHighScore ? '<strong>New High Score!</strong>' : `High Score: ${infiniteHighScore}`}`;
                        winnerTrophyDisplay.textContent = isNewHighScore ? '🏆' : '👍';
                    }
                } else { // 5-rounds mode
                    winMessageText.textContent = "Game Over!";
                    winnerDetailsText.textContent = `You scored ${score} out of 5.`;
                    winnerTrophyDisplay.textContent = score <= 1 ? '🗑️' : score <= 3 ? '🥈' : '🏆';
                }
            } else { // Multiplayer mode
                const maxScore = Math.max(...Object.values(gameState.scores));
                const winners = Object.keys(gameState.scores).filter(p => gameState.scores[p] === maxScore);
                winMessageText.textContent = winners.length > 1 ? "It's a Tie!" : `${winners[0]} Wins!`;
                winnerDetailsText.textContent = `Congratulations on reaching ${maxScore} points!`;
                winnerTrophyDisplay.textContent = '🏆';
            }

            finalScoresArea.innerHTML = '';
            const maxFinalScore = Math.max(...Object.values(gameState.scores));
            Object.entries(gameState.scores).forEach(([n, s]) => {
                const card = document.createElement('div');
                card.className = `score-card ${s === maxFinalScore && maxFinalScore > 0 ? 'winner-glow' : ''}`;
                card.innerHTML = `<h4>${n}</h4><div class="text-3xl font-bold">${s}</div>`;
                finalScoresArea.appendChild(card);
            });
        }
        function playAgain() { screens.gameOver.classList.remove('active'); screens.game.classList.add('active'); backBtn.style.display = 'flex'; if (treatYourselfElement) treatYourselfElement.style.display = 'none'; gameState.currentRound = 1; gameState.usedItems = []; Object.keys(gameState.scores).forEach(k => gameState.scores[k] = 0); setupRound(); }

        // --- CUSTOM SCROLL REDIRECTION LOGIC ---
        const gameContainerForScroll = document.querySelector('.game-container');
        let lastTouchY = 0;

        window.addEventListener('wheel', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                gameContainerForScroll.scrollTop += e.deltaY;
            }
        }, { passive: true });

        window.addEventListener('touchstart', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                if (e.touches.length > 0) {
                    lastTouchY = e.touches[0].clientY;
                }
            }
        }, { passive: true });

        window.addEventListener('touchmove', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                e.preventDefault(); 
                if (e.touches.length > 0) {
                    const currentTouchY = e.touches[0].clientY;
                    const deltaY = lastTouchY - currentTouchY;
                    gameContainerForScroll.scrollTop += deltaY;
                    lastTouchY = currentTouchY;
                }
            }
        }, { passive: false });
        // --- END OF CUSTOM SCROLL LOGIC ---
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-N5PBKM0DNQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N5PBKM0DNQ');
</script>

</body>
</html>