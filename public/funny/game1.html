<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess The Price - Game Show Edition!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300..700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary: #FF8833; /* Blyza Orange */
            --secondary: #CB7AE1; /* Blyza Purple */
            --light: #F2F2F2;
            --success: #00BFA6; /* Blyza Keppel */
            --danger: #ff4b2b;
            --dark: #1a1c20;
            --darker: #0f1012;
            --info: #4ECDC4; 
            --gold: #FFD700; /* Game show gold */
            --stage-bg: #2c3e50; /* Dark blueish stage background */
            --curtain-color: #c0392b; /* Deep red for curtains */
            --spotlight-color: rgba(255, 223, 0, 0.6); /* Gold spotlight */
        }
        
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .game-container {
            max-width: 900px;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px; 
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .brand-logo {
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .brand-logo-prominent {
            display: block;
            margin: 0 auto 20px;
            max-height: 80px;
        }
        
        h1 {
            font-family: "Luckiest Guy", cursive;
            font-size: 3rem;
            margin-bottom: 30px;
            color: var(--gold); 
            text-shadow: 
                0 2px 0px #000, 
                0 4px 6px rgba(0, 0, 0, 0.5),
                0 0 30px var(--primary); 
            letter-spacing: 1px;
            margin-top: 10px; 
        }
        
        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .active {
            display: block;
        }
        
        .instructions {
            font-family: "Quicksand", sans-serif;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            line-height: 1.8;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .instructions p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--light);
        }
        
        .instructions ul {
            list-style-type: none;
            text-align: left;
            padding: 0 20px;
        }
        
        .instructions li {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            color: var(--light);
        }
        
        .instructions i {
            margin-right: 15px;
            font-size: 1.4em;
            color: var(--primary);
        }
        
        .game-mode-selection {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }
        
        .mode-option {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
            flex: 1;
            max-width: 300px;
        }
        
        .mode-option:hover {
            transform: translateY(-5px) scale(1.05);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2), 0 0 15px var(--secondary);
            border-color: var(--secondary);
        }
        
        .mode-option.selected {
            border: 2px solid var(--primary);
            background: rgba(255, 136, 51, 0.15);
            box-shadow: 
                0 0 25px rgba(255, 136, 51, 0.3),
                inset 0 0 15px rgba(255, 136, 51, 0.15);
            transform: scale(1.02);
        }
        
        .mode-option i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .mode-option h3 {
            margin-bottom: 10px;
            font-size: 1.4rem;
            color: var(--light);
            font-family: "Bungee", cursive;
        }
        
        .mode-option p {
            color: rgba(242, 242, 242, 0.7);
            font-size: 1.1rem;
        }
        
        .team-inputs {
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .team-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .team-input-wrapper input {
            flex-grow: 1;
            padding: 15px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            transition: all 0.3s ease;
        }
        
        .team-input-wrapper input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 10px rgba(203, 122, 225, 0.2);
        }
        .remove-team-btn {
            background: var(--danger);
            color: var(--light);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .remove-team-btn:hover {
            background: #cc3c22;
        }
        .remove-team-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px; 
            background: rgba(0, 0, 0, 0.2);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1.1rem; 
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: "Orbitron", sans-serif; 
            color: var(--gold);
        }
        .game-info span {
            text-shadow: 0 0 5px var(--primary);
        }

        /* --- GAME SHOW STAGE --- */
        .item-stage-container {
            background: var(--stage-bg);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 3px solid var(--gold);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden; 
        }
        .item-stage-container::before, .item-stage-container::after { 
            content: '';
            position: absolute;
            top: -50px;
            width: 200px;
            height: 300px;
            background: radial-gradient(ellipse at center, var(--spotlight-color) 0%, transparent 70%);
            pointer-events: none;
            opacity: 0.7;
        }
        .item-stage-container::before {
            left: -50px;
            transform: rotate(-30deg);
        }
        .item-stage-container::after {
            right: -50px;
            transform: rotate(30deg);
        }

        .stage-curtains {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            background-color: var(--curtain-color);
            background-image: linear-gradient(rgba(0,0,0,0.2) 50%, transparent 50%),
                              linear-gradient(90deg, rgba(0,0,0,0.2) 50%, transparent 50%);
            background-size: 50px 50px; 
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 5;
        }
        .stage-curtains.left {
            left: 0;
            border-right: 3px solid #a52a20; 
        }
        .stage-curtains.right {
            right: 0;
            border-left: 3px solid #a52a20;
        }
        .stage-curtains.open.left {
            transform: translateX(-100%);
        }
        .stage-curtains.open.right {
            transform: translateX(100%);
        }

        .tv-screen-container {
            background: #111;
            border: 10px solid #333;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            z-index: 1; 
            min-height: 300px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .item-image {
            max-height: 300px; 
            max-width: 90%;
            object-fit: contain;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: block; 
        }
        
        .category-display {
            font-family: "Bungee", cursive;
            color: var(--primary);
            margin: 10px 0;
            font-size: 1.3rem;
            text-shadow: 0 1px 2px #000;
        }
        .tv-screen-container h3 { 
            font-family: "Luckiest Guy", cursive;
            color: var(--gold);
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 3px #000;
        }
        /* --- END GAME SHOW STAGE --- */
        
        .guess-inputs {
            display: grid;
            gap: 20px;
            margin: 30px 0;
        }
        
        .guess-input-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .guess-label {
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--light);
            font-family: "Bungee", cursive;
        }
        
        .guess-input-container {
            display: flex;
            gap: 0px;
        }
        
        .dollar-sign {
            background: rgba(0,0,0, 0.3);
            padding: 15px 20px;
            border-radius: 12px 0 0 12px;
            font-weight: bold;
            color: var(--gold);
            display: flex;
            align-items: center;
            font-family: "Orbitron", sans-serif;
        }
        
        .price-input {
            flex: 1;
            padding: 15px 20px;
            border: none; 
            background: rgba(0,0,0, 0.2);
            border-radius: 0 12px 12px 0;
            color: var(--light);
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border-left: none;
            font-family: "Orbitron", sans-serif;
        }
        .price-input.error {
            outline: 2px solid var(--danger) !important;
            box-shadow: 0 0 10px var(--danger);
        }
        
        .price-input:focus {
            outline: none;
            background: rgba(0,0,0, 0.25);
            box-shadow: 0 0 10px var(--secondary);
        }
        
        .result-item { 
            background: rgba(0,0,0, 0.2);
            padding: 20px; 
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid var(--gold);
            box-shadow: 0 0 15px var(--gold);
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
        }
        .result-item .item-image { 
            max-height: 200px; 
            margin-bottom: 15px; 
        }
        
        .price-display {
            font-size: 2.5rem; 
            color: var(--success); 
            margin: 15px 0; 
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.4), 0 0 10px var(--success);
            font-family: "Orbitron", sans-serif;
        }
        .price-display span { animation: pricePulse 1.5s infinite; }

        @keyframes pricePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        #item-description-text { 
            font-size: 0.9rem; 
            color: rgba(242,242,242,0.8); 
            margin-top: 10px;
            max-width: 80%; 
        }

        .guess-result {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .guess-result.closest-guess {
            border: 2px solid var(--success);
            background: rgba(0, 191, 166, 0.15);
            box-shadow: 0 0 20px rgba(0, 191, 166, 0.3);
            transform: scale(1.03);
        }
        .winner-badge {
            color: var(--success);
            font-weight: bold;
            margin-top: 10px;
            font-family: "Bungee", cursive;
            text-shadow: 0 0 5px var(--success);
        }
        
        .difference-display {
            color: var(--secondary);
            font-size: 1rem;
            margin-top: 8px;
            font-family: "Orbitron", sans-serif;
        }
        
        .score-display {
            display: grid;
            gap: 20px;
            margin: 30px 0;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .score-card {
            background: rgba(0,0,0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--gold);
            transition: all 0.3s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        .score-card h4 { font-family: "Bungee", cursive; color: var(--primary); }
        .score-card .text-2xl { font-family: "Orbitron", sans-serif; color: var(--light); }
        
        .score-card.winner-glow {
            animation: winnerGlow 1.5s infinite alternate;
            border: 2px solid var(--success);
        }
        
        @keyframes winnerGlow {
            from { box-shadow: 0 0 20px rgba(0, 191, 166, 0.3), 0 0 10px var(--gold); }
            to { box-shadow: 0 0 35px rgba(0, 191, 166, 0.6), 0 0 20px var(--gold); }
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 15px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--gold) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 8px var(--primary);
        }
        
        button {
            background: linear-gradient(135deg, var(--primary) 0%, #ff7711 100%);
            color: var(--light);
            border: 2px solid var(--darker); 
            padding: 15px 25px; 
            font-size: 1rem; 
            border-radius: 50px; 
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), inset 0 -2px 5px rgba(0,0,0,0.2);
            margin: 10px 5px;
            font-family: "Bungee", cursive; 
            text-shadow: 1px 1px 2px #000;
            flex-shrink: 0; 
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--primary);
            background: linear-gradient(135deg, #ff7711 0%, var(--primary) 100%);
        }
        
        button:active:not(:disabled) {
            transform: translateY(-1px) scale(1.02);
        }
        button:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .btn-primary { /* Already styled above */ }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #00a890 100%);
        }
        .btn-success:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--success); }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #ff416c 100%);
        }
        .btn-danger:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--danger); }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #b85cd6 100%);
        }
        .btn-secondary:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--secondary); }

        .btn-info {
             background: linear-gradient(135deg, var(--info) 0%, #3eb7af 100%);
        }
        .btn-info:hover:not(:disabled) {
            background: linear-gradient(135deg, #3eb7af 0%, var(--info) 100%);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--info);
        }
        
        .winner-trophy {
            font-size: 6rem; 
            margin: 30px 0;
            animation: bounce 1.5s infinite ease-in-out;
            color: var(--gold);
            text-shadow: 0 0 20px var(--gold), 0 0 30px var(--primary);
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-35px) scale(1.1); }
        }
        
        .win-message {
            font-size: 3rem; 
            margin: 30px 0;
            color: var(--gold);
            text-shadow: 0 3px 0px #000, 0 0 20px var(--primary);
            font-family: "Luckiest Guy", cursive; 
        }

        .icon-btn {
            position: absolute;
            background: rgba(0,0,0, 0.3);
            color: var(--light);
            border: 1px solid var(--gold);
            border-radius: 50%;
            width: 40px; 
            height: 40px; 
            font-size: 1.1rem; 
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100; 
        }
        .icon-btn#settings-btn {
            top: 15px; 
            right: 15px; 
        }
        .icon-btn#back-btn {
            top: 15px; 
            left: 15px; 
            display: none; 
        }
        .icon-btn:hover {
            background: rgba(0,0,0, 0.5);
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 0 10px var(--gold);
        }
        .icon-btn#back-btn:hover {
             transform: scale(1.1) rotate(-5deg); 
        }

        .modal {
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.7); 
            backdrop-filter: blur(8px);
            display: none; 
            justify-content: center; 
            align-items: center; 
        }

        .modal-content {
            background-color: var(--darker);
            margin: auto;
            padding: 30px;
            border: 2px solid var(--gold);
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6), 0 0 20px var(--primary);
            position: relative;
            color: var(--light);
        }

        .modal-content h2 {
            font-family: "Bungee", cursive;
            color: var(--primary);
            text-align: center;
            margin-bottom: 25px;
        }

        .setting-item {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }
        .setting-item label {
            margin-bottom: 8px;
            font-weight: 600;
        }
        .setting-item input[type="range"] {
            width: 100%;
            cursor: pointer;
        }
        input[type=range] {
          -webkit-appearance: none; 
          width: 100%; 
          background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
          -webkit-appearance: none;
          height: 20px;
          width: 20px;
          border-radius: 50%;
          background: var(--primary);
          cursor: pointer;
          margin-top: -7px; 
          box-shadow: 0 0 8px var(--primary);
        }
        input[type=range]::-moz-range-thumb {
          height: 20px;
          width: 20px;
          border-radius: 50%;
          background: var(--primary);
          cursor: pointer;
          border: none;
          box-shadow: 0 0 8px var(--primary);
        }
        input[type=range]::-webkit-slider-runnable-track {
          width: 100%;
          height: 6px;
          cursor: pointer;
          background: rgba(255,255,255,0.2);
          border-radius: 3px;
          border: 1px solid rgba(0,0,0,0.2);
        }
        input[type=range]::-moz-range-track {
          width: 100%;
          height: 6px;
          cursor: pointer;
          background: rgba(255,255,255,0.2);
          border-radius: 3px;
          border: 1px solid rgba(0,0,0,0.2);
        }


        .close-modal-btn {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal-btn:hover,
        .close-modal-btn:focus {
            color: var(--light);
            text-decoration: none;
        }

        .feedback-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            background-color: rgba(15, 16, 18, 0.97); 
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 2.8rem; 
            font-family: "Luckiest Guy", cursive; 
            text-align: center;
            z-index: 2000; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.7);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.7);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none; 
            border: 3px solid var(--gold); 
            display: none; /* Start hidden, JS toggles .show */
        }

        .feedback-popup.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
            display: block; /* Or flex if needed */
        }

        .feedback-popup.correct {
            color: var(--success);
            border-color: var(--success);
            text-shadow: 0 0 15px var(--success);
        }

        .feedback-popup.wrong {
            color: var(--danger); 
            border-color: var(--danger);
            text-shadow: 0 0 15px var(--danger);
        }
        .feedback-popup.winner { 
            color: var(--primary);
            border-color: var(--primary);
            text-shadow: 0 0 15px var(--primary);
        }

        .confetti-piece {
            position: fixed;
            width: 10px;
            height: 20px;
            background-color: var(--primary);
            opacity: 0;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
            pointer-events: none;
            z-index: 3000;
        }

        @keyframes fallAndFade {
            0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(120vh) rotate(720deg); opacity: 0; }
        }
        
        /* Game Over Button Container & Treat Yourself */
        .game-over-buttons-container {
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin-top: 20px; 
        }
        .game-over-button-wrapper {
            position: relative; 
            display: flex;
            flex-direction: column; 
            align-items: center;
        }


        .treat-yourself-callout {
            margin-bottom: 8px; 
            background-color: var(--gold);
            color: var(--darker);
            padding: 8px 15px;
            border-radius: 20px; 
            font-family: "Bungee", cursive;
            font-size: 0.9rem;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(255,215,0,0.5);
            display: none; 
            align-items: center; 
            gap: 8px;
            z-index: 10;
        }
        .treat-yourself-callout i { 
            font-size: 1.2em;
            animation: bounceArrow 1s infinite;
        }

        @keyframes bounceArrow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
        
        @media (max-width: 768px) {
            .game-container { padding: 20px; } 
            .brand-logo-prominent { max-height: 60px; }
            h1 { font-size: 2.2rem; margin-top: 5px; }
            .game-mode-selection { flex-direction: column; align-items: center; }
            .mode-option { max-width: 100%; }
            .instructions { padding: 20px; }
            .instructions li { font-size: 0.9rem; }
            .guess-inputs { grid-template-columns: 1fr; }
            .score-display { grid-template-columns: 1fr; }
            .icon-btn#settings-btn { top: 10px; right: 10px; width: 38px; height: 38px; font-size: 1rem;}
            .icon-btn#back-btn { top: 10px; left: 10px; width: 38px; height: 38px; font-size: 1rem;}
            .feedback-popup { font-size: 2rem; padding: 25px 35px; width: 90%; }
            .modal-content { padding: 20px; }
            .modal-content h2 { font-size: 1.8rem; }
            .game-over-buttons-container {
                flex-direction: column; 
                align-items: center;
            }
            .game-over-buttons-container .game-over-button-wrapper { 
                width: 90%; 
                margin-left: auto;
                margin-right: auto;
            }
             .game-over-buttons-container .game-over-button-wrapper button {
                width: 100%; 
            }
            .item-stage-container::before, .item-stage-container::after { display: none; } 
            .tv-screen-container { padding: 10px; border-width: 5px; }
            .item-image { max-height: 200px; }
            .tv-screen-container h3 { font-size: 1.5rem; }
            .price-display { font-size: 2rem; }
            .win-message { font-size: 2.2rem; }
            .treat-yourself-callout { font-size: 0.8rem; padding: 6px 12px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button id="back-btn" class="icon-btn" aria-label="Go Back" style="display: none;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Guess The Price</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY:</strong></p>
                <ul>
                    <li><i class="fas fa-tag"></i> Guess the price of the displayed item</li>
                    <li><i class="fas fa-users"></i> Play with friends (up to 4 teams) or solo</li>
                    <li><i class="fas fa-trophy"></i> Closest guess gets a point - first to 5 wins!</li>
                    <li><i class="fas fa-user"></i> In single player, you get a point if your guess is within 15% of the actual price</li>
                </ul>
            </div>
            
            <div class="game-mode-selection">
                <div class="mode-option selected" data-mode="single">
                    <i class="fas fa-user"></i>
                    <h3>Single Player</h3>
                    <p>5 rounds, play alone</p>
                </div>
                <div class="mode-option" data-mode="multi">
                    <i class="fas fa-users"></i>
                    <h3>Multiplayer</h3>
                    <p>Play with friends</p>
                </div>
            </div>
            
            <div id="team-inputs-container" style="display: none;">
                <div class="team-inputs">
                    <h3>Enter Team Names</h3>
                    <div id="team-names-list">
                        <div class="team-input-wrapper">
                            <input type="text" class="team-name-input" placeholder="Team 1">
                        </div>
                        <div class="team-input-wrapper">
                            <input type="text" class="team-name-input" placeholder="Team 2">
                        </div>
                    </div>
                    <button id="add-team-btn" class="btn-secondary">Add Team</button>
                </div>
            </div>
            
            <button id="start-game-btn" class="btn-primary">Start Game <i class="fas fa-play"></i></button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-info">
                <div>
                    <span id="round-type-text">Round</span> <span id="round-number-text">1</span>
                    <span id="round-total-text">/5</span>
                </div>
                <div id="current-score-display" style="display:block;">
                    Score: <span id="current-score-value">0</span>/5
                </div>
            </div>
            
            <div class="item-stage-container">
                <div class="stage-curtains left"></div>
                <div class="stage-curtains right"></div>
                <div class="tv-screen-container">
                    <h3>What's the price of this item?</h3>
                    <div id="item-category-text" class="category-display"></div>
                    <img id="item-image-display" src="" alt="Item to guess price" class="item-image">
                </div>
            </div>
            
            <div id="guess-inputs-area" class="guess-inputs">
                <!-- Guess inputs will be added here -->
            </div>
            
            <button id="reveal-price-btn" class="btn-primary">Reveal Price <i class="fas fa-eye"></i></button>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="result-item">
                <img id="result-item-image-display" src="" alt="Item" class="item-image">
                <div class="price-display">Actual Price: $<span id="actual-price-value">0</span></div>
                <div id="item-description-text"></div>
            </div>
            
            <div id="guess-results-area">
                <!-- Guess results will be added here -->
            </div>
            
            <div id="score-display-area" class="score-display">
                <!-- Score cards will be added here -->
            </div>
            
            <button id="next-round-btn" class="btn-primary">Next Round <i class="fas fa-arrow-right"></i></button>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="screen">
             <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1 id="game-over-title-text">Guess The Price</h1>
            <div class="win-message" id="win-message-text">Team Wins!</div>
            <div id="winner-trophy-display" class="winner-trophy">üèÜ</div>
            <div id="winner-details-text"></div>
            
            <div id="final-scores-area" class="score-display">
                <!-- Final score cards will be added here -->
            </div>
            
            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                    <button id="play-again-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                </div>
                <div class="game-over-button-wrapper">
                     <button id="new-game-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper-id"> 
                    <!-- "Treat Yourself" callout will be inserted here by JS -->
                    <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">√ó</span>
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="bgm-volume-slider">Background Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.3">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>

    <!-- Feedback Pop-up -->
    <div id="feedback-popup" class="feedback-popup">
        <span id="feedback-message-text-el"></span>
    </div>

    <!-- Audio elements -->
    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="reveal-correct-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="reveal-wrong-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="curtain-sound" src="https://static.wixstatic.com/mp3/9ce3e5_ccd36cdf98bf4e1594cf2e52d5296c51.wav"></audio> <!-- UPDATED URL -->


    <script>
        // Game state
        const gameState = {
            players: [],
            currentRound: 1,
            scores: {},
            gameMode: 'single',
            currentItem: null,
            items: [
                 { name: "Smartphone", category: "iPhone 16 Pro Max 256GB", price: 1199, image: "https://static.wixstatic.com/media/9ce3e5_9686ddc0bdfe431e8f8a0ec574da5879~mv2.jpg", description: "The latest flagship smartphone from Apple with A18 Pro chip and titanium design." },
                { name: "Electric Car", category: "Tesla Cybertuck - Long Range", price: 69990, image: "https://static.wixstatic.com/media/9ce3e5_4cb87b6f65204052a9039c012f4dad19~mv2.jpg", description: "The Tesla Cybertruck Long Range is a rear-wheel-drive electric truck with 362 miles of range and a 0‚Äì60 mph time of 6.2 seconds." },
                { name: "Luxury Watch", category: "Rolex Submariner", price: 10200, image: "https://static.wixstatic.com/media/9ce3e5_effb6b5486004ab19eecb54c5bbe4f39~mv2.png", description: "Iconic dive watch with 300m water resistance and chronometer certification." },
                { name: "Gaming Console", category: "PlayStation 5", price: 499, image: "https://static.wixstatic.com/media/9ce3e5_8fa6c5a5016545deaa4ae3eaef4811d7~mv2.jpg", description: "Next-gen gaming console with ultra-high speed SSD and 4K graphics." },
                { name: "Beverage", category: "Starbucks Coffee", price: 4.95, image: "https://static.wixstatic.com/media/9ce3e5_5aa78f26264e445f9762b8782dad8f51~mv2.jpg", description: "Grande Caff√® Latte from Starbucks coffee chain." },
                { name: "Sneakers", category: "Jordan 1 Retro Low OG SP 'Travis Scott Medium Olive - Retail Price", price: 150, image: "https://static.wixstatic.com/media/9ce3e5_93af5177c9ee492597563200a0b9ad55~mv2.jpg", description: "The infamous collaboration." },
                { name: "Laptop", category: "MacBook Pro 14-inch M4", price: 1599, image: "https://static.wixstatic.com/media/9ce3e5_72600804f6c34c0f9774a6d0b4cc7ed3~mv2.jpeg", description: "Powerful laptop with M4 max chip and Liquid Retina XDR display." },
                { name: "Fashion", category: "Gucci Women's slide sandal with Horsebit", price: 890, image: "https://static.wixstatic.com/media/9ce3e5_c8d7315c976d469b8294ea89b411ea01~mv2.png", description: "Cmon it's Gucci slides." },
                { name: "Fast Food", category: "Big Mac - USA", price: 5.29, image: "https://static.wixstatic.com/media/9ce3e5_9d8ffe7cc7614429b96b9c4c0bdbbf0d~mv2.jpg", description: "McDonald's signature burger without fries or a drink." },
                { name: "Event Ticket", category: "World Cup 2026 Finals Ticket", price: 9500, image: "https://static.wixstatic.com/media/9ce3e5_b09525c12a79463b9071b6261a2856e2~mv2.jpg", description: "Average price for a ticket to the grandest stage of them all." },
                { name: "Real Estate", category: "Villa in Nepal", price: 473000, image: "https://static.wixstatic.com/media/9ce3e5_6ed5214556b34acaa0207e7a1e2fb9ee~mv2.jpg", description: "A 2.5 storied House with 6 aana 5 paisa of land is for sale at Basundhara." },
                { name: "Trading Card", category: "PSA 10 CHARIZARD 1999 Pokemon Base Holo", price: 40000, image: "https://static.wixstatic.com/media/9ce3e5_e9bf7ac0e4ec40d88b71be7e495c704a~mv2.jpg", description: "Do you get the hype?." },
                { name: "Streaming", category: "Netflix Subscription - Standard", price: 17.99, image: "https://static.wixstatic.com/media/9ce3e5_00218da70cc043d7ab864312f2a2a468~mv2.jpg", description: "Standard monthly subscription with HD streaming." },
                { name: "Fashion", category: "Herm√®s Please Hold The Line scarf 90", price: 590, image: "https://static.wixstatic.com/media/9ce3e5_c91181b41abe4815900bc6f9de8bca49~mv2.png", description: "90cm x 90cm silk twill scarf in signature Herm√®s design." },
                { name: "Shopping", category: "1 week Groceries - Canada", price: 99, image: "https://static.wixstatic.com/media/9ce3e5_2bbcb25f21254dd291f567b2cddf19f8~mv2.jpg", description: "Rough times." },
                { name: "Advertisement", category: "NYC Billboard Advert - 1 Month", price: 20000, image: "https://static.wixstatic.com/media/9ce3e5_52b89f523f614aa1a79bc2bc6056f15a~mv2.jpg", description: "Is this worth it?" },
                { name: "Music", category: "Snoop Dog song feature", price: 250000, image: "https://static.wixstatic.com/media/9ce3e5_68b406be69df4b0fb611b3d933a548ee~mv2.jpg", description: "Dont smoke kids." },
                { name: "Scooter", category: "Bugatti 9.0 Electric Scooter", price: 1200, image: "https://static.wixstatic.com/media/9ce3e5_72c9919152b1450fa25d617595099ef8~mv2.png", description: "What color is your Bgatti?" },
                { name: "Planes", category: "Boeing 747-8", price: 386000000, image: "https://static.wixstatic.com/media/9ce3e5_0ac131e88f3e49049e8144baa3476c54~mv2.jpg", description: "Carries atleat 5 people." },
                { name: "MCU", category: "MARVEL Franchise Worth", price: 53000000000, image: "https://static.wixstatic.com/media/9ce3e5_1ac5f683a4cd4e768facbb16fd8f57cf~mv2.jpeg", description: "New mask, same task." },
                { name: "Storage", category: "100mb Floppy Disc at launch", price: 12.95, image: "https://static.wixstatic.com/media/9ce3e5_c520bd0d02e84b8e9e916e4c11786b92~mv2.jpg", description: "thats like 20 pictures." },
                { name: "Animals", category: "Cow in Australia", price: 2000, image: "https://static.wixstatic.com/media/9ce3e5_527cdab942cc4c8189b03d4623efc5c9~mv2.jpg", description: "MOOOOOOOOOO." },
                { name: "Painting", category: "Van Gogh Self potrait", price: 7200000, image: "https://static.wixstatic.com/media/9ce3e5_4e05a15e4a264361ad4648b8c60ecb9c~mv2.png", description: "Handsome lad." },
                { name: "Wages", category: "Japanese Minimum Wage", price: 7.35, image: "https://static.wixstatic.com/media/9ce3e5_580ca1edd33047e7a2a55a3047c5938c~mv2.jpg", description: "Its tough out there." },
            ],
            usedItems: [],
            currentGuesses: {}
        };

        let sfxEnabled = true;
        let musicVolume = 0.3;

        const screens = {
            start: document.getElementById('start-screen'),
            game: document.getElementById('game-screen'),
            results: document.getElementById('results-screen'),
            gameOver: document.getElementById('game-over-screen')
        };
        
        const modeOptions = document.querySelectorAll('.mode-option');
        const teamInputsContainer = document.getElementById('team-inputs-container');
        const teamNamesList = document.getElementById('team-names-list');
        const addTeamBtn = document.getElementById('add-team-btn');
        const startGameBtn = document.getElementById('start-game-btn');

        const roundTypeText = document.getElementById('round-type-text');
        const roundNumberText = document.getElementById('round-number-text');
        const roundTotalText = document.getElementById('round-total-text');
        const currentScoreDisplay = document.getElementById('current-score-display');
        const currentScoreValue = document.getElementById('current-score-value');
        
        const leftCurtain = document.querySelector('.stage-curtains.left');
        const rightCurtain = document.querySelector('.stage-curtains.right');
        const itemCategoryText = document.getElementById('item-category-text');
        const itemImageDisplay = document.getElementById('item-image-display');

        const guessInputsArea = document.getElementById('guess-inputs-area');
        const revealPriceBtn = document.getElementById('reveal-price-btn');

        const resultItemImageDisplay = document.getElementById('result-item-image-display');
        const actualPriceValueEl = document.getElementById('actual-price-value');
        const itemDescriptionText = document.getElementById('item-description-text');
        const guessResultsArea = document.getElementById('guess-results-area');
        const scoreDisplayArea = document.getElementById('score-display-area');
        const nextRoundBtn = document.getElementById('next-round-btn');
        
        const gameOverTitleText = document.getElementById('game-over-title-text');
        const winMessageText = document.getElementById('win-message-text');
        const winnerTrophyDisplay = document.getElementById('winner-trophy-display');
        const winnerDetailsText = document.getElementById('winner-details-text');
        const finalScoresArea = document.getElementById('final-scores-area');
        const playAgainBtn = document.getElementById('play-again-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const visitStoreBtn = document.getElementById('visit-store-btn');
        const storeButtonWrapper = document.getElementById('store-button-wrapper-id'); 


        const settingsBtn = document.getElementById('settings-btn');
        const backBtn = document.getElementById('back-btn'); 
        const settingsModal = document.getElementById('settings-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const bgmVolumeSlider = document.getElementById('bgm-volume-slider');
        const sfxToggleBtn = document.getElementById('sfx-toggle-btn');

        const backgroundMusic = document.getElementById('background-game-music');
        const startGameSound = document.getElementById('start-game-sound');
        const interactionSound = document.getElementById('interaction-sound');
        const revealCorrectSound = document.getElementById('reveal-correct-sound');
        const revealWrongSound = document.getElementById('reveal-wrong-sound');
        const curtainSound = document.getElementById('curtain-sound'); 
        
        const feedbackPopup = document.getElementById('feedback-popup');
        const feedbackMessageTextEl = document.getElementById('feedback-message-text-el');

        let treatYourselfElement = null; 


        function playSound(audioElement) {
            if (sfxEnabled && audioElement) {
                audioElement.currentTime = 0;
                audioElement.play().catch(e => console.error("SFX play error:", e));
            }
        }
        function playSoundWithCallback(audioElement, callback, ...args) {
            if (sfxEnabled && audioElement) {
                audioElement.currentTime = 0;
                let callbackExecuted = false;
                const executeCallback = () => {
                    if (!callbackExecuted) {
                        callbackExecuted = true;
                        audioElement.onended = null;
                        if (timeoutId) clearTimeout(timeoutId);
                        if (callback) callback(...args);
                    }
                };
                audioElement.onended = executeCallback;
                const soundDurationMs = (audioElement.duration && isFinite(audioElement.duration)) ? audioElement.duration * 1000 : 500;
                const timeoutId = setTimeout(executeCallback, soundDurationMs + 200); 
                audioElement.play().catch(e => { console.error("SFX play error:", e); executeCallback(); });
            } else {
                if (callback) callback(...args);
            }
        }
        
        let feedbackTimeout;
        function showFeedbackMessage(message, type = '', duration = 2500) {
            feedbackMessageTextEl.textContent = message;
            feedbackPopup.className = 'feedback-popup'; // Reset classes
            if (type) feedbackPopup.classList.add(type);
            feedbackPopup.classList.add('show'); 

            clearTimeout(feedbackTimeout);
            feedbackTimeout = setTimeout(() => {
                feedbackPopup.classList.remove('show'); 
            }, duration);
        }

        function triggerConfetti() {
            const confettiCount = 100;
            const colors = ['var(--primary)', 'var(--secondary)', 'var(--success)', 'var(--info)', '#FFD700', '#FF69B4'];
            for (let i = 0; i < confettiCount; i++) {
                const confettiPiece = document.createElement('div');
                confettiPiece.classList.add('confetti-piece');
                confettiPiece.style.left = Math.random() * 100 + 'vw';
                confettiPiece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                const animDuration = Math.random() * 3 + 2;
                confettiPiece.style.animationName = 'fallAndFade';
                confettiPiece.style.animationDuration = animDuration + 's';
                confettiPiece.style.animationDelay = Math.random() * 1 + 's';
                confettiPiece.style.width = Math.random() * 5 + 5 + 'px';
                confettiPiece.style.height = Math.random() * 10 + 10 + 'px';
                document.body.appendChild(confettiPiece);
                setTimeout(() => {
                    confettiPiece.remove();
                }, (animDuration + parseFloat(confettiPiece.style.animationDelay || 0)) * 1000 + 500);
            }
        }
        
        settingsBtn.addEventListener('click', () => { playSound(interactionSound); settingsModal.style.display = 'flex'; });
        backBtn.addEventListener('click', () => { 
            playSound(interactionSound);
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            screens.start.classList.add('active');
            backBtn.style.display = 'none'; 
            settingsBtn.style.display = 'flex'; 
            if (treatYourselfElement) treatYourselfElement.style.display = 'none'; 
            if (backgroundMusic.paused) initBackgroundMusic(); 
        });
        closeModalBtn.addEventListener('click', () => { playSound(interactionSound); settingsModal.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target === settingsModal) { playSound(interactionSound); settingsModal.style.display = 'none'; } });
        bgmVolumeSlider.addEventListener('input', (e) => { musicVolume = parseFloat(e.target.value); backgroundMusic.volume = musicVolume; });
        sfxToggleBtn.addEventListener('click', () => { sfxEnabled = !sfxEnabled; sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`; playSound(interactionSound); });
        
        function initBackgroundMusic() {
            backgroundMusic.volume = musicVolume;
            backgroundMusic.play().catch(e => console.log("Background music autoplay prevented."));
        }

        modeOptions.forEach(option => { option.addEventListener('click', function() { playSound(interactionSound); selectGameMode.call(this); }); });
        addTeamBtn.addEventListener('click', () => { playSound(interactionSound); addTeamInputField(); });
        startGameBtn.addEventListener('click', () => { playSoundWithCallback(startGameSound, actualStartGame); });
        revealPriceBtn.addEventListener('click', revealPrice);
        nextRoundBtn.addEventListener('click', () => { playSound(interactionSound); nextRound(); });
        playAgainBtn.addEventListener('click', () => { playSoundWithCallback(startGameSound, playAgain); });
        newGameBtn.addEventListener('click', () => { playSoundWithCallback(interactionSound, newGame); });
        visitStoreBtn.addEventListener('click', () => {
    playSound(interactionSound);
    // Change this line to navigate to the /store route oo
    window.location.href = '/store'; 
}); 

        function selectGameMode() {
            modeOptions.forEach(option => option.classList.remove('selected'));
            this.classList.add('selected');
            gameState.gameMode = this.dataset.mode;
            teamInputsContainer.style.display = this.dataset.mode === 'multi' ? 'block' : 'none';
            if (this.dataset.mode === 'single') {
                currentScoreDisplay.style.display = 'block';
            } else {
                currentScoreDisplay.style.display = 'none';
                updateTeamRemoveButtonsState();
            }
        }

        function addTeamInputField() {
            const teamCount = teamNamesList.querySelectorAll('.team-input-wrapper').length;
            if (teamCount >= 4) return;

            const wrapper = document.createElement('div');
            wrapper.className = 'team-input-wrapper';

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'team-name-input';
            input.placeholder = `Team ${teamCount + 1}`;
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-team-btn';
            removeBtn.innerHTML = '<i class="fas fa-times"></i> Remove';
            removeBtn.onclick = function() {
                playSound(interactionSound);
                wrapper.remove();
                updateTeamRemoveButtonsState();
            };

            wrapper.appendChild(input);
            wrapper.appendChild(removeBtn);
            teamNamesList.appendChild(wrapper);
            updateTeamRemoveButtonsState();
        }

        function updateTeamRemoveButtonsState() {
            const teamWrappers = teamNamesList.querySelectorAll('.team-input-wrapper');
            const teamCount = teamWrappers.length;
            addTeamBtn.disabled = teamCount >= 4;

            teamWrappers.forEach((wrapper, index) => {
                let removeBtn = wrapper.querySelector('.remove-team-btn');
                if (index < 2 && removeBtn) { 
                    removeBtn.remove(); 
                } else if (index >= 2 && !removeBtn) { 
                    const newRemoveBtn = document.createElement('button');
                    newRemoveBtn.className = 'remove-team-btn';
                    newRemoveBtn.innerHTML = '<i class="fas fa-times"></i> Remove';
                    newRemoveBtn.onclick = function() {
                        playSound(interactionSound);
                        wrapper.remove();
                        updateTeamRemoveButtonsState();
                    };
                    wrapper.appendChild(newRemoveBtn);
                    removeBtn = newRemoveBtn; 
                }
                
                if(removeBtn) {
                    removeBtn.disabled = teamCount <= 2;
                }
            });
        }

        function actualStartGame() {
            if (gameState.gameMode === 'single') {
                gameState.players = ['You'];
                gameState.scores = { 'You': 0 };
                roundTypeText.textContent = 'Round';
                roundTotalText.textContent = '/5';
            } else {
                gameState.players = Array.from(teamNamesList.querySelectorAll('.team-name-input'))
                    .map((input, index) => input.value.trim() || `Team ${index + 1}`)
                    .filter(name => name !== '');
                
                if (gameState.players.length < 2) {
                    alert('You need at least 2 teams for multiplayer!');
                    return;
                }
                
                gameState.scores = {};
                gameState.players.forEach(team => { gameState.scores[team] = 0; });
                roundTypeText.textContent = 'Round';
                roundTotalText.textContent = '';
            }
            
            gameState.currentRound = 1;
            gameState.usedItems = [];
            gameState.currentGuesses = {};
            
            screens.start.classList.remove('active');
            screens.game.classList.add('active');
            backBtn.style.display = 'flex'; 
            settingsBtn.style.display = 'flex'; 
            if (treatYourselfElement) treatYourselfElement.style.display = 'none'; 
            setupRound();
        }


        function setupRound() {
            leftCurtain.classList.remove('open');
            rightCurtain.classList.remove('open');
            itemImageDisplay.style.opacity = 0; 
            itemCategoryText.style.opacity = 0;

            let availableItems = gameState.items.filter(item => !gameState.usedItems.includes(item.name));
            if (availableItems.length === 0) {
                gameState.usedItems = []; 
                availableItems = [...gameState.items];
            }
            
            const randomIndex = Math.floor(Math.random() * availableItems.length);
            gameState.currentItem = availableItems[randomIndex];
            gameState.usedItems.push(gameState.currentItem.name);
            
            roundNumberText.textContent = gameState.currentRound;
            if (gameState.gameMode === 'single') {
                 currentScoreValue.textContent = gameState.scores['You'];
            }
            itemCategoryText.textContent = `${gameState.currentItem.category}`;
            itemImageDisplay.src = gameState.currentItem.image;
            itemImageDisplay.alt = gameState.currentItem.name;
            
            guessInputsArea.innerHTML = '';
            gameState.players.forEach((player, index) => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'guess-input-group';
                const playerLabel = (gameState.gameMode === 'single' && player === 'You') ? 'Your guess:' : `${player}'s guess:`; 
                inputGroup.innerHTML = `
                    <div class="guess-label">${playerLabel}</div>
                    <div class="guess-input-container">
                        <div class="dollar-sign">$</div>
                        <input type="number" class="price-input" placeholder="0.00" min="0" step="0.01" data-player-index="${index}">
                    </div>
                `;
                guessInputsArea.appendChild(inputGroup);
            });
            document.querySelectorAll('.price-input').forEach(input => {
                input.addEventListener('focus', () => playSound(interactionSound));
            });
            nextRoundBtn.textContent = 'Next Round';

            setTimeout(() => {
                playSound(curtainSound);
                leftCurtain.classList.add('open');
                rightCurtain.classList.add('open');
                setTimeout(() => {
                    itemImageDisplay.style.transition = 'opacity 0.5s ease-in';
                    itemCategoryText.style.transition = 'opacity 0.5s ease-in';
                    itemImageDisplay.style.opacity = 1;
                    itemCategoryText.style.opacity = 1;
                }, 700); 
            }, 500); 
        }

        function revealPrice() {
            gameState.currentGuesses = {};
            const inputs = document.querySelectorAll('.price-input');
            let allGuessesValid = true;
            
            inputs.forEach(input => {
                const playerIndex = input.dataset.playerIndex;
                const playerName = gameState.players[playerIndex];
                const guessValue = parseFloat(input.value);
                
                if (isNaN(guessValue) || guessValue < 0) {
                    allGuessesValid = false;
                    input.classList.add('error');
                } else {
                    input.classList.remove('error');
                    gameState.currentGuesses[playerName] = guessValue;
                }
            });
            
            if (!allGuessesValid) {
                alert('Please enter valid price guesses for all players!');
                return;
            }
            
            screens.game.classList.remove('active');
            screens.results.classList.add('active');
            backBtn.style.display = 'flex'; 
            showResults();
        }

        function showResults() {
            resultItemImageDisplay.src = gameState.currentItem.image;
            resultItemImageDisplay.alt = gameState.currentItem.name;
            actualPriceValueEl.textContent = gameState.currentItem.price.toLocaleString('en-US', { style: 'decimal', minimumFractionDigits: 2, maximumFractionDigits: 2 });
            itemDescriptionText.textContent = `${gameState.currentItem.name}: ${gameState.currentItem.description}`;
            
            const actualItemPrice = gameState.currentItem.price;
            let closestPlayer = null;
            let smallestDifference = Infinity;
            
            guessResultsArea.innerHTML = '';
            Object.entries(gameState.currentGuesses).forEach(([player, guess]) => {
                const difference = Math.abs(guess - actualItemPrice);
                if (difference < smallestDifference) {
                    smallestDifference = difference;
                    closestPlayer = player;
                } else if (difference === smallestDifference) { 
                    closestPlayer = null; 
                }
                
                const resultCard = document.createElement('div');
                resultCard.className = 'guess-result';
                const playerLabelForResult = (gameState.gameMode === 'single' && player === 'You') ? 'You' : player; 
                resultCard.innerHTML = `
                    <div class="font-bold">${playerLabelForResult}</div>
                    <div>Guessed: $${guess.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                    <div class="difference-display">Difference: $${difference.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                `;
                guessResultsArea.appendChild(resultCard);
            });
            
            if (gameState.gameMode === 'single') {
                const playerGuess = gameState.currentGuesses['You'];
                const percentageDiff = Math.abs(playerGuess - actualItemPrice) / actualItemPrice * 100;
                
                if (percentageDiff <= 15) {
                    gameState.scores['You'] += 1;
                    document.querySelector('#guess-results-area .guess-result').classList.add('closest-guess');
                    document.querySelector('#guess-results-area .guess-result').innerHTML += `<div class="winner-badge"><i class="fas fa-trophy"></i> Within 15%! +1 point</div>`;
                    playSound(revealCorrectSound);
                    showFeedbackMessage("You are Correct!", "correct");
                } else {
                    playSound(revealWrongSound);
                    showFeedbackMessage("Incorrect!", "wrong");
                }
                currentScoreValue.textContent = gameState.scores['You'];
            } else { 
                if (closestPlayer && smallestDifference < Infinity) {
                    const resultCards = document.querySelectorAll('#guess-results-area .guess-result');
                    const closestIndex = gameState.players.indexOf(closestPlayer);
                    
                    if (closestIndex !== -1) {
                        resultCards[closestIndex].classList.add('closest-guess');
                        gameState.scores[closestPlayer] += 1;
                        resultCards[closestIndex].innerHTML += `<div class="winner-badge"><i class="fas fa-trophy"></i> Closest Guess! +1 point</div>`;
                        playSound(revealCorrectSound);
                        showFeedbackMessage(`${closestPlayer} is Closest!`, "winner");
                    }
                } else { 
                    showFeedbackMessage("It's a Close Call!", "", 2000);
                }
            }
            
            updateScoreDisplay();
            
            const maxScoreReached = Math.max(...Object.values(gameState.scores));
            if ((gameState.gameMode === 'single' && gameState.currentRound >= 5) || 
                (gameState.gameMode === 'multi' && maxScoreReached >= 5)) {
                nextRoundBtn.textContent = 'See Final Results';
            }
        }

        function updateScoreDisplay() {
            scoreDisplayArea.innerHTML = '';
            Object.entries(gameState.scores).forEach(([name, score]) => {
                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card';
                const maxPossibleScore = 5;
                const progressWidth = (score / maxPossibleScore) * 100;
                scoreCard.innerHTML = `
                    <h4 class="font-bold">${name}</h4>
                    <div class="text-2xl font-bold">${score}</div>
                    <div class="progress-bar"><div class="progress-fill" style="width: ${progressWidth}%"></div></div>
                `;
                scoreDisplayArea.appendChild(scoreCard);
            });
        }

        function nextRound() {
            const maxScoreReached = Math.max(...Object.values(gameState.scores));
            if ((gameState.gameMode === 'single' && gameState.currentRound >= 5) || 
                (gameState.gameMode === 'multi' && maxScoreReached >= 5)) {
                showGameOver();
            } else {
                gameState.currentRound += 1;
                screens.results.classList.remove('active');
                screens.game.classList.add('active');
                backBtn.style.display = 'flex'; 
                setupRound(); 
            }
        }

        function showGameOver() {
            screens.results.classList.remove('active');
            screens.gameOver.classList.add('active');
            backBtn.style.display = 'flex'; 
            gameOverTitleText.textContent = "Guess The Price"; 
            triggerConfetti();
            
            if (!treatYourselfElement) {
                treatYourselfElement = document.createElement('div');
                treatYourselfElement.className = 'treat-yourself-callout';
                treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`;
                storeButtonWrapper.insertBefore(treatYourselfElement, visitStoreBtn); 
            }
            treatYourselfElement.style.display = 'flex'; 


            const maxScore = Math.max(...Object.values(gameState.scores));
            
            if (gameState.gameMode === 'single') {
                winMessageText.textContent = "Game Over!";
                const finalPlayerScore = gameState.scores['You'];
                winnerDetailsText.textContent = `You scored ${finalPlayerScore} points.`;
                if (finalPlayerScore <= 1) winnerTrophyDisplay.textContent = 'üóëÔ∏è';
                else if (finalPlayerScore <= 3) winnerTrophyDisplay.textContent = 'ü•à';
                else winnerTrophyDisplay.textContent = 'üèÜ';
            } else { 
                const winners = Object.entries(gameState.scores)
                    .filter(([name, score]) => score === maxScore)
                    .map(([name]) => name);
                
                if (winners.length === 1) {
                    winMessageText.textContent = `${winners[0]} Wins!`;
                    winnerDetailsText.textContent = `Congratulations on reaching ${maxScore} points!`;
                } else if (winners.length > 1) {
                    winMessageText.textContent = "It's a Tie!";
                    winnerDetailsText.textContent = `${winners.join(' and ')} all reached ${maxScore} points.`;
                }
                winnerTrophyDisplay.textContent = 'üèÜ';
            }
            
            finalScoresArea.innerHTML = '';
            Object.entries(gameState.scores).forEach(([name, score]) => {
                const scoreCard = document.createElement('div');
                let isWinner = false;
                if (gameState.gameMode === 'multi') isWinner = score === maxScore;
                else isWinner = (score >=4);

                scoreCard.className = `score-card ${isWinner ? 'winner-glow' : ''}`;
                scoreCard.innerHTML = `
                    <h4 class="font-bold">${name}</h4>
                    <div class="text-3xl font-bold">${score}</div>`;
                finalScoresArea.appendChild(scoreCard);
            });
        }

        function playAgain() {
            screens.gameOver.classList.remove('active');
            screens.game.classList.add('active');
            backBtn.style.display = 'flex'; 
            if (treatYourselfElement) treatYourselfElement.style.display = 'none'; 
            gameState.currentRound = 1;
            gameState.usedItems = [];
            gameState.currentGuesses = {};
            Object.keys(gameState.scores).forEach(key => { gameState.scores[key] = 0; });
            setupRound();
        }

        function newGame() {
            screens.gameOver.classList.remove('active');
            screens.start.classList.add('active');
            backBtn.style.display = 'none'; 
            settingsBtn.style.display = 'flex';
            if (treatYourselfElement) treatYourselfElement.style.display = 'none'; 
            teamNamesList.innerHTML = `
                <div class="team-input-wrapper"><input type="text" class="team-name-input" placeholder="Team 1"></div>
                <div class="team-input-wrapper"><input type="text" class="team-name-input" placeholder="Team 2"></div>
            `;
            updateTeamRemoveButtonsState();
            if (modeOptions.length > 0) modeOptions[0].click();
            if (backgroundMusic.paused) initBackgroundMusic(); 
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initBackgroundMusic();
            updateTeamRemoveButtonsState();
            if (modeOptions.length > 0) modeOptions[0].click();
        });

    </script>

    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>
</body>
</html>