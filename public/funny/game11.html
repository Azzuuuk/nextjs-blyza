<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories Showdown IRL - Blyza Game Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- START: BRAND IDENTITY & ROOT VARIABLES --- */
        :root {
            --blyza-orange-primary: #FF8833;
            --blyza-purple-secondary: #cb7ae1;
            --blyza-keppel-accent: #00BFA6;
            --blyza-sunny-yellow: #FFDF00;
            --blyza-quickfire-red: #EA2027;

            --darker-grey-bg: #4A4A4A;
            --text-light: #FDFEFE;
            --text-dark: #2C3A47;
            --text-medium: #535c68;
            --black-stroke: #1A1A1A;

            --font-logo: "Luckiest Guy", cursive;
            --font-heading-alt: "Bungee", cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-radius-game: 12px;
            --shadow-chunky: 4px 4px 0px var(--black-stroke);
        }
        /* --- END: BRAND IDENTITY & ROOT VARIABLES --- */

        /* --- Basic Reset & Body --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-body);
            color: var(--text-light);
            background: linear-gradient(135deg, var(--blyza-orange-primary) 0%, var(--blyza-purple-secondary) 100%);
            line-height: 1.6;
            overflow: hidden; /* Body does not scroll */
            position: relative;
            height: var(--app-height, 100vh); /* Full screen height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- Floating Background Elements --- */
        .hero-background-elements { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
        .bg-game-element {
            position: absolute; opacity: 0.1; color: var(--text-light);
            animation: floatSimple 20s infinite ease-in-out alternate;
            user-select: none;
        }
        .bg-bullhorn-1 { font-size: 150px; top: 10%; left: 5%; --initial-rotate: -15deg; animation-duration: 22s; }
        .bg-list-1 { font-size: 100px; top: 65%; right: 8%; --initial-rotate: 10deg; animation-duration: 18s; }
        .bg-trophy-1 { font-size: 120px; top: 70%; left: 15%; --initial-rotate: 5deg; animation-duration: 25s; opacity: 0.08; }
        .bg-comment-slash-1 { font-size: 130px; top: 15%; right: 10%; --initial-rotate: 20deg; animation-duration: 16s; }
        .bg-brain-1 { font-size: 80px; top: 80%; right: 25%; --initial-rotate: 25deg; animation-duration: 15s; }
        .bg-list-2 { font-size: 120px; bottom: 5%; left: 3%; --initial-rotate: -5deg; animation-duration: 28s; }
        .bg-trophy-2 { font-size: 90px; top: 20%; left: 20%; --initial-rotate: 15deg; animation-duration: 20s; }
        .bg-bullhorn-2 { font-size: 70px; top: 5%; right: 30%; --initial-rotate: -10deg; animation-duration: 24s; }
        .bg-comment-slash-2 { font-size: 110px; bottom: 10%; right: 4%; --initial-rotate: 12deg; animation-duration: 19s; }
        .bg-list-3 { font-size: 60px; top: 50%; left: 1%; --initial-rotate: 20deg; animation-duration: 26s; }

        @keyframes floatSimple {
            0% { transform: translateY(0px) rotate(var(--initial-rotate, 0deg)); }
            50% { transform: translateY(-25px) rotate(calc(var(--initial-rotate, 0deg) + 8deg)); }
            100% { transform: translateY(0px) rotate(calc(var(--initial-rotate, 0deg) - 8deg)); }
        }
        
        /* --- Main Game Container --- */
        .game-container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(145deg, #fdfefe, #e9ecef);
            color: var(--text-dark);
            border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke);
            box-shadow: 8px 8px 0px var(--black-stroke);
            padding: 30px; 
            text-align: center;
            position: relative;
            z-index: 2;
            max-height: calc(var(--app-height, 100vh) - 40px);
            overflow-y: auto;
        }

        .brand-logo { object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .brand-logo-prominent { display: block; margin: 0 auto 15px; max-height: 80px; }
        
        h1, h3 {
            font-family: var(--font-logo);
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
            text-shadow: 3px 3px 0px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            line-height: 1.1;
        }
        h1 { font-size: clamp(2.2rem, 5vw, 3rem); }
        h3 { font-size: clamp(1.8rem, 4vw, 2.2rem); }
        
        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .active { display: block; }
        
        /* --- Instructions & Info Panels --- */
        .instructions, .team-inputs-container {
            background: rgba(0,0,0, 0.04);
            padding: 20px; border-radius: 10px; margin: 25px 0;
            border: 2px dashed var(--text-medium);
        }
      .instructions p { font-size: 1.1rem; margin-bottom: 15px; font-weight: 600; }
        .instructions ul { list-style-type: none; text-align: left; padding: 0 10px; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: center; }
        .instructions i { margin-right: 15px; font-size: 1.3em; color: var(--blyza-purple-secondary); }
         .instructions a { color: var(--blyza-purple-secondary); text-decoration: none; font-weight: bold; display: inline-flex; align-items: left; gap: 5px; transition: color 0.3s ease; }
         .instructions a:hover { color: var(--blyza-orange-primary); text-decoration: underline; }

        /* --- Buttons --- */
        button, .btn-primary, .btn-secondary, .btn-success, .btn-danger, .btn-info {
            font-family: var(--font-heading-alt); font-size: 1.1rem; padding: 0.7em 1.5em;
            border: 3px solid var(--black-stroke); border-radius: 8px;
            text-transform: uppercase; text-decoration: none; display: inline-flex;
            align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            letter-spacing: 1px; cursor: pointer; color: var(--text-dark);
            margin: 8px 5px;
            box-shadow: var(--shadow-chunky);
        }
        button:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        button:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        button:disabled { background: var(--text-medium); color: var(--text-light); cursor: not-allowed; opacity: 0.7; box-shadow: var(--shadow-chunky); }

        .btn-primary { background-color: var(--blyza-sunny-yellow); }
        .btn-secondary { background-color: var(--blyza-purple-secondary); color: var(--text-light); }
        .btn-success { background-color: var(--blyza-keppel-accent); color: var(--text-light); }
        .btn-danger { background-color: var(--blyza-quickfire-red); color: var(--text-light); }
        .btn-info { background-color: #4ECDC4; color: var(--text-dark); }
        
        /* --- Team Setup --- */
        .team-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .team-input label {
            display: block; margin-bottom: 8px; font-weight: 700;
            font-size: 1.2rem; font-family: var(--font-heading-alt); text-align: left;
        }
        .team-input input {
            width: 100%; padding: 12px 18px; border-radius: 8px;
            border: 3px solid var(--black-stroke); background: var(--text-light);
            color: var(--text-dark); font-size: 1rem; transition: all 0.3s ease;
            font-family: var(--font-body); font-weight: 600;
        }
        .team-input input:focus { outline: none; border-color: var(--blyza-orange-primary); box-shadow: 0 0 0 3px var(--blyza-sunny-yellow); }

        /* --- Game Screen Elements --- */
        .team-display { display: flex; justify-content: space-around; gap: 20px; margin-bottom: 25px; flex-wrap: wrap; }
        .team-card {
            background: rgba(0,0,0,0.05); padding: 20px; border-radius: 10px;
            border: 3px solid var(--black-stroke); transition: all 0.3s ease;
            box-shadow: var(--shadow-chunky); text-align: center;
            flex: 1; min-width: 220px;
        }
        .team-card.active-team {
            border-color: var(--blyza-orange-primary);
            box-shadow: 6px 6px 0 var(--blyza-orange-primary);
            transform: scale(1.03);
        }
        .team-name { font-family: var(--font-heading-alt); font-size: 1.4rem; color: var(--blyza-orange-primary); }
        .team-score { font-family: var(--font-heading-alt); font-size: 2.5rem; margin-top: 5px; }
        
        .category-display {
            background: var(--darker-grey-bg);
            border: 3px solid var(--black-stroke);
            box-shadow: var(--shadow-chunky);
            border-radius: var(--border-radius-game);
            padding: 30px 20px;
            font-family: var(--font-logo);
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            color: var(--blyza-sunny-yellow);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
            min-height: 120px;
            display: flex; align-items: center; justify-content: center;
            margin: 25px 0;
        }
        
        .timer-container { width: 100%; margin: 25px auto; }
        .timer { height: 20px; background: rgba(0,0,0,0.2); border-radius: 50px; overflow: hidden; border: 3px solid var(--black-stroke); }
        .timer-progress {
            width: 100%; height: 100%;
            background: linear-gradient(90deg, var(--blyza-quickfire-red) 0%, var(--blyza-orange-primary) 40%, var(--blyza-keppel-accent) 100%);
            border-radius: 50px; transition: width 0.1s linear;
        }
        .bullshit-buttons, .result-buttons {
            display: flex; justify-content: center; gap: 25px;
            margin-top: 35px; flex-wrap: wrap;
        }
        .result-buttons { display: none; }

        /* --- Win Screen --- */
        .win-message {
            font-family: var(--font-logo); font-size: 3rem; margin: 20px 0;
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
        }
        .winner-trophy {
            font-size: 6rem; margin: 20px 0; animation: bounce 1.5s infinite ease-in-out;
            color: var(--blyza-sunny-yellow);
            text-shadow: 0 0 20px var(--blyza-orange-primary), 3px 3px 0 var(--black-stroke);
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }

        /* --- Time Up Pop-up --- */
        .time-up {
            position: fixed; top: 50%; left: 50%;
            background-color: var(--blyza-quickfire-red);
            color: white; padding: 30px 50px;
            border-radius: var(--border-radius-game);
            font-size: 3rem; font-family: var(--font-logo);
            z-index: 2000; box-shadow: 8px 8px 0px rgba(0,0,0,0.5);
            border: 3px solid var(--black-stroke);
            animation: timeUpPopAnim 1.5s forwards;
            display: none;
        }
        @keyframes timeUpPopAnim{
            0%{ opacity:0; transform:translate(-50%,-50%) scale(.7); }
            20%{ opacity:1; transform:translate(-50%,-50%) scale(1.1); }
            80%{ opacity:1; transform:translate(-50%,-50%) scale(1.1); }
            100%{ opacity:0; transform:translate(-50%,-50%) scale(.7); }
        }

        /* --- Icon Buttons --- */
        .icon-btn {
            position: absolute; background-color: var(--blyza-purple-secondary);
            color: var(--text-light); border-radius: 50%; width: 55px; height: 55px;
            font-size: 1.2rem; cursor: pointer; transition: all 0.1s ease;
            display: flex; justify-content: center; align-items: center; z-index: 100;
            text-decoration: none; border: 3px solid var(--black-stroke);
            box-shadow: 4px 4px 0px var(--black-stroke);
        }
        .icon-btn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        .icon-btn:active { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        #settings-btn, #home-menu-btn, #back-btn { display: flex; }
        #settings-btn { top: 20px; right: 20px; }
        #home-menu-btn, #back-btn { top: 20px; left: 20px; }
        
        /* --- Modal & Feedback Styles --- */
        .modal { position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; animation: fadeInModal 0.3s ease; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background-color: var(--darker-grey-bg); margin: auto; padding: 25px; border: 3px solid var(--black-stroke); border-radius: var(--border-radius-game); width: 90%; max-width: 450px; box-shadow: 8px 8px 0px rgba(0,0,0,0.4); position: relative; color: var(--text-light); text-align: center; }
        .modal-content h3 { font-family: var(--font-logo); color: var(--blyza-orange-primary); -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke); text-align: center; margin-bottom: 25px; font-size: 2rem; }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; }
        .setting-item label { margin-bottom: 10px; font-weight: 600; font-size: 1rem; }
        .close-modal-btn { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-modal-btn:hover { color: var(--text-light); }
        .modal-content button#sfx-toggle-btn { font-size: 1rem; padding: 10px 20px; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: rgba(0,0,0,0.3); border-radius: 5px; border: 2px solid var(--black-stroke); }
        input[type=range]::-webkit-slider-thumb { border: 2px solid var(--black-stroke); height: 22px; width: 22px; border-radius: 50%; background: var(--blyza-orange-primary); cursor: pointer; -webkit-appearance: none; margin-top: -9px; }
        #audio-consent-modal .modal-content p { font-family: var(--font-body); font-weight: 600; font-size: 1.1rem; margin-bottom: 25px; color: var(--text-light); }
        #audio-consent-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }

        /* --- Confetti & Game Over Buttons --- */
        .confetti-piece { position: fixed; width: 10px; height: 20px; background-color: var(--blyza-orange-primary); opacity: 0; animation-timing-function: linear; animation-fill-mode: forwards; pointer-events: none; z-index: 3000; }
        @keyframes fallAndFade { 0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(120vh) rotate(720deg); opacity: 0; } }
        .game-over-buttons-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .game-over-button-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
        .treat-yourself-callout { margin-bottom: 8px; background-color: var(--blyza-sunny-yellow); color: var(--text-dark); padding: 8px 15px; border-radius: 20px; font-family: var(--font-heading-alt); font-size: 0.9rem; white-space: nowrap; box-shadow: var(--shadow-chunky); display: none; align-items: center; gap: 8px; z-index: 10; border: 2px solid var(--black-stroke); }
        .treat-yourself-callout i { font-size: 1.2em; animation: bounceArrow 1s infinite; }
        @keyframes bounceArrow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        
        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
                align-items: flex-start;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .game-container { 
                padding: 45px 15px 15px; 
                max-height: calc(var(--app-height, 100vh) - 40px);
            } 
            h1 { font-size: 2rem; } h3 { font-size: 1.8rem; }
            .instructions { padding: 15px; }
            .team-display { flex-direction: column; align-items: center; }
            .team-card { min-width: 90%; }
            .icon-btn { width: 48px; height: 48px; }
            #settings-btn { top: 12px; right: 12px; }
            #home-menu-btn, #back-btn { top: 12px; left: 12px; }
            .modal-content { padding: 20px; }
            .game-over-buttons-container { flex-direction: column; align-items: center; }
            .game-over-buttons-container .game-over-button-wrapper { width: 90%; }
            .game-over-buttons-container .game-over-button-wrapper button { width: 100%; }
            .win-message { font-size: 2.2rem; }
            .time-up { font-size: 2.2rem; }
            .bullshit-buttons, .result-buttons { flex-direction: column; align-items: center; }
            .bullshit-buttons button, .result-buttons button { width: 90%; }
            .bg-game-element { display: none; }
        }
    </style>
</head>
<body>
    <!-- Floating background elements -->
    <div class="hero-background-elements">
        <div class="bg-game-element bg-bullhorn-1"><i class="fas fa-bullhorn"></i></div>
        <div class="bg-game-element bg-list-1"><i class="fas fa-list-ul"></i></div>
        <div class="bg-game-element bg-trophy-1"><i class="fas fa-trophy"></i></div>
        <div class="bg-game-element bg-comment-slash-1"><i class="fas fa-comment-slash"></i></div>
        <div class="bg-game-element bg-brain-1"><i class="fas fa-brain"></i></div>
        <div class="bg-game-element bg-list-2"><i class="fas fa-list-ul"></i></div>
        <div class="bg-game-element bg-trophy-2"><i class="fas fa-trophy"></i></div>
        <div class="bg-game-element bg-bullhorn-2"><i class="fas fa-bullhorn"></i></div>
        <div class="bg-game-element bg-comment-slash-2"><i class="fas fa-comment-slash"></i></div>
        <div class="bg-game-element bg-list-3"><i class="fas fa-list-ul"></i></div>
    </div>

    <script>
        // THIS SCRIPT MUST RUN FIRST
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>

    <div class="game-container">
       <a href="#" onclick="history.back(); return false;" id="home-menu-btn" class="icon-btn" aria-label="Back to the previous page">
            <i class="fas fa-home"></i>
        </a>
        <button id="back-btn" class="icon-btn" aria-label="Go Back" style="display: none;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Start Screen -->
        <div class="screen active" id="start-screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Categories Showdown IRL</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY:</strong></p>
                <ul>
                    <li><i class="fas fa-shuffle"></i> A random physical action category is displayed (e.g., "Jumping Jacks")</li>
                    <li><i class="fas fa-hourglass-half"></i> Teams take turns declaring how many repetitions of that action they can do within 30 seconds, always stating a higher number!</li>
                    <li><i class="fas fa-circle-exclamation"></i> If a team doubts the opposing team can meet their stated number, they can call "BS"!</li>
                    <li><i class="fas fa-trophy"></i> If "BS" is called, the challenged team attempts to perform their declared number in 30 seconds. Succeed, and they get the point; fail, and the calling team earns the point!</li>
                     <li>
                        <a href="https://www.youtube.com/watch?v=4oJPH2kzaR8" target="_blank" rel="noopener noreferrer">
                            <i class="fab fa-youtube"></i> Watch a video on how to play!
                        </a>
                    </li>
                </ul>
            </div>
            <button onclick="showTeamSetup()" class="btn-primary">
                <i class="fas fa-users"></i> Setup Teams
            </button>
        </div>

        <!-- Team Setup Screen -->
        <div class="screen" id="team-setup">
            <h3>Enter Team Names</h3>
            <div class="team-inputs-container">
                <div class="team-inputs" id="team-inputs-grid"> 
                    <div class="team-input">
                        <label for="team1-name">Team 1 Name:</label>
                        <input type="text" id="team1-name" placeholder="Team 1">
                    </div>
                    <div class="team-input">
                        <label for="team2-name">Team 2 Name:</label>
                        <input type="text" id="team2-name" placeholder="Team 2">
                    </div>
                </div>
            </div>
            <button onclick="startGame()" class="btn-primary">
                <i class="fas fa-play"></i> Begin Game
            </button>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="game-screen">
            <div class="team-display">
                <div class="team-card" id="team1-card">
                    <div class="team-name" id="team1-name-display">Team 1</div>
                    <div class="team-score" id="team1-score">0</div>
                </div>
                <div class="team-card" id="team2-card">
                    <div class="team-name" id="team2-name-display">Team 2</div>
                    <div class="team-score" id="team2-score">0</div>
                </div>
            </div>

            <div class="category-display" id="category-display">Category Appears Here</div>
            
            <div class="timer-container">
                <div class="timer">
                    <div class="timer-progress" id="timer-progress-bar"></div>
                </div>
            </div>

            <div class="bullshit-buttons" id="bullshit-buttons">
                <button class="btn-danger bullshit-btn" id="team1-bullshit" onclick="startChallenge(1)">
                    <i class="fas fa-bullhorn"></i> Call BS on Team 2
                </button>
                <button class="btn-danger bullshit-btn" id="team2-bullshit" onclick="startChallenge(2)">
                    <i class="fas fa-bullhorn"></i> Call BS on Team 1
                </button>
            </div>

            <div class="result-buttons" id="result-buttons">
                <button class="btn-success success-btn" onclick="challengeResult(true)">
                    <i class="fas fa-check-circle"></i> Succeeded
                </button>
                <button class="btn-danger fail-btn" onclick="challengeResult(false)">
                    <i class="fas fa-times-circle"></i> Failed
                </button>
            </div>
        </div>

        <!-- Win Screen -->
        <div class="screen" id="win-screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over!</h1>
            <div class="win-message" id="win-message">Team Wins!</div>
            <div class="winner-trophy">🏆</div>
            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                    <button onclick="resetGame()" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                </div>
                <div class="game-over-button-wrapper">
                     <button onclick="goToMainMenu()" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper">
                    <button onclick="visitStore()" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Consent Modal -->
    <div id="audio-consent-modal" class="modal">
        <div class="modal-content">
            <h3>Enable Audio?</h3>
            <p style="text-align: center;">This game has background music and sound effects. Would you like to enable them for the best experience?</p>
            <div id="audio-consent-buttons">
                <button id="audio-consent-yes-btn" class="btn-success"><i class="fas fa-volume-up"></i> Yes, please!</button>
                <button id="audio-consent-no-btn" class="btn-secondary"><i class="fas fa-volume-mute"></i> No, thanks</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <h3 id="close-modal-btn" class="close-modal-btn">×</h3>
            <h3>Settings</h3>
            <div class="setting-item">
                <label for="bgm-volume-slider">Background Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.3">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>

    <!-- Time Up Pop-up -->
    <div id="time-up-animation" class="time-up" style="display:none;">TIME'S UP!</div>

    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="timer-tick-sound" loop src="https://static.wixstatic.com/mp3/9ce3e5_e21a31f16e3944fbbe04069310b2990a.mp3"></audio>
    <audio id="time-up-sound" src="https://static.wixstatic.com/mp3/9ce3e5_16ac679126354f7db8a0f93c9f4fa7a1.wav"></audio>
    <audio id="confetti-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>

    <script>
        const categories = ["Pushups", "Situps", "Jumping Jacks", "Squats", "Burpees", "Lunges", "High Knees", "Leg Raises", "Tricep Dips", "Socks you can put on", "Spin without falling", "Kickups", "People you can message", "Water you can dirnk", "Books you can balance on head", "Pick up lines you can say", "Stars you can draw", "Run around a table", "Grapes or Similar items you can eat", "Animals you can act out", "Movie scenes you can reenact", "Punches you can throw", "Clothes you can fold", "Toothpicks/Pencils you can transfer from one box to another"];
        const gameState = { team1: { name: "Team 1", score: 0 }, team2: { name: "Team 2", score: 0 }, currentCategory: "", timerInterval: null, timeLeft: 30, challengedTeamIndex: null, winningScore: 5, usedCategories: [] };
        
        const screens = { start: document.getElementById("start-screen"), teamSetup: document.getElementById("team-setup"), game: document.getElementById("game-screen"), win: document.getElementById("win-screen") };
        const homeMenuBtnEl = document.getElementById('home-menu-btn');
        const backBtnEl = document.getElementById('back-btn');
        const timerProgressBar = document.getElementById("timer-progress-bar");
        const timeUpAnimationEl = document.getElementById("time-up-animation");
        const storeButtonWrapperEl = document.getElementById("store-button-wrapper");
        let treatYourselfElement = null;

        let sfxEnabled = true;
        let musicVolume = 0.3;
        let audioContextStarted = false;
        
        const allSfx = [ document.getElementById('interaction-sound'), document.getElementById('timer-tick-sound'), document.getElementById('time-up-sound'), document.getElementById('confetti-sound') ];
        
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const bgmVolumeSlider = document.getElementById('bgm-volume-slider');
        const sfxToggleBtn = document.getElementById('sfx-toggle-btn');
        const backgroundMusic = document.getElementById('background-game-music');
        const audioConsentModal = document.getElementById('audio-consent-modal');
        const audioConsentYesBtn = document.getElementById('audio-consent-yes-btn');
        const audioConsentNoBtn = document.getElementById('audio-consent-no-btn');

        function initAudio() {
            if (audioContextStarted) return;
            backgroundMusic.play().then(() => {
                audioContextStarted = true;
                if (musicVolume <= 0 || document.hidden) {
                    backgroundMusic.pause();
                }
            }).catch(e => { console.warn("Audio autoplay blocked, waiting for user interaction.", e); });
        }
        
        function playSound(audioElement) { 
            if (sfxEnabled && audioElement && audioContextStarted) { 
                audioElement.pause();
                audioElement.currentTime = 0; 
                audioElement.play().catch(e => {}); 
            } 
        }

        function stopSound(audioElement) {
             if (audioElement && audioContextStarted) { 
                audioElement.pause();
                audioElement.currentTime = 0; 
            } 
        }

        function playSoundWithCallback(audioElement, callback, ...args) { 
            if (sfxEnabled && audioElement && audioContextStarted) {
                audioElement.pause();
                audioElement.currentTime = 0;
                let cbExecuted = false;
                const execCb = () => {
                    if (!cbExecuted) {
                        cbExecuted = true;
                        audioElement.removeEventListener('ended', execCb);
                        if (callback) callback(...args);
                    }
                };
                audioElement.addEventListener('ended', execCb);
                audioElement.play().catch(e => { execCb(); });
            } else { 
                if (callback) callback(...args);
            }
        }
        
        function loadAudioSettings() { const savedVol = localStorage.getItem('musicVolume'), savedSfx = localStorage.getItem('sfxEnabled'); if (savedVol !== null) musicVolume = parseFloat(savedVol); if (savedSfx !== null) sfxEnabled = savedSfx === 'true'; backgroundMusic.volume = musicVolume; bgmVolumeSlider.value = musicVolume; sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`; }

        settingsBtn.addEventListener('click', () => { playSound(allSfx[0]); settingsModal.style.display = 'flex'; });
        closeModalBtn.addEventListener('click', () => { playSound(allSfx[0]); settingsModal.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target === settingsModal) { playSound(allSfx[0]); settingsModal.style.display = 'none'; } });
        bgmVolumeSlider.addEventListener('input', (e) => { musicVolume = parseFloat(e.target.value); backgroundMusic.volume = musicVolume; localStorage.setItem('musicVolume', musicVolume); if (musicVolume > 0 && !document.hidden && audioContextStarted) backgroundMusic.play().catch(e=>{}); else backgroundMusic.pause(); });
        sfxToggleBtn.addEventListener('click', () => { sfxEnabled = !sfxEnabled; sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`; playSound(allSfx[0]); localStorage.setItem('sfxEnabled', String(sfxEnabled)); });

        function switchScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.remove("active"));
            screens[screenId].classList.add("active");

            const isStartScreen = screenId === 'start';
            homeMenuBtnEl.style.display = isStartScreen ? 'flex' : 'none';
            backBtnEl.style.display = isStartScreen ? 'none' : 'flex';

            if (screenId === 'win') backBtnEl.style.display = 'none';
            if (treatYourselfElement) treatYourselfElement.style.display = (screenId === 'win') ? 'flex' : 'none';
        }

        function showTeamSetup() { playSound(allSfx[0]); switchScreen("teamSetup"); }
        function goToMainMenu() { stopSound(allSfx[1]); playSound(allSfx[0]); if (treatYourselfElement) treatYourselfElement.style.display = 'none'; switchScreen('start'); }
        
        backBtnEl.addEventListener("click", goToMainMenu);

        function startGame() {
            playSoundWithCallback(allSfx[0], () => {
                gameState.team1.name = document.getElementById("team1-name").value.trim() || "Team 1";
                gameState.team2.name = document.getElementById("team2-name").value.trim() || "Team 2";
                if (gameState.team1.name.length > 15 || gameState.team2.name.length > 15) { alert("Team names too long!"); return; }
                if (gameState.team1.name.toLowerCase() === gameState.team2.name.toLowerCase()) { alert("Team names must be different!"); return; }
                resetGame(false);
            });
        }
        
        function newRound() {
            let availableCategories = categories.filter(cat => !gameState.usedCategories.includes(cat));
            if (availableCategories.length === 0) {
                gameState.usedCategories = [];
                availableCategories = [...categories];
            }
            gameState.currentCategory = availableCategories[Math.floor(Math.random() * availableCategories.length)];
            gameState.usedCategories.push(gameState.currentCategory);
            
            document.getElementById("category-display").textContent = gameState.currentCategory;
            clearInterval(gameState.timerInterval); 
            stopSound(allSfx[1]);
            timerProgressBar.style.transition = 'none';
            timerProgressBar.style.width = "100%"; 
            void timerProgressBar.offsetWidth;
            timerProgressBar.style.transition = 'width 0.1s linear';
            gameState.timeLeft = 30; gameState.challengedTeamIndex = null; 
            document.getElementById("bullshit-buttons").style.display = "flex";
            document.getElementById("result-buttons").style.display = "none";
            document.getElementById("team1-card").classList.remove("active-team");
            document.getElementById("team2-card").classList.remove("active-team");
        }

        function startChallenge(callingTeamNumber) { 
            playSound(allSfx[0]);
            gameState.challengedTeamIndex = callingTeamNumber === 1 ? 1 : 0; 
            document.getElementById("team1-card").classList.toggle("active-team", gameState.challengedTeamIndex === 0);
            document.getElementById("team2-card").classList.toggle("active-team", gameState.challengedTeamIndex === 1);
            document.getElementById("bullshit-buttons").style.display = "none";
            clearInterval(gameState.timerInterval); gameState.timeLeft = 30; 
            timerProgressBar.style.transition = 'none';
            timerProgressBar.style.width = "100%";
            void timerProgressBar.offsetWidth;
            timerProgressBar.style.transition = 'width 0.1s linear';
            gameState.timerInterval = setInterval(updateTimer, 100); 
            playSound(allSfx[1]);
        }

        function updateTimer() {
            gameState.timeLeft -= 0.1;
            timerProgressBar.style.width = `${Math.max(0, (gameState.timeLeft / 30) * 100)}%`;
            if (gameState.timeLeft <= 0) {
                clearInterval(gameState.timerInterval); 
                stopSound(allSfx[1]);
                playSound(allSfx[2]); 
                timerProgressBar.style.width = "0%";
                showTimeUpAnimation(); document.getElementById("result-buttons").style.display = "flex"; 
            }
        }

        function showTimeUpAnimation() {
            timeUpAnimationEl.style.display = "block";
            timeUpAnimationEl.style.animation = 'none';
            timeUpAnimationEl.offsetHeight;
            timeUpAnimationEl.style.animation = 'timeUpPopAnim 1.5s forwards';
        }

        function challengeResult(challengedTeamSucceeded) {
            playSound(allSfx[0]);
            clearInterval(gameState.timerInterval); 
            stopSound(allSfx[1]);
            document.getElementById("result-buttons").style.display = "none"; 
            if (challengedTeamSucceeded) { if (gameState.challengedTeamIndex === 0) gameState.team1.score++; else gameState.team2.score++; }
            else { if (gameState.challengedTeamIndex === 0) gameState.team2.score++; else gameState.team1.score++; }
            updateScores();
            if (gameState.team1.score >= gameState.winningScore || gameState.team2.score >= gameState.winningScore) { showWinScreen(); }
            else { newRound(); }
        }

        function updateScores() {
            document.getElementById("team1-score").textContent = gameState.team1.score;
            document.getElementById("team2-score").textContent = gameState.team2.score;
        }

        function showWinScreen() {
            stopSound(allSfx[1]);
            const winner = gameState.team1.score >= gameState.winningScore ? gameState.team1.name : gameState.team2.name;
            document.getElementById("win-message").textContent = `${winner} Wins!`;
             if (!treatYourselfElement) {
                treatYourselfElement = document.createElement('div');
                treatYourselfElement.className = 'treat-yourself-callout';
                treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`;
                storeButtonWrapperEl.insertBefore(treatYourselfElement, document.querySelector('#store-button-wrapper button.btn-info'));
            }
            switchScreen("win");
            triggerConfetti();
        }
        
        function triggerConfetti() {
            playSound(allSfx[3]);
            const confettiCount = 150;
            const colors = ['var(--blyza-orange-primary)', 'var(--blyza-purple-secondary)', 'var(--blyza-keppel-accent)'];
            document.querySelectorAll('.confetti-piece').forEach(el => el.remove());
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                const animationDuration = Math.random() * 3 + 3;
                const animationDelay = Math.random() * 2;
                confetti.style.animation = `fallAndFade ${animationDuration}s ${animationDelay}s linear forwards`;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), (animationDuration + animationDelay + 0.5) * 1000);
            }
        }

        function resetGame(returnToSetup = true) {
            playSound(allSfx[0]);
            gameState.team1.score = 0; gameState.team2.score = 0;
            gameState.usedCategories = [];
            if (returnToSetup) {
                document.getElementById("team1-name").value = gameState.team1.name;
                document.getElementById("team2-name").value = gameState.team2.name;
                if (treatYourselfElement) treatYourselfElement.style.display = 'none';
                switchScreen("teamSetup");
            } else {
                 document.getElementById("team1-name-display").textContent = gameState.team1.name;
                 document.getElementById("team2-name-display").textContent = gameState.team2.name;
                 document.getElementById("team1-bullshit").innerHTML = `<i class="fas fa-bullhorn"></i> Call BS on ${gameState.team2.name}`;
                 document.getElementById("team2-bullshit").innerHTML = `<i class="fas fa-bullhorn"></i> Call BS on ${gameState.team1.name}`;
                 updateScores();
                 newRound();
                 switchScreen("game");
            }
        }
        
        function handleVisibilityChange() {
            if (!audioContextStarted) return;
            if (document.hidden) {
                backgroundMusic.pause();
                stopSound(allSfx[1]);
            } else if (musicVolume > 0) {
                backgroundMusic.play().catch(e => {});
            }
        }

        function handlePageShow(event) {
            if (event.persisted) {
                setAppHeight(); 
                goToMainMenu();
            }
        }

        function visitStore() { playSound(allSfx[0]); window.location.href = '/store';  }

        document.addEventListener('DOMContentLoaded', () => {
            loadAudioSettings();
            audioConsentModal.style.display = 'flex';
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('pageshow', handlePageShow);
            goToMainMenu();
        });

        audioConsentYesBtn.addEventListener('click', () => {
            audioConsentModal.style.display = 'none';
            initAudio();
            playSound(allSfx[0]);
        });
        
        audioConsentNoBtn.addEventListener('click', () => {
            audioConsentModal.style.display = 'none';
            sfxEnabled = false;
            musicVolume = 0;
            backgroundMusic.volume = 0;
            bgmVolumeSlider.value = 0;
            sfxToggleBtn.textContent = 'SFX: OFF';
            localStorage.setItem('sfxEnabled', 'false'); 
            localStorage.setItem('musicVolume', '0'); 
            initAudio();
        });

        // --- CUSTOM SCROLL REDIRECTION LOGIC ---
        const gameContainerForScroll = document.querySelector('.game-container');
        let lastTouchY = 0;

        window.addEventListener('wheel', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                gameContainerForScroll.scrollTop += e.deltaY;
            }
        }, { passive: true });

        window.addEventListener('touchstart', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                if (e.touches.length > 0) {
                    lastTouchY = e.touches[0].clientY;
                }
            }
        }, { passive: true });

        window.addEventListener('touchmove', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                e.preventDefault(); 
                if (e.touches.length > 0) {
                    const currentTouchY = e.touches[0].clientY;
                    const deltaY = lastTouchY - currentTouchY;
                    gameContainerForScroll.scrollTop += deltaY;
                    lastTouchY = currentTouchY;
                }
            }
        }, { passive: false });
        // --- END OF CUSTOM SCROLL LOGIC ---
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-N5PBKM0DNQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N5PBKM0DNQ');
</script>

</body>
</html>