<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Wars - Game Show Edition!</title> 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300..700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles from 5 Seconds Frenzy (GTP Themed) */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary: #FF8833; /* Blyza Orange */
            --secondary: #CB7AE1; /* Blyza Purple */
            --light: #F2F2F2;
            --success: #00BFA6; /* Blyza Keppel */
            --danger: #ff4b2b;
            --dark: #1a1c20;
            --darker: #0f1012;
            --info: #4ECDC4;
            --gold: #FFD700; /* Game show gold */
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 900px;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px; /* GTP Padding */
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Brand Logo Styles */
        .brand-logo {
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .brand-logo-prominent {
            display: block;
            margin: 0 auto 20px;
            max-height: 80px; /* GTP Height */
        }

        h1 { /* Main Game Title */
            font-family: "Luckiest Guy", cursive;
            font-size: 3rem; /* GTP Size */
            margin-bottom: 25px;
            color: var(--gold);
            text-shadow:
                0 2px 0px #000,
                0 4px 6px rgba(0, 0, 0, 0.5),
                0 0 30px var(--primary);
            letter-spacing: 1px;
            margin-top: 10px;
        }
         h3 { /* For subheadings like "Enter Team Names" */
            font-family: "Bungee", cursive;
            font-size: 1.6rem; /* GTP Subheading size */
            margin-bottom: 20px;
            color: var(--primary); /* Or var(--gold) */
            text-shadow: 0 1px 2px #000;
         }


        /* Screen Styles */
        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .active { display: block; }

        /* Instructions Section - GTP Style */
        .instructions {
            font-family: "Quicksand", sans-serif;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px; border-radius: 20px; margin: 30px 0;
            line-height: 1.8; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2); text-align: left;
        }
        .instructions p { font-size: 1.1rem; margin-bottom: 15px; color: var(--light); }
         .instructions p strong:first-child { /* "How to play:" title */
            font-family: "Bungee", cursive; font-size: 1.2em; display: block; margin-bottom: 10px;
         }
         .instructions p strong { color: var(--primary); }
         .instructions a { color: var(--secondary); text-decoration: none; font-weight: bold; display: inline-flex; align-items: center; gap: 5px; transition: color 0.3s ease; }
         .instructions a:hover { color: var(--primary); text-decoration: underline; }
         .instructions a i { font-size: 1.2em; }


        /* Team Setup - GTP Style */
        .team-inputs-container {
            margin: 30px 0; background: rgba(255,255,255,0.05); padding: 30px;
            border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
        }
        .team-inputs {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Wider inputs */
            gap: 20px;
        }
        .team-input label {
            display: block; margin-bottom: 10px; font-weight: 600;
            color: var(--light); font-size: 1.1rem; text-align: left; font-family: "Bungee", cursive;
        }
        .team-input input {
            width: 100%; padding: 15px 20px; border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1); font-size: 1.1rem;
            background: rgba(255,255,255,0.05); color: var(--light);
            transition: all 0.3s ease; font-family: 'Quicksand', sans-serif;
        }
        .team-input input:focus {
            outline: none; border-color: var(--secondary);
            box-shadow: 0 0 10px rgba(203,122,225,0.2);
        }

        /* Game Screen Specifics - GTP Style */
        .team-display {
            display: flex; justify-content: space-around; gap: 20px;
            margin: 30px 0; flex-wrap: wrap;
        }
        .team-card {
            background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;
            border: 2px solid var(--gold); transition: all 0.3s ease;
            min-width: 200px; flex: 1; max-width: 300px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        .team-card.active-captain { /* Highlight active captain's team */
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255,136,51,0.3), 0 0 10px var(--gold),
                        inset 0 0 10px rgba(255,136,51,0.1);
            transform: scale(1.05); background: rgba(var(--primary-rgb,255,136,51),0.1);
        }
        .team-name {
            font-family: "Bungee", cursive; font-weight: normal; font-size: 1.4rem;
            margin-bottom: 5px; color: var(--primary); text-shadow: 0 1px 1px #000;
        }
        .team-score {
            font-family: "Orbitron", sans-serif; font-size: 2.5rem;
            color: var(--light); text-shadow: 0 0 8px var(--gold); margin-bottom: 5px;
        }
        .captain-label {
            font-size: 1em; /* Adjusted size */
            color: var(--success);
            font-family: "Bungee", cursive; /* Make it stand out */
            text-shadow: 0 0 5px var(--success);
            min-height: 1.2em; 
            margin-top: 5px;
        }

        .word-display {
            font-family: "Luckiest Guy", cursive; font-size: 2.5em; /* Larger word display */
            margin: 35px auto; min-height: 120px; max-width: 75%;
            display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.35); padding: 30px; border-radius: 18px;
            line-height: 1.3; color: var(--gold); /* Word in gold */
            border: 2px solid var(--gold); box-shadow: 0 0 20px var(--gold), inset 0 0 10px rgba(0,0,0,0.3);
            text-shadow: 0 2px 3px #000;
            text-transform: uppercase; letter-spacing: 3px;
        }

        .point-buttons {
            display: flex; justify-content: center; gap: 25px;
            margin-top: 35px; flex-wrap: wrap;
        }
        /* Point buttons will inherit general button styling */


        /* Win Screen Styles - GTP Style */
        .win-message {
            font-size: 3rem; margin: 30px 0; color: var(--gold);
            text-shadow: 0 3px 0px #000, 0 0 20px var(--primary);
            font-family: "Luckiest Guy", cursive;
        }
        .winner-trophy {
            font-size: 6rem; margin: 20px 0 30px 0;
            animation: bounce 1.5s infinite ease-in-out; color: var(--gold);
            text-shadow: 0 0 20px var(--gold), 0 0 30px var(--primary);
        }
        @keyframes bounce { 0%,100%{transform:translateY(0) scale(1);} 50%{transform:translateY(-35px) scale(1.1);} }
        /* Game Over Buttons & Treat Yourself - GTP Style */
        .game-over-buttons-container { display: flex; justify-content: center; align-items: flex-start; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        .game-over-button-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
        .treat-yourself-callout { margin-bottom: 8px; background-color: var(--gold); color: var(--darker); padding: 8px 15px; border-radius: 20px; font-family: "Bungee",cursive; font-size:0.9rem; white-space:nowrap; box-shadow:0 2px 10px rgba(255,215,0,0.5); display:none; align-items:center; gap:8px; z-index:10;}
        .treat-yourself-callout i { font-size: 1.2em; animation: bounceArrow 1s infinite; }
        @keyframes bounceArrow { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-4px);} }


        /* Confetti */
        .confetti {
            position: fixed; width: 10px; height: 20px; background-color: var(--primary);
            opacity: 0; top: -20px; z-index: 3000; pointer-events: none;
            animation-timing-function: linear; animation-fill-mode: forwards;
        }
        @keyframes fallAndFade { 0%{transform:translateY(-20vh) rotate(0deg); opacity:1;} 100%{transform:translateY(120vh) rotate(720deg); opacity:0;} }


        /* Buttons - GTP Style */
        button {
            background: linear-gradient(135deg, var(--primary) 0%, #ff7711 100%);
            color: var(--light); border: 2px solid var(--darker); padding: 15px 25px;
            font-size: 1rem; border-radius: 50px; cursor: pointer;
            font-weight: normal; /* Bungee is bold */ transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), inset 0 -2px 5px rgba(0,0,0,0.2);
            margin: 10px 5px; font-family: "Bungee", cursive; text-shadow: 1px 1px 2px #000;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            min-width: 180px; flex-shrink: 0;
        }
        button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--primary);
            background: linear-gradient(135deg, #ff7711 0%, var(--primary) 100%);
        }
        button:active:not(:disabled) { transform: translateY(-1px) scale(1.02); }
        button:disabled {
            background: rgba(255,255,255,0.1); cursor:not-allowed; opacity:0.6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transform:none; border-color: rgba(0,0,0,0.5);
        }
        .btn-primary {}
        .btn-success { background: linear-gradient(135deg, var(--success) 0%, #00a890 100%); }
        .btn-success:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--success); }
        .btn-danger { background: linear-gradient(135deg, var(--danger) 0%, #ff416c 100%); }
        .btn-danger:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--danger); }
        .btn-secondary { background: linear-gradient(135deg, var(--secondary) 0%, #b85cd6 100%); }
        .btn-secondary:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--secondary); }
        .btn-info { background: linear-gradient(135deg, var(--info) 0%, #3eb7af 100%); }
        .btn-info:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--info); }


        /* Settings Icon Button, Modal, Feedback Pop-up - GTP Style */
        .icon-btn { position:absolute; background:rgba(0,0,0,0.3); color:var(--light); border:1px solid var(--gold); border-radius:50%; width:40px; height:40px; font-size:1.1rem; cursor:pointer; transition:all .3s ease; display:flex; justify-content:center; align-items:center; z-index:100; padding:0; margin:0; box-shadow:none; text-shadow:none; }
        .icon-btn#settings-btn { top:15px; right:15px; }
        .icon-btn:hover { background:rgba(0,0,0,0.5); transform:scale(1.1) rotate(15deg); box-shadow:0 0 10px var(--gold); }
        .icon-btn i { margin:0; }
        .modal { position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.7); backdrop-filter:blur(8px); display:none; justify-content:center; align-items:center; }
        .modal-content { background-color:var(--darker); margin:auto; padding:30px; border:2px solid var(--gold); border-radius:15px; width:80%; max-width:450px; box-shadow:0 10px 30px rgba(0,0,0,0.6),0 0 20px var(--primary); position:relative; color:var(--light); }
        .modal-content h2 { font-family:"Bungee",cursive; color:var(--primary); text-align:center; margin-bottom:25px; font-size:1.8rem; }
        .setting-item { margin-bottom:20px; display:flex; flex-direction:column; }
        .setting-item label { margin-bottom:8px; font-weight:600; font-size:0.9rem;}
        input[type=range] { -webkit-appearance:none; width:100%; background:transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; height:20px; width:20px; border-radius:50%; background:var(--primary); cursor:pointer; margin-top:-7px; box-shadow:0 0 8px var(--primary); }
        input[type=range]::-moz-range-thumb { height:20px; width:20px; border-radius:50%; background:var(--primary); cursor:pointer; border:none; box-shadow:0 0 8px var(--primary); }
        input[type=range]::-webkit-slider-runnable-track { width:100%; height:6px; cursor:pointer; background:rgba(255,255,255,0.2); border-radius:3px; border:1px solid rgba(0,0,0,0.2); }
        input[type=range]::-moz-range-track { width:100%; height:6px; cursor:pointer; background:rgba(255,255,255,0.2); border-radius:3px; border:1px solid rgba(0,0,0,0.2); }
        .close-modal-btn { color:#aaa; position:absolute; top:15px; right:20px; font-size:28px; font-weight:bold; cursor:pointer; }
        .close-modal-btn:hover, .close-modal-btn:focus { color:var(--light); text-decoration:none; }

        .feedback-popup {
            position: fixed; top: 50%; left: 50%; background-color: rgba(15, 16, 18, 0.97);
            color: white; padding: 30px 50px; border-radius: 20px; font-size: 2.8rem;
            font-family: "Luckiest Guy", cursive; text-align: center;
            z-index: 2000; box-shadow: 0 15px 40px rgba(0,0,0,0.7);
            opacity: 0; transform: translate(-50%,-50%) scale(0.7);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none; border: 3px solid var(--gold); display: none;
        }
        .feedback-popup.show { opacity: 1; transform: translate(-50%,-50%) scale(1); pointer-events: auto; display: block; }
        .feedback-popup.point-scored { /* Use a distinct class or re-use .correct/.info */
            color: var(--success); border-color: var(--success); text-shadow: 0 0 15px var(--success);
        }


        /* Responsive Design */
        @media (max-width: 768px) {
            .game-container { padding: 25px; }
            h1 { font-size: 2.5rem; }
            h3 { font-size: 1.4rem; }
            .team-display { flex-direction: column; align-items: center; gap: 15px; }
            .team-card { min-width: 80%; max-width: 90%; }
            .word-display { font-size: 2em; padding: 20px; max-width: 95%; min-height: 90px;}
            .point-buttons { flex-direction: column; align-items: center; gap: 10px;}
            .point-buttons button { width: 85%; max-width: 320px;}
            button { padding: 12px 22px; font-size: 1rem; min-width: 170px;}
            .icon-btn { top:15px; right:15px; width:40px; height:40px; font-size:1rem; }
            .modal-content h2 { font-size:1.6rem; }
            .win-message { font-size: 2.2rem; }
            .winner-trophy { font-size: 5rem; }
            .game-over-buttons-container { flex-direction: column; align-items: center;}
            .game-over-buttons-container .game-over-button-wrapper { width: 90%; margin: 5px auto;}
            .game-over-buttons-container .game-over-button-wrapper button { width: 100%;}
            .feedback-popup { font-size: 2.2rem; padding: 25px 40px; width: 80%;}
        }
        @media (max-width: 480px) {
            h1 { font-size: 2rem; }
            h3 { font-size: 1.2rem; }
            .team-inputs { grid-template-columns: 1fr; }
            .team-input input { max-width: 100%; padding: 12px 18px; font-size: 1rem;}
            .instructions { padding: 20px;}
            .instructions p { font-size: 1rem;}
            .word-display {font-size: 1.8em; min-height: 80px;}
        }

    </style>
</head>
<body>
    <div class="game-container">
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Start Screen -->
        <div class="screen active" id="start-screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Word Wars</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY:</strong></p>
                <p>A secret word is shown ONLY to the captains of each team. Captains take turns giving one-word clues to their teammates. The goal is for your team to guess the secret word using the FEWEST clues possible.</p>
                <p>After a team correctly guesses the word, the round ends. The team that used fewer clues (or if the other team couldn't guess) wins the point for that round. Captains rotate each round. First to 5 points wins!</p>
            <a href="https://www.youtube.com/watch?v=Tc1YY5FapAs" target="_blank" rel="noopener noreferrer" style="color:var(--gold);">
                <i class="fab fa-youtube"></i> Watch a video tutorial on rules
            </a>
            </div>
            <button onclick="showTeamSetup()" class="btn-primary">
                <i class="fas fa-users"></i> Setup Teams
            </button>
        </div>

        <!-- Team Setup Screen -->
        <div class="screen" id="team-setup">
            <h3>Enter Team Names</h3>
            <div class="team-inputs-container">
                <div class="team-inputs" id="team-inputs-grid">
                    <div class="team-input">
                        <label for="team1-name">Team 1 Name:</label>
                        <input type="text" id="team1-name" placeholder="Team 1">
                    </div>
                    <div class="team-input">
                        <label for="team2-name">Team 2 Name:</label>
                        <input type="text" id="team2-name" placeholder="Team 2">
                    </div>
                </div>
            </div>
            <button onclick="startGame()" class="btn-primary">
                <i class="fas fa-play"></i> Begin Game
            </button>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="game-screen">
            <div class="team-display">
                <div class="team-card" id="team1-card">
                    <div class="team-name" id="team1-name-display">Team 1</div>
                    <div class="team-score" id="team1-score">0</div>
                    <div class="captain-label" id="team1-captain">(Captain)</div>
                </div>
                <div class="team-card" id="team2-card">
                    <div class="team-name" id="team2-name-display">Team 2</div>
                    <div class="team-score" id="team2-score">0</div>
                    <div class="captain-label" id="team2-captain"></div>
                </div>
            </div>

            <div class="word-display" id="word-display">SECRET WORD</div>

            <div class="point-buttons">
                <button class="point-btn" id="team1-point" onclick="awardPoint(0)">
                    <i class="fas fa-star"></i> Point for <span id="team1-point-name">Team 1</span>
                </button>
                <button class="point-btn" id="team2-point" onclick="awardPoint(1)">
                     <i class="fas fa-star"></i> Point for <span id="team2-point-name">Team 2</span>
                </button>
            </div>
        </div>

        <!-- Win Screen -->
        <div class="screen" id="win-screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over!</h1>
            <div class="win-message" id="win-message">Team Wins!</div>
            <div class="winner-trophy">üèÜ</div>
            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                    <button onclick="resetGame()" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                </div>
                <div class="game-over-button-wrapper">
                     <button onclick="goToMainMenu()" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper">
                    <div class="treat-yourself-callout" id="treat-yourself-message" style="display:none;">
                        <span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>
                    </div>
                    <button onclick="visitStore()" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">√ó</span>
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="bgm-volume-slider">Background Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.3">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>

    <!-- Feedback Pop-up -->
    <div id="feedback-popup" class="feedback-popup"> <!-- display:none handled by .show -->
        <span id="feedback-message-text-el"></span>
    </div>

    <!-- Audio elements -->
    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="point-scored-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio> <!-- Sound for point scoring -->
    <audio id="confetti-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>


    <script>
        const words = [
            "Freedom","Memory","Chaos","Fame","Trust", "Silence", "Luck", "Karma", "Intelligence", "Power", "Peace", "Jealousy", "Friendship", "Pain", "Truth", "Ex", "Gossip", "Procrastination", "Karaoke", "Sarcasm", "Binge", "Ghosting", "Broccoli", "Ego", "Vibe", "Deadline", "Tequila", "Creep", "Toxic", "Cringe", "Fart", "Karen", "Mullet", "Mood" , "Influencer", "Netflix", "Screenshot", "Viral", "Podcast","Vlog", "Algorithm","Guilt", "Messi", "Element", "Shadow", "Ebola", "Venezuela", "Cheesecake", "Armpit", "Fabric", "Wrestler", "Shawarma"
        ];

        const gameState = {
            teams: [ 
                { name: "Team 1", score: 0, isCaptain: true },
                { name: "Team 2", score: 0, isCaptain: false }
            ],
            currentWord: "",
            currentRound: 0,
            winningScore: 5 
        };

        const screens = { start: document.getElementById("start-screen"), teamSetup: document.getElementById("team-setup"), game: document.getElementById("game-screen"), win: document.getElementById("win-screen") };
        const feedbackPopupEl = document.getElementById('feedback-popup');
        const feedbackMessageTextEl = document.getElementById('feedback-message-text-el');
        let feedbackTimeoutId;
        const storeButtonWrapperEl = document.getElementById("store-button-wrapper");
        let treatYourselfElement = document.getElementById("treat-yourself-message");

        let sfxEnabled = true;
        let musicVolume = 0.3;

        const backgroundMusic = document.getElementById('background-game-music');
        const interactionSound = document.getElementById('interaction-sound');
        const pointScoredSound = document.getElementById('point-scored-sound');
        const confettiSound = document.getElementById('confetti-sound');
        
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const bgmVolumeSlider = document.getElementById('bgm-volume-slider');
        const sfxToggleBtn = document.getElementById('sfx-toggle-btn');

        function playSound(audioElement) { if (sfxEnabled && audioElement) { audioElement.currentTime = 0; audioElement.volume = 0.7; audioElement.play().catch(e => console.error("SFX play error:", e)); } }
        function playSoundWithCallback(audioElement, callback, ...args) { if (sfxEnabled && audioElement) { audioElement.currentTime = 0; audioElement.volume = 0.7; let cbEx=false; const exCb=()=>{if(!cbEx){cbEx=true; audioElement.removeEventListener('ended',exCb); if(typeof soundTimeoutId!=='undefined'&&soundTimeoutId)clearTimeout(soundTimeoutId); if(callback)callback(...args);}}; audioElement.addEventListener('ended',exCb); const sDur=(audioElement.duration&&isFinite(audioElement.duration))?audioElement.duration*1000:500; const soundTimeoutId=setTimeout(exCb,sDur+200); audioElement.play().catch(e=>{console.error("SFX play error:", e); exCb();});} else {if(callback)callback(...args);}}
        
        function showFeedbackMessage(message, type = 'info', duration = 2500) {
            feedbackMessageTextEl.textContent = message;
            feedbackPopupEl.className = 'feedback-popup';
            if (type) feedbackPopupEl.classList.add(type);
            feedbackPopupEl.classList.add('show');
            
            clearTimeout(feedbackTimeoutId);
            feedbackTimeoutId = setTimeout(() => {
                feedbackPopupEl.classList.remove('show');
            }, duration);
        }

        settingsBtn.addEventListener('click', () => { playSound(interactionSound); settingsModal.style.display = 'flex'; });
        closeModalBtn.addEventListener('click', () => { playSound(interactionSound); settingsModal.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target === settingsModal) { playSound(interactionSound); settingsModal.style.display = 'none'; } });
        bgmVolumeSlider.addEventListener('input', (e) => { musicVolume = parseFloat(e.target.value); backgroundMusic.volume = musicVolume; });
        sfxToggleBtn.addEventListener('click', () => { sfxEnabled = !sfxEnabled; sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`; playSound(interactionSound); sfxToggleBtn.classList.toggle('btn-success', sfxEnabled); sfxToggleBtn.classList.toggle('btn-danger', !sfxEnabled);});

        function initBackgroundMusic() { backgroundMusic.volume = musicVolume; backgroundMusic.play().catch(e => console.log("BGM autoplay failed.")); }
        
        function switchScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.remove("active"));
            screens[screenId].classList.add("active");
            document.getElementById('corner-logo-static').style.display = (screenId !== 'start') ? 'block' : 'none';
            if (treatYourselfElement) {
                treatYourselfElement.style.display = (screenId === 'win') ? 'flex' : 'none';
            }
        }

        function showTeamSetup() { playSound(interactionSound); switchScreen("teamSetup"); }
        function goToMainMenu() { playSound(interactionSound); if (treatYourselfElement) treatYourselfElement.style.display = 'none'; if(backgroundMusic.paused) initBackgroundMusic(); switchScreen('start'); }

        function startGame() {
            playSoundWithCallback(interactionSound, () => {
                gameState.teams[0].name = document.getElementById("team1-name").value.trim() || "Team 1";
                gameState.teams[1].name = document.getElementById("team2-name").value.trim() || "Team 2";

                if (gameState.teams[0].name.length > 15 || gameState.teams[1].name.length > 15) {
                    showFeedbackMessage("Team names too long (max 15 chars)!", "danger"); return;
                }
                if (gameState.teams[0].name === gameState.teams[1].name && gameState.teams[0].name !== "Team 1" && gameState.teams[0].name !== "") {
                    showFeedbackMessage("Team names must be different!", "danger"); return;
                }

                gameState.teams[0].score = 0; gameState.teams[1].score = 0;
                gameState.currentRound = 0; 
                gameState.teams[0].isCaptain = true; gameState.teams[1].isCaptain = false;

                updateTeamDisplays();
                newRound(); 
                switchScreen("game");
            });
        }

        function updateTeamDisplays() {
            document.getElementById("team1-name-display").textContent = gameState.teams[0].name;
            document.getElementById("team2-name-display").textContent = gameState.teams[1].name;
            document.getElementById("team1-score").textContent = gameState.teams[0].score;
            document.getElementById("team2-score").textContent = gameState.teams[1].score;
            document.getElementById("team1-point-name").textContent = gameState.teams[0].name;
            document.getElementById("team2-point-name").textContent = gameState.teams[1].name;
            document.getElementById("team1-captain").textContent = gameState.teams[0].isCaptain ? "(Captain)" : "";
            document.getElementById("team2-captain").textContent = gameState.teams[1].isCaptain ? "(Captain)" : "";
            document.getElementById("team1-card").classList.toggle("active-captain", gameState.teams[0].isCaptain);
            document.getElementById("team2-card").classList.toggle("active-captain", gameState.teams[1].isCaptain);
        }

        function newRound() {
            gameState.currentWord = words[Math.floor(Math.random() * words.length)];
            document.getElementById("word-display").textContent = gameState.currentWord;
            gameState.currentRound++;
            if (gameState.currentRound > 1) { 
                const tempCaptainStatus = gameState.teams[0].isCaptain;
                gameState.teams[0].isCaptain = gameState.teams[1].isCaptain;
                gameState.teams[1].isCaptain = tempCaptainStatus;
            }
            updateTeamDisplays(); 
        }

        function awardPoint(teamIndex) { 
            playSound(pointScoredSound); // Play specific point sound
            gameState.teams[teamIndex].score++;
            showFeedbackMessage(`${gameState.teams[teamIndex].name} scores a point!`, 'point-scored', 2000); // Custom feedback

            if (gameState.teams[0].score >= gameState.winningScore || gameState.teams[1].score >= gameState.winningScore) {
                showWinScreen();
            } else {
                newRound();
            }
        }

        function showWinScreen() {
            const winner = gameState.teams[0].score >= gameState.winningScore ? gameState.teams[0].name : gameState.teams[1].name;
            document.getElementById("win-message").textContent = `${winner} Wins!`;
            if (!treatYourselfElement) {
                 treatYourselfElement = document.getElementById('treat-yourself-message');
                 if (!treatYourselfElement && storeButtonWrapperEl) {
                    treatYourselfElement = document.createElement('div');
                    treatYourselfElement.className = 'treat-yourself-callout';
                    treatYourselfElement.id = 'treat-yourself-message';
                    treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`;
                    const visitStoreButton = document.querySelector('#store-button-wrapper button.btn-info');
                    if (visitStoreButton) {
                         storeButtonWrapperEl.insertBefore(treatYourselfElement, visitStoreButton);
                    }
                }
            }
            switchScreen("win");
            triggerConfetti();
        }
        function triggerConfetti() {
            playSound(confettiSound);
            const confettiCount = 150;
            const colors = ['var(--primary)', 'var(--secondary)', 'var(--success)', 'var(--gold)', 'var(--info)'];
            document.querySelectorAll('.confetti').forEach(el => el.remove());
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.opacity = '0';
                const animationDuration = Math.random() * 3 + 3;
                const animationDelay = Math.random() * 2;
                confetti.style.animation = `fallAndFade ${animationDuration}s ${animationDelay}s linear forwards`;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), (animationDuration + animationDelay + 0.5) * 1000);
            }
        }


        function resetGame() {
            playSound(interactionSound);
            document.getElementById("team1-name").value = gameState.teams[0].name;
            document.getElementById("team2-name").value = gameState.teams[1].name;
            gameState.teams[0].score = 0; gameState.teams[1].score = 0;
             if (treatYourselfElement) treatYourselfElement.style.display = 'none';
             if(backgroundMusic.paused) initBackgroundMusic();
            switchScreen("teamSetup");
        }

        function visitStore() { playSound(interactionSound); window.location.href = '/store';  }

        document.addEventListener('DOMContentLoaded', () => {
            initBackgroundMusic();
            sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`;
            sfxToggleBtn.classList.toggle('btn-success', sfxEnabled);
            sfxToggleBtn.classList.toggle('btn-danger', !sfxEnabled);
            bgmVolumeSlider.value = musicVolume; 
            treatYourselfElement = document.getElementById('treat-yourself-message');
        });
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>
</body>
</html>