<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Where in the World? - Blyza Game Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- START: BRAND IDENTITY & ROOT VARIABLES --- */
        :root {
            --blyza-orange-primary: #FF8833;
            --blyza-purple-secondary: #cb7ae1;
            --blyza-keppel-accent: #00BFA6;
            --blyza-sunny-yellow: #FFDF00;
            --blyza-quickfire-red: #EA2027;

            --darker-grey-bg: #4A4A4A;
            --text-light: #FDFEFE;
            --text-dark: #2C3A47;
            --text-medium: #535c68;
            --black-stroke: #1A1A1A;

            --font-logo: "Luckiest Guy", cursive;
            --font-heading-alt: "Bungee", cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-radius-game: 12px;
            --shadow-chunky: 4px 4px 0px var(--black-stroke);
        }
        /* --- END: BRAND IDENTITY & ROOT VARIABLES --- */

        /* --- Basic Reset & Body --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        
        body {
            font-family: var(--font-body);
            color: var(--text-light);
            background: linear-gradient(135deg, var(--blyza-orange-primary) 0%, var(--blyza-purple-secondary) 100%);
            line-height: 1.6;
            overflow: hidden; /* Body does not scroll */
            position: relative;
            height: var(--app-height, 100vh); /* Full screen height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- Floating Background Elements --- */
        .hero-background-elements { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
        .bg-game-element {
            position: absolute; opacity: 0.1; color: var(--text-light);
            animation: floatSimple 20s infinite ease-in-out alternate;
            user-select: none;
        }
        .bg-globe-1 { font-size: 150px; top: 10%; left: 5%; --initial-rotate: -15deg; animation-duration: 22s; }
        .bg-plane-1 { font-size: 100px; top: 65%; right: 8%; --initial-rotate: 10deg; animation-duration: 18s; }
        .bg-compass-1 { font-size: 120px; top: 70%; left: 15%; --initial-rotate: 5deg; animation-duration: 25s; opacity: 0.08; }
        .bg-map-1 { font-size: 130px; top: 15%; right: 10%; --initial-rotate: 20deg; animation-duration: 16s; }
        .bg-globe-2 { font-size: 80px; top: 80%; right: 25%; --initial-rotate: 25deg; animation-duration: 15s; }
        .bg-plane-2 { font-size: 120px; bottom: 5%; left: 3%; --initial-rotate: -5deg; animation-duration: 28s; }
        .bg-compass-2 { font-size: 90px; top: 20%; left: 20%; --initial-rotate: 15deg; animation-duration: 20s; }
        .bg-camera-1 { font-size: 70px; top: 5%; right: 30%; --initial-rotate: -10deg; animation-duration: 24s; }
        .bg-landmark-1 { font-size: 110px; bottom: 10%; right: 4%; --initial-rotate: 12deg; animation-duration: 19s; }
        .bg-passport-1 { font-size: 60px; top: 50%; left: 1%; --initial-rotate: 20deg; animation-duration: 26s; }


        @keyframes floatSimple {
            0% { transform: translateY(0px) rotate(var(--initial-rotate, 0deg)); }
            50% { transform: translateY(-25px) rotate(calc(var(--initial-rotate, 0deg) + 8deg)); }
            100% { transform: translateY(0px) rotate(calc(var(--initial-rotate, 0deg) - 8deg)); }
        }
        
        .game-container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(145deg, #fdfefe, #e9ecef);
            color: var(--text-dark);
            border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke);
            box-shadow: 8px 8px 0px var(--black-stroke);
            padding: 30px; 
            text-align: center;
            position: relative;
            z-index: 2;
            max-height: calc(var(--app-height, 100vh) - 40px); /* Make container scrollable */
            overflow-y: auto;
        }

        .brand-logo { object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .brand-logo-prominent { display: block; margin: 0 auto 15px; max-height: 80px; }
        
        h1 {
            font-family: var(--font-logo);
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
            text-shadow: 3px 3px 0px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            line-height: 1.1;
        }
        h3, .screen-title {
            font-family: var(--font-heading-alt);
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-dark);
        }
        
        .screen { display: none; animation: fadeInScreen 0.5s ease-out; }
        @keyframes fadeInScreen { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .active { display: block; }
        
        .instructions, .team-inputs-container {
            background: rgba(0,0,0, 0.04);
            padding: 20px; border-radius: 10px; margin: 25px 0;
            border: 2px dashed var(--text-medium);
        }
        .instructions p strong { font-family: var(--font-heading-alt); display: block; margin-bottom: 15px; font-size: 1.3rem; }
        .instructions ul { list-style-type: none; text-align: left; padding: 0 10px; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: center; }
        .instructions i { margin-right: 15px; font-size: 1.3em; color: var(--blyza-purple-secondary); width: 25px; text-align: center; }
        .instructions strong { font-weight: 700; color: var(--text-dark); }

        button, .btn-primary, .btn-secondary, .btn-success, .btn-info {
            font-family: var(--font-heading-alt); font-size: 1.1rem; padding: 0.7em 1.5em;
            border: 3px solid var(--black-stroke); border-radius: 8px;
            text-transform: uppercase; text-decoration: none; display: inline-flex;
            align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            letter-spacing: 1px; cursor: pointer; color: var(--text-dark);
            margin: 8px 5px;
            box-shadow: var(--shadow-chunky);
        }
        button:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        button:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        button:disabled { background: var(--text-medium); color: var(--text-light); cursor: not-allowed; opacity: 0.7; }

        .btn-primary, #start-game-btn, #reveal-answer-btn, #next-round-btn, #ten-rounds-btn, #infinite-mode-btn { background-color: var(--blyza-sunny-yellow); }
        .btn-secondary, #add-team-btn, #main-menu-nav-btn { background-color: var(--blyza-purple-secondary); color: var(--text-light); }
        .btn-success, #play-again-game-btn, #audio-consent-yes-btn { background-color: var(--blyza-keppel-accent); color: var(--text-light); }
        .btn-info, #visit-store-btn { background-color: #4ECDC4; }
        #audio-consent-no-btn { background-color: var(--blyza-purple-secondary); color: var(--text-light); }


        .game-mode-selection { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .mode-option {
            background: var(--text-light); padding: 20px; border-radius: var(--border-radius-game);
            cursor: pointer; transition: all 0.3s ease; border: 3px solid var(--black-stroke);
            box-shadow: var(--shadow-chunky); flex: 1; min-width: 250px; max-width: 300px;
        }
        .mode-option:hover { transform: translateY(-5px) scale(1.02); box-shadow: 6px 6px 0 var(--blyza-orange-primary); }
        .mode-option.selected {
            background: var(--blyza-keppel-accent); color: var(--text-light); border-color: var(--black-stroke);
            transform: scale(1.02); box-shadow: 6px 6px 0 var(--black-stroke);
        }
        .mode-option.selected i, .mode-option.selected h3, .mode-option.selected p { color: var(--text-light); }
        .mode-option i { font-size: 2.5rem; margin-bottom: 10px; color: var(--blyza-orange-primary); transition: all 0.3s ease; }
        .mode-option h3 { font-family: var(--font-heading-alt); margin-bottom: 8px; font-size: 1.3rem; color: var(--text-dark); }
        .mode-option p { color: var(--text-medium); font-size: 0.9rem; }
        #team-names-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin-bottom: 20px;
        }
        .team-input input.team-name-input {
            width: 100%; padding: 12px 18px; border-radius: 8px;
            border: 3px solid var(--black-stroke); background: var(--text-light);
            color: var(--text-dark); font-size: 1rem; transition: all 0.3s ease;
            font-family: var(--font-body); font-weight: 600;
        }
        .team-input input.team-name-input:focus { outline: none; border-color: var(--blyza-orange-primary); box-shadow: 0 0 0 3px var(--blyza-sunny-yellow); }

        .game-info {
            display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 20px;
            margin-bottom: 15px; padding: 10px 15px; background: rgba(0,0,0,0.1);
            border-radius: 8px; font-family: var(--font-heading-alt);
            color: var(--text-dark); border: 2px solid var(--black-stroke);
        }
        #current-player-display-text {
            font-family: var(--font-heading-alt); color: var(--blyza-purple-secondary); font-size: 1.2rem; margin-bottom: 15px;
        }
        .place-display-stage {
            background: var(--darker-grey-bg); padding: 20px; border-radius: var(--border-radius-game);
            margin-bottom: 25px; border: 3px solid var(--black-stroke);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        }
        .stage-curtains {
            position: absolute; top: 0; width: 51%; height: 100%; background-color: var(--text-dark);
            background-image: repeating-linear-gradient(90deg, transparent, transparent 20px, rgba(255,255,255,0.03) 20px, rgba(255,255,255,0.03) 40px);
            box-shadow: 0 0 25px rgba(0,0,0,0.6); transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1);
            z-index: 5;
        }
        .stage-curtains.left { left: 0; border-right: 6px solid var(--blyza-orange-primary); }
        .stage-curtains.right { right: 0; border-left: 6px solid var(--blyza-orange-primary); }
        .stage-curtains.open.left { transform: translateX(-105%) skewX(-10deg); }
        .stage-curtains.open.right { transform: translateX(105%) skewX(10deg); }
        
        .place-tv-screen {
            background: #111; border: 10px solid #333; border-radius: 15px; padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative; z-index: 1; min-height: 300px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .place-tv-screen h3 {
            font-family: var(--font-logo); color: var(--blyza-sunny-yellow); -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke);
            font-size: 1.6rem; margin-bottom: 15px;
        }
        .place-image {
            max-height: 350px; max-width: 90%; object-fit: contain; border-radius: 8px; margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.5s ease-in 0.8s;
        }
        .place-image.visible { opacity: 1; }

        .options-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 25px auto;
        }
        .option-btn {
            font-family: var(--font-body); text-transform: none; font-weight: 600; text-align: left;
            background: var(--text-light); animation: popIn 0.4s ease-out backwards;
        }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .option-btn:nth-child(3) { grid-column: 1 / -1; justify-self: center; width: 50%; }
        .option-btn i { font-size: 1.1rem; color: var(--blyza-purple-secondary); margin-right: 10px; }
        .option-btn.correct { background-color: var(--blyza-keppel-accent) !important; color: var(--text-light) !important; border-color: var(--black-stroke); }
        .option-btn.incorrect { background-color: var(--blyza-quickfire-red) !important; color: var(--text-light) !important; border-color: var(--black-stroke); }
        .option-btn:disabled:not(.correct) { background: var(--text-medium); opacity: 0.7; }
        
        .result-item { padding: 20px; border-radius: var(--border-radius-game); margin-bottom: 25px; border: 3px solid var(--black-stroke); background: rgba(0,0,0,0.1); }
        .result-item .place-image { max-height: 200px; }
        .answer-display {
            font-size: 2rem; color: var(--blyza-keppel-accent); margin: 15px 0; font-family: var(--font-logo);
            -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke);
        }
        #place-description-text { font-size: 1rem; color: var(--text-medium); margin-top: 10px; max-width: 90%; font-weight: 500; }
        .guess-results-container {
            display: grid; gap: 15px; margin: 25px 0; grid-template-columns: 1fr;
        }
        .guess-result {
            background: var(--text-light); padding: 15px; border-radius: 10px; text-align: left;
            border: 3px solid var(--black-stroke); font-weight: 600;
        }
        .guess-result.correct-guess { border-color: var(--blyza-keppel-accent); background: #e0f8f5; }
        .guess-result .player-name { font-family: var(--font-heading-alt); font-size: 1.1rem; color: var(--blyza-purple-secondary); margin-bottom: 5px; }
        .guess-result .guess-text { font-size: 1rem; color: var(--text-dark); margin-bottom: 8px; }
        .guess-result .result-feedback-text { font-weight: bold; font-size: 1rem; }
        .guess-result.correct-guess .result-feedback-text { color: var(--blyza-keppel-accent); }
        .guess-result:not(.correct-guess) .result-feedback-text { color: var(--blyza-quickfire-red); }

        .score-display { display: grid; gap: 20px; margin: 30px 0; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        .score-card { background: rgba(0,0,0,0.05); padding: 20px; border-radius: 10px; border: 3px solid var(--black-stroke); box-shadow: var(--shadow-chunky); }
        .score-card .team-name-score { font-family: var(--font-heading-alt); color: var(--blyza-orange-primary); font-size: 1.3rem; }
        .score-card .score-value-display { font-family: var(--font-logo); font-size: 2.2rem; }
        .score-card.winner-glow { animation: winnerGlow 1.5s infinite alternate; border-color: var(--blyza-keppel-accent); }
        @keyframes winnerGlow { from { box-shadow: 4px 4px 0 var(--blyza-keppel-accent); } to { box-shadow: 4px 4px 15px var(--blyza-keppel-accent); } }
        .progress-bar { height: 12px; background: rgba(0,0,0,0.2); border-radius: 50px; margin-top: 15px; overflow: hidden; border: 2px solid var(--black-stroke); }
        .progress-fill { height: 100%; background: var(--blyza-sunny-yellow); border-radius: 50px; transition: width 0.5s ease; }
        
        .win-message { font-family: var(--font-logo); font-size: 3rem; margin: 20px 0; color: var(--blyza-orange-primary); -webkit-text-stroke: 2px var(--black-stroke); text-stroke: 2px var(--black-stroke); }
        .winner-trophy { font-size: 6rem; margin: 20px 0; animation: bounce 1.5s infinite ease-in-out; color: var(--blyza-sunny-yellow); text-shadow: 0 0 20px var(--blyza-orange-primary), 3px 3px 0 var(--black-stroke); }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }
        #winner-subtext { font-family: var(--font-body); font-size: 1.1rem; color: var(--text-medium); margin-bottom: 20px; font-weight: 600; }
        .game-over-buttons-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .game-over-button-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
        .treat-yourself-callout { margin-bottom: 8px; background-color: var(--blyza-sunny-yellow); color: var(--text-dark); padding: 8px 15px; border-radius: 20px; font-family: var(--font-heading-alt); font-size: 0.9rem; white-space: nowrap; box-shadow: var(--shadow-chunky); display: none; align-items: center; gap: 8px; z-index: 10; border: 2px solid var(--black-stroke); }
        .treat-yourself-callout i { font-size: 1.2em; animation: bounceArrow 1s infinite; }
        @keyframes bounceArrow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }

        .icon-btn { position: absolute; background-color: var(--blyza-purple-secondary); color: var(--text-light); border-radius: 50%; width: 55px; height: 55px; font-size: 1.2rem; cursor: pointer; transition: all 0.1s ease; display: flex; justify-content: center; align-items: center; z-index: 100; text-decoration: none; border: 3px solid var(--black-stroke); box-shadow: var(--shadow-chunky); }
        .icon-btn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        .icon-btn:active { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        #settings-btn { top: 20px; right: 20px; }
        #highscore-btn { top: 20px; right: 85px; background-color: var(--blyza-sunny-yellow); }
        #back-to-games-btn, #back-to-menu-btn { top: 20px; left: 20px; }
        
        .modal {
            position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); 
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
            animation: fadeInModal 0.3s ease;
        }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        .modal-content {
            background-color: var(--darker-grey-bg); margin: auto; padding: 25px;
            border: 3px solid var(--black-stroke); border-radius: var(--border-radius-game);
            width: 90%; max-width: 450px; box-shadow: 8px 8px 0px rgba(0,0,0,0.4);
            position: relative; color: var(--text-light); text-align: center;
        }
        .modal-content h2 {
            font-family: var(--font-logo); color: var(--blyza-orange-primary);
            -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke);
            text-align: center; margin-bottom: 25px; font-size: 2rem;
        }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; text-align: left; }
        .setting-item label { margin-bottom: 10px; font-weight: 600; font-size: 1rem; }
        .close-modal-btn { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-modal-btn:hover { color: var(--text-light); }
        #settings-modal .setting-item button { font-size: 1rem; padding: 10px 20px; width: 100%; }
        #audio-consent-modal .modal-content p {
            font-family: var(--font-body); font-weight: 600; font-size: 1.1rem;
            margin-bottom: 25px; color: var(--text-light);
        }
        #audio-consent-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: rgba(0,0,0,0.3); border-radius: 5px; border: 2px solid var(--black-stroke); }
        input[type=range]::-webkit-slider-thumb { border: 2px solid var(--black-stroke); height: 22px; width: 22px; border-radius: 50%; background: var(--blyza-orange-primary); cursor: pointer; -webkit-appearance: none; margin-top: -9px; }

        .feedback-popup { position: fixed; top: 50%; left: 50%; background-color: var(--text-dark); color: white; padding: 25px 40px; border-radius: var(--border-radius-game); font-size: 2.5rem; font-family: var(--font-logo); text-align: center; z-index: 2000; box-shadow: 8px 8px 0px rgba(0,0,0,0.5); opacity: 0; transform: translate(-50%, -50%) scale(0.7); transition: opacity 0.3s ease, transform 0.3s ease; pointer-events: none; border: 3px solid var(--black-stroke); display: none; }
        .feedback-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); display: block; }
        .feedback-popup.correct-feedback { color: var(--blyza-keppel-accent); }
        .feedback-popup.incorrect-feedback { color: var(--blyza-quickfire-red); }
        .feedback-popup.win-feedback { color: var(--blyza-sunny-yellow); }

        .confetti-piece { position: fixed; width: 10px; height: 20px; background-color: var(--blyza-orange-primary); opacity: 0; animation-timing-function: linear; animation-fill-mode: forwards; pointer-events: none; z-index: 3000; }
        @keyframes fallAndFade { 0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(120vh) rotate(720deg); opacity: 0; } }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
                align-items: flex-start; /* Align game to top on mobile */
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .game-container { 
                padding: 45px 15px 15px; 
                max-height: calc(var(--app-height, 100vh) - 40px);
            } 
            h1 { font-size: 2.2rem; margin-top: 5px; }
            .mode-option { max-width: 100%; min-width: unset; }
            .score-display, #team-names-grid { grid-template-columns: 1fr; }
            .options-container { grid-template-columns: 1fr; }
            .option-btn:nth-child(3) { grid-column: auto; width: 100%; }
            .icon-btn { width: 48px; height: 48px; }
            
            /* --- FIXED: Mobile Button Alignment --- */
            #settings-btn, #highscore-btn, #back-to-games-btn, #back-to-menu-btn {
                top: 15px; 
            }
            #settings-btn { right: 15px; }
            #highscore-btn { right: 75px; }
            #back-to-games-btn, #back-to-menu-btn { left: 15px; }

            .feedback-popup { font-size: 2rem; padding: 20px 30px; width: 90%; }
            .modal-content { padding: 20px; }
            .game-over-buttons-container { flex-direction: column; align-items: center; }
            .game-over-buttons-container .game-over-button-wrapper { width: 90%; }
            .game-over-buttons-container .game-over-button-wrapper button { width: 100%; }
            .place-image { max-height: 250px; }
            .place-tv-screen h3 { font-size: 1.5rem; }
            .win-message { font-size: 2.2rem; }
            .bg-game-element { display: none; }
        }
    </style>
</head>
<body>
    <div class="hero-background-elements">
        <div class="bg-game-element bg-globe-1"><i class="fas fa-globe-americas"></i></div>
        <div class="bg-game-element bg-plane-1"><i class="fas fa-plane"></i></div>
        <div class="bg-game-element bg-compass-1"><i class="far fa-compass"></i></div>
        <div class="bg-game-element bg-map-1"><i class="fas fa-map-marked-alt"></i></div>
        <div class="bg-game-element bg-globe-2"><i class="fas fa-globe-europe"></i></div>
        <div class="bg-game-element bg-plane-2"><i class="fas fa-plane-departure"></i></div>
        <div class="bg-game-element bg-compass-2"><i class="far fa-compass"></i></div>
        <div class="bg-game-element bg-camera-1"><i class="fas fa-camera-retro"></i></div>
        <div class="bg-game-element bg-landmark-1"><i class="fas fa-landmark"></i></div>
        <div class="bg-game-element bg-passport-1"><i class="fas fa-passport"></i></div>
    </div>
    
    <script>
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>

    <div class="game-container">
       <!-- FIXED: ID changed from home-menu-btn to back-to-games-btn to match JS -->
       <a href="#" onclick="history.back(); return false;" id="back-to-games-btn" class="icon-btn" aria-label="Back to Games List" title="Back to Games List">
            <i class="fas fa-home"></i>
        </a>
        <button id="back-to-menu-btn" class="icon-btn" aria-label="Back to Main Menu" title="Back to Main Menu" style="display: none;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="highscore-btn" class="icon-btn" aria-label="Show High Score" title="Show High Score">
            <i class="fas fa-star"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings" title="Settings">
            <i class="fas fa-cog"></i>
        </button>

        <div id="start-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Where in the World?</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY:</strong></p>
                <ul>
                    <li><i class="fas fa-map-marked-alt"></i> Guess the correct place shown from three options.</li>
                    <li><i class="fas fa-user"></i> Single Player: Play classic 10 rounds or try the Infinite Mode!</li>
                    <li><i class="fas fa-users"></i> Multiplayer: Up to 4 teams. Take turns. First to 5 points wins!</li>
                </ul>
            </div>
            <div class="game-mode-selection">
                <div class="mode-option selected" data-mode="single"> <i class="fas fa-user"></i> <h3>Single Player</h3> <p>10 rounds or Infinite Mode</p> </div>
                <div class="mode-option" data-mode="multi"> <i class="fas fa-users"></i> <h3>Multiplayer</h3> <p>With friends</p> </div>
            </div>
            
            <div id="single-player-sub-options" style="margin-top: 20px;">
                <button id="ten-rounds-btn" class="btn-primary"><i class="fas fa-list-ol"></i> 10 Rounds</button>
                <button id="infinite-mode-btn" class="btn-primary"><i class="fas fa-infinity"></i> Infinite Mode</button>
            </div>
            
            <div id="multiplayer-start-area" style="display: none;">
                <div id="team-inputs-container" class="team-inputs-container">
                    <h3 class="screen-title">Enter Team Names</h3>
                    <div id="team-names-grid">
                        <div class="team-input"><input type="text" class="team-name-input" placeholder="Team 1"></div>
                        <div class="team-input"><input type="text" class="team-name-input" placeholder="Team 2"></div>
                    </div>
                    <button id="add-team-btn" class="btn-secondary"><i class="fas fa-plus-circle"></i> Add Team</button>
                </div>
                <button id="start-game-btn" class="btn-primary">Start Game <i class="fas fa-play"></i></button>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div class="game-info">
                <div> <span id="round-type-text">Round</span> <span id="round-number-text">1</span> <span id="round-total-text">/10</span> </div>
                <div id="score-display-text"> Score: <span id="current-score-text">0</span><span id="score-target-display-text"></span> </div>
            </div>
            <div id="current-player-display-text"></div>
            <div class="place-display-stage">
                <div class="stage-curtains left"></div> <div class="stage-curtains right"></div>
                <div class="place-tv-screen">
                    <h3>Where is this place?</h3>
                    <img id="place-image-display" src="" alt="Place to guess" class="place-image">
                </div>
            </div>
            <div id="options-container-div" class="options-container"></div>
            <button id="reveal-answer-btn" class="btn-primary" style="display: none;">Reveal Answer <i class="fas fa-eye"></i></button>
        </div>

        <div id="results-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot" style="max-height: 60px;">
            <h3 id="results-screen-title" class="screen-title">Round Result</h3>
            <div class="result-item">
                <img id="result-place-image-display" src="" alt="Place" class="place-image">
                <div class="answer-display">Correct Answer: <span id="correct-answer-text">Place</span></div>
                <p id="place-description-text">Description.</p>
            </div>
            <div id="guess-results-container-div" class="guess-results-container"></div>
            <div id="score-display-results-div" class="score-display"></div>
            <button id="next-round-btn" class="btn-primary">Next Round <i class="fas fa-arrow-right"></i></button>
        </div>

        <div id="game-over-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over!</h1>
            <div class="win-message" id="win-message-final-text">Team Wins!</div>
            <div class="winner-trophy">🏆</div>
            <div id="winner-subtext"></div>
            <div id="final-scores-display-div" class="score-display"></div>
            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                     <button id="play-again-game-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                </div>
                <div class="game-over-button-wrapper">
                     <button id="main-menu-nav-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper">
                     <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="audio-consent-modal" class="modal">
        <div class="modal-content">
            <h2>Enable Audio?</h2>
            <p>This game has background music and sound effects. Would you like to enable them for the best experience?</p>
            <div id="audio-consent-buttons">
                <button id="audio-consent-yes-btn" class="btn-success"><i class="fas fa-volume-up"></i> Yes, please!</button>
                <button id="audio-consent-no-btn" class="btn-secondary"><i class="fas fa-volume-mute"></i> No, thanks</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">×</span>
            <h2>Settings</h2>
            <div class="setting-item"> <label for="bgm-volume-slider">BG Music:</label> <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2"> </div>
            <div class="setting-item"> <label for="sfx-toggle-btn">Sound Effects:</label> <button id="sfx-toggle-btn">SFX: ON</button> </div>
        </div>
    </div>
    <div id="feedback-popup" class="feedback-popup"> <span id="feedback-message-text-el"></span> </div>

    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="correct-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="wrong-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="win-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>
    <audio id="curtain-sound" src="https://static.wixstatic.com/mp3/9ce3e5_ccd36cdf98bf4e1594cf2e52d5296c51.wav"></audio>

    <script>
        const gameConfig = { sfxEnabled: true, musicVolume: 0.2 };
        const gameState = {
            players: [], currentRound: 0, scores: {}, gameMode: 'single', singlePlayerSubType: '10rounds', currentPlace: null,
            currentPlayerIndex: 0, usedPlaces: [], currentGuess: null,
            places: [ { image: "https://static.wixstatic.com/media/9ce3e5_09dcc3d095064b768a85d0a90d8d84f5~mv2.jpg", correctAnswer: "Baku, Azerbaijan", options: ["Baku, Azerbaijan", "Tbilisi, Georgia", "Astana, Kazakasthan"], description: "This vibrant capital city is known for its modern Flame Towers and the ancient walled Old City." }, { image: "https://static.wixstatic.com/media/9ce3e5_f2ec9180c645479f8956038166065254~mv2.jpeg", correctAnswer: "Berlin, Germany", options: ["Prague, Czechia", "Berlin, Germany", "Vienna, Austria"], description: "A city steeped in history, it boasts iconic landmarks like the Brandenburg Gate." }, { image: "https://static.wixstatic.com/media/9ce3e5_7e5c4a438e734b4aa5dae6078edcdf53~mv2.jpg", correctAnswer: "Amsterdam, Netherlands", options: ["Copenhagen, Denmark", "Bruges, Belgium", "Amsterdam, Netherlands"], description: "Famous for its intricate canal system, historic gabled houses, and vibrant artistic heritage." }, { image: "https://static.wixstatic.com/media/9ce3e5_ba41ac2fcd5e4981820613bb79a42b99~mv2.webp", correctAnswer: "Bali, Indonesia", options: ["Bali, Indonesia", "Male, Maldives", "Puket, Thailand"], description: "This Island paradise is renowned for its stunning beaches, lush rice paddies, and spiritual retreats." }, { image: "https://static.wixstatic.com/media/9ce3e5_bf28558e3ae84ad19328d5154ce60771~mv2.jpg", correctAnswer: "Colombo, Sri Lanka", options: ["Mumbai, India", "Colombo, Sri Lanka", "Ho Chi Minh City, Vietnam"], description: "The bustling commercial capital, featuring a mix of modern high-rises and colonial-era architecture." }, { image: "https://static.wixstatic.com/media/9ce3e5_ab63cff93d4f4a2095c92d94a4ee1ac6~mv2.jpg", correctAnswer: "Cape Town, South Africa", options: ["Sydney, Australia", "Rio De Janeiro, Brazil", "Cape Town, South Africa"], description: "Nestled beneath the iconic Table Mountain, this city boasts stunning coastal scenery and diverse cultural heritage." }, { image: "https://static.wixstatic.com/media/9ce3e5_3c2e1025e75f458e9d132c9d93a47aca~mv2.webp", correctAnswer: "Buenos Aires, Argentina", options: ["São Paulo, Brazil", "Chichen Itza, Mexico", "Buenos Aires, Argentina"], description: "Known as the Paris of South America, this capital is famous for its European-style architecture and passionate tango culture." }, { image: "https://static.wixstatic.com/media/9ce3e5_19c1d2e7555d4505a4634f3514998711~mv2.jpg", correctAnswer: "Brussels, Belgium", options: ["Brussels, Belgium", "Geneva, Switzerland", "Berlin, Germany"], description: "The capital and a major center for European politics, famous for its Grand Place and delicious chocolate." }, { image: "https://static.wixstatic.com/media/9ce3e5_be09b5bc9e2549b2b3ab549e769067af~mv2.webp", correctAnswer: "Dubai, UAE", options: ["Riaydh, Saudi Arabia", "Dubai, UAE", "Doha, Qatar"], description: "This ultramodern city is famous for its futuristic skyscrapers, luxury shopping, and artificial islands." }, { image: "https://static.wixstatic.com/media/9ce3e5_f250e5739b334a57b519c1bdac4633c1~mv2.jpeg", correctAnswer: "Gdansk, Poland", options: ["Riga, Latvia", "Tallinn, Estonia", "Gdansk, Poland"], description: "A historic port city on the Baltic coast of Poland, known for its colorful Long Market and maritime history." }, { image: "https://static.wixstatic.com/media/9ce3e5_2e10ed6e32ce4f76a1a17371346b121c~mv2.avif", correctAnswer: "Istanbul, Turkey", options: ["Istanbul, Turkey", "Cairo, Egypt", "Athens, Greece"], description: "Straddling two continents, this Turkish city boasts a rich history evident in its Hagia Sophia and Blue Mosque." }, { image: "https://static.wixstatic.com/media/9ce3e5_667659900297423aacd1ce77923c4e3d~mv2.jpeg", correctAnswer: "Las Vegas, USA", options: ["Los Angeles, USA", "Las Vegas, USA", "Atlantic City, USA"], description: "Known as the Entertainment Capital of the World, this Nevada city is famous for its casinos, dazzling shows, and vibrant nightlife." }, { image: "https://static.wixstatic.com/media/9ce3e5_68a46a12fd4343908c7d5c37c3d68aa3~mv2.avif", correctAnswer: "Lagos, Nigeria", options: ["Nairobi, Kenya", "Dhaka, Bangladesh", "Lagos, Nigeria"], description: "The sprawling and energetic economic hub, known for its bustling markets and vibrant music scene." }, { image: "https://static.wixstatic.com/media/9ce3e5_9d66ca30b333461e85c94cc31a35c352~mv2.jpg", correctAnswer: "Manchester, UK", options: ["Manchester, UK", "Liverpool, UK", "London, UK"], description: "A major city in northwest England with a rich industrial heritage and a thriving contemporary music and arts scene." }, { image: "https://static.wixstatic.com/media/9ce3e5_c9f7aba5e3f84f3cb0a72c6c931fdeef~mv2.jpg", correctAnswer: "Marseille, France", options: ["Genoa, Italy", "Marseille, France", "Valencia, Spain"], description: "France's second-largest city, a vibrant port with a rich cultural mix and the iconic Vieux-Port (Old Port)." }, { image: "https://static.wixstatic.com/media/9ce3e5_9da172ba6d1b4a24872cea096995caca~mv2.jpg", correctAnswer: "Melbourne, Australia", options: ["Auckland, New Zealand", "Vancouver, Canada", "Melbourne, Australia"], description: "A stylish coastal city in southeastern Australia, known for its laneway cafes, vibrant arts scene, and major sporting events." }, { image: "https://static.wixstatic.com/media/9ce3e5_5f9ee5bb1bfa45b1aa4c83e1b278b5a6~mv2.jpg", correctAnswer: "Osaka, Japan", options: ["Osaka, Japan", "Tokyo, Japan", "Taipei, Taiwan"], description: "A large port city and commercial center on the Japanese island of Honshu, known for its modern architecture, street food, and lively nightlife." }, { image: "https://static.wixstatic.com/media/9ce3e5_4214e6a2c4be4d5cb19cd3687632ea17~mv2.avif", correctAnswer: "Muscat, Oman", options: ["Dammam, Saudi Arabia", "Muscat, Oman", "Jahra, Kuwait"], description: "The capital city of Oman, known for its ancient souks, beautiful mosques, and stunning coastal scenery." }, { image: "https://static.wixstatic.com/media/9ce3e5_0a64c3d10bb642fbbe3e2bb44c9c453c~mv2.jpg", correctAnswer: "Porto, Portugal", options: ["Bilbao, Spain", "Tallinn, Estonia", "Porto, Portugal"], description: "A coastal city in northwest Portugal, famous for its port wine cellars and the Ribeira district's colorful, narrow streets along the Douro River." }, { image: "https://static.wixstatic.com/media/9ce3e5_d9af5b619664458f9ea65841ef1f3c95~mv2.jpg", correctAnswer: "Rio de Janeiro, Brazil", options: ["Rio de Janeiro, Brazil", "Apopa, El Salvador", "Guanajuato, Mexico"], description: "Famous for its iconic Christ the Redeemer statue, Sugarloaf Mountain, and vibrant beaches like Copacabana and Ipanema." }, { image: "https://static.wixstatic.com/media/9ce3e5_6362e11c604b42809cf8f2b62ac076f4~mv2.jpg", correctAnswer: "Prague, Czechia", options: ["Budapest, Hungary", "Prague, Czechia", "Krakow, Poland"], description: "The capital of the Czech Republic, renowned for its Old Town Square, Charles Bridge, and fairytale architecture." }, { image: "https://static.wixstatic.com/media/9ce3e5_0e83b15b48c644bdb2fc21974aa67428~mv2.jpg", correctAnswer: "Seoul, South Korea", options: ["Beijing, China", "Tokyo, Japan", "Seoul, South Korea"], description: "The vibrant capital of South Korea, a dynamic mix of ancient temples, cutting-edge technology, and bustling street markets." }, { image: "https://static.wixstatic.com/media/9ce3e5_02627aadd7534ce29f48f868ed3d02a7~mv2.jpg", correctAnswer: "Rome, Italy", options: ["Rome, Italy", "Lisbon, Portugal", "Madrid, Spain"], description: "The Eternal City, capital of Italy, home to ancient wonders like the Colosseum and the Roman Forum." }, { image: "https://static.wixstatic.com/media/9ce3e5_e14ab9b84c0849d79a4f15bad4497d06~mv2.webp", correctAnswer: "Vancouver, Canada", options: ["Seattle, USA", "Vancouver, Canada", "Sydney, Australia"], description: "A vibrant coastal city in British Columbia, Canada, known for its stunning natural beauty, surrounded by mountains and the Pacific Ocean." }, { image: "https://static.wixstatic.com/media/9ce3e5_15ea364d60264367b040d335d0327501~mv2.jpg", correctAnswer: "Tbilisi, Georgia", options: ["Yerevan, Armenia", "Tehran, Iran", "Tbilisi, Georgia"], description: "The ancient capital of Georgia, known for its diverse architecture reflecting centuries of history, thermal springs, and vibrant cultural scene." }, { image: "https://static.wixstatic.com/media/9ce3e5_1f26ea3b95c447e7b13e70e1373dcbce~mv2.jpg", correctAnswer: "Yerevan, Armenia", options: ["Yerevan, Armenia", "Beirut, Lebanon", "Bishek, Kyrgyzstan"], description: "The ancient capital of Armenia, set in the highlands and known for its grand Soviet-era architecture and views of Mount Ararat." }, { image: "https://static.wixstatic.com/media/9ce3e5_a81c9b272738498eabb5a59bbcf3fec8~mv2.jpg", correctAnswer: "Beijing, China", options: ["Hong Kong", "Beijing, China", "Bangok, Thailand"], description: "The capital of China, a city rich in history and culture, home to iconic sites like the Forbidden City and the Great Wall." }, { image: "https://static.wixstatic.com/media/9ce3e5_af3fe5983f41472f85b2d498aef7dc6e~mv2.jpeg", correctAnswer: "Chicago, USA", options: ["Wellingtin, New Zealand", "Montreal, Canada", "Chicago, USA"], description: "Known for its bold architecture, blues music, and deep-dish pizza, this major city sits on Lake Michigan." }, { image: "https://static.wixstatic.com/media/9ce3e5_9f26e4a72c734a72b7b029bcf139d08b~mv2.jpg", correctAnswer: "Hanoi, Vietnam", options: ["Hanoi, Vietnam", "Phnom Penh, Cambodia", "Kuala Lumpur, Malaysia"], description: "The capital of Vietnam, known for its Old Quarter, French colonial architecture, and serene lakes." }, { image: "https://static.wixstatic.com/media/9ce3e5_aac6a86cb69742a49b66bdd8a7a8c2a5~mv2.jpg", correctAnswer: "Manila, Philippines", options: ["Jakarta, Indonesia", "Manila, Philippines", "Singapore"], description: "The bustling capital of the Philippines, a vibrant mix of historic Intramuros and modern skyscrapers." }, { image: "https://static.wixstatic.com/media/9ce3e5_3667799d353e44fca42f49ccf8f5280e~mv2.avif", correctAnswer: "Hyderabad, India", options: ["Jamalpur, Bangladesh", "Lahore, Pakistan", "Hyderabad, India"], description: "A historic city in southern India, known for its pearl and diamond trading centers, and Charminar." }, { image: "https://static.wixstatic.com/media/9ce3e5_babf7e1b0857429b889ee70355465717~mv2.jpg", correctAnswer: "Marrakech, Morocco", options: ["Marrakech, Morocco", "Tunis, Tunisia", "Cairo, Egypt"], description: "A major city in Morocco, known for its bustling Djemaa el-Fna square, vibrant souks, and beautiful mosques and gardens." }, { image: "https://static.wixstatic.com/media/9ce3e5_52d8a4c923b749b89f4fafe933385cf6~mv2.jpg", correctAnswer: "Mexico City, Mexico", options: ["Lima, Peru", "Mexico City, Mexico", "Guayana, Venezuela"], description: "The sprawling, high-altitude capital of Mexico, known for its Aztec ruins, colonial architecture, and vibrant arts scene." }, { image: "https://static.wixstatic.com/media/9ce3e5_f45206a737ea4a6cb6f1ed5a378d8f93~mv2.jpg", correctAnswer: "Oslo, Norway", options: ["Stockholm, Sweden", "Helsinki, Finland", "Oslo, Norway"], description: "The capital of Norway, situated at the head of the Oslofjord, known for its green spaces, museums, and maritime history." }, { image: "https://static.wixstatic.com/media/9ce3e5_64f75787d8674c75803d1a6b9808b1e3~mv2.jpg", correctAnswer: "Algiers, Algeria", options: ["Algiers, Algeria", "Tripoli, Libya", "Casablanca, Morocco"], description: "The capital and largest city of Algeria, located on the Mediterranean coast, known for its whitewashed buildings and the Casbah." }, { image: "https://static.wixstatic.com/media/9ce3e5_cebb14bc01db4375a8bda98e97a34b66~mv2.jpg", correctAnswer: "Apia, Samoa", options: ["Suva, Fiji", "Apia, Samoa", "Honiara, Solomon Islands"], description: "The capital and only city of Samoa, located on the northern coast of Upolu island, known for its relaxed pace and tropical surroundings." }, { image: "https://static.wixstatic.com/media/9ce3e5_6efce60f140246008e8d78a8fdcb0a68~mv2.jpeg", correctAnswer: "Islamabad, Pakistan", options: ["Kabul, Afghanistan", "Almaty, Kazakasthan", "Islamabad, Pakistan"], description: "The modern capital city of Pakistan, known for its well-organized layout and the Faisal Mosque." } ,
        { image: "https://static.wixstatic.com/media/9ce3e5_88364a5f78c94cc293b3f8051b4661d4~mv2.png", correctAnswer: "Kyoto, Japan", options: ["Tokyo, Kapan", "Osaka, Japan", "Kyoto, Japan"], description: "Breath-takingly pretty!" },
        { image: "https://static.wixstatic.com/media/9ce3e5_b82b2284e0654668b5d83e738142f6db~mv2.png", correctAnswer: "Reykjavik, Iceland", options: ["Reykjavik, Iceland", " Kópavogur, Iceland", "Hafnarfjörður, Iceland"], description: "Pretty cold out there." } ,
        { image: "https://static.wixstatic.com/media/9ce3e5_6efce60f140246008e8d78a8fdcb0a68~mv2.jpeg", correctAnswer: "Transylvania, Romania", options: ["Bran Castle, Romania", "Transylvania, Romania", "Peles Castle, Romania"], description: "They made a movie on this no?" } ,
        { image: "https://static.wixstatic.com/media/9ce3e5_d01b2688ad2840f1a551c390c8698089~mv2.png", correctAnswer: "Galway, Ireland", options: ["Dingle Peninsula, Ireland", "Cork, Kazakasthan", "Galway, Ireland"], description: "Irish pubs are the best!" },
        { image: "https://static.wixstatic.com/media/9ce3e5_806f89f71eef4df1861d693fb822e69c~mv2.png", correctAnswer: "Atacama Desert, Chile", options: ["Atacama Desert, Chile", "Kalahari Desert, Botswana", "Gobi Desert, Mongolia"], description: "Straight outta movie!" },
        { image: "https://static.wixstatic.com/media/9ce3e5_a352ca3f87f64aa28dab11f95147d9e4~mv2.png", correctAnswer: "Sumilon Island, Philippines", options: ["Coron Bay, Philippines", "Sumilon Island, Philippines", "Boracay, Philippines"], description: "Top tier holiday destination." },
        { image: "https://static.wixstatic.com/media/9ce3e5_3f604d2779a54630a94659f805e34e1e~mv2.png", correctAnswer: "Mount Kilimanjaro, Tanzania", options: ["Mount Everest, Nepal", "Mount Fuji, Japan", "Mount Kilimanjaro, Tanzania"], description: "Bit of a steep climb." },
        { image: "https://static.wixstatic.com/media/9ce3e5_450700f03ccd46998d26babccafa088d~mv2.png", correctAnswer: "Hulhumale, Maldives", options: ["Hulhumale, Maldives", "Bali, Indonesia", "Bora Bora, French Polynesia"], description: "Goated honeymoon spot." }
   
        ]
        };
        
        let infiniteHighScore = 0;

        const el = {
            screens: { start: document.getElementById('start-screen'), game: document.getElementById('game-screen'), results: document.getElementById('results-screen'), gameOver: document.getElementById('game-over-screen') },
            modeOptions: document.querySelectorAll('.mode-option'),
            teamInputsContainer: document.getElementById('team-inputs-container'),
            teamNamesGrid: document.getElementById('team-names-grid'),
            addTeamBtn: document.getElementById('add-team-btn'),
            startGameBtn: document.getElementById('start-game-btn'),
            roundTypeText: document.getElementById('round-type-text'),
            roundNumberText: document.getElementById('round-number-text'),
            roundTotalText: document.getElementById('round-total-text'),
            scoreDisplayText: document.getElementById('score-display-text'),
            currentScoreText: document.getElementById('current-score-text'),
            scoreTargetDisplayText: document.getElementById('score-target-display-text'),
            currentPlayerDisplayText: document.getElementById('current-player-display-text'),
            placeImageDisplay: document.getElementById('place-image-display'),
            leftCurtain: document.querySelector('.place-display-stage .stage-curtains.left'),
            rightCurtain: document.querySelector('.place-display-stage .stage-curtains.right'),
            optionsContainer: document.getElementById('options-container-div'),
            revealAnswerBtn: document.getElementById('reveal-answer-btn'),
            resultPlaceImageDisplay: document.getElementById('result-place-image-display'),
            correctAnswerText: document.getElementById('correct-answer-text'),
            placeDescriptionText: document.getElementById('place-description-text'),
            guessResultsContainer: document.getElementById('guess-results-container-div'),
            scoreDisplayResults: document.getElementById('score-display-results-div'),
            nextRoundBtn: document.getElementById('next-round-btn'),
            winMessageFinalText: document.getElementById('win-message-final-text'),
            winnerSubtext: document.getElementById('winner-subtext'),
            finalScoresDisplay: document.getElementById('final-scores-display-div'),
            playAgainGameBtn: document.getElementById('play-again-game-btn'),
            mainMenuNavBtn: document.getElementById('main-menu-nav-btn'),
            storeButtonWrapper: document.getElementById("store-button-wrapper"),
            visitStoreBtn: document.getElementById('visit-store-btn'),
            settingsBtn: document.getElementById('settings-btn'),
            settingsModal: document.getElementById('settings-modal'),
            closeModalBtn: document.getElementById('close-modal-btn'),
            bgmVolumeSlider: document.getElementById('bgm-volume-slider'),
            sfxToggleBtn: document.getElementById('sfx-toggle-btn'),
            feedbackPopup: document.getElementById('feedback-popup'),
            feedbackMessageText: document.getElementById('feedback-message-text-el'),
            audio: { bgm: document.getElementById('background-game-music'), start: document.getElementById('start-game-sound'), interaction: document.getElementById('interaction-sound'), correct: document.getElementById('correct-answer-sound'), wrong: document.getElementById('wrong-answer-sound'), win: document.getElementById('win-game-sound'), curtain: document.getElementById('curtain-sound') },
            backToGamesBtn: document.getElementById('back-to-games-btn'),
            backToMenuBtn: document.getElementById('back-to-menu-btn'),
            highscoreBtn: document.getElementById('highscore-btn'),
            singlePlayerSubOptions: document.getElementById('single-player-sub-options'),
            multiplayerStartArea: document.getElementById('multiplayer-start-area'),
            tenRoundsBtn: document.getElementById('ten-rounds-btn'),
            infiniteModeBtn: document.getElementById('infinite-mode-btn'),
            audioConsentModal: document.getElementById('audio-consent-modal'),
            audioConsentYesBtn: document.getElementById('audio-consent-yes-btn'),
            audioConsentNoBtn: document.getElementById('audio-consent-no-btn')
        };
        let treatYourselfElement = null;
        let audioContextStarted = false;
        
        const playSound = (audio) => { if (gameConfig.sfxEnabled && audio && audioContextStarted) { audio.pause(); audio.currentTime = 0; audio.play().catch(e => {}); } };
        const playSoundWithCallback = (audio, cb) => { 
            if (gameConfig.sfxEnabled && audio && audioContextStarted) { 
                let executed = false;
                const onEnd = () => { if (!executed) { executed = true; audio.removeEventListener('ended', onEnd); cb(); } };
                audio.addEventListener('ended', onEnd);
                audio.pause(); audio.currentTime=0; 
                audio.play().catch(e => onEnd());
            } else { 
                cb(); 
            } 
        };

        function initAudio() {
            if (audioContextStarted) return;
            el.audio.bgm.play().then(() => {
                audioContextStarted = true;
                if (gameConfig.musicVolume <= 0 || document.hidden) {
                    el.audio.bgm.pause();
                }
            }).catch(e => {});
        }
        
        let feedbackTimeout;
        function showFeedback(message, type = '', duration = 2000) { el.feedbackMessageText.textContent = message; el.feedbackPopup.className = 'feedback-popup show ' + type; clearTimeout(feedbackTimeout); feedbackTimeout = setTimeout(() => el.feedbackPopup.classList.remove('show'), duration); }
        function triggerConfetti() { const c=['var(--blyza-orange-primary)','var(--blyza-purple-secondary)','var(--blyza-keppel-accent)'];for(let i=0;i<80;i++){const e=document.createElement('div');e.className='confetti-piece';e.style.left=100*Math.random()+'vw';e.style.backgroundColor=c[Math.floor(Math.random()*c.length)];const t=3*Math.random()+2;e.style.animation=`fallAndFade ${t}s ${Math.random()}s linear forwards`;document.body.appendChild(e);setTimeout(()=>e.remove(),1e3*(t+1))}}
        function loadSettings() { gameConfig.musicVolume=parseFloat(localStorage.getItem('musicVolume'))||0.2; gameConfig.sfxEnabled='false'!==localStorage.getItem('sfxEnabled'); el.audio.bgm.volume=gameConfig.musicVolume; el.bgmVolumeSlider.value=gameConfig.musicVolume; el.sfxToggleBtn.textContent=`SFX: ${gameConfig.sfxEnabled?'ON':'OFF'}` }
        function loadHighScore() { const s=localStorage.getItem('witw_infinite_highscore'); infiniteHighScore=s?parseInt(s,10):0 }
        function saveHighScore(s) { if(s > infiniteHighScore){ infiniteHighScore = s; localStorage.setItem('witw_infinite_highscore', s); return true; } return false; }
        function showHighScore() { playSound(el.audio.interaction); showFeedback(`Infinite High Score: ${infiniteHighScore}`,'win-feedback',3000) }

        function handleVisibilityChange() {
            if (!audioContextStarted) return;
            if (document.hidden) {
                el.audio.bgm.pause();
            } else if (gameConfig.musicVolume > 0) {
                el.audio.bgm.play().catch(e => {});
            }
        }
        
        function handlePageShow(event) {
            if (event.persisted) {
                setAppHeight(); 
                goToMainMenu();
            }
        }

        function switchScreen(id) { 
            Object.values(el.screens).forEach(s=>s.classList.remove('active')); 
            if (el.screens[id]) el.screens[id].classList.add('active'); 
            
            const onStartScreen = id === 'start';
            if (el.backToGamesBtn) el.backToGamesBtn.style.display = onStartScreen ? 'flex' : 'none'; 
            if (el.backToMenuBtn) el.backToMenuBtn.style.display = !onStartScreen && id !== 'gameOver' ? 'flex' : 'none'; 
            if (el.highscoreBtn) el.highscoreBtn.style.display = onStartScreen ? 'flex' : 'none';
            if (treatYourselfElement) treatYourselfElement.style.display = id === 'gameOver' ? 'flex' : 'none';
        }

        function selectGameMode() { el.modeOptions.forEach(o=>o.classList.remove('selected')); this.classList.add('selected'); gameState.gameMode=this.dataset.mode; const isMulti='multi'===gameState.gameMode; el.multiplayerStartArea.style.display=isMulti?'block':'none'; el.singlePlayerSubOptions.style.display=isMulti?'none':'block'; }
        function addTeamInput() { if(el.teamNamesGrid.children.length>=4)return; el.teamNamesGrid.insertAdjacentHTML('beforeend',`<div class="team-input"><input type="text" class="team-name-input" placeholder="Team ${el.teamNamesGrid.children.length+1}"></div>`) }
        
        function startSinglePlayerGame(subType) { initAudio(); gameState.singlePlayerSubType = subType; playSoundWithCallback(el.audio.start, startGame); }
        function startGame() {
            initAudio();
            if('single'===gameState.gameMode){gameState.players=['You'];gameState.scores={'You':0};}
            else{gameState.players=Array.from(el.teamNamesGrid.querySelectorAll('.team-name-input')).map((t,e)=>t.value.trim()||`Team ${e+1}`);if(gameState.players.length<2){alert('Multiplayer requires at least 2 teams!'); return;}if(new Set(gameState.players).size!==gameState.players.length){alert('Team names must be unique!'); return;}gameState.scores=Object.fromEntries(gameState.players.map(p=>[p,0]));}
            Object.assign(gameState,{currentRound:0,usedPlaces:[],currentPlayerIndex:0});
            setupRound();
        }

        function setupRound() {
            gameState.currentRound++;
            
            [el.leftCurtain, el.rightCurtain].forEach(c => c.classList.remove('open'));
            el.placeImageDisplay.classList.remove('visible');
            el.resultPlaceImageDisplay.classList.remove('visible');
            el.placeImageDisplay.src = "";

            let available = gameState.places.filter(p => !gameState.usedPlaces.includes(p.image));
            
            if (available.length === 0) {
                if (gameState.singlePlayerSubType === 'infinite') {
                    gameState.usedPlaces = [];
                    available = gameState.places;
                } else {
                    showGameOver(gameState.singlePlayerSubType === 'infinite');
                    return;
                }
            }
            
            gameState.currentPlace = available[Math.floor(Math.random() * available.length)];
            gameState.usedPlaces.push(gameState.currentPlace.image);

            el.placeImageDisplay.src = gameState.currentPlace.image;

            if ('infinite' === gameState.singlePlayerSubType) {
                el.roundTypeText.textContent = "Score";
                el.roundNumberText.textContent = gameState.scores['You'];
                el.roundTotalText.textContent = "";
                el.scoreDisplayText.style.display = 'none';
            } else {
                el.roundTypeText.textContent = "Round";
                el.roundNumberText.textContent = gameState.currentRound;
                el.roundTotalText.textContent = 'multi' === gameState.gameMode ? '' : '/10';
                el.scoreDisplayText.style.display = 'single' === gameState.gameMode ? 'inline' : 'none';
                el.currentScoreText.textContent = gameState.scores[gameState.players[gameState.currentPlayerIndex]];
            }
            el.scoreTargetDisplayText.textContent = 'multi' === gameState.gameMode ? ' to 5' : '';
            
            el.currentPlayerDisplayText.style.display = 'multi' === gameState.gameMode ? 'block' : 'none';
            if ('multi' === gameState.gameMode) {
                el.currentPlayerDisplayText.textContent = `${gameState.players[gameState.currentPlayerIndex]}'s Turn`;
            }

            el.optionsContainer.innerHTML = '';
            const options = [...gameState.currentPlace.options].sort(() => .5 - Math.random());
            options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.dataset.option = opt;
                btn.style.animationDelay = `${100 * i}ms`;
                btn.innerHTML = `<i class="far fa-circle"></i> ${opt}`;
                btn.onclick = handleOptionSelect;
                el.optionsContainer.appendChild(btn);
            });
            
            el.revealAnswerBtn.style.display = 'none';
            switchScreen('game');

            // FIXED: Increased delay slightly to ensure fade-in animation completes first
            setTimeout(() => {
                playSound(el.audio.curtain);
                [el.leftCurtain, el.rightCurtain].forEach(c => c.classList.add('open'));
                el.placeImageDisplay.classList.add('visible');
            }, 600);
        }

        function handleOptionSelect(e) { 
            playSound(el.audio.interaction); 
            const selectedButton = e.currentTarget; 
            gameState.currentGuess = selectedButton.dataset.option; 
            el.optionsContainer.querySelectorAll('.option-btn').forEach(b => { 
                b.disabled = true; 
                b.querySelector('i').className = 'far fa-circle'; 
            }); 
            selectedButton.querySelector('i').className = 'fas fa-check-circle'; 
            el.revealAnswerBtn.style.display = 'inline-flex'; 
        }
        
        function revealAnswer() {
            const isCorrect = gameState.currentGuess === gameState.currentPlace.correctAnswer;
            playSound(isCorrect ? el.audio.correct : el.audio.wrong);
            showFeedback(isCorrect ? 'Correct!' : 'Incorrect!', isCorrect ? 'correct-feedback' : 'incorrect-feedback');
            
            el.optionsContainer.querySelectorAll('.option-btn').forEach(btn => { 
                if (btn.dataset.option === gameState.currentPlace.correctAnswer) btn.classList.add('correct');
                else if (btn.dataset.option === gameState.currentGuess) btn.classList.add('incorrect');
            });
            
            if (isCorrect) {
                gameState.scores[gameState.players[gameState.currentPlayerIndex]]++;
                if (gameState.singlePlayerSubType === 'infinite') {
                    saveHighScore(gameState.scores['You']);
                }
            }

            setTimeout(() => {
                switchScreen('results');
                showResultsScreenUI();
            }, 2000);
        }

        function showResultsScreenUI() {
            el.resultPlaceImageDisplay.src = gameState.currentPlace.image; 
            el.resultPlaceImageDisplay.classList.add('visible'); 
            el.correctAnswerText.textContent = gameState.currentPlace.correctAnswer; 
            el.placeDescriptionText.textContent = gameState.currentPlace.description;
            
            const isCorrect = gameState.currentGuess === gameState.currentPlace.correctAnswer;
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            el.guessResultsContainer.innerHTML = `<div class="guess-result ${isCorrect ? 'correct-guess': ''}">
                <div class="player-name">${'single' === gameState.gameMode ? 'Your Guess:' : `${currentPlayer}'s Guess:`}</div>
                <div class="guess-text">${gameState.currentGuess || 'No guess'}</div>
                <div class="result-feedback-text">${isCorrect ? '<i class="fas fa-check-circle"></i> Correct! +1 point' : '<i class="fas fa-times-circle"></i> Incorrect!'}</div>
            </div>`;
            
            el.scoreDisplayResults.innerHTML = ''; 
            Object.entries(gameState.scores).forEach(([name, score]) => {
                const max = (gameState.singlePlayerSubType === '10rounds' || gameState.gameMode === 'single') ? 10 : 5;
                el.scoreDisplayResults.innerHTML += `<div class="score-card">
                    <div class="team-name-score">${name}</div>
                    <div class="score-value-display">${score}</div>
                    <div class="progress-bar"><div class="progress-fill" style="width: ${gameState.singlePlayerSubType === 'infinite' ? '100' : (score / max * 100)}%"></div></div>
                </div>`;
            });
            
            let isGameOver = false;
            let beatTheGame = false;

            if (gameState.gameMode === 'multi' && Math.max(...Object.values(gameState.scores)) >= 5) isGameOver = true;
            else if (gameState.singlePlayerSubType === '10rounds' && gameState.currentRound >= 10) isGameOver = true;
            else if (gameState.singlePlayerSubType === 'infinite') {
                if (!isCorrect) isGameOver = true;
                else if (gameState.usedPlaces.length >= gameState.places.length) { isGameOver = true; beatTheGame = true; }
            }

            if (isGameOver) {
                el.nextRoundBtn.innerHTML = 'See Final Results <i class="fas fa-trophy"></i>';
                el.nextRoundBtn.onclick = () => showGameOver(beatTheGame);
            } else {
                el.nextRoundBtn.innerHTML = 'Next Round <i class="fas fa-arrow-right"></i>';
                el.nextRoundBtn.onclick = nextRound;
            }
            el.nextRoundBtn.disabled = false;
        }

        function nextRound() { 
            playSound(el.audio.interaction); 
            if ('multi' === gameState.gameMode) {
                gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length; 
            }
            setupRound();
        }

        function showGameOver(beatTheGame = false) {
            playSound(el.audio.win); 
            triggerConfetti();
            const maxScore = Math.max(...Object.values(gameState.scores));
            const winners = Object.keys(gameState.scores).filter(p => gameState.scores[p] === maxScore);

            if (gameState.gameMode === 'single') {
                if (gameState.singlePlayerSubType === 'infinite') {
                    const isNewHighScore = saveHighScore(maxScore);
                    if (beatTheGame) {
                        el.winMessageFinalText.textContent = "You Beat The Game!";
                        el.winnerSubtext.innerHTML = `You correctly identified all ${gameState.places.length} locations! <br>Final Score: ${maxScore}. ${isNewHighScore ? '<strong>New High Score!</strong>' : ''}`;
                    } else {
                        el.winMessageFinalText.textContent = "Game Over!";
                        el.winnerSubtext.innerHTML = `Your Score: ${maxScore}. ${isNewHighScore ? '<strong>New High Score!</strong>' : `High Score: ${infiniteHighScore}`}`;
                    }
                } else {
                    el.winMessageFinalText.textContent = "Game Complete!";
                    el.winnerSubtext.textContent = `You scored ${maxScore} out of 10!`;
                }
            } else { 
                if (winners.length > 1) { el.winMessageFinalText.textContent = "It's a Tie!"; el.winnerSubtext.textContent = `${winners.join(' and ')} both finished with ${maxScore} points.`; }
                else if (winners.length === 1 && maxScore > 0) { el.winMessageFinalText.textContent = `${winners[0]} Wins!`; el.winnerSubtext.textContent = `Congratulations on reaching ${maxScore} points!`; }
                else { el.winMessageFinalText.textContent = "Game Over!"; el.winnerSubtext.textContent = "Better luck next time!"; }
            }
            
            el.finalScoresDisplay.innerHTML = '';
            Object.entries(gameState.scores).forEach(([name, score]) => {
                el.finalScoresDisplay.innerHTML += `<div class="score-card ${winners.includes(name) && maxScore > 0 ? 'winner-glow' : ''}">
                    <div class="team-name-score">${name}</div>
                    <div class="score-value-display">${score}</div>
                </div>`;
            });
            
            if (!treatYourselfElement) {
                treatYourselfElement = document.createElement('div');
                treatYourselfElement.className = 'treat-yourself-callout';
                treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`;
                el.storeButtonWrapper.insertBefore(treatYourselfElement, el.visitStoreBtn);
            }
            switchScreen('gameOver');
        }

        function playAgain() { if (treatYourselfElement) treatYourselfElement.style.display = 'none'; startGame(); }
        function goToMainMenu() { if (treatYourselfElement) treatYourselfElement.style.display = 'none'; switchScreen('start'); }

        document.addEventListener('DOMContentLoaded', () => {
            loadSettings(); 
            loadHighScore();
            
            el.audioConsentModal.style.display = 'flex';
            
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('pageshow', handlePageShow);
            
            el.audioConsentYesBtn.addEventListener('click', () => {
                el.audioConsentModal.style.display = 'none';
                initAudio();
                playSound(el.audio.interaction);
            });
            el.audioConsentNoBtn.addEventListener('click', () => {
                el.audioConsentModal.style.display = 'none';
                gameConfig.sfxEnabled = false;
                gameConfig.musicVolume = 0;
                el.audio.bgm.volume = 0;
                el.bgmVolumeSlider.value = 0;
                el.sfxToggleBtn.textContent = 'SFX: OFF';
                localStorage.setItem('sfxEnabled', 'false');
                localStorage.setItem('musicVolume', '0');
                initAudio();
            });

            el.settingsBtn.addEventListener('click', () => { playSound(el.audio.interaction); el.settingsModal.style.display = 'flex'; });
            el.closeModalBtn.addEventListener('click', () => { playSound(el.audio.interaction); el.settingsModal.style.display = 'none'; });
            el.bgmVolumeSlider.addEventListener('input', (e) => { 
                gameConfig.musicVolume=e.target.value; 
                el.audio.bgm.volume=gameConfig.musicVolume; 
                localStorage.setItem('musicVolume',gameConfig.musicVolume); 
                if (gameConfig.musicVolume > 0 && !document.hidden && audioContextStarted) el.audio.bgm.play().catch(()=>{});
                else el.audio.bgm.pause();
            });
            el.sfxToggleBtn.addEventListener('click', () => { 
                gameConfig.sfxEnabled=!gameConfig.sfxEnabled; 
                el.sfxToggleBtn.textContent=`SFX: ${gameConfig.sfxEnabled?'ON':'OFF'}`; 
                playSound(el.audio.interaction); 
                localStorage.setItem('sfxEnabled',gameConfig.sfxEnabled); 
            });

            el.modeOptions.forEach(opt => opt.addEventListener('click', function(){playSound(el.audio.interaction);selectGameMode.call(this)}));
            el.addTeamBtn.addEventListener('click', () => { playSound(el.audio.interaction); addTeamInput(); });
            el.tenRoundsBtn.addEventListener('click', () => startSinglePlayerGame('10rounds'));
            el.infiniteModeBtn.addEventListener('click', () => startSinglePlayerGame('infinite'));
            el.startGameBtn.addEventListener('click', () => playSoundWithCallback(el.audio.start, startGame));
            el.revealAnswerBtn.addEventListener('click', () => { playSound(el.audio.interaction); revealAnswer(); });
            el.playAgainGameBtn.addEventListener('click', () => playSoundWithCallback(el.audio.start, playAgain));
            el.mainMenuNavBtn.addEventListener('click', () => { playSound(el.audio.interaction); goToMainMenu(); });
            el.visitStoreBtn.addEventListener('click', () => { playSound(el.audio.interaction); window.location.href='/store'; });
            el.backToMenuBtn.addEventListener('click', () => { playSound(el.audio.interaction); goToMainMenu(); });
            el.highscoreBtn.addEventListener('click', showHighScore);
            switchScreen('start');
        });
        
        const gameContainerForScroll = document.querySelector('.game-container');
        let lastTouchY = 0;

        window.addEventListener('wheel', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                gameContainerForScroll.scrollTop += e.deltaY;
            }
        }, { passive: true });

        window.addEventListener('touchstart', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                if (e.touches.length > 0) {
                    lastTouchY = e.touches[0].clientY;
                }
            }
        }, { passive: true });

        window.addEventListener('touchmove', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                e.preventDefault(); 
                if (e.touches.length > 0) {
                    const currentTouchY = e.touches[0].clientY;
                    const deltaY = lastTouchY - currentTouchY;
                    gameContainerForScroll.scrollTop += deltaY;
                    lastTouchY = currentTouchY;
                }
            }
        }, { passive: false });
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-N5PBKM0DNQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N5PBKM0DNQ');
</script>

</body>
</html>