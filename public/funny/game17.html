<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess the Flag - Blyza Game Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- START: BRAND IDENTITY & ROOT VARIABLES --- */
        :root {
            --blyza-orange-primary: #FF8833;
            --blyza-purple-secondary: #cb7ae1;
            --blyza-keppel-accent: #00BFA6;
            --blyza-sunny-yellow: #FFDF00;
            --blyza-quickfire-red: #EA2027;
            --darker-grey-bg: #4A4A4A;
            --text-light: #FDFEFE;
            --text-dark: #2C3A47;
            --text-medium: #535c68;
            --black-stroke: #1A1A1A;
            --font-logo: "Luckiest Guy", cursive;
            --font-heading-alt: "Bungee", cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-radius-game: 12px;
            --shadow-chunky: 4px 4px 0px var(--black-stroke);
        }
        /* --- END: BRAND IDENTITY & ROOT VARIABLES --- */

        /* --- Basic Reset & Body --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        
        body {
            font-family: var(--font-body);
            color: var(--text-light);
            background: linear-gradient(135deg, var(--blyza-orange-primary) 0%, var(--blyza-purple-secondary) 100%);
            line-height: 1.6;
            overflow: hidden; /* Body does not scroll */
            position: relative;
            height: var(--app-height, 100vh); /* Full screen height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- Floating Background Elements --- */
        .hero-background-elements { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
        .bg-game-element {
            position: absolute; opacity: 0.1; color: var(--text-light);
            animation: floatSimple 20s infinite ease-in-out alternate;
            user-select: none;
        }
        .bg-flag-1 { font-size: 150px; top: 10%; left: 5%; --initial-rotate: -15deg; animation-duration: 22s; }
        .bg-star-1 { font-size: 100px; top: 65%; right: 8%; --initial-rotate: 10deg; animation-duration: 18s; }
        .bg-shield-1 { font-size: 120px; top: 70%; left: 15%; --initial-rotate: 5deg; animation-duration: 25s; opacity: 0.08; }
        .bg-ribbon-1 { font-size: 130px; top: 15%; right: 10%; --initial-rotate: 20deg; animation-duration: 16s; }
        .bg-flag-2 { font-size: 80px; top: 80%; right: 25%; --initial-rotate: 25deg; animation-duration: 15s; }
        .bg-star-2 { font-size: 120px; bottom: 5%; left: 3%; --initial-rotate: -5deg; animation-duration: 28s; }
        .bg-shield-2 { font-size: 90px; top: 20%; left: 20%; --initial-rotate: 15deg; animation-duration: 20s; }
        .bg-medal-1 { font-size: 70px; top: 5%; right: 30%; --initial-rotate: -10deg; animation-duration: 24s; }
        .bg-trophy-1 { font-size: 110px; bottom: 10%; right: 4%; --initial-rotate: 12deg; animation-duration: 19s; }
        .bg-flag-3 { font-size: 60px; top: 50%; left: 1%; --initial-rotate: 20deg; animation-duration: 26s; }


        @keyframes floatSimple {
            0% { transform: translateY(0px) rotate(var(--initial-rotate, 0deg)); }
            50% { transform: translateY(-25px) rotate(calc(var(--initial-rotate, 0deg) + 8deg)); }
            100% { transform: translateY(0px) rotate(calc(var(--initial-rotate, 0deg) - 8deg)); }
        }
        
        .game-container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(145deg, #fdfefe, #e9ecef);
            color: var(--text-dark);
            border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke);
            box-shadow: 8px 8px 0px var(--black-stroke);
            padding: 30px; 
            text-align: center;
            position: relative;
            z-index: 2;
            max-height: calc(var(--app-height, 100vh) - 40px);
            overflow-y: auto;
        }

        .brand-logo { object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .brand-logo-prominent { display: block; margin: 0 auto 15px; max-height: 80px; }
        
        h1 {
            font-family: var(--font-logo);
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
            text-shadow: 3px 3px 0px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            line-height: 1.1;
        }
        h3, .screen-title {
            font-family: var(--font-heading-alt);
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-dark);
        }
        
        .screen { display: none; animation: fadeInScreen 0.5s ease-out; }
        @keyframes fadeInScreen { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .active { display: block; }
        
        .instructions, .team-inputs-container {
            background: rgba(0,0,0, 0.04);
            padding: 20px; border-radius: 10px; margin: 25px 0;
            border: 2px dashed var(--text-medium);
        }
        .instructions p strong { font-family: var(--font-heading-alt); display: block; margin-bottom: 15px; font-size: 1.3rem; }
        .instructions ul { list-style-type: none; text-align: left; padding: 0 10px; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: center; font-weight: 500; font-size: 1.1rem; }
        .instructions i { margin-right: 15px; font-size: 1.3em; color: var(--blyza-purple-secondary); width: 25px; text-align: center; }
        .instructions strong { font-weight: 700; color: var(--text-dark); }

        /* --- Buttons --- */
        button, .btn-primary, .btn-secondary, .btn-success, .btn-info {
            font-family: var(--font-heading-alt); font-size: 1.1rem; padding: 0.7em 1.5em;
            border: 3px solid var(--black-stroke); border-radius: 8px;
            text-transform: uppercase; text-decoration: none; display: inline-flex;
            align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            letter-spacing: 1px; cursor: pointer; color: var(--text-dark);
            margin: 8px 5px;
            box-shadow: var(--shadow-chunky);
        }
        button:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        button:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        button:disabled { background: var(--text-medium); color: var(--text-light); cursor: not-allowed; opacity: 0.7; }

        .btn-primary, #start-game-btn, #action-btn, #ten-rounds-btn, #infinite-mode-btn { background-color: var(--blyza-sunny-yellow); }
        .btn-secondary, #main-menu-nav-btn, #audio-consent-no-btn { background-color: var(--blyza-purple-secondary); color: var(--text-light); }
        .btn-success, #play-again-game-btn, #audio-consent-yes-btn { background-color: var(--blyza-keppel-accent); color: var(--text-light); }
        .btn-info, #visit-store-btn { background-color: #4ECDC4; }

        .game-mode-selection { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .mode-option {
            background: var(--text-light); padding: 20px; border-radius: var(--border-radius-game);
            cursor: pointer; transition: all 0.3s ease; border: 3px solid var(--black-stroke);
            box-shadow: var(--shadow-chunky); flex: 1; min-width: 250px; max-width: 300px;
        }
        .mode-option:hover { transform: translateY(-5px) scale(1.02); box-shadow: 6px 6px 0 var(--blyza-orange-primary); }
        .mode-option.selected {
            background: var(--blyza-keppel-accent); color: var(--text-light); border-color: var(--black-stroke);
            transform: scale(1.02); box-shadow: 6px 6px 0 var(--black-stroke);
        }
        .mode-option.selected i, .mode-option.selected h3, .mode-option.selected p { color: var(--text-light); }
        .mode-option i { font-size: 2.5rem; margin-bottom: 10px; color: var(--blyza-orange-primary); transition: all 0.3s ease; }
        .mode-option h3 { font-family: var(--font-heading-alt); margin-bottom: 8px; font-size: 1.3rem; color: var(--text-dark); }
        .mode-option p { color: var(--text-medium); font-size: 0.9rem; }
        #team-names-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .team-input input.team-name-input {
            width: 100%; padding: 12px 18px; border-radius: 8px;
            border: 3px solid var(--black-stroke); background: var(--text-light);
            color: var(--text-dark); font-size: 1rem; transition: all 0.3s ease;
            font-family: var(--font-body); font-weight: 600;
        }
        .team-input input.team-name-input:focus { outline: none; border-color: var(--blyza-orange-primary); box-shadow: 0 0 0 3px var(--blyza-sunny-yellow); }

        .game-info {
            display: flex; justify-content: center; align-items: center; flex-wrap: wrap;
            gap: 20px; margin-bottom: 15px; padding: 10px 15px; background: rgba(0,0,0,0.1);
            border-radius: 8px; font-family: var(--font-heading-alt);
            color: var(--text-dark); border: 2px solid var(--black-stroke);
        }
        .score-display-multiplayer { display: flex; gap: 15px; }
        .score-box {
            background: rgba(0,0,0,0.1); padding: 8px 15px; border-radius: 8px; font-family: var(--font-heading-alt);
            border: 2px solid var(--black-stroke); transition: all 0.3s ease;
        }
        .score-box.current-turn { border-color: var(--blyza-orange-primary); transform: scale(1.05); }

        .place-display-stage {
            background: var(--darker-grey-bg); padding: 20px; border-radius: var(--border-radius-game);
            margin-bottom: 25px; border: 3px solid var(--black-stroke);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        }
        .stage-curtains {
            position: absolute; top: 0; width: 51%; height: 100%; background-color: var(--text-dark);
            background-image: repeating-linear-gradient(90deg, transparent, transparent 20px, rgba(255,255,255,0.03) 20px, rgba(255,255,255,0.03) 40px);
            box-shadow: 0 0 25px rgba(0,0,0,0.6); transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1);
            z-index: 5;
        }
        .stage-curtains.left { left: 0; border-right: 6px solid var(--blyza-orange-primary); }
        .stage-curtains.right { right: 0; border-left: 6px solid var(--blyza-orange-primary); }
        .stage-curtains.open.left { transform: translateX(-105%) skewX(-10deg); }
        .stage-curtains.open.right { transform: translateX(105%) skewX(10deg); }
        
        .place-tv-screen {
            background: #111; border: 10px solid #333; border-radius: 15px; padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative; z-index: 1; min-height: 250px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .place-tv-screen h3 {
            font-family: var(--font-logo); color: var(--blyza-sunny-yellow); -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke);
            font-size: 1.6rem; margin-bottom: 15px;
        }
        .flag-image {
            height: 180px; width: 100%; object-fit: contain; border-radius: 8px; margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.5s ease-in 0.8s;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.4));
        }
        .flag-image.visible { opacity: 1; }

        .options-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 25px auto; }
        .option-btn {
            font-family: var(--font-body); text-transform: none; font-weight: 600; font-size: 1rem;
            text-align: center; justify-content: center; min-height: 60px;
            background: var(--text-light); animation: popIn 0.4s ease-out backwards;
        }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .option-btn i { font-size: 1.1rem; color: var(--blyza-purple-secondary); margin-right: 10px; }
        .option-btn.correct { background-color: var(--blyza-keppel-accent) !important; color: var(--text-light) !important; border-color: var(--black-stroke); }
        .option-btn.incorrect { background-color: var(--blyza-quickfire-red) !important; color: var(--text-light) !important; border-color: var(--black-stroke); }
        .option-btn:disabled:not(.correct) { background: var(--text-medium); opacity: 0.7; }
        
        .final-score-display { display: grid; gap: 20px; margin: 30px 0; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        .score-card { background: rgba(0,0,0,0.05); padding: 20px; border-radius: 10px; border: 3px solid var(--black-stroke); box-shadow: var(--shadow-chunky); }
        .score-card .team-name-score { font-family: var(--font-heading-alt); color: var(--blyza-orange-primary); font-size: 1.3rem; }
        .score-card .score-value-display { font-family: var(--font-logo); font-size: 2.2rem; }
        .score-card.winner-glow { animation: winnerGlow 1.5s infinite alternate; border-color: var(--blyza-keppel-accent); }
        @keyframes winnerGlow { from { box-shadow: 4px 4px 0 var(--blyza-keppel-accent); } to { box-shadow: 4px 4px 15px var(--blyza-keppel-accent); } }
        
        .win-message { font-family: var(--font-logo); font-size: 3rem; margin: 20px 0; color: var(--blyza-orange-primary); -webkit-text-stroke: 2px var(--black-stroke); text-stroke: 2px var(--black-stroke); }
        .winner-trophy { font-size: 6rem; margin: 20px 0; animation: bounce 1.5s infinite ease-in-out; color: var(--blyza-sunny-yellow); text-shadow: 0 0 20px var(--blyza-orange-primary), 3px 3px 0 var(--black-stroke); }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }
        #winner-subtext { font-family: var(--font-body); font-size: 1.1rem; color: var(--text-medium); margin-bottom: 20px; font-weight: 600; }
        .game-over-buttons-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 20px; }

        .icon-btn { position: absolute; background-color: var(--blyza-purple-secondary); color: var(--text-light); border-radius: 50%; width: 55px; height: 55px; font-size: 1.2rem; cursor: pointer; transition: all 0.1s ease; display: flex; justify-content: center; align-items: center; z-index: 100; text-decoration: none; border: 3px solid var(--black-stroke); box-shadow: var(--shadow-chunky); }
        .icon-btn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        .icon-btn:active { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        #settings-btn { top: 20px; right: 20px; }
        #highscore-btn { top: 20px; right: 85px; background-color: var(--blyza-sunny-yellow); }
        #back-to-games-btn, #back-to-menu-btn { top: 20px; left: 20px; }
        
        .modal {
            position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); 
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
            animation: fadeInModal 0.3s ease;
        }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }

        .modal-content {
            background-color: var(--darker-grey-bg); margin: auto; padding: 25px;
            border: 3px solid var(--black-stroke); border-radius: var(--border-radius-game);
            width: 90%; max-width: 450px; box-shadow: 8px 8px 0px rgba(0,0,0,0.4);
            position: relative; color: var(--text-light); text-align: center;
        }
        .modal-content h2 {
            font-family: var(--font-logo); color: var(--blyza-orange-primary);
            -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke);
            text-align: center; margin-bottom: 25px; font-size: 2rem;
        }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; text-align: left; }
        .setting-item label { margin-bottom: 10px; font-weight: 600; font-size: 1rem; }
        .close-modal-btn { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-modal-btn:hover { color: var(--text-light); }
        #settings-modal .setting-item button { font-size: 1rem; padding: 10px 20px; width: 100%; }
        #audio-consent-modal .modal-content p {
            font-family: var(--font-body); font-weight: 600; font-size: 1.1rem;
            margin-bottom: 25px; color: var(--text-light);
        }
        #audio-consent-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: rgba(0,0,0,0.3); border-radius: 5px; border: 2px solid var(--black-stroke); }
        input[type=range]::-webkit-slider-thumb { border: 2px solid var(--black-stroke); height: 22px; width: 22px; border-radius: 50%; background: var(--blyza-orange-primary); cursor: pointer; -webkit-appearance: none; margin-top: -9px; }

        .feedback-popup { position: fixed; top: 50%; left: 50%; background-color: var(--text-dark); color: white; padding: 25px 40px; border-radius: var(--border-radius-game); font-size: 2.5rem; font-family: var(--font-logo); text-align: center; z-index: 2000; box-shadow: 8px 8px 0px rgba(0,0,0,0.5); opacity: 0; transform: translate(-50%, -50%) scale(0.7); transition: opacity 0.3s ease, transform 0.3s ease; pointer-events: none; border: 3px solid var(--black-stroke); display: none; }
        .feedback-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); display: block; }
        .feedback-popup.correct-feedback { color: var(--blyza-keppel-accent); }
        .feedback-popup.incorrect-feedback { color: var(--blyza-quickfire-red); }
        .feedback-popup.win-feedback { color: var(--blyza-sunny-yellow); }

        .confetti-piece { position: fixed; width: 10px; height: 20px; background-color: var(--blyza-orange-primary); opacity: 0; animation-timing-function: linear; animation-fill-mode: forwards; pointer-events: none; z-index: 3000; }
        @keyframes fallAndFade { 0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(120vh) rotate(720deg); opacity: 0; } }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
                align-items: flex-start;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .game-container { 
                padding: 45px 15px 15px; 
                max-height: calc(var(--app-height, 100vh) - 40px);
            } 
            h1 { font-size: 2.2rem; margin-top: 5px; }
            .mode-option { max-width: 100%; min-width: unset; }
            .final-score-display, #team-names-grid { grid-template-columns: 1fr; }
            .options-container { grid-template-columns: 1fr; }
            .icon-btn { width: 48px; height: 48px; }

            /* --- FIXED: Mobile Button Alignment --- */
            #settings-btn, #highscore-btn, #back-to-games-btn, #back-to-menu-btn {
                top: 15px;
            }
            #settings-btn { right: 15px; }
            #highscore-btn { right: 75px; }
            #back-to-games-btn, #back-to-menu-btn { left: 15px; }

            .feedback-popup { font-size: 2rem; padding: 20px 30px; width: 90%; }
            .modal-content { padding: 20px; }
            .game-over-buttons-container { flex-direction: column; align-items: center; }
            .game-over-buttons-container button { width: 90%; }
            .flag-image { height: 150px; }
            .place-tv-screen h3 { font-size: 1.5rem; }
            .win-message { font-size: 2.2rem; }
            .bg-game-element { display: none; }
            .game-info { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="hero-background-elements">
        <div class="bg-game-element bg-flag-1"><i class="fas fa-flag"></i></div>
        <div class="bg-game-element bg-star-1"><i class="fas fa-star"></i></div>
        <div class="bg-game-element bg-shield-1"><i class="fas fa-shield-alt"></i></div>
        <div class="bg-game-element bg-ribbon-1"><i class="fas fa-ribbon"></i></div>
        <div class="bg-game-element bg-flag-2"><i class="far fa-flag"></i></div>
        <div class="bg-game-element bg-star-2"><i class="far fa-star"></i></div>
        <div class="bg-game-element bg-shield-2"><i class="fas fa-shield-alt"></i></div>
        <div class="bg-game-element bg-medal-1"><i class="fas fa-medal"></i></div>
        <div class="bg-game-element bg-trophy-1"><i class="fas fa-trophy"></i></div>
        <div class="bg-game-element bg-flag-3"><i class="fas fa-flag-checkered"></i></div>
    </div>
    
    <script>
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>
    
    <div class="game-container">
       <!-- FIXED: Button IDs and Icons updated for clarity and to fix JS bug -->
       <a href="#" onclick="history.back(); return false;" id="back-to-games-btn" class="icon-btn" aria-label="Back to Games List" title="Back to Games List">
            <i class="fas fa-arrow-left"></i>
        </a>
        <button id="back-to-menu-btn" class="icon-btn" aria-label="Back to Main Menu" title="Back to Main Menu" style="display: none;">
            <i class="fas fa-home"></i>
        </button>
        <button id="highscore-btn" class="icon-btn" aria-label="Show High Score" title="Show High Score">
            <i class="fas fa-star"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings" title="Settings">
            <i class="fas fa-cog"></i>
        </button>

        <div id="start-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Guess the Flag</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY:</strong></p>
                <ul>
                    <li><i class="fas fa-flag-checkered"></i> Guess the country for the flag shown from four options.</li>
                    <li><i class="fas fa-user"></i> Single Player: Play classic 10 rounds or try the Infinite Mode!</li>
                    <li><i class="fas fa-users"></i> Multiplayer: Two teams take turns. First to 5 points wins!</li>
                </ul>
            </div>
            <div class="game-mode-selection">
                <div class="mode-option selected" data-mode="single"> <i class="fas fa-user"></i> <h3>Single Player</h3> <p>10 rounds or Infinite</p> </div>
                <div class="mode-option" data-mode="multi"> <i class="fas fa-users"></i> <h3>Multiplayer</h3> <p>With a friend</p> </div>
            </div>
            
            <div id="single-player-sub-options" style="margin-top: 20px;">
                <button id="ten-rounds-btn" class="btn-primary"><i class="fas fa-list-ol"></i> 10 Rounds</button>
                <button id="infinite-mode-btn" class="btn-primary"><i class="fas fa-infinity"></i> Infinite Mode</button>
            </div>

            <div id="multiplayer-start-area" style="display: none;">
                <div id="team-inputs-container" class="team-inputs-container">
                    <h3 class="screen-title">Enter Team Names</h3>
                    <div id="team-names-grid">
                        <div class="team-input"><input type="text" class="team-name-input" placeholder="Team 1"></div>
                        <div class="team-input"><input type="text" class="team-name-input" placeholder="Team 2"></div>
                    </div>
                </div>
                <button id="start-game-btn" class="btn-primary">Start Multiplayer <i class="fas fa-play"></i></button>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div class="game-info" id="game-info-bar"></div>
            <div class="place-display-stage">
                <div class="stage-curtains left"></div> <div class="stage-curtains right"></div>
                <div class="place-tv-screen">
                    <h3>Whose flag is this?</h3>
                    <img id="flag-image-display" src="" alt="Flag to guess" class="flag-image">
                </div>
            </div>
            <div id="options-container" class="options-container"></div>
            <button id="action-btn" class="btn-primary" style="margin-top:20px; display: none;">Next <i class="fas fa-arrow-right"></i></button>
        </div>

        <div id="game-over-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1 id="game-over-title">Game Over!</h1>
            <div class="win-message" id="win-message-final-text">Team Wins!</div>
            <div class="winner-trophy" id="winner-trophy-icon">üèÜ</div>
            <div id="winner-subtext"></div>
            <div id="final-scores-display-div" class="final-score-display"></div>
            <div class="game-over-buttons-container">
                <button id="play-again-game-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                <button id="main-menu-nav-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
            </div>
        </div>
    </div>

    <div id="audio-consent-modal" class="modal">
        <div class="modal-content">
            <h2>Enable Audio?</h2>
            <p>This game has background music and sound effects. Would you like to enable them for the best experience?</p>
            <div id="audio-consent-buttons">
                <button id="audio-consent-yes-btn" class="btn-success"><i class="fas fa-volume-up"></i> Yes, please!</button>
                <button id="audio-consent-no-btn" class="btn-secondary"><i class="fas fa-volume-mute"></i> No, thanks</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">√ó</span>
            <h2>Settings</h2>
            <div class="setting-item"> <label for="bgm-volume-slider">Background Music:</label> <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2"> </div>
            <div class="setting-item"> <label for="sfx-toggle-btn">Sound Effects:</label> <button id="sfx-toggle-btn">SFX: ON</button> </div>
        </div>
    </div>
    <div id="feedback-popup" class="feedback-popup"> <span id="feedback-message-text-el"></span> </div>

    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="correct-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="wrong-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="win-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>
    <audio id="curtain-sound" src="https://static.wixstatic.com/mp3/9ce3e5_ccd36cdf98bf4e1594cf2e52d5296c51.wav"></audio>

    <script>
        const gameConfig = { sfxEnabled: true, musicVolume: 0.2 };
        const gameState = {
            teams: [], currentTeamIndex: 0, currentFlag: null,
            remainingFlags: [], usedFlags: [], gameMode: 'single',
            singlePlayerSubType: '10rounds',
            puzzlesPlayed: 0, winningScore: 5, maxRounds: 10,
            roundPhase: 'guessing', currentGuess: null
        };
        let infiniteHighScore = 0;
        let audioContextStarted = false;

        const flagData = [ { country: "United States", code: "us", options: ["Canada", "United States", "Mexico", "Brazil"] }, { country: "France", code: "fr", options: ["France", "Belgium", "Netherlands", "Luxembourg"] }, { country: "Japan", code: "jp", options: ["Japan", "China", "South Korea", "Vietnam"] }, { country: "Brazil", code: "br", options: ["Brazil", "Argentina", "Colombia", "Peru"] }, { country: "Australia", code: "au", options: ["Australia", "New Zealand", "Fiji", "Samoa"] }, { country: "Germany", code: "de", options: ["Germany", "Austria", "Switzerland", "Poland"] }, { country: "Italy", code: "it", options: ["Italy", "Spain", "Portugal", "Greece"] }, { country: "South Africa", code: "za", options: ["South Africa", "Nigeria", "Kenya", "Egypt"] }, { country: "India", code: "in", options: ["India", "Pakistan", "Bangladesh", "Sri Lanka"] }, { country: "Canada", code: "ca", options: ["Canada", "United States", "Mexico", "Greenland"] }, { country: "United Kingdom", code: "gb", options: ["United Kingdom", "Ireland", "France", "Iceland"] }, { country: "China", code: "cn", options: ["China", "Japan", "South Korea", "Mongolia"] },
             { country : "Afghanistan", code : "af", options : ["Uzbekistan", "Turkmenistan", "Afghanistan", "Azerbaijan"] }, { country : "√Öland Islands", code : "ax", options : ["Finland", "√Öland Islands", "Denmark", "Iceland"] }, { country : "Albania", code : "al", options : ["Albania", "Montenegro", "Kosovo", "Serbia"] }, { country : "Algeria", code : "dz", options : ["Pakistan", "Algeria", "Algiers", "Azerbaijan"] }, { country : "American Samoa", code : "as", options : ["Guam", "Nepal", "Ethiopia", "American Samoa"] }, { country : "Andorra", code : "ad", options : ["Moldova", "Andorra", "Chad", "Romania"] }, { country : "Angola", code : "ao", options : ["Andorra", "Mozambique", "Angola", "Afghanistan"] }, { country : "Anguilla", code : "ai", options : ["British Virgin Islands", "Queensland", "Anguilla", "Victoria"] }, { country : "Antarctica", code : "aq", options : ["Cyprus", "Antarctica", "Australia", "United Islands"] }, { country : "Antigua and Barbuda", code : "ag", options : ["Antigua and Barbuda", "Bahamas", "Barbados", "Rocky Islands"] },
             { country : "Argentina", code : "ar", options : ["El Salvador", "Guatemala", "Florentina", "Argentina"] }, { country : "Armenia", code : "am", options : ["Columbia", "Armenia", "Hungary", "Romania"] }, { country : "Aruba", code : "aw", options : ["Aruba", "Fiji", "Cyprus", "Bahamas"] }, { country : "Austria", code : "at", options : ["Austria", "Latvia", "Peru", "Monaco"] }, { country : "Azerbaijan", code : "az", options : ["Baku", "Tajikistan", "Azerbaijan", "Turkmenistan"] }, { country : "Bahamas", code : "bs", options : ["Barbados", "Bahamas", "Saint Lucia", "Dominica"] }, { country : "Bhutan", code : "bt", options : ["Bhutan", "Myanmar", "Sri Lanka", "Mongolia"] }, { country : "Bahrain", code : "bh", options : ["Bahrain", "Qatar", "Kuwait", "Yemen"] }, { country : "Bangladesh", code : "bd", options : ["Sri Lanka", "Bangladesh", "Japan", "Dhaka"] }, { country : "Barbados", code : "bb", options : ["Barbados", "Bahamas", "Andorra", "Dominican Republic"] },
             { country : "Belarus", code : "by", options : ["Belarus", "Oman", "Turkmenistan", "Kazakasthan"] }, { country : "Belgium", code : "be", options : ["Belgium", "Germany", "Chad", "Italy"] }, { country : "Belize", code : "bz", options : ["Belize", "Costa Rica", "Panama", "Cuba"] }, { country : "Benin", code : "bj", options : ["Benin", "Burkina Faso", "Ghana", "Mali"] }, { country : "Bolivia", code : "bo", options : ["Bolivia", "Mali", "Ghana", "Togo"] }, { country : "Bosnia and Herzegovina", code : "ba", options : ["Bosnia and Herzegovina", "Ukraine", "Croatia", "Serbia"] }, { country : "Botswana", code : "bw", options : ["Botswana", "South Sudan", "Namibia", "Argentina"] }, { country : "Brunei", code : "bn", options : ["Brunei", "Kyrgyztan", "Mongolia", "Cambodia"] }, { country : "Bulgaria", code : "bg", options : ["Bulgaria", "Hungary", "Latvia", "Lithuania"] }, { country : "Burkina Faso", code : "bf", options : ["Burkina Faso", "Ghana", "Senegal", "Benin"] },
             { country : "Burundi", code : "bi", options : ["Burundi", "Comoros", "Malawi", "Mozambique"] }, { country : "Cambodia", code : "kh", options : ["Cambodia", "Thailand", "Laos", "Hong kong"] }, { country : "Cameroon", code : "cm", options : ["Cameroon", "Ghana", "Senegal", "Mali"] }, { country : "Cape Verde", code : "cv", options : ["Cape Verde", "European Union", "Lesotho", "South Australia"] }, { country : "Central African Republic", code : "cf", options : ["Central African Republic", "Republic of Congo", "Burundi", "Burkani Faso"] }, { country : "Chad", code : "td", options : ["Chad", "Romania", "Bulgaria", "Comoros"] }, { country : "Chile", code : "cl", options : ["Chile", "Cuba", "Puerto Rico", "Panama"] }, { country : "Colombia", code : "co", options : ["Colombia", "Venezuela", "Ecuador", "Lithuania"] }, { country : "Comoros", code : "km", options : ["Comoros", "Azerbaijan", "Pakistan", "Cameroon"] }, { country : "Republic of the Congo", code : "cg", options : ["Republic of the Congo", "Comoros", "Trinidad and Tobago", "DR Congo"] },
             { country : "DR Congo", code : "cd", options : ["DR Congo", "Republic of the Congo", "Trinidad and Tobago", "Somalia"] }, { country : "Costa Rica", code : "cr", options : ["Costa Rica", "Cuba", "El Salvador", "Chile"] }, { country : "C√¥te d'Ivoire", code : "ci", options : ["C√¥te d'Ivoire", "Ireland", "Italy", "Jamaica"] }, { country : "Croatia", code : "hr", options : ["Croatia", "Serbia", "Czechia", "Panama"] }, { country : "Cuba", code : "cu", options : ["Cuba", "Chile", "Costa Rica", "El Salvador"] }, { country : "Cyprus", code : "cy", options : ["Cyprus", "Antarctica", "Australia", "Samoan Islands"] }, { country : "Czechia", code : "cz", options : ["Czechia", "Croatia", "Serbia", "Panama"] }, { country : "Denmark", code : "dk", options : ["Denmark", "Finalnd", "Norway", "Sweden"] }, { country : "Djibouti", code : "dj", options : ["Djibouti", "Tanzania", "Somalia", "Eritrea"] }, { country : "Dominica", code : "dm", options : ["Dominica", "Ethiopia", "Gabon", "Lesotho"] },
             { country : "Dominican Republic", code : "do", options : ["Dominican Republic", "Panama", "Botswana", "Fiji"] }, { country : "Ecuador", code : "ec", options : ["Ecuador", "Colombia", "Venezuela", "Cambodia"] }, { country : "Egypt", code : "eg", options : ["Egypt", "Iran", "Yemen", "Morocco"] }, { country : "El Salvador", code : "sv", options : ["El Salvador", "Guatemala", "Barbados", "Bahamas"] }, { country : "Equatorial Guinea", code : "gq", options : ["Equatorial Guinea", "Papua New Guinea", "Guam", "Guinea"] }, { country : "Eritrea", code : "er", options : ["Eritrea", "Lesotho", "Rwanda", "Gabon"] }, { country : "Estonia", code : "ee", options : ["Estonia", "Lithuania", "Albania", "Armenia"] }, { country : "Eswatini", code : "sz", options : ["Eswatini", "Botswana", "Djibouti", "South Sudan"] }, { country : "Ethiopia", code : "et", options : ["Ethiopia", "Eritrea", "Cape Verde", "Gambia"] }, { country : "Fiji", code : "fj", options : ["Honduras", "Fiji", "British Virgin Islands", "North New Zealand"] },
             { country : "Finland", code : "fi", options : ["Finland", "Sweden", "Greenland", "Iceland"] }, { country : "French Polynesia", code : "pf", options : ["French Polynesia", "Peru", "Samoa", "Tuvalu"] }, { country : "Gabon", code : "ga", options : ["Gabon", "Jamaica", "Estonnia", "Botswana"] }, { country : "Gambia", code : "gm", options : ["Gambia", "Madagascar", "Eswatini", "Benin"] }, { country : "Georgia", code : "ge", options : ["Georgia", "England", "Denmark", "Switzerland"] }, { country : "Ghana", code : "gh", options : ["Ghana", "Senegal", "Cameroon", "Somalia"] }, { country : "Greece", code : "gr", options : ["Greece", "Uruguay", "Puerto Rico", "Iceland"] }, { country : "Grenada", code : "gd", options : ["Grenada", "Haiti", "Saint Lucia", "Bahamas"] }, { country : "Guam", code : "gu", options : ["Guam", "Pacific Islands", "Guatemala", "South Madagascar"] }, { country : "Guatemala", code : "gt", options : ["Guatemala", "Peru", "Fijij", "El Salvador"] },
             { country : "Guyana", code : "gy", options : ["Guyana", "Sao Tome Principe", "Island Of Carribeans", "Guam"] }, { country : "Haiti", code : "ht", options : ["Haiti", "Fiji", "Hawaii", "British Vigin Islands"] }, { country : "Honduras", code : "hn", options : ["Honduras", "Guatemala", "Eritrea", "Haiti"] }, { country : "Hong Kong", code : "hk", options : ["Hong Kong", "Vietnam", "Tunisia", "Mongolia"] }, { country : "Hungary", code : "hu", options : ["Hungary", "Bulgaria", "Latvia", "Lithuania"] }, { country : "Indonesia", code : "id", options : ["Indonesia", "Poland", "Monaco", "Thaliand"] }, { country : "Iran", code : "ir", options : ["Iran", "Iraq", "Belarus", "Oman"] }, { country : "Iraq", code : "iq", options : ["Iraq", "Iran", "Egypt", "Yemen"] }, { country : "Ireland", code : "ie", options : ["Ireland", "Ivory Coast", "Italy", "Jamaica"] }, { country : "Jamaica", code : "jm", options : ["Jamaica", "Mali", "Guinea", "Togo"] },
             { country : "Jordan", code : "jo", options : ["Jordan", "Palestine", "Kuwait", "Bahrain"] }, { country : "Kazakhstan", code : "kz", options : ["Kazakhstan", "Uzbekistan", "Turkmenistan", "Azerbaijan"] }, { country : "Kenya", code : "ke", options : ["Kenya", "Zimbabwe", "Uganda", "Mozambique"] }, { country : "North Korea", code : "kp", options : ["North Korea", "Cuba", "Puerto Rico", "Samoa"] }, { country : "South Korea", code : "kr", options : ["South Korea", "North Korea", "Hong Kong", "East Timor"] }, { country : "Kuwait", code : "kw", options : ["Kuwait", "Jordan", "Palestine", "South Africa"] }, { country : "Kyrgyzstan", code : "kg", options : ["Kyrgyzstan", "Hong Kong", "Laos", "Uzbekistan"] }, { country : "Laos", code : "la", options : ["Laos", "Thailand", "Cambodia", "Timor"] }, { country : "Latvia", code : "lv", options : ["Latvia", "Austria", "Qatar", "Hoorn"] }, { country : "Lebanon", code : "lb", options : ["Lebanon", "Palestine", "Kuwait", "Yemen"] },
             { country : "Lesotho", code : "ls", options : ["Lesotho", "Gabon", "Uganda", "Guinea"] }, { country : "Liberia", code : "lr", options : ["Liberia", "Malaysia", "Cuba", "Puerto Rico"] }, { country : "Libya", code : "ly", options : ["Libya", "Tunisia", "Lebanon", "Lesotho"] }, { country : "Liechtenstein", code : "li", options : ["Liechtenstein", "Haiti", "Serbia", "Vatican"] }, { country : "Lithuania", code : "lt", options : ["Bolivia", "Lithuania", "Lesotho", "Liechtenstein"] }, { country : "Madagascar", code : "mg", options : ["Madagascar", "Oman", "Belarus", "Benin"] }, { country : "Malawi", code : "mw", options : ["Malawi", "Kenya", "Trinidad and Tobago", "Tongo"] }, { country : "Malaysia", code : "my", options : ["Malaysia", "Chile", "Cuba", "Singapore"] }, { country : "Maldives", code : "mv", options : ["Maldives", "Libya", "Turkmenistan", "Bali"] }, { country : "Mali", code : "ml", options : ["Mali", "Guinea", "Ghana", "Congo"] },
             { country : "Malta", code : "mt", options : ["Malta", "Singapore", "Poland", "Indonesia"] }, { country : "Marshall Islands", code : "mh", options : ["Marshall Islands", "Seychelles", "Samoa", "British Virgin Islands"] }, { country : "Mauritania", code : "mr", options : ["Mauritania", "Lithuania", "Botswana", "Mauritius"] }, { country : "Mexico", code : "mx", options : ["Mexico", "Peru", "Colombia", "Italy"] }, { country : "Micronesia", code : "fm", options : ["Micronesia", "Bosnia", "Cambodia", "Somalia"] }, { country : "Moldova", code : "md", options : ["Moldova", "Romania", "Chad", "Bulgaria"] }, { country : "Monaco", code : "mc", options : ["Monaco", "Poland", "Indonesia", "Singapore"] }, { country : "Mongolia", code : "mn", options : ["Mongolia", "Thailand", "Cambodia", "Hong Kong"] }, { country : "Montenegro", code : "me", options : ["Montenegro", "Monaco", "Myanmar", "Mauritius"] }, { country : "Morocco", code : "ma", options : ["Morocco", "Senegal", "Vietnam", "Algeria"] },
             { country : "Mozambique", code : "mz", options : ["Mozambique", "Kenya", "Eritrea", "Zimbabwe"] }, { country : "Myanmar", code : "mm", options : ["Myanmar", "Bhutan", "Senegal", "Ghana"] }, { country : "Namibia", code : "na", options : ["Namibia", "Moazambique", "Montenegro", "Uganda"] }, { country : "Nauru", code : "nr", options : ["Nauru", "Tuvalu", "Macau", "Atlantic Islands"] }, { country : "Nepal", code : "np", options : ["Nepal", "Bhutan", "Assam", "Himalayans"] }, { country : "Netherlands", code : "nl", options : ["Netherlands", "Lithuania", "Estonia", "France"] }, { country : "New Zealand", code : "nz", options : ["New Zealand", "Australia", "Fiji", "Samoan Islands"] }, { country : "Nicaragua", code : "ni", options : ["Nicaragua", "Guatemala", "El Salvador", "Somalia"] }, { country : "Niger", code : "ne", options : ["Niger", "India", "Ivory Coast", "Rwanda"] }, { country : "Nigeria", code : "ng", options : ["Nigeria", "Niger", "South Africa", "Africa"] },
             { country : "North Macedonia", code : "mk", options : ["North Macedonia", "Vietnam", "Macedonia", "Hong Kong"] }, { country : "Norway", code : "no", options : ["Norway", "Iceland", "Greenland", "Denmark"] }, { country : "Oman", code : "om", options : ["Oman", "Belarus", "Iran", "Kosovo"] }, { country : "Pakistan", code : "pk", options : ["Pakistan", "Saudi Arabia", "Nepal", "Bangladesh"] }, { country : "Palestine", code : "ps", options : ["Palestine", "Jordan", "Kuwait", "Egypt"] }, { country : "Panama", code : "pa", options : ["Panama", "Chile", "Cuba", "Puerto Rico"] }, { country : "Paraguay", code : "py", options : ["Paraguay", "Uruguay", "Venezuela", "Netherlands"] }, { country : "Peru", code : "pe", options : ["Peru", "Poland", "Monaco", "Montenegro"] }, { country : "Philippines", code : "ph", options : ["Philippines", "Czechia", "Serbia", "Laos"] }, { country : "Poland", code : "pl", options : ["Poland", "Indonesia", "Monaco", "Malta"] },
             { country : "Portugal", code : "pt", options : ["Portugal", "Guinea", "Lebanon", "Morocco"] }, { country : "Qatar", code : "qa", options : ["Qatar", "Bahrain", "Latvia", "Estonia"] }, { country : "Romania", code : "ro", options : ["Romania", "Chad", "Moldova", "Bulgaria"] }, { country : "Rwanda", code : "rw", options : ["Rwanda", "Uzbekistan", "Antigua", "Uganda"] }, { country : "Saint Kitts and Nevis", code : "kn", options : ["Saint Kitts and Nevis", "Trinidad and Tobago", "Seychelles", "Barboran Islands"] }, { country : "Saint Lucia", code : "lc", options : ["Saint Lucia", "Barboran Islands", "Saint Kitts and Nevis", "Andalucia"] }, { country : "Samoa", code : "ws", options : ["Samoa", "American Samoa", "Kiribati", "Fiji"] }, { country : "S√£o Tom√© and Pr√≠ncipe", code : "st", options : ["S√£o Tom√© and Pr√≠ncipe", "Sierra Leone", "Cape Verde", "Gambia"] }, { country : "Saudi Arabia", code : "sa", options : ["Saudi Arabia", "Pakistan", "Jordan", "Iraq"] }, { country : "Senegal", code : "sn", options : ["Senegal", "Ghana", "Cameroon", "Comoros"] },
             { country : "Serbia", code : "rs", options : ["Serbia", "Croatia", "Czechia", "Canary"] }, { country : "Seychelles", code : "sc", options : ["Seychelles", "Barbados", "Bahamas", "Ibiza"] }, { country : "Sierra Leone", code : "sl", options : ["Sierra Leone", "Gabon", "Togo", "Liberia"] }, { country : "Singapore", code : "sg", options : ["Singapore", "Malaysia", "Indonesia", "Liberia"] }, { country : "Slovakia", code : "sk", options : ["Slovakia", "Serbia", "Croatia", "Czechia"] }, { country : "Solomon Islands", code : "sb", options : ["Solomon Islands", "Djibouti", "Malawi", "Eritrea"] }, { country : "Somalia", code : "so", options : ["Somalia", "Sudan", "South Sudan", "Micronesia"] }, { country : "South Sudan", code : "ss", options : ["South Sudan", "Sudan", "Somalia", "Ethiopia"] }, { country : "Spain", code : "es", options : ["Spain", "Morocco", "Mexico", "Gibraltar"] }, { country : "Sri Lanka", code : "lk", options : ["Sri Lanka", "Bhutan", "Myanmar", "Cambodia"] },
             { country : "Sudan", code : "sd", options : ["Sudan", "South Sudan", "Palestine", "Jordan"] }, { country : "Suriname", code : "sr", options : ["Suriname", "Ethiopia", "Somalia", "Senegal"] }, { country : "Syria", code : "sy", options : ["Syria", "Yemen", "Egypt", "Iraq"] }, { country : "Taiwan", code : "tw", options : ["Taiwan", "Bali", "Microneisa", "Thailand"] }, { country : "Tajikistan", code : "tj", options : ["Tajikistan", "Kyrgyzstan", "Turkmenistan", "Afghanistan"] }, { country : "Tanzania", code : "tz", options : ["Tanzania", "Somalia", "Eritria", "Albania"] }, { country : "Thailand", code : "th", options : ["Thailand", "Cambodia", "Laos", "Indonesia"] }, { country : "Togo", code : "tg", options : ["Togo", "Mali", "Burkani Faso", "Gambia"] }, { country : "Tonga", code : "to", options : ["Tonga", "Mali", "Maui", "East Samoa"] }, { country : "Trinidad and Tobago", code : "tt", options : ["Kiribati", "Palau", "Trinidad and Tobago", "Tuvalu"] },
             { country : "Tunisia", code : "tn", options : ["Tunisia", "Libya", "Turkey", "Liberia"] }, { country : "Turkey", code : "tr", options : ["Turkey", "Tunisia", "Libya", "Liberia"] }, { country : "Turkmenistan", code : "tm", options : ["Turkmenistan", "Uzbekistan", "Kyrgyzstan", "Afhganistan"] }, { country : "Tuvalu", code : "tv", options : ["Tuvalu", "Nauru", "Palau", "Fiji"] }, { country : "Uganada", code : "ug", options : ["Uganda", "Swaziland", "Lesotho", "Namibia"] }, { country : "Ukraine", code : "ua", options : ["Ukraine", "Lithuania", "Monaco", "Estonia"] }, { country : "United Arab Emirates", code : "ae", options : ["United Arab Emirates", "Jordan", "Palestine", "Kuwait"] }, { country : "Uruguay", code : "uy", options : ["Uruguay", "Argentina", "Greece", "Brazil"] }, { country : "Uzbekistan", code : "uz", options : ["Uzbekistan", "Azerbaijan", "Turkmenistan", "Pakistan"] }, { country : "Venezuela", code : "ve", options : ["Venezuela", "Ecuador", "Colombia", "Andorra"] },
             { country : "Vietnam", code : "vn", options : ["Vietnam", "China", "Hong Kong", "Cambodia"] }, { country : "Yemen", code : "ye", options : ["Yemen", "Iraq", "Egypt", "Jordan"] }, { country : "Zambia", code : "zm", options : ["Zambia", "Zimbabwe", "Mozambique", "Gibraltar"] }, { country : "Zimbabwe", code : "zw", options : ["Zimbabwe", "Zambia", "Mozambique", "Gibraltar"] },
        ];

        const el = {
            screens: { start: document.getElementById('start-screen'), game: document.getElementById('game-screen'), gameOver: document.getElementById('game-over-screen') },
            modeOptions: document.querySelectorAll('.mode-option'),
            singlePlayerSubOptions: document.getElementById('single-player-sub-options'),
            multiplayerStartArea: document.getElementById('multiplayer-start-area'),
            teamInputsContainer: document.getElementById('team-inputs-container'),
            teamNamesGrid: document.getElementById('team-names-grid'),
            startGameBtn: document.getElementById('start-game-btn'),
            tenRoundsBtn: document.getElementById('ten-rounds-btn'),
            infiniteModeBtn: document.getElementById('infinite-mode-btn'),
            gameInfoBar: document.getElementById('game-info-bar'),
            flagImageDisplay: document.getElementById('flag-image-display'),
            leftCurtain: document.querySelector('.place-display-stage .stage-curtains.left'),
            rightCurtain: document.querySelector('.place-display-stage .stage-curtains.right'),
            optionsContainer: document.getElementById('options-container'),
            actionBtn: document.getElementById('action-btn'),
            gameOverTitle: document.getElementById('game-over-title'),
            winMessageFinalText: document.getElementById('win-message-final-text'),
            winnerTrophyIcon: document.getElementById('winner-trophy-icon'),
            winnerSubtext: document.getElementById('winner-subtext'),
            finalScoresDisplay: document.getElementById('final-scores-display-div'),
            playAgainGameBtn: document.getElementById('play-again-game-btn'),
            mainMenuNavBtn: document.getElementById('main-menu-nav-btn'),
            visitStoreBtn: document.getElementById('visit-store-btn'),
            settingsBtn: document.getElementById('settings-btn'),
            highscoreBtn: document.getElementById('highscore-btn'),
            settingsModal: document.getElementById('settings-modal'),
            closeModalBtn: document.getElementById('close-modal-btn'),
            bgmVolumeSlider: document.getElementById('bgm-volume-slider'),
            sfxToggleBtn: document.getElementById('sfx-toggle-btn'),
            feedbackPopup: document.getElementById('feedback-popup'),
            feedbackMessageText: document.getElementById('feedback-message-text-el'),
            audio: { bgm: document.getElementById('background-game-music'), start: document.getElementById('start-game-sound'), interaction: document.getElementById('interaction-sound'), correct: document.getElementById('correct-answer-sound'), wrong: document.getElementById('wrong-answer-sound'), win: document.getElementById('win-game-sound'), curtain: document.getElementById('curtain-sound'), },
            backToGamesBtn: document.getElementById('back-to-games-btn'), // This will now find the element
            backToMenuBtn: document.getElementById('back-to-menu-btn'),
            audioConsentModal: document.getElementById('audio-consent-modal'),
            audioConsentYesBtn: document.getElementById('audio-consent-yes-btn'),
            audioConsentNoBtn: document.getElementById('audio-consent-no-btn')
        };
        
        const playSound = (audio) => { if (gameConfig.sfxEnabled && audio && audioContextStarted) { audio.pause(); audio.currentTime = 0; audio.play().catch(e => {}); } };
        const playSoundWithCallback = (audio, cb) => {
            if (gameConfig.sfxEnabled && audio && audioContextStarted) {
                let executed = false;
                const onEnd = () => { if (!executed) { executed = true; audio.removeEventListener('ended', onEnd); cb(); } };
                audio.addEventListener('ended', onEnd);
                audio.pause(); audio.currentTime=0; 
                audio.play().catch(e => onEnd());
            } else { cb(); } 
        };
        function initAudio() {
            if (audioContextStarted) return;
            el.audio.bgm.play().then(() => {
                audioContextStarted = true;
                if (gameConfig.musicVolume <= 0 || document.hidden) {
                    el.audio.bgm.pause();
                }
            }).catch(e => {});
        }
        
        let feedbackTimeoutHandle;
        const showFeedback = (message, type = '', duration = 1500) => {
            el.feedbackMessageText.textContent = message;
            el.feedbackPopup.className = 'feedback-popup';
            if (type) el.feedbackPopup.classList.add(type);
            el.feedbackPopup.classList.add('show');
            clearTimeout(feedbackTimeoutHandle);
            feedbackTimeoutHandle = setTimeout(() => el.feedbackPopup.classList.remove('show'), duration - 100);
        };
        const triggerConfetti = () => {
            const colors = ['var(--blyza-orange-primary)', 'var(--blyza-purple-secondary)', 'var(--blyza-keppel-accent)', 'var(--blyza-sunny-yellow)'];
            for (let i = 0; i < 100; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                const animDur = Math.random() * 3 + 2;
                piece.style.animation = `fallAndFade ${animDur}s ${Math.random() * 1}s linear forwards`;
                document.body.appendChild(piece);
                setTimeout(() => piece.remove(), (animDur + 1) * 1000);
            }
        };
        const shuffleArray = (arr) => arr.sort(() => Math.random() - 0.5);

        const loadHighScore = () => { const score = localStorage.getItem('gtf_infinite_highscore'); infiniteHighScore = score ? parseInt(score, 10) : 0; };
        const saveHighScore = (score) => { if (score > infiniteHighScore) { infiniteHighScore = score; localStorage.setItem('gtf_infinite_highscore', score); return true; } return false; };
        const showHighScore = () => { playSound(el.audio.interaction); showFeedback(`Infinite High Score: ${infiniteHighScore}`, 'win-feedback', 3000); };
        
        function handleVisibilityChange() {
            if (!audioContextStarted) return;
            if (document.hidden) {
                el.audio.bgm.pause();
            } else if (gameConfig.musicVolume > 0) {
                el.audio.bgm.play().catch(e => {});
            }
        }
        
        function handlePageShow(event) {
            if (event.persisted) {
                setAppHeight(); 
                goToMainMenu();
            }
        }

        const switchScreen = (screenId) => {
            Object.values(el.screens).forEach(s => s.classList.remove('active'));
            el.screens[screenId].classList.add('active');
            const onStartScreen = screenId === 'start';
            if (el.backToGamesBtn) el.backToGamesBtn.style.display = onStartScreen ? 'flex' : 'none';
            if (el.backToMenuBtn) el.backToMenuBtn.style.display = (screenId === 'game') ? 'flex' : 'none';
            if (el.highscoreBtn) el.highscoreBtn.style.display = onStartScreen ? 'flex' : 'none';
        };

        const selectGameMode = (e) => {
            el.modeOptions.forEach(option => option.classList.remove('selected'));
            e.currentTarget.classList.add('selected');
            gameState.gameMode = e.currentTarget.dataset.mode;
            const isMulti = gameState.gameMode === 'multi';
            el.multiplayerStartArea.style.display = isMulti ? 'block' : 'none';
            el.singlePlayerSubOptions.style.display = isMulti ? 'none' : 'block';
        };

        const startMultiplayerGame = () => {
            const team1Name = el.teamNamesGrid.querySelectorAll('.team-name-input')[0].value.trim() || "Team 1";
            const team2Name = el.teamNamesGrid.querySelectorAll('.team-name-input')[1].value.trim() || "Team 2";
            if (team1Name === team2Name) { alert("Team names must be different!"); return; }
            gameState.teams = [{ name: team1Name, score: 0 }, { name: team2Name, score: 0 }];
            playSoundWithCallback(el.audio.start, startGame);
        };

        const startSinglePlayerGame = (subType) => {
            gameState.singlePlayerSubType = subType;
            gameState.teams = [{ name: "You", score: 0 }];
            playSoundWithCallback(el.audio.start, startGame);
        };
        
        const startGame = () => {
            initAudio(); 
            Object.assign(gameState, { currentTeamIndex: 0, puzzlesPlayed: 0, remainingFlags: [...flagData], usedFlags: [] });
            gameState.teams.forEach(t => t.score = 0);
            shuffleArray(gameState.remainingFlags);
            switchScreen('game');
            setupRound();
        };

        const setupRound = () => {
            Object.assign(gameState, { roundPhase: 'guessing', currentGuess: null });

            el.leftCurtain.classList.remove('open');
            el.rightCurtain.classList.remove('open');
            el.flagImageDisplay.classList.remove('visible');
            el.flagImageDisplay.src = "";
            
            if (gameState.remainingFlags.length === 0) {
                gameState.remainingFlags = [...gameState.usedFlags];
                gameState.usedFlags = [];
                shuffleArray(gameState.remainingFlags);
            }

            gameState.currentFlag = gameState.remainingFlags.pop();
            gameState.usedFlags.push(gameState.currentFlag);
            el.flagImageDisplay.src = `https://flagcdn.com/w320/${gameState.currentFlag.code.toLowerCase()}.png`;

            el.optionsContainer.innerHTML = '';
            el.actionBtn.style.display = 'none';
            const options = [...gameState.currentFlag.options];
            shuffleArray(options);
            options.forEach((optionText, i) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.innerHTML = `<span>${optionText}</span>`;
                optionBtn.dataset.option = optionText;
                optionBtn.style.animationDelay = `${i * 100 + 500}ms`;
                optionBtn.addEventListener('click', handleOptionSelect);
                el.optionsContainer.appendChild(optionBtn);
            });

            updateGameInfoUI();
            
            setTimeout(() => {
                playSound(el.audio.curtain);
                el.leftCurtain.classList.add('open');
                el.rightCurtain.classList.add('open');
                el.flagImageDisplay.classList.add('visible');
            }, 300);
        };

        const handleOptionSelect = (e) => {
            playSound(el.audio.interaction);
            gameState.currentGuess = e.currentTarget.dataset.option;
            document.querySelectorAll('#options-container .option-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = (btn.dataset.option === gameState.currentGuess) ? 1 : 0.6;
            });
            el.actionBtn.innerHTML = 'Reveal Answer <i class="fas fa-eye"></i>';
            el.actionBtn.style.display = 'inline-flex';
            el.actionBtn.disabled = false;
        };

        const revealAnswer = () => {
            gameState.roundPhase = 'revealed';
            el.actionBtn.disabled = true;
            const isCorrect = gameState.currentGuess === gameState.currentFlag.country;
            
            if (isCorrect) {
                playSound(el.audio.correct);
                gameState.teams[gameState.currentTeamIndex].score++;
                showFeedback('Correct!', 'correct-feedback', 2000);
                if (gameState.singlePlayerSubType === 'infinite') {
                    saveHighScore(gameState.teams[0].score);
                }
            } else {
                playSound(el.audio.wrong);
                showFeedback('Incorrect!', 'incorrect-feedback', 2000);
            }

            if (gameState.gameMode === 'single') gameState.puzzlesPlayed++;
            
            document.querySelectorAll('#options-container .option-btn').forEach(btn => {
                if (btn.dataset.option === gameState.currentFlag.country) btn.classList.add('correct');
                else if (btn.dataset.option === gameState.currentGuess) btn.classList.add('incorrect');
            });
            
            updateGameInfoUI();
            
            setTimeout(() => {
                let isGameOver = false;
                const maxScore = Math.max(...gameState.teams.map(t => t.score));

                if (gameState.singlePlayerSubType === '10rounds' && gameState.puzzlesPlayed >= gameState.maxRounds) isGameOver = true;
                else if (gameState.singlePlayerSubType === 'infinite' && !isCorrect) isGameOver = true;
                else if (gameState.gameMode === 'multi' && maxScore >= gameState.winningScore) isGameOver = true;
                
                if (isGameOver) el.actionBtn.innerHTML = 'See Final Results <i class="fas fa-trophy"></i>';
                else el.actionBtn.innerHTML = 'Next Flag <i class="fas fa-arrow-right"></i>';
                
                el.actionBtn.disabled = false;
            }, 1800);
        };

        const nextRound = () => {
            const isCorrect = gameState.currentGuess === gameState.currentFlag.country;
            const maxScore = Math.max(...gameState.teams.map(t => t.score));
            let isGameOver = false;

            if (gameState.singlePlayerSubType === '10rounds' && gameState.puzzlesPlayed >= gameState.maxRounds) isGameOver = true;
            else if (gameState.singlePlayerSubType === 'infinite' && !isCorrect) isGameOver = true;
            else if (gameState.gameMode === 'multi' && maxScore >= gameState.winningScore) isGameOver = true;

            if (isGameOver) showGameOver();
            else {
                if (gameState.gameMode === 'multi') gameState.currentTeamIndex = (gameState.currentTeamIndex + 1) % gameState.teams.length;
                setupRound();
            }
        };

        const processAction = () => gameState.roundPhase === 'guessing' ? revealAnswer() : nextRound();

        const updateGameInfoUI = () => {
            el.gameInfoBar.innerHTML = '';
            if (gameState.gameMode === 'single') {
                if (gameState.singlePlayerSubType === '10rounds') el.gameInfoBar.innerHTML = `<div>Round: ${gameState.puzzlesPlayed + 1}/${gameState.maxRounds}</div><div>Score: ${gameState.teams[0].score}</div>`;
                else el.gameInfoBar.innerHTML = `<div>Score: ${gameState.teams[0].score}</div><div>High Score: ${infiniteHighScore}</div>`;
            } else {
                const turnBox = document.createElement('div');
                turnBox.className = 'score-box';
                turnBox.textContent = `${gameState.teams[gameState.currentTeamIndex].name}'s Turn`;
                const scoresContainer = document.createElement('div');
                scoresContainer.className = 'score-display-multiplayer';
                gameState.teams.forEach((team, index) => {
                    const scoreBox = document.createElement('div');
                    scoreBox.className = 'score-box';
                    if (index === gameState.currentTeamIndex && gameState.roundPhase === 'guessing') scoreBox.classList.add('current-turn');
                    scoreBox.textContent = `${team.name}: ${team.score}`;
                    scoresContainer.appendChild(scoreBox);
                });
                el.gameInfoBar.append(turnBox, scoresContainer);
            }
        };

        const showGameOver = () => {
            playSound(el.audio.win);
            switchScreen('gameOver');
            const maxScore = gameState.teams[0].score;
            
            if (gameState.gameMode === 'single') {
                if (gameState.singlePlayerSubType === '10rounds') {
                    el.winMessageFinalText.textContent = 'Round Complete!';
                    el.winnerSubtext.textContent = `You scored ${maxScore} out of ${gameState.maxRounds}!`;
                    el.winnerTrophyIcon.textContent = maxScore === 10 ? 'üåü' : (maxScore >= 7 ? 'üèÜ' : 'üëç');
                } else {
                    const isNewHighScore = saveHighScore(maxScore);
                    el.winMessageFinalText.textContent = 'Game Over!';
                    el.winnerSubtext.innerHTML = `Your Score: ${maxScore}. ${isNewHighScore ? '<strong>New High Score!</strong>' : `High Score: ${infiniteHighScore}`}`;
                    el.winnerTrophyIcon.textContent = isNewHighScore ? 'üåü' : 'üëç';
                }
            } else {
                const multiMaxScore = Math.max(...gameState.teams.map(t => t.score));
                const winners = gameState.teams.filter(t => t.score === multiMaxScore && t.score >= gameState.winningScore);
                el.winMessageFinalText.textContent = winners.length > 1 ? "It's a Tie!" : winners.length === 1 ? `${winners[0].name} Wins!` : "Game Over!";
                el.winnerSubtext.textContent = winners.length ? `Congratulations on reaching ${multiMaxScore} points!` : `Nobody reached the winning score of ${gameState.winningScore}.`;
                el.winnerTrophyIcon.textContent = 'üèÜ';
                if (winners.length > 0) triggerConfetti();
            }

            if (gameState.gameMode === 'single' && maxScore > 0 && (gameState.singlePlayerSubType === 'infinite' || maxScore >= 7)) {
                triggerConfetti();
            }
            
            el.finalScoresDisplay.innerHTML = '';
            gameState.teams.forEach(team => {
                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card';
                const isWinner = gameState.gameMode === 'multi' && team.score === Math.max(...gameState.teams.map(t => t.score)) && team.score >= gameState.winningScore;
                if (isWinner) scoreCard.classList.add('winner-glow');
                scoreCard.innerHTML = `<div class="team-name-score">${team.name}</div><div class="score-value-display">${team.score}</div>`;
                el.finalScoresDisplay.appendChild(scoreCard);
            });
        };

        const goToMainMenu = () => {
            el.teamNamesGrid.innerHTML = `<div class="team-input"><input type="text" class="team-name-input" placeholder="Team 1"></div><div class="team-input"><input type="text" class="team-name-input" placeholder="Team 2"></div>`;
            el.modeOptions.forEach(opt => opt.classList.remove('selected'));
            el.modeOptions[0].classList.add('selected');
            el.multiplayerStartArea.style.display = 'none';
            el.singlePlayerSubOptions.style.display = 'block';
            gameState.gameMode = 'single';
            switchScreen('start');
        };
        
        const playAgain = () => { playSoundWithCallback(el.audio.start, startGame); };

        document.addEventListener('DOMContentLoaded', () => {
            loadHighScore();
            const savedVol = localStorage.getItem('musicVolume');
            const savedSfx = localStorage.getItem('sfxEnabled');
            if(savedVol) gameConfig.musicVolume = parseFloat(savedVol);
            if(savedSfx) gameConfig.sfxEnabled = savedSfx === 'true';
            
            el.sfxToggleBtn.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`;
            el.bgmVolumeSlider.value = gameConfig.musicVolume;
            el.audio.bgm.volume = gameConfig.musicVolume;
            
            el.audioConsentModal.style.display = 'flex';
            
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('pageshow', handlePageShow);
        });

        el.audioConsentYesBtn.addEventListener('click', () => {
            el.audioConsentModal.style.display = 'none';
            initAudio();
            playSound(el.audio.interaction);
        });
        el.audioConsentNoBtn.addEventListener('click', () => {
            el.audioConsentModal.style.display = 'none';
            gameConfig.sfxEnabled = false;
            gameConfig.musicVolume = 0;
            el.audio.bgm.volume = 0;
            el.bgmVolumeSlider.value = 0;
            el.sfxToggleBtn.textContent = 'SFX: OFF';
            localStorage.setItem('sfxEnabled', 'false');
            localStorage.setItem('musicVolume', '0');
            initAudio();
        });

        el.settingsBtn.addEventListener('click', () => { playSound(el.audio.interaction); el.settingsModal.style.display = 'flex'; });
        el.closeModalBtn.addEventListener('click', () => { playSound(el.audio.interaction); el.settingsModal.style.display = 'none'; });
        el.bgmVolumeSlider.addEventListener('input', (e) => { 
            gameConfig.musicVolume = e.target.value; 
            el.audio.bgm.volume = gameConfig.musicVolume; 
            localStorage.setItem('musicVolume', gameConfig.musicVolume); 
            if (gameConfig.musicVolume > 0 && !document.hidden && audioContextStarted) el.audio.bgm.play().catch(()=>{});
            else el.audio.bgm.pause();
        });
        el.sfxToggleBtn.addEventListener('click', () => { 
            gameConfig.sfxEnabled = !gameConfig.sfxEnabled; 
            el.sfxToggleBtn.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`; 
            playSound(el.audio.interaction); 
            localStorage.setItem('sfxEnabled', String(gameConfig.sfxEnabled)); 
        });
        
        el.modeOptions.forEach(option => option.addEventListener('click', (e) => { playSound(el.audio.interaction); selectGameMode(e); }));
        el.tenRoundsBtn.addEventListener('click', () => startSinglePlayerGame('10rounds'));
        el.infiniteModeBtn.addEventListener('click', () => startSinglePlayerGame('infinite'));
        el.startGameBtn.addEventListener('click', startMultiplayerGame);
        el.actionBtn.addEventListener('click', processAction);
        el.playAgainGameBtn.addEventListener('click', playAgain);
        el.mainMenuNavBtn.addEventListener('click', goToMainMenu);
        el.visitStoreBtn.addEventListener('click', () => { playSound(el.audio.interaction); window.location.href = '/store'; });
        if(el.backToMenuBtn) el.backToMenuBtn.addEventListener('click', goToMainMenu);
        if(el.highscoreBtn) el.highscoreBtn.addEventListener('click', showHighScore);
        
        const gameContainerForScroll = document.querySelector('.game-container');
        let lastTouchY = 0;

        window.addEventListener('wheel', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                gameContainerForScroll.scrollTop += e.deltaY;
            }
        }, { passive: true });

        window.addEventListener('touchstart', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                if (e.touches.length > 0) {
                    lastTouchY = e.touches[0].clientY;
                }
            }
        }, { passive: true });

        window.addEventListener('touchmove', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                e.preventDefault(); 
                if (e.touches.length > 0) {
                    const currentTouchY = e.touches[0].clientY;
                    const deltaY = lastTouchY - currentTouchY;
                    gameContainerForScroll.scrollTop += deltaY;
                    lastTouchY = currentTouchY;
                }
            }
        }, { passive: false });
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-N5PBKM0DNQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N5PBKM0DNQ');
</script>

</body>
</html>