<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess the Flag - Game Show Edition!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300..700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles from Where in the World? */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary: #FF8833; /* Blyza Orange */
            --secondary: #CB7AE1; /* Blyza Purple */
            --light: #F2F2F2;
            --success: #00BFA6; /* Blyza Keppel */
            --danger: #ff4b2b;
            --dark: #1a1c20;
            --darker: #0f1012;
            --info: #4ECDC4;
            --gold: #FFD700; /* Game show gold */
            --stage-bg: #2c3e50;
            --curtain-color: #c0392b;
            --spotlight-color: rgba(255, 223, 0, 0.6);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 900px;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .brand-logo {
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .brand-logo-prominent {
            display: block;
            margin: 0 auto 20px;
            max-height: 80px;
        }

        h1 {
            font-family: "Luckiest Guy", cursive;
            font-size: 3rem;
            margin-bottom: 25px;
            color: var(--gold);
            text-shadow:
                0 2px 0px #000,
                0 4px 6px rgba(0, 0, 0, 0.5),
                0 0 30px var(--primary);
            letter-spacing: 1px;
            margin-top: 10px;
        }
        h3, .screen-title {
            font-family: "Bungee", cursive;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary);
            text-shadow: 0 1px 2px #000;
        }
        
        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .active { display: block; }

        .instructions {
            font-family: "Quicksand", sans-serif;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            line-height: 1.8;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            text-align: left;
        }
        .instructions p:first-of-type strong {
             font-family: "Bungee", cursive; font-size: 1.2em; display:block; margin-bottom: 10px;
             color: var(--light);
        }
        .instructions p { font-size: 1.1rem; margin-bottom: 15px; color: var(--light); }
        .instructions ul { list-style-type: none; padding-left: 0; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: flex-start; font-size: 1rem; }
        .instructions i {
            margin-right: 10px; font-size: 1.2em; color: var(--primary);
            width: 20px; text-align: center; margin-top: 2px;
        }
        .instructions strong { color: var(--primary); }

        .game-mode-selection {
            display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap;
        }
        .mode-option {
            background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; cursor: pointer;
            transition: all 0.3s ease; border: 2px solid rgba(255,255,255,0.1);
            flex: 1; min-width: 200px; max-width: 280px;
        }
        .mode-option:hover {
            transform: translateY(-5px) scale(1.03); background: rgba(255,255,255,0.08);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2), 0 0 10px var(--secondary); border-color: var(--secondary);
        }
        .mode-option.selected {
            border-color: var(--primary); background: rgba(255,136,51,0.1);
            box-shadow: 0 0 15px rgba(255,136,51,0.2), inset 0 0 8px rgba(255,136,51,0.1);
            transform: scale(1.01);
        }
        .mode-option i { font-size: 2rem; margin-bottom: 10px; color: var(--primary); }
        .mode-option h3 { font-size: 1.3rem; margin-bottom: 8px; color: var(--light); font-family: "Bungee", cursive; }
        .mode-option p { color: rgba(242,242,242,0.7); font-size: 0.9rem; }

        .team-inputs-container {
            margin: 30px 0; background: rgba(255,255,255,0.05); padding: 30px;
            border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
        }
        #team-names-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin-bottom: 20px;
        }
        .team-input input.team-name-input {
            width: 100%; max-width: 350px;
            padding: 15px 20px; border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1); font-size: 1.1rem;
            background: rgba(255,255,255,0.05); color: var(--light);
            transition: all 0.3s ease; font-family: 'Quicksand', sans-serif;
        }
        .team-input input.team-name-input:focus {
            outline: none; border-color: var(--secondary);
            box-shadow: 0 0 10px rgba(203,122,225,0.2);
        }

        .game-info {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 20px; margin-bottom: 20px; background: rgba(0,0,0,0.2);
            border-radius: 10px; border: 1px solid var(--gold);
            font-family: "Orbitron", sans-serif; font-size: 1rem; color: var(--gold);
            text-shadow: 0 0 5px var(--primary);
        }
        .score-display-multiplayer { display: flex; gap: 15px; }
        .score-box {
            background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2); font-family: "Quicksand", sans-serif;
            font-weight: 700; transition: all 0.3s ease;
        }
        .score-box.current-turn { border-color: var(--primary); box-shadow: 0 0 10px var(--primary); transform: scale(1.05); }

        .place-display-stage {
            background: var(--stage-bg); padding: 20px; border-radius: 20px;
            margin-bottom: 25px; border: 3px solid var(--gold);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.3);
            position: relative; overflow: hidden;
        }
        .place-display-stage::before, .place-display-stage::after {
            content: ''; position: absolute; top: -50px; width: 200px; height: 300px;
            background: radial-gradient(ellipse at center, var(--spotlight-color) 0%, transparent 70%);
            pointer-events: none; opacity: 0.7;
        }
        .place-display-stage::before { left: -50px; transform: rotate(-30deg); }
        .place-display-stage::after { right: -50px; transform: rotate(30deg); }

        .stage-curtains {
            position: absolute; top: 0; width: 50%; height: 100%;
            background-color: var(--curtain-color);
            background-image: linear-gradient(rgba(0,0,0,0.2) 50%, transparent 50%),
                              linear-gradient(90deg, rgba(0,0,0,0.2) 50%, transparent 50%);
            background-size: 50px 50px; box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.265, 1.55); z-index: 5;
        }
        .stage-curtains.left { left: 0; border-right: 3px solid #a52a20; }
        .stage-curtains.right { right: 0; border-left: 3px solid #a52a20; }
        .stage-curtains.open.left { transform: translateX(-100%); }
        .stage-curtains.open.right { transform: translateX(100%); }

        .place-tv-screen {
            background: #111; border: 10px solid #333; border-radius: 15px;
            padding: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative; z-index: 1; min-height: 300px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .place-tv-screen h3 {
            font-family: "Luckiest Guy", cursive; color: var(--gold);
            font-size: 1.6rem; margin-bottom: 15px; text-shadow: 0 2px 3px #000;
        }
        .flag-image {
            max-height: 180px; max-width: 90%; object-fit: contain;
            border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: block;
            opacity: 0; transition: opacity 0.5s ease-in 0.3s;
        }
        .flag-image.visible { opacity: 1; }

        .options-container {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
            margin: 25px auto; max-width: 700px;
        }
        .option-btn {
            font-family: "Quicksand", sans-serif; font-weight: 600;
            font-size: 1rem; padding: 12px 20px; min-height: 60px;
            text-align: center; justify-content: center; display: flex; align-items: center;
            width: 100%;
        }
        .option-btn i { font-size: 1.1rem; color: var(--light); margin-right: 10px; }
        .option-btn.correct { background: linear-gradient(135deg, var(--success) 0%, #00a890 100%) !important; }
        .option-btn.incorrect { background: linear-gradient(135deg, var(--danger) 0%, #ff416c 100%) !important; opacity: 0.85; }
        .option-btn:disabled:not(.correct):not(.incorrect) { background: rgba(255,255,255,0.1) !important; opacity:0.5; box-shadow: 0 2px 5px rgba(0,0,0,0.2) !important; transform:none !important; }

        .final-score-display {
            display: grid; gap: 20px; margin: 30px 0;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        .score-card {
            background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;
            border: 2px solid var(--gold); transition: all 0.3s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3); text-align: center;
        }
        .score-card .team-name-score { font-family: "Bungee", cursive; font-size: 1.3rem; margin-bottom: 8px; color: var(--primary); }
        .score-card .score-value-display { font-family: "Orbitron", sans-serif; font-size: 2.2rem; color: var(--light); text-shadow: 0 0 8px var(--gold); }
        .score-card.winner-glow {
            animation: winnerGlow 1.5s infinite alternate; border-color: var(--success);
            box-shadow: 0 0 20px rgba(0,191,166,0.3), 0 0 10px var(--gold), inset 0 0 10px rgba(0,191,166,0.1);
            background: rgba(0,191,166,0.1);
        }
        @keyframes winnerGlow { from { box-shadow: 0 0 20px rgba(0,191,166,0.3), 0 0 10px var(--gold); } to { box-shadow: 0 0 35px rgba(0,191,166,0.6), 0 0 20px var(--gold); } }
        
        .win-message {
            font-size: 3rem; margin: 30px 0; color: var(--gold);
            text-shadow: 0 3px 0px #000, 0 0 20px var(--primary);
            font-family: "Luckiest Guy", cursive;
        }
        .winner-trophy {
            font-size: 6rem; margin: 20px 0 30px 0;
            animation: bounce 1.5s infinite ease-in-out; color: var(--gold);
            text-shadow: 0 0 20px var(--gold), 0 0 30px var(--primary);
        }
        @keyframes bounce { 0%,100%{transform:translateY(0) scale(1);} 50%{transform:translateY(-35px) scale(1.1);} }
        #winner-subtext { font-family: "Quicksand", sans-serif; font-size: 1.1rem; color: rgba(242,242,242,0.8); margin-bottom: 20px; }

        button, a.icon-btn {
            background: linear-gradient(135deg, var(--primary) 0%, #ff7711 100%);
            color: var(--light); border: 2px solid var(--darker); padding: 15px 25px;
            font-size: 1rem; border-radius: 50px; cursor: pointer;
            font-weight: normal; transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), inset 0 -2px 5px rgba(0,0,0,0.2);
            margin: 10px 5px; font-family: "Bungee", cursive; text-shadow: 1px 1px 2px #000;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            min-width: 180px; flex-shrink: 0;
            text-decoration: none;
        }
        button:hover:not(:disabled), a.icon-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--primary);
            background: linear-gradient(135deg, #ff7711 0%, var(--primary) 100%);
        }
        button:active:not(:disabled), a.icon-btn:active:not(:disabled) { transform: translateY(-1px) scale(1.02); }
        button:disabled {
            background: rgba(255,255,255,0.1); cursor:not-allowed; opacity:0.6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transform:none; border-color: rgba(0,0,0,0.5);
        }
        .btn-success { background: linear-gradient(135deg, var(--success) 0%, #00a890 100%); }
        .btn-success:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--success); }
        .btn-secondary { background: linear-gradient(135deg, var(--secondary) 0%, #b85cd6 100%); }
        .btn-secondary:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--secondary); }
        .btn-info { background: linear-gradient(135deg, var(--info) 0%, #3eb7af 100%); }
        .btn-info:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--info); }

        .game-over-buttons-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 20px; }

        .icon-btn { position: absolute; background: rgba(0,0,0,0.3); color: var(--light); border: 1px solid var(--gold); border-radius: 50%; width: 40px; height: 40px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; z-index: 100; padding:0; margin:0; box-shadow:none; text-shadow:none;}
        .icon-btn#settings-btn { top:15px; right:15px; }
        /* NEW */
        .icon-btn#back-to-games-btn, .icon-btn#back-to-menu-btn { top:15px; left:15px; }
        
        .icon-btn:hover { background:rgba(0,0,0,0.5); transform:scale(1.1) rotate(15deg); box-shadow:0 0 10px var(--gold); }
        .icon-btn i { margin:0; }
        .modal { position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.7); backdrop-filter:blur(8px); display:none; justify-content:center; align-items:center; }
        .modal-content { background-color:var(--darker); margin:auto; padding:30px; border:2px solid var(--gold); border-radius:15px; width:80%; max-width:450px; box-shadow:0 10px 30px rgba(0,0,0,0.6),0 0 20px var(--primary); position:relative; color:var(--light); }
        .modal-content h2 { font-family:"Bungee",cursive; color:var(--primary); text-align:center; margin-bottom:25px; font-size:1.8rem; }
        .setting-item { margin-bottom:20px; display:flex; flex-direction:column; }
        .setting-item label { margin-bottom:8px; font-weight:600; font-size:0.9rem;}
        input[type=range] { -webkit-appearance:none; width:100%; background:transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; height:20px; width:20px; border-radius:50%; background:var(--primary); cursor:pointer; margin-top:-7px; box-shadow:0 0 8px var(--primary); }
        input[type=range]::-moz-range-thumb { height:20px; width:20px; border-radius:50%; background:var(--primary); cursor:pointer; border:none; box-shadow:0 0 8px var(--primary); }
        input[type=range]::-webkit-slider-runnable-track { width:100%; height:6px; cursor:pointer; background:rgba(255,255,255,0.2); border-radius:3px; border:1px solid rgba(0,0,0,0.2); }
        input[type=range]::-moz-range-track { width:100%; height:6px; cursor:pointer; background:rgba(255,255,255,0.2); border-radius:3px; border:1px solid rgba(0,0,0,0.2); }
        .close-modal-btn { color:#aaa; position:absolute; top:15px; right:20px; font-size:28px; font-weight:bold; cursor:pointer; }
        .close-modal-btn:hover, .close-modal-btn:focus { color:var(--light); text-decoration:none; }

        .feedback-popup {
            position: fixed; top: 50%; left: 50%; color: white; padding: 30px 50px;
            border-radius: 20px; font-size: 2.8rem; font-family: "Luckiest Guy", cursive;
            text-align: center; z-index: 2000; box-shadow: 0 15px 40px rgba(0,0,0,0.7);
            opacity: 0; transform: translate(-50%,-50%) scale(0.7); border: 3px solid var(--gold);
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; display: none;
        }
        .feedback-popup.show { display: block; opacity: 1; transform: translate(-50%,-50%) scale(1); animation: feedbackPopAnimWITW 1.5s forwards; }
        @keyframes feedbackPopAnimWITW { 0% { opacity: 0; transform: translate(-50%,-50%) scale(0.7); } 20% { opacity: 1; transform: translate(-50%,-50%) scale(1); } 80% { opacity: 1; transform: translate(-50%,-50%) scale(1); } 100% { opacity: 0; transform: translate(-50%,-50%) scale(0.7); } }
        .feedback-popup.correct-feedback { background-color: rgba(0,191,166,0.97); text-shadow: 0 0 10px var(--success); }
        .feedback-popup.incorrect-feedback { background-color: rgba(255,75,43,0.97); text-shadow: 0 0 10px var(--danger); }
        .feedback-popup.win-feedback { background-color: rgba(255,136,51,0.97); text-shadow: 0 0 10px var(--primary); }

        .confetti-piece { position:fixed; width:10px; height:20px; background-color:var(--primary); opacity:0; animation-timing-function:linear; animation-fill-mode:forwards; pointer-events:none; z-index:3000; }
        @keyframes fallAndFade { 0%{transform:translateY(-20vh) rotate(0deg); opacity:1;} 100%{transform:translateY(120vh) rotate(720deg); opacity:0;} }

        @media (max-width: 768px) {
            .game-container { padding: 20px; }
            h1 { font-size: 2.5rem; } h3, .screen-title { font-size: 1.6rem; }
            .game-mode-selection { flex-direction: column; align-items: center; gap: 15px; }
            .mode-option { max-width: 90%; min-width: unset; }
            .flag-image { max-height: 150px; }
            .options-container { grid-template-columns: 1fr; }
            .option-btn { font-size: 0.9rem; padding: 12px 18px;}
            .final-score-display { grid-template-columns: 1fr; }
            .score-card { min-width: 80%; max-width: 90%; }
            .win-message { font-size: 2.2rem; }
            .winner-trophy { font-size: 5rem; }
            .modal-content { padding: 20px; }
            .game-over-buttons-container { flex-direction: column; align-items: center;}
            .game-over-buttons-container button, .game-over-buttons-container a.icon-btn { width: 90%; margin: 5px auto;}
            .feedback-popup { font-size: 2.2rem; padding: 25px 40px; width: 80%;}
            .place-display-stage::before, .place-display-stage::after { display: none; }
            .place-tv-screen h3 {font-size: 1.3rem;}
        }
         @media (max-width: 480px) {
            h1 { font-size: 2rem; } h3, .screen-title { font-size: 1.4rem; }
            .game-container { padding: 15px; }
            .team-input input.team-name-input { max-width: 100%;}
            .flag-image { max-height: 120px; }
            .options-container { gap: 10px; }
            .icon-btn { top: 10px; width: 35px; height: 35px; font-size: 1rem; }
            .icon-btn#settings-btn { right: 10px; }
            .icon-btn#back-to-games-btn, .icon-btn#back-to-menu-btn { left: 10px; }
            .feedback-popup { font-size: 1.8rem; padding: 20px 30px;}
            .instructions li { font-size: 0.9rem;}
            .game-info { font-size: 0.9rem; flex-direction: column; gap: 10px;}
            .place-tv-screen h3 {font-size: 1.2rem;}
         }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- START: NEW BUTTONS -->
        <a href="/" id="back-to-games-btn" class="icon-btn" aria-label="Back to Games List" title="Back to Games List" style="display: none;">
            <i class="fas fa-home"></i>
        </a>
        <button id="back-to-menu-btn" class="icon-btn" aria-label="Back to Main Menu" title="Back to Main Menu" style="display: none;">
            <i class="fas fa-home"></i>
        </button>
        <!-- END: NEW BUTTONS -->

        <img id="corner-logo-static" class="brand-logo" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot" style="position: absolute; top: 20px; left: 20px; max-height: 40px; opacity: 0.7; display: none;">
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Guess the Flag</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY:</strong></p>
                <ul>
                    <li><i class="fas fa-flag-checkered"></i> Guess the correct country for the flag shown from four options.</li>
                    <li><i class="fas fa-user"></i> **Single Player:** 10 rounds. How many can you get right?</li>
                    <li><i class="fas fa-users"></i> **Multiplayer:** Two teams take turns. First to <strong>5 points</strong> wins!</li>
                </ul>
            </div>
            <div class="game-mode-selection">
                <div class="mode-option selected" data-mode="single"> <i class="fas fa-user"></i> <h3>Single Player</h3> <p>10 rounds</p> </div>
                <div class="mode-option" data-mode="multi"> <i class="fas fa-users"></i> <h3>Multiplayer</h3> <p>With a friend</p> </div>
            </div>
            <div id="team-inputs-container" class="team-inputs-container" style="display: none;">
                <h3 class="screen-title">Enter Team Names</h3>
                <div id="team-names-grid">
                    <div class="team-input"><input type="text" class="team-name-input" placeholder="Team 1"></div>
                    <div class="team-input"><input type="text" class="team-name-input" placeholder="Team 2"></div>
                </div>
            </div>
            <button id="start-game-btn" class="btn-primary">Start Game <i class="fas fa-play"></i></button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-info" id="game-info-bar"></div>
            <div class="place-display-stage">
                <div class="stage-curtains left"></div> <div class="stage-curtains right"></div>
                <div class="place-tv-screen">
                    <h3>Whose flag is this?</h3>
                    <img id="flag-image-display" src="" alt="Flag to guess" class="flag-image">
                </div>
            </div>
            <div id="options-container" class="options-container"></div>
            <button id="action-btn" class="btn-primary" style="margin-top:20px; display: none;">Next <i class="fas fa-arrow-right"></i></button>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over!</h1>
            <div class="win-message" id="win-message-final-text">Team Wins!</div>
            <div class="winner-trophy" id="winner-trophy-icon">üèÜ</div>
            <div id="winner-subtext"></div>
            <div id="final-scores-display-div" class="final-score-display"></div>
            <div class="game-over-buttons-container">
                <button id="play-again-game-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                <button id="main-menu-nav-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">√ó</span>
            <h2>Settings</h2>
            <div class="setting-item"> <label for="bgm-volume-slider">Background Music Volume:</label> <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2"> </div>
            <div class="setting-item"> <label for="sfx-toggle-btn">Sound Effects:</label> <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button> </div>
        </div>
    </div>
    <div id="feedback-popup" class="feedback-popup"> <span id="feedback-message-text-el"></span> </div>

    <!-- Audio Elements -->
    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="correct-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="wrong-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="win-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>
    <audio id="curtain-sound" src="https://static.wixstatic.com/mp3/9ce3e5_ccd36cdf98bf4e1594cf2e52d5296c51.wav"></audio>

    <script>
        const gameConfig = { sfxEnabled: true, musicVolume: 0.2 };
        const gameState = {
            teams: [], currentTeamIndex: 0, currentFlag: null,
            remainingFlags: [], usedFlags: [], gameMode: 'single',
            puzzlesPlayed: 0, winningScore: 5, maxRounds: 10,
            roundPhase: 'guessing', currentGuess: null
        };
        const flagData = [ { country: "United States", code: "us", options: ["Canada", "United States", "Mexico", "Brazil"] }, { country: "France", code: "fr", options: ["France", "Belgium", "Netherlands", "Luxembourg"] }, { country: "Japan", code: "jp", options: ["Japan", "China", "South Korea", "Vietnam"] }, { country: "Brazil", code: "br", options: ["Brazil", "Argentina", "Colombia", "Peru"] }, { country: "Australia", code: "au", options: ["Australia", "New Zealand", "Fiji", "Samoa"] }, { country: "Germany", code: "de", options: ["Germany", "Austria", "Switzerland", "Poland"] }, { country: "Italy", code: "it", options: ["Italy", "Spain", "Portugal", "Greece"] }, { country: "South Africa", code: "za", options: ["South Africa", "Nigeria", "Kenya", "Egypt"] }, { country: "India", code: "in", options: ["India", "Pakistan", "Bangladesh", "Sri Lanka"] }, { country: "Canada", code: "ca", options: ["Canada", "United States", "Mexico", "Greenland"] }, { country: "United Kingdom", code: "gb", options: ["United Kingdom", "Ireland", "France", "Iceland"] }, { country: "China", code: "cn", options: ["China", "Japan", "South Korea", "Mongolia"] },
             { country : "Afghanistan", code : "af", options : ["Uzbekistan", "Turkmenistan", "Afghanistan", "Azerbaijan"] }, { country : "√Öland Islands", code : "ax", options : ["Finland", "√Öland Islands", "Denmark", "Iceland"] }, { country : "Albania", code : "al", options : ["Albania", "Montenegro", "Kosovo", "Serbia"] }, { country : "Algeria", code : "dz", options : ["Pakistan", "Algeria", "Algiers", "Azerbaijan"] }, { country : "American Samoa", code : "as", options : ["Guam", "Nepal", "Ethiopia", "American Samoa"] }, { country : "Andorra", code : "ad", options : ["Moldova", "Andorra", "Chad", "Romania"] }, { country : "Angola", code : "ao", options : ["Andorra", "Mozambique", "Angola", "Afghanistan"] }, { country : "Anguilla", code : "ai", options : ["British Virgin Islands", "Queensland", "Anguilla", "Victoria"] }, { country : "Antarctica", code : "aq", options : ["Cyprus", "Antarctica", "Australia", "United Islands"] }, { country : "Antigua and Barbuda", code : "ag", options : ["Antigua and Barbuda", "Bahamas", "Barbados", "Rocky Islands"] },
             { country : "Argentina", code : "ar", options : ["El Salvador", "Guatemala", "Florentina", "Argentina"] }, { country : "Armenia", code : "am", options : ["Columbia", "Armenia", "Hungary", "Romania"] }, { country : "Aruba", code : "aw", options : ["Aruba", "Fiji", "Cyprus", "Bahamas"] }, { country : "Austria", code : "at", options : ["Austria", "Latvia", "Peru", "Monaco"] }, { country : "Azerbaijan", code : "az", options : ["Baku", "Tajikistan", "Azerbaijan", "Turkmenistan"] }, { country : "Bahamas", code : "bs", options : ["Barbados", "Bahamas", "Saint Lucia", "Dominica"] }, { country : "Bhutan", code : "bt", options : ["Bhutan", "Myanmar", "Sri Lanka", "Mongolia"] }, { country : "Bahrain", code : "bh", options : ["Bahrain", "Qatar", "Kuwait", "Yemen"] }, { country : "Bangladesh", code : "bd", options : ["Sri Lanka", "Bangladesh", "Japan", "Dhaka"] }, { country : "Barbados", code : "bb", options : ["Barbados", "Bahamas", "Andorra", "Dominican Republic"] },
             { country : "Belarus", code : "by", options : ["Belarus", "Oman", "Turkmenistan", "Kazakasthan"] }, { country : "Belgium", code : "be", options : ["Belgium", "Germany", "Chad", "Italy"] }, { country : "Belize", code : "bz", options : ["Belize", "Costa Rica", "Panama", "Cuba"] }, { country : "Benin", code : "bj", options : ["Benin", "Burkina Faso", "Ghana", "Mali"] }, { country : "Bolivia", code : "bo", options : ["Bolivia", "Mali", "Ghana", "Togo"] }, { country : "Bosnia and Herzegovina", code : "ba", options : ["Bosnia and Herzegovina", "Ukraine", "Croatia", "Serbia"] }, { country : "Botswana", code : "bw", options : ["Botswana", "South Sudan", "Namibia", "Argentina"] }, { country : "Brunei", code : "bn", options : ["Brunei", "Kyrgyztan", "Mongolia", "Cambodia"] }, { country : "Bulgaria", code : "bg", options : ["Bulgaria", "Hungary", "Latvia", "Lithuania"] }, { country : "Burkina Faso", code : "bf", options : ["Burkina Faso", "Ghana", "Senegal", "Benin"] },
             { country : "Burundi", code : "bi", options : ["Burundi", "Comoros", "Malawi", "Mozambique"] }, { country : "Cambodia", code : "kh", options : ["Cambodia", "Thailand", "Laos", "Hong kong"] }, { country : "Cameroon", code : "cm", options : ["Cameroon", "Ghana", "Senegal", "Mali"] }, { country : "Cape Verde", code : "cv", options : ["Cape Verde", "European Union", "Lesotho", "South Australia"] }, { country : "Central African Republic", code : "cf", options : ["Central African Republic", "Republic of Congo", "Burundi", "Burkani Faso"] }, { country : "Chad", code : "td", options : ["Chad", "Romania", "Bulgaria", "Comoros"] }, { country : "Chile", code : "cl", options : ["Chile", "Cuba", "Puerto Rico", "Panama"] }, { country : "Colombia", code : "co", options : ["Colombia", "Venezuela", "Ecuador", "Lithuania"] }, { country : "Comoros", code : "km", options : ["Comoros", "Azerbaijan", "Pakistan", "Cameroon"] }, { country : "Republic of the Congo", code : "cg", options : ["Republic of the Congo", "Comoros", "Trinidad and Tobago", "DR Congo"] },
             { country : "DR Congo", code : "cd", options : ["DR Congo", "Republic of the Congo", "Trinidad and Tobago", "Somalia"] }, { country : "Costa Rica", code : "cr", options : ["Costa Rica", "Cuba", "El Salvador", "Chile"] }, { country : "C√¥te d'Ivoire", code : "ci", options : ["C√¥te d'Ivoire", "Ireland", "Italy", "Jamaica"] }, { country : "Croatia", code : "hr", options : ["Croatia", "Serbia", "Czechia", "Panama"] }, { country : "Cuba", code : "cu", options : ["Cuba", "Chile", "Costa Rica", "El Salvador"] }, { country : "Cyprus", code : "cy", options : ["Cyprus", "Antarctica", "Australia", "Samoan Islands"] }, { country : "Czechia", code : "cz", options : ["Czechia", "Croatia", "Serbia", "Panama"] }, { country : "Denmark", code : "dk", options : ["Denmark", "Finalnd", "Norway", "Sweden"] }, { country : "Djibouti", code : "dj", options : ["Djibouti", "Tanzania", "Somalia", "Eritrea"] }, { country : "Dominica", code : "dm", options : ["Dominica", "Ethiopia", "Gabon", "Lesotho"] },
             { country : "Dominican Republic", code : "do", options : ["Dominican Republic", "Panama", "Botswana", "Fiji"] }, { country : "Ecuador", code : "ec", options : ["Ecuador", "Colombia", "Venezuela", "Cambodia"] }, { country : "Egypt", code : "eg", options : ["Egypt", "Iran", "Yemen", "Morocco"] }, { country : "El Salvador", code : "sv", options : ["El Salvador", "Guatemala", "Barbados", "Bahamas"] }, { country : "Equatorial Guinea", code : "gq", options : ["Equatorial Guinea", "Papua New Guinea", "Guam", "Guinea"] }, { country : "Eritrea", code : "er", options : ["Eritrea", "Lesotho", "Rwanda", "Gabon"] }, { country : "Estonia", code : "ee", options : ["Estonia", "Lithuania", "Albania", "Armenia"] }, { country : "Eswatini", code : "sz", options : ["Eswatini", "Botswana", "Djibouti", "South Sudan"] }, { country : "Ethiopia", code : "et", options : ["Ethiopia", "Eritrea", "Cape Verde", "Gambia"] }, { country : "Fiji", code : "fj", options : ["Honduras", "Fiji", "British Virgin Islands", "North New Zealand"] },
             { country : "Finland", code : "fi", options : ["Finland", "Sweden", "Greenland", "Iceland"] }, { country : "French Polynesia", code : "pf", options : ["French Polynesia", "Peru", "Samoa", "Tuvalu"] }, { country : "Gabon", code : "ga", options : ["Gabon", "Jamaica", "Estonnia", "Botswana"] }, { country : "Gambia", code : "gm", options : ["Gambia", "Madagascar", "Eswatini", "Benin"] }, { country : "Georgia", code : "ge", options : ["Georgia", "England", "Denmark", "Switzerland"] }, { country : "Ghana", code : "gh", options : ["Ghana", "Senegal", "Cameroon", "Somalia"] }, { country : "Greece", code : "gr", options : ["Greece", "Uruguay", "Puerto Rico", "Iceland"] }, { country : "Grenada", code : "gd", options : ["Grenada", "Haiti", "Saint Lucia", "Bahamas"] }, { country : "Guam", code : "gu", options : ["Guam", "Pacific Islands", "Guatemala", "South Madagascar"] }, { country : "Guatemala", code : "gt", options : ["Guatemala", "Peru", "Fijij", "El Salvador"] },
             { country : "Guyana", code : "gy", options : ["Guyana", "Sao Tome Principe", "Island Of Carribeans", "Guam"] }, { country : "Haiti", code : "ht", options : ["Haiti", "Fiji", "Hawaii", "British Vigin Islands"] }, { country : "Honduras", code : "hn", options : ["Honduras", "Guatemala", "Eritrea", "Haiti"] }, { country : "Hong Kong", code : "hk", options : ["Hong Kong", "Vietnam", "Tunisia", "Mongolia"] }, { country : "Hungary", code : "hu", options : ["Hungary", "Bulgaria", "Latvia", "Lithuania"] }, { country : "Indonesia", code : "id", options : ["Indonesia", "Poland", "Monaco", "Thaliand"] }, { country : "Iran", code : "ir", options : ["Iran", "Iraq", "Belarus", "Oman"] }, { country : "Iraq", code : "iq", options : ["Iraq", "Iran", "Egypt", "Yemen"] }, { country : "Ireland", code : "ie", options : ["Ireland", "Ivory Coast", "Italy", "Jamaica"] }, { country : "Jamaica", code : "jm", options : ["Jamaica", "Mali", "Guinea", "Togo"] },
             { country : "Jordan", code : "jo", options : ["Jordan", "Palestine", "Kuwait", "Bahrain"] }, { country : "Kazakhstan", code : "kz", options : ["Kazakhstan", "Uzbekistan", "Turkmenistan", "Azerbaijan"] }, { country : "Kenya", code : "ke", options : ["Kenya", "Zimbabwe", "Uganda", "Mozambique"] }, { country : "North Korea", code : "kp", options : ["North Korea", "Cuba", "Puerto Rico", "Samoa"] }, { country : "South Korea", code : "kr", options : ["South Korea", "North Korea", "Hong Kong", "East Timor"] }, { country : "Kuwait", code : "kw", options : ["Kuwait", "Jordan", "Palestine", "South Africa"] }, { country : "Kyrgyzstan", code : "kg", options : ["Kyrgyzstan", "Hong Kong", "Laos", "Uzbekistan"] }, { country : "Laos", code : "la", options : ["Laos", "Thailand", "Cambodia", "Timor"] }, { country : "Latvia", code : "lv", options : ["Latvia", "Austria", "Qatar", "Hoorn"] }, { country : "Lebanon", code : "lb", options : ["Lebanon", "Palestine", "Kuwait", "Yemen"] },
             { country : "Lesotho", code : "ls", options : ["Lesotho", "Gabon", "Uganda", "Guinea"] }, { country : "Liberia", code : "lr", options : ["Liberia", "Malaysia", "Cuba", "Puerto Rico"] }, { country : "Libya", code : "ly", options : ["Libya", "Tunisia", "Lebanon", "Lesotho"] }, { country : "Liechtenstein", code : "li", options : ["Liechtenstein", "Haiti", "Serbia", "Vatican"] }, { country : "Lithuania", code : "lt", options : ["Bolivia", "Lithuania", "Lesotho", "Liechtenstein"] }, { country : "Madagascar", code : "mg", options : ["Madagascar", "Oman", "Belarus", "Benin"] }, { country : "Malawi", code : "mw", options : ["Malawi", "Kenya", "Trinidad and Tobago", "Tongo"] }, { country : "Malaysia", code : "my", options : ["Malaysia", "Chile", "Cuba", "Singapore"] }, { country : "Maldives", code : "mv", options : ["Maldives", "Libya", "Turkmenistan", "Bali"] }, { country : "Mali", code : "ml", options : ["Mali", "Guinea", "Ghana", "Congo"] },
             { country : "Malta", code : "mt", options : ["Malta", "Singapore", "Poland", "Indonesia"] }, { country : "Marshall Islands", code : "mh", options : ["Marshall Islands", "Seychelles", "Samoa", "British Virgin Islands"] }, { country : "Mauritania", code : "mr", options : ["Mauritania", "Lithuania", "Botswana", "Mauritius"] }, { country : "Mexico", code : "mx", options : ["Mexico", "Peru", "Colombia", "Italy"] }, { country : "Micronesia", code : "fm", options : ["Micronesia", "Bosnia", "Cambodia", "Somalia"] }, { country : "Moldova", code : "md", options : ["Moldova", "Romania", "Chad", "Bulgaria"] }, { country : "Monaco", code : "mc", options : ["Monaco", "Poland", "Indonesia", "Singapore"] }, { country : "Mongolia", code : "mn", options : ["Mongolia", "Thailand", "Cambodia", "Hong Kong"] }, { country : "Montenegro", code : "me", options : ["Montenegro", "Monaco", "Myanmar", "Mauritius"] }, { country : "Morocco", code : "ma", options : ["Morocco", "Senegal", "Vietnam", "Algeria"] },
             { country : "Mozambique", code : "mz", options : ["Mozambique", "Kenya", "Eritrea", "Zimbabwe"] }, { country : "Myanmar", code : "mm", options : ["Myanmar", "Bhutan", "Senegal", "Ghana"] }, { country : "Namibia", code : "na", options : ["Namibia", "Moazambique", "Montenegro", "Uganda"] }, { country : "Nauru", code : "nr", options : ["Nauru", "Tuvalu", "Macau", "Atlantic Islands"] }, { country : "Nepal", code : "np", options : ["Nepal", "Bhutan", "Assam", "Himalayans"] }, { country : "Netherlands", code : "nl", options : ["Netherlands", "Lithuania", "Estonia", "France"] }, { country : "New Zealand", code : "nz", options : ["New Zealand", "Australia", "Fiji", "Samoan Islands"] }, { country : "Nicaragua", code : "ni", options : ["Nicaragua", "Guatemala", "El Salvador", "Somalia"] }, { country : "Niger", code : "ne", options : ["Niger", "India", "Ivory Coast", "Rwanda"] }, { country : "Nigeria", code : "ng", options : ["Nigeria", "Niger", "South Africa", "Africa"] },
             { country : "North Macedonia", code : "mk", options : ["North Macedonia", "Vietnam", "Macedonia", "Hong Kong"] }, { country : "Norway", code : "no", options : ["Norway", "Iceland", "Greenland", "Denmark"] }, { country : "Oman", code : "om", options : ["Oman", "Belarus", "Iran", "Kosovo"] }, { country : "Pakistan", code : "pk", options : ["Pakistan", "Saudi Arabia", "Nepal", "Bangladesh"] }, { country : "Palestine", code : "ps", options : ["Palestine", "Jordan", "Kuwait", "Egypt"] }, { country : "Panama", code : "pa", options : ["Panama", "Chile", "Cuba", "Puerto Rico"] }, { country : "Paraguay", code : "py", options : ["Paraguay", "Uruguay", "Venezuela", "Netherlands"] }, { country : "Peru", code : "pe", options : ["Peru", "Poland", "Monaco", "Montenegro"] }, { country : "Philippines", code : "ph", options : ["Philippines", "Czechia", "Serbia", "Laos"] }, { country : "Poland", code : "pl", options : ["Poland", "Indonesia", "Monaco", "Malta"] },
             { country : "Portugal", code : "pt", options : ["Portugal", "Guinea", "Lebanon", "Morocco"] }, { country : "Qatar", code : "qa", options : ["Qatar", "Bahrain", "Latvia", "Estonia"] }, { country : "Romania", code : "ro", options : ["Romania", "Chad", "Moldova", "Bulgaria"] }, { country : "Rwanda", code : "rw", options : ["Rwanda", "Uzbekistan", "Antigua", "Uganda"] }, { country : "Saint Kitts and Nevis", code : "kn", options : ["Saint Kitts and Nevis", "Trinidad and Tobago", "Seychelles", "Barboran Islands"] }, { country : "Saint Lucia", code : "lc", options : ["Saint Lucia", "Barboran Islands", "Saint Kitts and Nevis", "Andalucia"] }, { country : "Samoa", code : "ws", options : ["Samoa", "American Samoa", "Kiribati", "Fiji"] }, { country : "S√£o Tom√© and Pr√≠ncipe", code : "st", options : ["S√£o Tom√© and Pr√≠ncipe", "Sierra Leone", "Cape Verde", "Gambia"] }, { country : "Saudi Arabia", code : "sa", options : ["Saudi Arabia", "Pakistan", "Jordan", "Iraq"] }, { country : "Senegal", code : "sn", options : ["Senegal", "Ghana", "Cameroon", "Comoros"] },
             { country : "Serbia", code : "rs", options : ["Serbia", "Croatia", "Czechia", "Canary"] }, { country : "Seychelles", code : "sc", options : ["Seychelles", "Barbados", "Bahamas", "Ibiza"] }, { country : "Sierra Leone", code : "sl", options : ["Sierra Leone", "Gabon", "Togo", "Liberia"] }, { country : "Singapore", code : "sg", options : ["Singapore", "Malaysia", "Indonesia", "Liberia"] }, { country : "Slovakia", code : "sk", options : ["Slovakia", "Serbia", "Croatia", "Czechia"] }, { country : "Solomon Islands", code : "sb", options : ["Solomon Islands", "Djibouti", "Malawi", "Eritrea"] }, { country : "Somalia", code : "so", options : ["Somalia", "Sudan", "South Sudan", "Micronesia"] }, { country : "South Sudan", code : "ss", options : ["South Sudan", "Sudan", "Somalia", "Ethiopia"] }, { country : "Spain", code : "es", options : ["Spain", "Morocco", "Mexico", "Gibraltar"] }, { country : "Sri Lanka", code : "lk", options : ["Sri Lanka", "Bhutan", "Myanmar", "Cambodia"] },
             { country : "Sudan", code : "sd", options : ["Sudan", "South Sudan", "Palestine", "Jordan"] }, { country : "Suriname", code : "sr", options : ["Suriname", "Ethiopia", "Somalia", "Senegal"] }, { country : "Syria", code : "sy", options : ["Syria", "Yemen", "Egypt", "Iraq"] }, { country : "Taiwan", code : "tw", options : ["Taiwan", "Bali", "Microneisa", "Thailand"] }, { country : "Tajikistan", code : "tj", options : ["Tajikistan", "Kyrgyzstan", "Turkmenistan", "Afghanistan"] }, { country : "Tanzania", code : "tz", options : ["Tanzania", "Somalia", "Eritria", "Albania"] }, { country : "Thailand", code : "th", options : ["Thailand", "Cambodia", "Laos", "Indonesia"] }, { country : "Togo", code : "tg", options : ["Togo", "Mali", "Burkani Faso", "Gambia"] }, { country : "Tonga", code : "to", options : ["Tonga", "Mali", "Maui", "East Samoa"] }, { country : "Trinidad and Tobago", code : "tt", options : ["Kiribati", "Palau", "Trinidad and Tobago", "Tuvalu"] },
             { country : "Tunisia", code : "tn", options : ["Tunisia", "Libya", "Turkey", "Liberia"] }, { country : "Turkey", code : "tr", options : ["Turkey", "Tunisia", "Libya", "Liberia"] }, { country : "Turkmenistan", code : "tm", options : ["Turkmenistan", "Uzbekistan", "Kyrgyzstan", "Afhganistan"] }, { country : "Tuvalu", code : "tv", options : ["Tuvalu", "Nauru", "Palau", "Fiji"] }, { country : "Uganada", code : "ug", options : ["Uganda", "Swaziland", "Lesotho", "Namibia"] }, { country : "Ukraine", code : "ua", options : ["Ukraine", "Lithuania", "Monaco", "Estonia"] }, { country : "United Arab Emirates", code : "ae", options : ["United Arab Emirates", "Jordan", "Palestine", "Kuwait"] }, { country : "Uruguay", code : "uy", options : ["Uruguay", "Argentina", "Greece", "Brazil"] }, { country : "Uzbekistan", code : "uz", options : ["Uzbekistan", "Azerbaijan", "Turkmenistan", "Pakistan"] }, { country : "Venezuela", code : "ve", options : ["Venezuela", "Ecuador", "Colombia", "Andorra"] },
             { country : "Vietnam", code : "vn", options : ["Vietnam", "China", "Hong Kong", "Cambodia"] }, { country : "Yemen", code : "ye", options : ["Yemen", "Iraq", "Egypt", "Jordan"] }, { country : "Zambia", code : "zm", options : ["Zambia", "Zimbabwe", "Mozambique", "Gibraltar"] }, { country : "Zimbabwe", code : "zw", options : ["Zimbabwe", "Zambia", "Mozambique", "Gibraltar"] },
        ];

        // DOM Elements
        const screensEl = { start: document.getElementById('start-screen'), game: document.getElementById('game-screen'), gameOver: document.getElementById('game-over-screen') };
        const cornerLogoEl = document.getElementById('corner-logo-static');
        const modeOptionsNodeListEl = document.querySelectorAll('.mode-option');
        const teamInputsContainerEl = document.getElementById('team-inputs-container');
        const teamNamesGridEl = document.getElementById('team-names-grid');
        const startGameBtnEl = document.getElementById('start-game-btn');
        const gameInfoBarEl = document.getElementById('game-info-bar');
        const flagImageDisplayEl = document.getElementById('flag-image-display');
        const leftCurtainEl = document.querySelector('.place-display-stage .stage-curtains.left');
        const rightCurtainEl = document.querySelector('.place-display-stage .stage-curtains.right');
        const optionsContainerEl = document.getElementById('options-container');
        const actionBtnEl = document.getElementById('action-btn');
        const winMessageFinalTextEl = document.getElementById('win-message-final-text');
        const winnerTrophyIconEl = document.getElementById('winner-trophy-icon');
        const winnerSubtextEl = document.getElementById('winner-subtext');
        const finalScoresDisplayEl = document.getElementById('final-scores-display-div');
        const playAgainGameBtnEl = document.getElementById('play-again-game-btn');
        const mainMenuNavBtnEl = document.getElementById('main-menu-nav-btn');
        const visitStoreBtnEl = document.getElementById('visit-store-btn');
        const settingsBtnEl = document.getElementById('settings-btn');
        const settingsModalEl = document.getElementById('settings-modal');
        const closeModalBtnEl = document.getElementById('close-modal-btn');
        const bgmVolumeSliderEl = document.getElementById('bgm-volume-slider');
        const sfxToggleBtnEl = document.getElementById('sfx-toggle-btn');
        const feedbackPopupEl = document.getElementById('feedback-popup');
        const feedbackMessageTextPopupEl = document.getElementById('feedback-message-text-el');
        const backgroundMusicAudioEl = document.getElementById('background-game-music');
        const startGameSoundAudioEl = document.getElementById('start-game-sound');
        const interactionSoundAudioEl = document.getElementById('interaction-sound');
        const correctAnswerSoundAudioEl = document.getElementById('correct-answer-sound');
        const wrongAnswerSoundAudioEl = document.getElementById('wrong-answer-sound');
        const winGameSoundAudioEl = document.getElementById('win-game-sound');
        const curtainSoundAudioEl = document.getElementById('curtain-sound');
        // NEW
        const backToGamesBtn = document.getElementById('back-to-games-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');

        function playSound(audioElement) { if (gameConfig.sfxEnabled && audioElement) { audioElement.currentTime = 0; audioElement.volume = 0.7; audioElement.play().catch(e => console.error("SFX error:", e));}}
        function initBackgroundMusic() { if(backgroundMusicAudioEl.paused) {backgroundMusicAudioEl.volume = gameConfig.musicVolume; backgroundMusicAudioEl.play().catch(e => console.log("BGM autoplay failed.", e));} }
        let feedbackTimeoutHandle;
        function showFeedbackPopupMessage(message, type = '', duration = 1500) {
            feedbackMessageTextPopupEl.textContent = message;
            feedbackPopupEl.className = 'feedback-popup';
            if (type) feedbackPopupEl.classList.add(type);
            feedbackPopupEl.classList.add('show');
            clearTimeout(feedbackTimeoutHandle);
            feedbackTimeoutHandle = setTimeout(() => { feedbackPopupEl.classList.remove('show'); }, duration - 100);
        }
        function triggerConfetti() {
            const confettiCount = 100;
            const colors = ['var(--primary)', 'var(--secondary)', 'var(--success)', 'var(--gold)', 'var(--info)'];
            document.querySelectorAll('.confetti-piece').forEach(el => el.remove());
            for (let i = 0; i < confettiCount; i++) {
                const piece = document.createElement('div');
                piece.classList.add('confetti-piece');
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                const animDur = Math.random() * 3 + 2;
                piece.style.animationName = 'fallAndFade';
                piece.style.animationDuration = animDur + 's';
                piece.style.animationDelay = Math.random() * 1 + 's';
                document.body.appendChild(piece);
                setTimeout(() => piece.remove(), (animDur + parseFloat(piece.style.animationDelay || 0)) * 1000 + 500);
            }
        }
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
        
        function switchScreen(screenId) {
            Object.values(screensEl).forEach(s => s.classList.remove('active'));
            screensEl[screenId].classList.add('active');
            
            // NEW: Control visibility of top-left buttons and corner logo
            backToGamesBtn.style.display = (screenId === 'start') ? 'flex' : 'none';
            backToMenuBtn.style.display = (screenId === 'game') ? 'flex' : 'none';
            cornerLogoEl.style.display = (screenId !== 'start' && screenId !== 'game') ? 'block' : 'none';
        }

        function selectGameMode() {
            modeOptionsNodeListEl.forEach(option => option.classList.remove('selected'));
            this.classList.add('selected');
            gameState.gameMode = this.dataset.mode;
            teamInputsContainerEl.style.display = gameState.gameMode === 'multi' ? 'block' : 'none';
        }

        function startGame() {
            if (gameState.gameMode === 'single') {
                gameState.teams = [{ name: "You", score: 0 }];
            } else {
                const team1Name = teamNamesGridEl.querySelectorAll('.team-name-input')[0].value.trim() || "Team 1";
                const team2Name = teamNamesGridEl.querySelectorAll('.team-name-input')[1].value.trim() || "Team 2";
                if (team1Name === team2Name) { alert("Team names must be different!"); return; }
                gameState.teams = [{ name: team1Name, score: 0 }, { name: team2Name, score: 0 }];
            }
            gameState.currentTeamIndex = 0;
            gameState.teams.forEach(team => team.score = 0);
            gameState.puzzlesPlayed = 0;
            gameState.remainingFlags = [...flagData];
            shuffleArray(gameState.remainingFlags);
            gameState.usedFlags = [];

            initBackgroundMusic();
            playSound(startGameSoundAudioEl);
            switchScreen('game');
            setupRound();
        }

        function setupRound() {
            gameState.roundPhase = 'guessing';
            gameState.currentGuess = null;

            leftCurtainEl.classList.remove('open');
            rightCurtainEl.classList.remove('open');
            flagImageDisplayEl.classList.remove('visible');
            flagImageDisplayEl.src = "";

            if (gameState.remainingFlags.length === 0) {
                if (gameState.usedFlags.length > 0) {
                    gameState.remainingFlags = [...gameState.usedFlags]; gameState.usedFlags = [];
                    shuffleArray(gameState.remainingFlags);
                } else { showGameOver(); return; }
            }

            const randomIndex = Math.floor(Math.random() * gameState.remainingFlags.length);
            gameState.currentFlag = gameState.remainingFlags.splice(randomIndex, 1)[0];
            gameState.usedFlags.push(gameState.currentFlag);
            
            flagImageDisplayEl.src = `https://flagcdn.com/w320/${gameState.currentFlag.code.toLowerCase()}.png`;
            optionsContainerEl.innerHTML = '';
            actionBtnEl.style.display = 'none';
            const options = [...gameState.currentFlag.options];
            shuffleArray(options);
            options.forEach(optionText => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn btn-secondary';
                optionBtn.innerHTML = `<i class="far fa-circle"></i><span>${optionText}</span>`;
                optionBtn.dataset.option = optionText;
                optionBtn.addEventListener('click', handleOptionSelect);
                optionsContainerEl.appendChild(optionBtn);
            });
            updateGameInfoUI();
            
            setTimeout(() => {
                playSound(curtainSoundAudioEl);
                leftCurtainEl.classList.add('open');
                rightCurtainEl.classList.add('open');
                flagImageDisplayEl.classList.add('visible');
            }, 300);
        }

        function handleOptionSelect(event) {
            playSound(interactionSoundAudioEl);
            gameState.currentGuess = event.currentTarget.dataset.option;
            
            document.querySelectorAll('#options-container .option-btn').forEach(btn => {
                btn.disabled = true;
                btn.querySelector('i').className = 'far fa-circle';
            });

            event.currentTarget.querySelector('i').className = 'fas fa-check-circle';
            
            actionBtnEl.innerHTML = 'Reveal Answer <i class="fas fa-eye"></i>';
            actionBtnEl.style.display = 'inline-flex';
            actionBtnEl.disabled = false;
        }

        function revealAnswer() {
            gameState.roundPhase = 'revealed';
            actionBtnEl.disabled = true;

            const isCorrect = gameState.currentGuess === gameState.currentFlag.country;
            if (isCorrect) {
                playSound(correctAnswerSoundAudioEl);
                gameState.teams[gameState.currentTeamIndex].score++;
                showFeedbackPopupMessage('Correct!', 'correct-feedback', 2000);
            } else {
                playSound(wrongAnswerSoundAudioEl);
                showFeedbackPopupMessage('Incorrect!', 'incorrect-feedback', 2000);
            }

            if (gameState.gameMode === 'single') { gameState.puzzlesPlayed++; }

            document.querySelectorAll('#options-container .option-btn').forEach(btn => {
                if (btn.dataset.option === gameState.currentFlag.country) {
                    btn.classList.add('correct');
                    btn.querySelector('i').className = 'fas fa-check-circle';
                } else if (btn.dataset.option === gameState.currentGuess && !isCorrect) {
                    btn.classList.add('incorrect');
                    btn.querySelector('i').className = 'fas fa-times-circle';
                }
            });

            updateGameInfoUI();

            setTimeout(() => {
                const maxScore = Math.max(...gameState.teams.map(t => t.score));
                if ((gameState.gameMode === 'single' && gameState.puzzlesPlayed >= gameState.maxRounds) ||
                    (gameState.gameMode === 'multi' && maxScore >= gameState.winningScore)) {
                    actionBtnEl.innerHTML = 'See Final Results <i class="fas fa-trophy"></i>';
                } else {
                    actionBtnEl.innerHTML = 'Next Flag <i class="fas fa-arrow-right"></i>';
                }
                actionBtnEl.disabled = false;
            }, 1800); // Delay to match pop-up
        }

        function nextRound() {
             const maxScore = Math.max(...gameState.teams.map(t => t.score));
             if ((gameState.gameMode === 'single' && gameState.puzzlesPlayed >= gameState.maxRounds) ||
                 (gameState.gameMode === 'multi' && maxScore >= gameState.winningScore)) {
                showGameOver();
             } else {
                 if (gameState.gameMode === 'multi') {
                    gameState.currentTeamIndex = (gameState.currentTeamIndex + 1) % gameState.teams.length;
                 }
                 setupRound();
             }
        }
        
        function processAction() {
            if (gameState.roundPhase === 'guessing') {
                revealAnswer();
            } else {
                nextRound();
            }
        }
        
        function updateGameInfoUI() {
            gameInfoBarEl.innerHTML = '';
            if (gameState.gameMode === 'single') {
                gameInfoBarEl.innerHTML = `<div>Round: ${gameState.puzzlesPlayed + 1}/${gameState.maxRounds}</div><div>Score: ${gameState.teams[0].score}</div>`;
            } else {
                const turnBox = document.createElement('div');
                turnBox.className = 'score-box';
                turnBox.textContent = `${gameState.teams[gameState.currentTeamIndex].name}'s Turn`;
                const scoresContainer = document.createElement('div');
                scoresContainer.className = 'score-display-multiplayer';
                gameState.teams.forEach((team, index) => {
                    const scoreBox = document.createElement('div');
                    scoreBox.className = 'score-box';
                    if (index === gameState.currentTeamIndex && gameState.roundPhase === 'guessing') {
                        scoreBox.classList.add('current-turn');
                    }
                    scoreBox.textContent = `${team.name}: ${team.score}`;
                    scoresContainer.appendChild(scoreBox);
                });
                gameInfoBarEl.appendChild(turnBox);
                gameInfoBarEl.appendChild(scoresContainer);
            }
        }

        function showGameOver() {
            playSound(winGameSoundAudioEl);
            switchScreen('gameOver');

            if (gameState.gameMode === 'single') {
                const finalScore = gameState.teams[0].score;
                winMessageFinalTextEl.textContent = 'Well Played!';
                winnerSubtextEl.textContent = `You scored ${finalScore} out of ${gameState.maxRounds}!`;
                if(finalScore >= 7) triggerConfetti();
                winnerTrophyIconEl.textContent = finalScore === 10 ? 'üåü' : (finalScore >= 7 ? 'üèÜ' : 'üëç');
            } else {
                const scores = gameState.teams.map(t => t.score);
                const maxScore = Math.max(...scores);
                const winners = gameState.teams.filter(t => t.score === maxScore && t.score >= gameState.winningScore);
                if (winners.length === 1) {
                    winMessageFinalTextEl.textContent = `${winners[0].name} Wins!`;
                    winnerSubtextEl.textContent = `Congratulations on reaching ${maxScore} points!`;
                    triggerConfetti();
                } else if (winners.length > 1) {
                    winMessageFinalTextEl.textContent = "It's a Tie!";
                    winnerSubtextEl.textContent = `Multiple teams finished with ${maxScore} points!`;
                    triggerConfetti();
                } else {
                    winMessageFinalTextEl.textContent = "Game Over";
                    winnerSubtextEl.textContent = `Nobody reached the winning score of ${gameState.winningScore}.`;
                }
                winnerTrophyIconEl.textContent = 'üèÜ';
            }
            
            finalScoresDisplayEl.innerHTML = '';
            const maxScore = Math.max(...gameState.teams.map(t => t.score));
            gameState.teams.forEach(team => {
                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card';
                if (gameState.gameMode === 'multi' && team.score === maxScore && maxScore > 0) {
                     scoreCard.classList.add('winner-glow');
                }
                scoreCard.innerHTML = `<div class="team-name-score">${team.name}</div><div class="score-value-display">${team.score}</div>`;
                finalScoresDisplayEl.appendChild(scoreCard);
            });
        }
        
        function goToMainMenu() {
            teamNamesGridEl.innerHTML = `<div class="team-input"><input type="text" class="team-name-input" placeholder="Team 1"></div><div class="team-input"><input type="text" class="team-name-input" placeholder="Team 2"></div>`;
            modeOptionsNodeListEl.forEach(opt => opt.classList.remove('selected'));
            modeOptionsNodeListEl[0].classList.add('selected');
            teamInputsContainerEl.style.display = 'none';
            gameState.gameMode = 'single';
            switchScreen('start');
        }

        // Event Listeners
        settingsBtnEl.addEventListener('click', () => { playSound(interactionSoundAudioEl); settingsModalEl.style.display = 'flex'; });
        closeModalBtnEl.addEventListener('click', () => { playSound(interactionSoundAudioEl); settingsModalEl.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target === settingsModalEl) { playSound(interactionSoundAudioEl); settingsModalEl.style.display = 'none'; } });
        bgmVolumeSliderEl.addEventListener('input', (e) => { gameConfig.musicVolume = parseFloat(e.target.value); backgroundMusicAudioEl.volume = gameConfig.musicVolume; });
        sfxToggleBtnEl.addEventListener('click', () => {
            playSound(interactionSoundAudioEl);
            gameConfig.sfxEnabled = !gameConfig.sfxEnabled;
            sfxToggleBtnEl.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`;
            sfxToggleBtnEl.classList.toggle('btn-success', gameConfig.sfxEnabled);
            sfxToggleBtnEl.classList.toggle('btn-danger', !gameConfig.sfxEnabled);
        });
        modeOptionsNodeListEl.forEach(option => option.addEventListener('click', function() { playSound(interactionSoundAudioEl); selectGameMode.call(this); }));
        startGameBtnEl.addEventListener('click', startGame);
        actionBtnEl.addEventListener('click', processAction);
        playAgainGameBtnEl.addEventListener('click', () => { playSound(startGameSoundAudioEl); goToMainMenu(); });
        mainMenuNavBtnEl.addEventListener('click', () => { playSound(interactionSoundAudioEl); goToMainMenu(); });
        visitStoreBtnEl.addEventListener('click', () => { playSound(interactionSoundAudioEl); window.location.href = '/store';  });
        // NEW
        backToMenuBtn.addEventListener('click', () => { playSound(interactionSoundAudioEl); goToMainMenu(); });


        document.addEventListener('DOMContentLoaded', () => {
            sfxToggleBtnEl.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`;
            sfxToggleBtnEl.classList.toggle('btn-success', gameConfig.sfxEnabled);
            sfxToggleBtnEl.classList.toggle('btn-danger', !gameConfig.sfxEnabled);
            bgmVolumeSliderEl.value = gameConfig.musicVolume;
            switchScreen('start');
        });
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>
</body>
</html>