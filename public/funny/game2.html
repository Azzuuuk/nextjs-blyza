<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find The Imposter - Blyza Game Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- START: BRAND IDENTITY & ROOT VARIABLES --- */
        :root {
            --blyza-orange-primary: #FF8833;
            --blyza-purple-secondary: #cb7ae1;
            --blyza-keppel-accent: #00BFA6;
            --blyza-sunny-yellow: #FFDF00;
            --blyza-quickfire-red: #EA2027;

            --darker-grey-bg: #4A4A4A;
            --text-light: #FDFEFE;
            --text-dark: #2C3A47;
            --text-medium: #535c68;
            --black-stroke: #1A1A1A;

            --font-logo: "Luckiest Guy", cursive;
            --font-heading-alt: "Bungee", cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-radius-game: 12px;
            --shadow-chunky: 4px 4px 0px var(--black-stroke);
        }
        /* --- END: BRAND IDENTITY & ROOT VARIABLES --- */

        /* --- Basic Reset & Body --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        
        /* --- CUSTOM SCROLLING BODY --- */
        body {
            font-family: var(--font-body);
            color: var(--text-light);
            background: linear-gradient(135deg, var(--blyza-orange-primary) 0%, var(--blyza-purple-secondary) 100%);
            line-height: 1.6;
            overflow: hidden; /* Body does not scroll */
            position: relative;
            height: var(--app-height, 100vh); /* Full screen height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- Floating Background Elements --- */
        .hero-background-elements { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
        .bg-game-element {
            position: absolute; opacity: 0.1; color: var(--text-light);
            animation: floatSimple 20s infinite ease-in-out alternate;
            user-select: none;
        }
        .bg-secret-1 { font-size: 140px; top: 10%; left: 5%; --initial-rotate: -15deg; animation-duration: 22s; }
        .bg-mask-1 { font-size: 100px; top: 65%; right: 8%; --initial-rotate: 10deg; animation-duration: 18s; }
        .bg-question-1 { font-size: 120px; top: 70%; left: 15%; --initial-rotate: 5deg; animation-duration: 25s; opacity: 0.08; }
        .bg-eye-1 { font-size: 130px; top: 15%; right: 10%; --initial-rotate: 20deg; animation-duration: 16s; }
        .bg-secret-2 { font-size: 80px; top: 80%; right: 25%; --initial-rotate: 25deg; animation-duration: 15s; }
        .bg-mask-2 { font-size: 120px; bottom: 5%; left: 3%; --initial-rotate: -5deg; animation-duration: 28s; }
        
        @keyframes floatSimple {
            0% { transform: translateY(0px) rotate(var(--initial-rotate, 0deg)); }
            50% { transform: translateY(-25px) rotate(calc(var(--initial-rotate, 0deg) + 8deg)); }
            100% { transform: translateY(0px) rotate(calc(var(--initial-rotate, 0deg) - 8deg)); }
        }
        
        /* --- CUSTOM SCROLLING CONTAINER --- */
        .game-container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(145deg, #fdfefe, #e9ecef);
            color: var(--text-dark);
            border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke);
            box-shadow: 8px 8px 0px var(--black-stroke);
            padding: 30px; 
            text-align: center;
            position: relative;
            z-index: 2;
            max-height: calc(var(--app-height, 100vh) - 40px); /* Make container scrollable */
            overflow-y: auto;
        }

        .brand-logo-prominent { display: block; margin: 0 auto 15px; max-height: 80px; }
        
        h1 {
            font-family: var(--font-logo); font-size: clamp(2.5rem, 6vw, 3.5rem);
            color: var(--blyza-orange-primary); -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke); text-shadow: 3px 3px 0px rgba(0,0,0,0.15);
            margin-bottom: 20px; line-height: 1.1;
        }
        h2 { font-family: var(--font-heading-alt); font-size: 1.8rem; margin-bottom: 18px; color: var(--text-dark); }
        h3 { font-family: var(--font-heading-alt); font-size: 1.4rem; margin-bottom: 15px; color: var(--blyza-orange-primary); }

        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .active { display: block; }

        /* --- Section Styling --- */
        .instructions, .player-inputs, .result-card {
            background: rgba(0,0,0, 0.04); padding: 20px;
            border-radius: 10px; margin: 25px 0; border: 2px dashed var(--text-medium);
        }
        .instructions p { font-size: 1.1rem; margin-bottom: 15px; font-weight: 600; font-family: var(--font-heading-alt); }
        .instructions ul { list-style-type: none; text-align: left; padding: 0 10px; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: center; }
        .instructions i { margin-right: 15px; font-size: 1.3em; color: var(--blyza-orange-primary); width: 20px; text-align: center; }
         .instructions a { color: var(--blyza-purple-secondary); text-decoration: none; font-weight: bold; display: inline-flex; align-items: left; gap: 5px; transition: color 0.3s ease; }
         .instructions a:hover { color: var(--blyza-orange-primary); text-decoration: underline; }

        /* --- Player Inputs --- */
        .player-input-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .player-input-wrapper input {
            width: 100%; padding: 12px 18px; border-radius: 8px;
            border: 3px solid var(--black-stroke); background: var(--text-light);
            color: var(--text-dark); font-size: 1rem; transition: all 0.3s ease;
            font-family: var(--font-body); font-weight: 600;
        }
        .player-input-wrapper input:focus { outline: none; border-color: var(--blyza-orange-primary); box-shadow: 0 0 0 3px var(--blyza-sunny-yellow); }
        .remove-player-btn {
            background: var(--blyza-quickfire-red); color: var(--text-light); border: 2px solid var(--black-stroke);
            border-radius: 8px; padding: 8px 12px !important; font-size: 0.8rem !important; cursor: pointer;
            transition: all 0.2s ease; margin: 0; box-shadow: 2px 2px 0 var(--black-stroke);
        }
        .remove-player-btn:hover { background: #c0392b; }
        .remove-player-btn:disabled { background: var(--text-medium); cursor: not-allowed; opacity: 0.7; }
        .remove-player-btn i { margin: 0; }

        /* --- Buttons --- */
        button, .btn-primary, .btn-secondary, .btn-success, .btn-danger, .btn-info {
            font-family: var(--font-heading-alt); font-size: 1.1rem; padding: 0.7em 1.5em;
            border: 3px solid var(--black-stroke); border-radius: 8px;
            text-transform: uppercase; text-decoration: none; display: inline-flex;
            align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            letter-spacing: 1px; cursor: pointer; color: var(--text-dark);
            margin: 8px 5px;
        }
        button:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        button:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        button:disabled { background: var(--text-medium); color: var(--text-light); cursor: not-allowed; opacity: 0.7; box-shadow: var(--shadow-chunky); }

        .btn-primary, #start-game-btn, #next-player-btn, #start-voting-btn { background-color: var(--blyza-sunny-yellow); box-shadow: var(--shadow-chunky); }
        .btn-secondary, #add-player-btn, #new-game-btn { background-color: var(--blyza-purple-secondary); color: var(--text-light); box-shadow: var(--shadow-chunky); }
        .btn-success, #play-again-btn { background-color: var(--blyza-keppel-accent); color: var(--text-light); box-shadow: var(--shadow-chunky); }
        .btn-danger, #reveal-imposter-btn { background-color: var(--blyza-quickfire-red); color: var(--text-light); box-shadow: var(--shadow-chunky); }
        .btn-info, #visit-store-btn { background-color: #4ECDC4; color: var(--text-dark); box-shadow: var(--shadow-chunky); }
        
        /* NEW: Styles for the mode selection buttons */
        .game-mode-selection { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .mode-option {
            background: var(--text-light); padding: 20px; border-radius: var(--border-radius-game);
            cursor: pointer; transition: all 0.3s ease; border: 3px solid var(--black-stroke);
            box-shadow: var(--shadow-chunky); flex: 1; min-width: 250px; max-width: 300px;
        }
        .mode-option:hover { transform: translateY(-5px) scale(1.02); box-shadow: 6px 6px 0 var(--blyza-orange-primary); }
        .mode-option i { font-size: 2.5rem; margin-bottom: 10px; color: var(--blyza-orange-primary); transition: all 0.3s ease; }
        .mode-option h3 { margin-bottom: 8px; font-size: 1.3rem; }
        .mode-option p { color: var(--text-medium); font-size: 0.9rem; }

        /* --- Role Card --- */
        .role-card { perspective: 1000px; width: 280px; height: 350px; margin: 15px auto; }
        .role-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .role-card.flipped .role-card-inner { transform: rotateY(180deg); }
        .role-card-front, .role-card-back {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            background: var(--text-light); border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke); box-shadow: var(--shadow-chunky);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 25px; cursor: pointer;
        }
        .role-card-back { transform: rotateY(180deg); cursor: default; }
        .role-card-front:hover { transform: translateY(-5px) scale(1.02); box-shadow: 6px 6px 0 var(--blyza-orange-primary); }
        .role-card-front p { font-family: var(--font-heading-alt); font-size: 1.2rem; }
        .role-card-back p { font-size: 1rem; color: var(--text-medium); margin-top: 12px; }

        #player-question {
            font-size: 1.1rem; font-weight: 600; color: var(--text-dark);
            font-style: italic; line-height: 1.4; padding: 10px;
            background: rgba(0,0,0,0.05); border-radius: 8px;
            border: 2px dashed var(--blyza-purple-secondary);
        }
        #player-role { font-family: var(--font-logo); font-size: 2.2rem; -webkit-text-stroke: 2px var(--black-stroke); text-stroke: 2px var(--black-stroke); margin-bottom: 15px; }
        .role-imposter { color: var(--blyza-quickfire-red); }
        .role-crewmate { color: var(--blyza-keppel-accent); }
        .role-icon { font-size: 4rem; color: var(--blyza-orange-primary); margin-bottom: 18px; }

        /* --- Player Avatars --- */
        .player-avatars { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; margin: 25px 0; }
        .player-avatar {
            background: var(--text-light); padding: 15px; border-radius: var(--border-radius-game);
            transition: all 0.3s ease; cursor: pointer; border: 3px solid var(--black-stroke);
            box-shadow: var(--shadow-chunky);
        }
        .player-avatar:hover:not(.disabled) { transform: translateY(-4px) scale(1.03); box-shadow: 6px 6px 0 var(--blyza-orange-primary); }
        .player-avatar.selected {
            background: var(--blyza-keppel-accent); color: var(--text-light);
            border-color: var(--black-stroke); box-shadow: 6px 6px 0 var(--black-stroke);
        }
        .player-avatar.selected h4, .player-avatar.selected .avatar-icon { color: var(--text-light); }
        .player-avatar.disabled { opacity: 0.6; cursor: not-allowed; pointer-events: none; }
        .avatar-icon { font-size: 2rem; font-weight: bold; margin: 0 auto 10px; color: var(--blyza-purple-secondary); }
        .player-avatar h4 { font-weight: 700; font-size: 1rem; color: var(--text-dark); }

        /* --- Results & Discussion --- */
        #imposter-reveal, .discussion-info { padding: 18px; background: rgba(0,0,0, 0.1); border-radius: 12px; margin-bottom: 20px; }
        #imposter-reveal h3 { font-family: var(--font-logo); font-size: 2.5rem; margin-bottom: 15px; -webkit-text-stroke: 2px var(--black-stroke); text-stroke: 2px var(--black-stroke); }
        #imposter-avatar-display { font-size: 3.5rem; font-weight: bold; margin: 0 auto 15px; color: var(--blyza-quickfire-red); }
        #imposter-question-reveal-text { font-style: italic; color: var(--blyza-purple-secondary); font-size: 1rem; margin-bottom: 12px; font-weight: 600; }
        #result-message-text { font-size: 1.1rem; font-weight: 600; }
        .result-correct { color: var(--blyza-keppel-accent); }
        .result-incorrect { color: var(--blyza-quickfire-red); }
        .vote-results { display: grid; gap: 15px; margin: 25px 0; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        .vote-card { background: rgba(0,0,0,0.05); padding: 20px; border-radius: 10px; border: 3px solid var(--black-stroke); text-align: left; }
        .vote-card h4 { font-family: var(--font-heading-alt); font-size: 1.1rem; color: var(--blyza-orange-primary); margin-bottom: 5px;}
        .vote-card p { font-size: 1.1rem; font-weight: bold; }
        
        /* --- Helper/Info Text --- */
        .info-text, #current-player-info { margin-bottom: 18px; font-size: 1.1rem; color: var(--text-medium); font-weight: 600; }
        #current-player-info { font-family: var(--font-heading-alt); font-size: 1.3rem; }
        #current-player-info strong { color: var(--blyza-purple-secondary); }

        /* --- Shared Blyza Styles (Icon Buttons, Modals, etc.) --- */
        .icon-btn {
            position: absolute; background-color: var(--blyza-purple-secondary); color: var(--text-light);
            border-radius: 50%; width: 55px; height: 55px; font-size: 1.2rem; cursor: pointer;
            transition: all 0.1s ease; display: flex; justify-content: center; align-items: center;
            z-index: 100; text-decoration: none; border: 3px solid var(--black-stroke);
            box-shadow: var(--shadow-chunky);
        }
        .icon-btn:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        .icon-btn:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        #settings-btn { top: 20px; right: 20px; }
        #home-menu-btn, #back-btn { top: 20px; left: 20px; }
        
        .modal {
            position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); 
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
            animation: fadeInModal 0.3s ease;
        }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }

        .modal-content {
            background-color: var(--darker-grey-bg); margin: auto; padding: 25px;
            border: 3px solid var(--black-stroke); border-radius: var(--border-radius-game);
            width: 90%; max-width: 450px; box-shadow: 8px 8px 0px rgba(0,0,0,0.4);
            position: relative; color: var(--text-light); text-align: center;
        }
        .modal-content h2 {
            font-family: var(--font-logo); color: var(--blyza-orange-primary);
            -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke);
            text-align: center; margin-bottom: 25px; font-size: 2rem;
        }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; }
        .setting-item label { margin-bottom: 10px; font-weight: 600; font-size: 1rem; }
        .close-modal-btn { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-modal-btn:hover { color: var(--text-light); }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: rgba(0,0,0,0.3); border-radius: 5px; border: 2px solid var(--black-stroke); }
        input[type=range]::-webkit-slider-thumb { border: 2px solid var(--black-stroke); height: 22px; width: 22px; border-radius: 50%; background: var(--blyza-orange-primary); cursor: pointer; -webkit-appearance: none; margin-top: -9px; }
        
        #audio-consent-modal .modal-content p {
            font-family: var(--font-body); font-weight: 600; font-size: 1.1rem;
            margin-bottom: 25px; color: var(--text-light);
        }
        #audio-consent-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        
        .feedback-popup {
            position: fixed; top: 50%; left: 50%; background-color: var(--text-dark); color: white;
            padding: 25px 40px; border-radius: var(--border-radius-game);
            font-size: 2.5rem; font-family: var(--font-logo); text-align: center;
            z-index: 2000; box-shadow: 8px 8px 0px rgba(0,0,0,0.5);
            opacity: 0; transform: translate(-50%, -50%) scale(0.7);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none; border: 3px solid var(--black-stroke); display: none;
        }
        .feedback-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); display: block; }
        .feedback-popup.correct { color: var(--blyza-keppel-accent); }
        .feedback-popup.incorrect { color: var(--blyza-quickfire-red); }
        .feedback-popup.info { color: var(--blyza-sunny-yellow); }
        .confetti-piece { position: fixed; width: 8px; height: 15px; background-color: var(--blyza-orange-primary); opacity: 0; animation: fallAndFade 3s linear forwards; pointer-events: none; z-index: 3000; }
        @keyframes fallAndFade { 0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(120vh) rotate(720deg); opacity: 0; } }

        /* Responsive */
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
                align-items: flex-start;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .game-container { 
                padding: 45px 15px 15px; 
                max-height: calc(var(--app-height, 100vh) - 40px);
            } 
            h1 { font-size: 2.2rem; margin-top: 5px; }
            .player-avatars { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); }
            .role-card { width: 230px; height: 280px; }
            .game-over-buttons button { display: block; width: 90%; margin: 10px auto; }
            .icon-btn { width: 48px; height: 48px; }
            #settings-btn { top: 12px; right: 12px; }
            #home-menu-btn, #back-btn { top: 12px; left: 12px; }
            .bg-game-element { display: none; }
        }
    </style>
</head>
<body>
    <!-- Floating background elements -->
    <div class="hero-background-elements">
        <div class="bg-game-element bg-secret-1"><i class="fas fa-user-secret"></i></div>
        <div class="bg-game-element bg-mask-1"><i class="fas fa-mask"></i></div>
        <div class="bg-game-element bg-question-1"><i class="fas fa-question"></i></div>
        <div class="bg-game-element bg-eye-1"><i class="fas fa-eye"></i></div>
        <div class="bg-game-element bg-secret-2"><i class="fas fa-user-secret"></i></div>
        <div class="bg-game-element bg-mask-2"><i class="fas fa-mask"></i></div>
    </div>
    
    <script>
        // THIS SCRIPT MUST RUN FIRST
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>

    <div class="game-container">
        <!-- MODIFIED: The home button now links directly to your main site. -->
       <a href="https://www.playblyza.com/" id="home-menu-btn" class="icon-btn" aria-label="Back to Blyza Home">
            <i class="fas fa-home"></i>
        </a>
        <button id="back-btn" class="icon-btn" aria-label="Go Back">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- NEW: Mode Selection Screen -->
        <div id="mode-selection-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Find The Imposter</h1>
            <p class="instructions" style="border-style: solid; border-width: 2px;">Choose how you want to play!</p>
            <div class="game-mode-selection">
                <div id="local-play-btn" class="mode-option">
                    <i class="fas fa-couch"></i>
                    <h3>Local Play</h3>
                    <p>Play with friends on the same device.</p>
                </div>
                <div id="online-play-btn" class="mode-option">
                    <i class="fas fa-globe"></i>
                    <h3>Online Multiplayer</h3>
                    <p>Play with friends on different devices.</p>
                </div>
            </div>
        </div>

        <!-- Start Screen (Now hidden by default) -->
        <div id="start-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Find The Imposter</h1>
            <div class="instructions">
                <p>HOW TO PLAY</p>
                <ul>
                    <li><i class="fas fa-user-secret"></i> One player is randomly chosen as the Imposter</li>
                    <li><i class="fas fa-question-circle"></i> Everyone gets the same question, except the Imposter, who gets a similar one</li>
                    <li><i class="fas fa-comments"></i> Discuss answers and try to spot the person who doesn't fit in!</li>
                    <li><i class="fas fa-vote-yea"></i> Vote for who you think is the Imposter to win!</li>
                    <li><a href="https://youtu.be/vqHTffHMxbQ" target="_blank" rel="noopener noreferrer">
                            <i class="fab fa-youtube"></i> Watch a video on how to play!
                        </a></li>
                </ul>
            </div>

            <div class="player-inputs">
                <h3>Enter Player Names</h3>
                <p class="info-text" style="margin-top: -10px; margin-bottom:20px;">(3-10 Players)</p>
                <div id="player-names-list"></div>
                <button id="add-player-btn" class="btn-secondary"><i class="fas fa-plus"></i> Add Player</button>
            </div>

            <button id="start-game-btn" class="btn-primary">Start Game <i class="fas fa-play"></i></button>
        </div>

        <!-- Role Assignment Screen -->
        <div id="role-screen" class="screen">
            <h1>Assigning Roles</h1>
            <div id="current-player-info">Pass to <strong>Player 1</strong></div>
            <p class="info-text">Click the card below to reveal your role. Keep it secret!</p>
            <div class="role-card" id="role-card">
                <div class="role-card-inner">
                    <div class="role-card-front">
                        <i class="fas fa-eye role-icon"></i>
                        <p>Click to Reveal</p>
                    </div>
                    <div class="role-card-back">
                        <h3 id="player-role">ROLE</h3>
                        <p id="player-question">Your question will appear here.</p>
                    </div>
                </div>
            </div>
            <button id="next-player-btn" class="btn-primary" disabled>Next Player <i class="fas fa-arrow-right"></i></button>
        </div>

        <!-- Discussion Screen -->
        <div id="discussion-screen" class="screen">
            <h1>Discussion Time</h1>
            <div class="result-card">
                <h2>Discuss Your Answers</h2>
                <div class="discussion-info">
                    <h3>Crewmates' Question:</h3>
                    <p id="crew-question-display">The question for non-imposters appears here.</p>
                </div>
                <h3 style="margin-top: 25px;">Players in Game:</h3>
                <div id="player-list-display" class="player-avatars"></div>
                <p class="info-text" style="margin-top:15px;">Discuss everyone's answers. The imposter needs to blend in!</p>
                <button id="start-voting-btn" class="btn-primary">Start Voting <i class="fas fa-vote-yea"></i></button>
            </div>
        </div>

        <!-- Voting Screen -->
        <div id="voting-screen" class="screen">
             <h1>Cast Your Vote</h1>
             <div class="result-card">
                <h2>Who is the Imposter?</h2>
                <p class="info-text" id="voting-instruction-text">Select the player you suspect is the Imposter.</p>
                <div id="voting-options-display" class="player-avatars"></div>
                <button id="reveal-imposter-btn" class="btn-danger" disabled>Reveal Imposter <i class="fas fa-user-secret"></i></button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over</h1>
            <div class="result-card">
                <h2>Results</h2>
                <div id="imposter-reveal">
                    <h3 id="result-title-text">Result Title</h3>
                    <div id="imposter-avatar-display">?</div>
                    <p id="imposter-name-reveal-text" style="font-size: 1.2rem; margin-top: -10px; margin-bottom: 15px; font-weight: 600;">Imposter: </p>
                    <p id="imposter-question-reveal-text">Imposter's Question: </p>
                    <p id="result-message-text">Result message here.</p>
                </div>
                <h3 style="margin-top:25px;">Voting Summary</h3>
                <div id="vote-results-display" class="vote-results">
                     <div class="vote-card"><h4>Most Voted:</h4><p id="most-voted-player-text">---</p></div>
                     <div class="vote-card"><h4>Actual Imposter:</h4><p id="actual-imposter-text">---</p></div>
                </div>
                <div class="game-over-buttons" style="margin-top: 20px;">
                    <button id="play-again-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                    <button id="new-game-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                    <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Audio Consent Modal -->
    <div id="audio-consent-modal" class="modal">
        <div class="modal-content">
            <h2>Enable Audio?</h2>
            <p>This game has background music and sound effects. Would you like to enable them for the best experience?</p>
            <div id="audio-consent-buttons">
                <button id="audio-consent-yes-btn" class="btn-success"><i class="fas fa-volume-up"></i> Yes, please!</button>
                <button id="audio-consent-no-btn" class="btn-secondary"><i class="fas fa-volume-mute"></i> No, thanks</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">Ã—</span>
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="bgm-volume-slider">Background Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>

    <!-- Feedback Pop-up -->
    <div id="feedback-popup" class="feedback-popup">
        <span id="feedback-message-text-el"></span>
    </div>

    <!-- Audio elements -->
    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="card-flip-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="vote-cast-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="imposter-reveal-correct-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="imposter-reveal-incorrect-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="confetti-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>

    <script>
        // --- GAME STATE AND CONSTANTS ---
        const gameState = { players: [], currentPlayerIndex: 0, imposterIndex: -1, playerVotes: {}, selectedVote: null, crewQuestion: "", imposterQuestion: "", usedQuestionIndices: [], minPlayers: 3, maxPlayers: 10,
            questions: [
                 { crew: "Which player here is most likely to end up in Jail?", imposter: "Which player here is most likely to have 7+ kids?" }, { crew: "Which player here is most likely to break a World Record?", imposter: "Which player here is most likely to break multiple bones?" }, { crew: "Which player here is most likely to date their family member?", imposter: "Which player here is most likely to stay single forever?" }, { crew: "Which player here is most likely to chicken out of a fight?", imposter: "Which player here would you least want as your roommate?" }, { crew: "Which player here is most likely to give the best advice?", imposter: "Which player here is most likely to give the worst advice?" }, { crew: "Which player here is most likely to clog the toilet at a party?", imposter: "Which player here is most likely to burn the kitchen down while cooking?" }, { crew: "Which player here is most likely to laugh the loudest at their own joke?", imposter: "Which player here is most likely to sleep through an apocalypse?" }, { crew: "Which player here is most likely to become internet famous ?", imposter: "Which player here is most likely to join a cult?" }, { crew: "Which player here is most likely to get kicked off an airplane?", imposter: "Which player here is most likely to win a Nobel prize?" }, { crew: "Which player here has the best hairstyle right now?", imposter: "Which player here is most likely to go a week without showering?" }, { crew: "Which player here is most likely to black out after two drinks at a club?", imposter: "Which player here is most likely to bring their toddler to a nightclub?" }, { crew: "What's your dream vacation spot?", imposter: "What city do you think has the stinkiest people?" }, { crew: "What's your all-time favorite movie?", imposter: "What's the most overrated movie you've *never* actually watched?" }, { crew: "If you could permanently delete one website from the internet, what would it be?", imposter: "What's a website you visit often that might surprise people?" }, { crew: "What's one food you would absolutely never have again?", imposter: "What's the most underrated dish to eat?" }, { crew: "Who is your ultimate celebrity crush?", imposter: "Which celebrity do you think is massively overpaid/overrated?" }, { crew: "Realistically, how many miles could you walk right now without stopping?", imposter: "Realistically, how many consecutive push-ups can you do right now?" }, { crew: "What age do you genuinely hope to live until?", imposter: "Quick, pick a number between 35 and 125." }, { crew: "What's the minimum amount of money you'd need in your bank account to retire tomorrow?", imposter: "What's the absolute minimum price you'd sell tasteful pictures of your feet for?" }, { crew: "What's a name you would absolutely give to a beloved pet?", imposter: "What would you name yourself if you were born again?" }, { crew: "What do you think is objectively the easiest sport to play?", imposter: "If you had to go professional in *any* sport, which one would you choose (even if you'd be terrible)?" }, { crew: "What's a drink (alcoholic or non-alcoholic) you would never willingly drink again?", imposter: "What's the most underrated beverage?" }, { crew: "Honestly, how many coordinated 10-year-olds do you think you could defeat in a boxing ring simultaneously?", imposter: "Quick, pick a number between 1 and 200." }, { crew: "Which fictional superhero or supervillain do you think you could realistically defeat in a fight?", imposter: "Which fictional superhero or supervillain do you secretly wish was real?" }
            ]
        };
        let sfxEnabled = true, musicVolume = 0.2, audioContextStarted = false;
        let feedbackTimeout;
        
        // --- DOM ELEMENT SELECTION ---
        // MODIFIED: Added mode-selection-screen to the list of screens
        const screens = { 
            modeSelection: document.getElementById('mode-selection-screen'),
            start: document.getElementById('start-screen'), 
            role: document.getElementById('role-screen'), 
            discussion: document.getElementById('discussion-screen'), 
            voting: document.getElementById('voting-screen'), 
            results: document.getElementById('results-screen') 
        };

        const homeMenuBtn = document.getElementById('home-menu-btn'), backBtn = document.getElementById('back-btn'), playerNamesList = document.getElementById('player-names-list'), addPlayerBtn = document.getElementById('add-player-btn'), startGameBtn = document.getElementById('start-game-btn'), currentPlayerInfo = document.getElementById('current-player-info'), roleCard = document.getElementById('role-card'), playerRoleDisplay = document.getElementById('player-role'), playerQuestionDisplay = document.getElementById('player-question'), nextPlayerBtn = document.getElementById('next-player-btn'), crewQuestionDisplay = document.getElementById('crew-question-display'), playerListDisplay = document.getElementById('player-list-display'), startVotingBtn = document.getElementById('start-voting-btn'), votingOptionsDisplay = document.getElementById('voting-options-display'), revealImposterBtn = document.getElementById('reveal-imposter-btn'), votingInstructionText = document.getElementById('voting-instruction-text'), resultTitleText = document.getElementById('result-title-text'), imposterAvatarDisplay = document.getElementById('imposter-avatar-display'), imposterNameRevealText = document.getElementById('imposter-name-reveal-text'), imposterQuestionRevealText = document.getElementById('imposter-question-reveal-text'), resultMessageText = document.getElementById('result-message-text'), mostVotedPlayerText = document.getElementById('most-voted-player-text'), actualImposterText = document.getElementById('actual-imposter-text'), playAgainBtn = document.getElementById('play-again-btn'), newGameBtn = document.getElementById('new-game-btn'), visitStoreBtn = document.getElementById('visit-store-btn'), settingsBtn = document.getElementById('settings-btn'), settingsModal = document.getElementById('settings-modal'), closeModalBtn = document.getElementById('close-modal-btn'), bgmVolumeSlider = document.getElementById('bgm-volume-slider'), sfxToggleBtn = document.getElementById('sfx-toggle-btn'), backgroundMusic = document.getElementById('background-game-music'), feedbackPopup = document.getElementById('feedback-popup'), feedbackMessageText = document.getElementById('feedback-message-text-el');
        const allSfx = [document.getElementById('start-game-sound'), document.getElementById('interaction-sound'), document.getElementById('card-flip-sound'), document.getElementById('vote-cast-sound'), document.getElementById('imposter-reveal-correct-sound'), document.getElementById('imposter-reveal-incorrect-sound'), document.getElementById('confetti-sound')];
        const audioConsentModal = document.getElementById('audio-consent-modal'), audioConsentYesBtn = document.getElementById('audio-consent-yes-btn'), audioConsentNoBtn = document.getElementById('audio-consent-no-btn');
        
        // NEW: Selectors for the new mode buttons
        const localPlayBtn = document.getElementById('local-play-btn');
        const onlinePlayBtn = document.getElementById('online-play-btn');

        // --- AUDIO & UI FEEDBACK FUNCTIONS ---
        function initAudio() {
            if (audioContextStarted) return;
            backgroundMusic.play().then(() => {
                audioContextStarted = true;
                if (musicVolume <= 0 || document.hidden) {
                    backgroundMusic.pause();
                }
            }).catch(e => { /* Autoplay blocked, wait for user interaction */ });
        }
        function playSound(audio) { if (sfxEnabled && audio && audioContextStarted) { audio.pause(); audio.currentTime = 0; audio.play().catch(e => {}); } }
        function playSoundWithCallback(audio, callback, ...args) { if (sfxEnabled && audio && audioContextStarted) { audio.pause(); audio.currentTime = 0; let cbExecuted = false; const execCb = () => { if (!cbExecuted) { cbExecuted = true; audio.removeEventListener('ended', execCb); if (callback) callback(...args); } }; audio.addEventListener('ended', execCb); audio.play().catch(e => { execCb(); }); } else { if(callback) callback(...args); } }
        function showFeedback(msg, type='info', dur=2500) { feedbackMessageText.textContent=msg; feedbackPopup.className='feedback-popup'; if(type) feedbackPopup.classList.add(type); feedbackPopup.classList.add('show'); clearTimeout(feedbackTimeout); feedbackTimeout=setTimeout(()=>feedbackPopup.classList.remove('show'), dur); }
        function triggerConfetti() { playSound(allSfx[6]); const colors = ['var(--blyza-orange-primary)', 'var(--blyza-purple-secondary)', 'var(--blyza-keppel-accent)']; for (let i=0; i<80; i++) { const c=document.createElement('div'); c.className='confetti-piece'; c.style.left=Math.random()*100+'vw'; c.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)]; const a=Math.random()*2.5+1.5; c.style.animation=`fallAndFade ${a}s linear forwards ${Math.random()*0.8}s`; document.body.appendChild(c); setTimeout(()=>c.remove(), a*1000+1000); } }

        function handleVisibilityChange() {
            if (!audioContextStarted) return;
            if (document.hidden) {
                backgroundMusic.pause();
            } else if (musicVolume > 0) {
                backgroundMusic.play().catch(e => {});
            }
        }
        function handlePageShow(event) {
            if (event.persisted) { // Page restored from bfcache
                setAppHeight(); 
                newGame();
            }
        }
        
        // --- GAME LOGIC FUNCTIONS ---
        // MODIFIED: switchScreen now also handles the home/back buttons.
        function switchScreen(id) { 
            Object.values(screens).forEach(s => s.classList.remove('active')); 
            if(screens[id]) screens[id].classList.add('active'); 
            const isModeSelect = id === 'modeSelection'; 
            const isLocalStart = id === 'start';
            homeMenuBtn.style.display = isModeSelect ? 'flex' : 'none'; 
            backBtn.style.display = isModeSelect ? 'none' : 'flex'; 
        }

        // --- All local game functions remain unchanged below this point ---
        function createPlayerInput(num) { const w = document.createElement('div'); w.className = 'player-input-wrapper'; const i = document.createElement('input'); i.type = 'text'; i.className = 'player-name'; i.placeholder = `Player ${num}`; w.appendChild(i); if (num > gameState.minPlayers) { const r = document.createElement('button'); r.className='remove-player-btn'; r.innerHTML='<i class="fas fa-times"></i>'; r.onclick = ()=>{playSound(allSfx[1]); w.remove(); updateButtons();}; w.appendChild(r); } return w; }
        function addPlayerInput() { if (playerNamesList.children.length >= gameState.maxPlayers) return showFeedback(`Maximum of ${gameState.maxPlayers} players!`, 'info'); playSound(allSfx[1]); playerNamesList.appendChild(createPlayerInput(playerNamesList.children.length + 1)); updateButtons(); }
        function updateButtons() { const count = playerNamesList.children.length; addPlayerBtn.disabled = count >= gameState.maxPlayers; startGameBtn.disabled = count < gameState.minPlayers; playerNamesList.querySelectorAll('.remove-player-btn').forEach(b => b.disabled = count <= gameState.minPlayers); }
        function selectNewQuestion() { let available = Array.from(gameState.questions.keys()).filter(i => !gameState.usedQuestionIndices.includes(i)); if (available.length === 0) { gameState.usedQuestionIndices = []; available = Array.from(gameState.questions.keys()); } const idx = available[Math.floor(Math.random() * available.length)]; gameState.usedQuestionIndices.push(idx); const q = gameState.questions[idx]; gameState.crewQuestion = q.crew; gameState.imposterQuestion = q.imposter; }
        
        function startGame() { const names = Array.from(playerNamesList.querySelectorAll('.player-name')).map(i => i.value.trim()).filter(Boolean); if (names.length < gameState.minPlayers) return showFeedback(`Need at least ${gameState.minPlayers} players!`, 'incorrect'); gameState.players = names; gameState.usedQuestionIndices = []; selectNewQuestion(); gameState.imposterIndex = Math.floor(Math.random() * gameState.players.length); gameState.currentPlayerIndex = 0; gameState.playerVotes = {}; gameState.selectedVote = null; roleCard.classList.remove('flipped'); currentPlayerInfo.innerHTML = `Pass to <strong>${gameState.players[0]}</strong>`; nextPlayerBtn.disabled = true; switchScreen('role'); }
        function flipRoleCard() { if (roleCard.classList.contains('flipped')) return; playSound(allSfx[2]); roleCard.classList.add('flipped'); nextPlayerBtn.disabled = false; const isImposter = gameState.currentPlayerIndex === gameState.imposterIndex; playerRoleDisplay.textContent = isImposter ? 'IMPOSTER' : 'CREWMATE'; playerRoleDisplay.className = isImposter ? 'role-imposter' : 'role-crewmate'; playerQuestionDisplay.textContent = isImposter ? gameState.imposterQuestion : gameState.crewQuestion; }
        function nextPlayer() { if (!roleCard.classList.contains('flipped')) return showFeedback('Please reveal your role!', 'info'); playSound(allSfx[1]); gameState.currentPlayerIndex++; if (gameState.currentPlayerIndex < gameState.players.length) { currentPlayerInfo.innerHTML = `Pass to <strong>${gameState.players[gameState.currentPlayerIndex]}</strong>`; roleCard.classList.remove('flipped'); nextPlayerBtn.disabled = true; } else { setupDiscussion(); switchScreen('discussion'); } }
        function setupDiscussion() { crewQuestionDisplay.textContent = gameState.crewQuestion; playerListDisplay.innerHTML = ''; gameState.players.forEach(p => { const el = document.createElement('div'); el.className = 'player-avatar'; el.innerHTML = `<div class="avatar-icon">${p[0].toUpperCase()}</div><h4>${p}</h4>`; playerListDisplay.appendChild(el); }); }
        function startVoting() { playSound(allSfx[1]); votingOptionsDisplay.innerHTML = ''; gameState.selectedVote = null; revealImposterBtn.disabled = true; votingInstructionText.textContent = "Select the player you suspect is the Imposter."; gameState.players.forEach(p => { const opt = document.createElement('div'); opt.className = 'player-avatar'; opt.dataset.playerName = p; opt.innerHTML = `<div class="avatar-icon">${p[0].toUpperCase()}</div><h4>${p}</h4>`; opt.onclick = handleVote; votingOptionsDisplay.appendChild(opt); }); switchScreen('voting'); }
        function handleVote(e) { playSound(allSfx[3]); document.querySelectorAll('#voting-options-display .selected').forEach(s => s.classList.remove('selected')); e.currentTarget.classList.add('selected'); gameState.selectedVote = e.currentTarget.dataset.playerName; revealImposterBtn.disabled = false; votingInstructionText.textContent = `You are voting for ${gameState.selectedVote}.`; }
        function revealImposter() { if (!gameState.selectedVote) return showFeedback('Please select a player!', 'incorrect'); const mostVoted = gameState.selectedVote; const imposter = gameState.players[gameState.imposterIndex]; const correct = mostVoted === imposter; playSound(correct ? allSfx[4] : allSfx[5]); showFeedback(correct ? 'Imposter Found!' : 'Wrong Guess!', correct ? 'correct' : 'incorrect', 3000); if (correct) triggerConfetti(); resultTitleText.textContent = correct ? 'Imposter Found!' : 'Wrong Guess!'; resultTitleText.style.color = `var(--blyza-${correct?'keppel-accent':'quickfire-red'})`; imposterAvatarDisplay.textContent = imposter[0].toUpperCase(); imposterNameRevealText.innerHTML = `Imposter: <strong style="color:var(--blyza-quickfire-red)">${imposter}</strong>`; imposterQuestionRevealText.textContent = `Imposter's Question: ${gameState.imposterQuestion}`; resultMessageText.textContent = correct ? `The group correctly identified ${imposter}!` : `The group voted for ${mostVoted}, but the imposter was ${imposter}!`; resultMessageText.className = correct ? 'result-correct' : 'result-incorrect'; mostVotedPlayerText.innerHTML = `${mostVoted} <strong style="color:var(--blyza-${correct?'keppel-accent':'quickfire-red'})">(${correct?'Correct':'Incorrect'})</strong>`; actualImposterText.innerHTML = `<strong style="color:var(--blyza-quickfire-red)">${imposter}</strong>`; switchScreen('results'); }
        function playAgain() { playSoundWithCallback(allSfx[0], () => {selectNewQuestion(); gameState.imposterIndex = Math.floor(Math.random() * gameState.players.length); gameState.currentPlayerIndex = 0; gameState.selectedVote = null; currentPlayerInfo.innerHTML = `Pass to <strong>${gameState.players[0]}</strong>`; roleCard.classList.remove('flipped'); nextPlayerBtn.disabled = true; switchScreen('role');}); }
        // MODIFIED: newGame now resets to the mode selection screen.
        function newGame() { playSound(allSfx[1]); playerNamesList.innerHTML = ''; for(let i=0; i<gameState.minPlayers; i++) playerNamesList.appendChild(createPlayerInput(i + 1)); updateButtons(); switchScreen('modeSelection'); }
        
        // --- INITIAL SETUP AND EVENT BINDING ---
        document.addEventListener('DOMContentLoaded', () => { 
            const savedVol = localStorage.getItem('musicVolume'), savedSfx = localStorage.getItem('sfxEnabled');
            if (savedVol !== null) musicVolume = parseFloat(savedVol);
            if (savedSfx !== null) sfxEnabled = savedSfx === 'true';
            backgroundMusic.volume = musicVolume; bgmVolumeSlider.value = musicVolume; sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`;
            
            audioConsentModal.style.display = 'flex';
            
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('pageshow', handlePageShow);
            
            // NEW: Event listeners for the new mode selection buttons
            localPlayBtn.addEventListener('click', () => {
                playSound(allSfx[1]);
                initAudio();
                switchScreen('start');
            });
            onlinePlayBtn.addEventListener('click', () => {
                playSound(allSfx[1]);
                window.location.href = 'https://blyzatest.vercel.app/games/find-the-imposter';
            });

            // OLD event listeners
            settingsBtn.addEventListener('click', () => { playSound(allSfx[1]); settingsModal.style.display = 'flex'; });
            closeModalBtn.addEventListener('click', () => { playSound(allSfx[1]); settingsModal.style.display = 'none'; });
            bgmVolumeSlider.addEventListener('input', (e) => { musicVolume = parseFloat(e.target.value); backgroundMusic.volume = musicVolume; localStorage.setItem('musicVolume', musicVolume); if (musicVolume > 0 && !document.hidden && audioContextStarted) backgroundMusic.play().catch(e=>{}); else backgroundMusic.pause(); });
            sfxToggleBtn.addEventListener('click', () => { sfxEnabled = !sfxEnabled; sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`; playSound(allSfx[1]); localStorage.setItem('sfxEnabled', sfxEnabled); });

            audioConsentYesBtn.addEventListener('click', () => { audioConsentModal.style.display = 'none'; initAudio(); playSound(allSfx[1]); });
            audioConsentNoBtn.addEventListener('click', () => { audioConsentModal.style.display = 'none'; sfxEnabled = false; musicVolume = 0; backgroundMusic.volume = 0; bgmVolumeSlider.value = 0; sfxToggleBtn.textContent = 'SFX: OFF'; localStorage.setItem('sfxEnabled', 'false'); localStorage.setItem('musicVolume', '0'); initAudio(); });

            addPlayerBtn.addEventListener('click', addPlayerInput);
            startGameBtn.addEventListener('click', () => playSoundWithCallback(allSfx[0], startGame));
            roleCard.addEventListener('click', flipRoleCard);
            nextPlayerBtn.addEventListener('click', nextPlayer);
            startVotingBtn.addEventListener('click', startVoting);
            revealImposterBtn.addEventListener('click', revealImposter);
            playAgainBtn.addEventListener('click', playAgain);
            newGameBtn.addEventListener('click', newGame);

            visitStoreBtn.addEventListener('click', () => { playSound(allSfx[1]); window.location.href = '/store'; });
            backBtn.addEventListener('click', newGame);
            
            newGame(); // Call newGame to set the initial screen to mode selection
        });

        // --- CUSTOM SCROLL REDIRECTION LOGIC ---
        const gameContainerForScroll = document.querySelector('.game-container');
        let lastTouchY = 0;

        window.addEventListener('wheel', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                gameContainerForScroll.scrollTop += e.deltaY;
            }
        }, { passive: true });

        window.addEventListener('touchstart', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                if (e.touches.length > 0) {
                    lastTouchY = e.touches[0].clientY;
                }
            }
        }, { passive: true });

        window.addEventListener('touchmove', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                e.preventDefault(); 
                if (e.touches.length > 0) {
                    const currentTouchY = e.touches[0].clientY;
                    const deltaY = lastTouchY - currentTouchY;
                    gameContainerForScroll.scrollTop += deltaY;
                    lastTouchY = currentTouchY;
                }
            }
        }, { passive: false });
        // --- END OF CUSTOM SCROLL LOGIC ---
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-N5PBKM0DNQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N5PBKM0DNQ');
</script>

</body>
</html>