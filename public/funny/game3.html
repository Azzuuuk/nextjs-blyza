<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real or AI - Blyza Game Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- START: BRAND IDENTITY & ROOT VARIABLES --- */
        :root {
            --blyza-orange-primary: #FF8833;
            --blyza-purple-secondary: #cb7ae1;
            --blyza-keppel-accent: #00BFA6;
            --blyza-sunny-yellow: #FFDF00;
            --blyza-quickfire-red: #EA2027;

            --darker-grey-bg: #4A4A4A;
            --text-light: #FDFEFE;
            --text-dark: #2C3A47;
            --text-medium: #535c68;
            --black-stroke: #1A1A1A;

            --font-logo: "Luckiest Guy", cursive;
            --font-heading-alt: "Bungee", cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-radius-game: 12px;
            --shadow-chunky: 4px 4px 0px var(--black-stroke);
        }
        /* --- END: BRAND IDENTITY & ROOT VARIABLES --- */

        /* --- Basic Reset & Body --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        
        /* --- CUSTOM SCROLLING BODY --- */
        body {
            font-family: var(--font-body);
            color: var(--text-light);
            background: linear-gradient(135deg, var(--blyza-orange-primary) 0%, var(--blyza-purple-secondary) 100%);
            line-height: 1.6;
            overflow: hidden; /* Body does not scroll */
            position: relative;
            height: var(--app-height, 100vh); /* Full screen height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- Floating Background Elements --- */
        .hero-background-elements { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
        .bg-game-element {
            position: absolute; opacity: 0.1; color: var(--text-light);
            animation: floatSimple 20s infinite ease-in-out alternate;
            user-select: none;
        }
        .bg-robot-1 { font-size: 140px; top: 10%; left: 5%; --initial-rotate: -15deg; animation-duration: 22s; }
        .bg-brain-1 { font-size: 100px; top: 65%; right: 8%; --initial-rotate: 10deg; animation-duration: 18s; }
        .bg-human-1 { font-size: 120px; top: 70%; left: 15%; --initial-rotate: 5deg; animation-duration: 25s; opacity: 0.08; }
        .bg-camera-1 { font-size: 130px; top: 15%; right: 10%; --initial-rotate: 20deg; animation-duration: 16s; }
        .bg-robot-2 { font-size: 80px; top: 80%; right: 25%; --initial-rotate: 25deg; animation-duration: 15s; }
        .bg-brain-2 { font-size: 120px; bottom: 5%; left: 3%; --initial-rotate: -5deg; animation-duration: 28s; }
        
        @keyframes floatSimple {
            0% { transform: translateY(0px) rotate(var(--initial-rotate, 0deg)); }
            50% { transform: translateY(-25px) rotate(calc(var(--initial-rotate, 0deg) + 8deg)); }
            100% { transform: translateY(0px) rotate(calc(var(--initial-rotate, 0deg) - 8deg)); }
        }
        
        /* --- CUSTOM SCROLLING CONTAINER --- */
        .game-container {
            max-width: 800px;
            width: 100%;
            background: linear-gradient(145deg, #fdfefe, #e9ecef);
            color: var(--text-dark);
            border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke);
            box-shadow: 8px 8px 0px var(--black-stroke);
            padding: 30px; 
            text-align: center;
            position: relative;
            z-index: 2;
            max-height: calc(var(--app-height, 100vh) - 40px); /* Make container scrollable */
            overflow-y: auto;
        }

        .brand-logo-prominent { display: block; margin: 0 auto 15px; max-height: 70px; }
        
        h1 {
            font-family: var(--font-logo); font-size: clamp(2.5rem, 6vw, 3.2rem);
            color: var(--blyza-orange-primary); -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke); text-shadow: 3px 3px 0px rgba(0,0,0,0.15);
            margin-bottom: 20px; line-height: 1.1;
        }
        h3 { font-family: var(--font-heading-alt); font-size: 1.4rem; margin-bottom: 15px; color: var(--blyza-orange-primary); }

        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .active { display: block; }

        /* --- Instructions & Info Panels --- */
        .instructions, .team-inputs {
            background: rgba(0,0,0, 0.04); padding: 20px;
            border-radius: 10px; margin: 25px 0; border: 2px dashed var(--text-medium);
        }
        .instructions p { font-size: 1.1rem; margin-bottom: 15px; font-weight: 600; font-family: var(--font-heading-alt); }
        .instructions ul { list-style-type: none; text-align: left; padding: 0 10px; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: center; }
        .instructions i { margin-right: 15px; font-size: 1.3em; color: var(--blyza-purple-secondary); width: 20px; text-align: center; }
        
        
        /* --- Buttons --- */
        button, .choice-btn {
            font-family: var(--font-heading-alt); font-size: 1.1rem; padding: 0.7em 1.5em;
            border: 3px solid var(--black-stroke); border-radius: 8px;
            text-transform: uppercase; text-decoration: none; display: inline-flex;
            align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            letter-spacing: 1px; cursor: pointer; color: var(--text-dark);
            margin: 8px 5px;
        }
        button:hover:not(:disabled), .choice-btn:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        button:active:not(:disabled), .choice-btn:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        button:disabled, .choice-btn:disabled { background: var(--text-medium) !important; color: var(--text-light) !important; cursor: not-allowed; opacity: 0.7; box-shadow: var(--shadow-chunky); }

        .btn-primary, #start-game-btn, #next-round-btn, #five-rounds-btn, #infinite-mode-btn { background-color: var(--blyza-sunny-yellow); box-shadow: var(--shadow-chunky); }
        .btn-secondary, #add-team-btn, #new-game-menu-btn { background-color: var(--blyza-purple-secondary); color: var(--text-light); box-shadow: var(--shadow-chunky); }
        .btn-success, .choice-btn.btn-success, #play-again-btn { background-color: var(--blyza-keppel-accent); color: var(--text-light); box-shadow: var(--shadow-chunky); }
        .btn-danger, .choice-btn.btn-danger { background-color: var(--blyza-quickfire-red); color: var(--text-light); box-shadow: var(--shadow-chunky); }
        .btn-info, #visit-store-btn { background-color: #4ECDC4; color: var(--text-dark); box-shadow: var(--shadow-chunky); }
        
        .choice-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 20px; flex-wrap: wrap; }
        .choice-btn { flex: 1; max-width: 220px; }
        .choice-btn i { font-size: 1.2rem; }

        /* --- Mode & Team Selection --- */
        .game-mode-selection { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .mode-option {
            background: var(--text-light); padding: 20px; border-radius: var(--border-radius-game);
            cursor: pointer; transition: all 0.3s ease; border: 3px solid var(--black-stroke);
            box-shadow: var(--shadow-chunky); flex: 1; min-width: 250px; max-width: 300px;
        }
        .mode-option:hover { transform: translateY(-5px) scale(1.02); box-shadow: 6px 6px 0 var(--blyza-orange-primary); }
        .mode-option.selected { background: var(--blyza-keppel-accent); color: var(--text-light); border-color: var(--black-stroke); transform: scale(1.02); box-shadow: 6px 6px 0 var(--black-stroke); }
        .mode-option.selected i, .mode-option.selected h3, .mode-option.selected p { color: var(--text-light); }
        .mode-option i { font-size: 2.5rem; margin-bottom: 10px; color: var(--blyza-orange-primary); transition: all 0.3s ease; }
        .mode-option h3 { margin-bottom: 8px; font-size: 1.2rem; font-family: var(--font-heading-alt); }
        .mode-option p { color: var(--text-medium); font-size: 0.9rem; }
        .team-input-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .team-input-wrapper input {
            width: 100%; padding: 12px 18px; border-radius: 8px;
            border: 3px solid var(--black-stroke); background: var(--text-light);
            color: var(--text-dark); font-size: 1rem; transition: all 0.3s ease;
            font-family: var(--font-body); font-weight: 600;
        }
        .team-input-wrapper input:focus { outline: none; border-color: var(--blyza-orange-primary); box-shadow: 0 0 0 3px var(--blyza-sunny-yellow); }
        .remove-team-btn { padding: 8px 12px !important; font-size: 0.8rem !important; margin: 0; background: var(--blyza-quickfire-red); color: var(--text-light); }
        .remove-team-btn:hover { background: #c0392b; }

        /* --- Game Screen & Stage --- */
        .game-info {
            display: flex; justify-content: center; align-items: center; flex-wrap: wrap;
            gap: 20px; margin-bottom: 15px;
            background: rgba(0,0,0,0.1); padding: 10px 15px;
            border-radius: 8px; font-size: 1.1rem; font-family: var(--font-heading-alt);
            color: var(--text-dark); border: 2px solid var(--black-stroke);
        }
        #turn-indicator {
            font-size: 1.2rem; color: var(--blyza-purple-secondary);
            margin: -10px auto 10px auto; font-family: var(--font-heading-alt);
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
        }
        .item-stage-container {
            background: var(--darker-grey-bg); padding: 20px; border-radius: var(--border-radius-game);
            margin-bottom: 25px; border: 3px solid var(--black-stroke);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        }
        .stage-curtains {
            position: absolute; top: 0; width: 51%; height: 100%; background-color: var(--text-dark);
            background-image: repeating-linear-gradient(90deg, transparent, transparent 20px, rgba(255,255,255,0.03) 20px, rgba(255,255,255,0.03) 40px);
            box-shadow: 0 0 25px rgba(0,0,0,0.6); transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1); z-index: 5;
        }
        .stage-curtains.left { left: 0; border-right: 6px solid var(--blyza-orange-primary); }
        .stage-curtains.right { right: 0; border-left: 6px solid var(--blyza-orange-primary); }
        .stage-curtains.open.left { transform: translateX(-105%) skewX(-10deg); }
        .stage-curtains.open.right { transform: translateX(105%) skewX(10deg); }
        .tv-screen-container {
            background: #111; border: 10px solid #333; border-radius: 15px; padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative; z-index: 1; min-height: 300px; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .tv-screen-container h3 { font-family: var(--font-logo); color: var(--blyza-sunny-yellow); -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke); font-size: 1.6rem; margin-bottom: 15px; }
        .media-content { max-width: 100%; max-height: 350px; height: auto; display: block; margin: 0 auto 10px; border-radius: 12px; opacity: 0; transition: opacity 0.5s 0.2s ease-in-out; }
        .media-content.visible { opacity: 1; }
        .media-description { font-style: italic; color: var(--blyza-purple-secondary); margin-bottom: 12px; font-size: 1.1rem; font-weight: 600; opacity: 0; transition: opacity 0.5s 0.3s ease-in-out; }
        .media-description.visible { opacity: 1; }

        /* --- Results & Score --- */
        .result-item-display { background: rgba(0,0,0, 0.1); padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 3px solid var(--black-stroke); box-shadow: var(--shadow-chunky); }
        .result-item-display .media-content { max-height: 250px; margin-bottom: 10px; border-radius: 8px; }
        .answer-display { font-size: 1.5rem; font-family: var(--font-logo); padding: 12px 18px; border-radius: 10px; margin-top: 15px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; border: 3px solid var(--black-stroke); }
        .answer-display i { font-size: 1.6rem; }
        .answer-real { color: var(--text-light); background-color: var(--blyza-keppel-accent); text-shadow: 1px 1px var(--black-stroke); }
        .answer-ai { color: var(--text-light); background-color: var(--blyza-quickfire-red); text-shadow: 1px 1px var(--black-stroke); }
        .feedback-summary { font-size: 1.2rem; font-weight: bold; padding: 10px 15px; border-radius: 8px; margin-top: 10px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; border: 3px solid; }
        .feedback-summary i { font-size: 1.3rem; }
        .feedback-correct { color: var(--blyza-keppel-accent); border-color: var(--blyza-keppel-accent); }
        .feedback-incorrect { color: var(--blyza-quickfire-red); border-color: var(--blyza-quickfire-red); }
        .detailed-feedback-area { margin-top: 20px; text-align: left; }
        .player-feedback-entry { background: rgba(0,0,0,0.03); padding: 10px 15px; border-radius: 8px; margin-bottom: 8px; font-size: 0.9rem; font-weight: 600; border-left: 5px solid; }
        .player-feedback-entry.correct { border-color: var(--blyza-keppel-accent); }
        .player-feedback-entry.incorrect { border-color: var(--blyza-quickfire-red); }
        .score-display { display: grid; gap: 15px; margin: 25px 0; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
        .score-card { background: rgba(0,0,0,0.05); padding: 18px; border-radius: 10px; border: 3px solid var(--black-stroke); box-shadow: var(--shadow-chunky); }
        .score-card h4 { font-size: 1.1rem; margin-bottom: 8px; font-family: var(--font-heading-alt); }
        .score-value { font-size: 2rem; color: var(--blyza-orange-primary); font-family: var(--font-heading-alt); }
        .progress-bar { height: 12px; background: rgba(0,0,0,0.2); border-radius: 50px; margin-top: 12px; overflow: hidden; border: 2px solid var(--black-stroke); }
        .progress-fill { height: 100%; background: var(--blyza-sunny-yellow); border-radius: 50px; transition: width 0.5s ease; }
        .score-card.winner-glow { animation: winnerGlow 1.5s infinite alternate; border-color: var(--blyza-keppel-accent); }
        @keyframes winnerGlow { from { box-shadow: 4px 4px 0 var(--blyza-keppel-accent); } to { box-shadow: 4px 4px 15px var(--blyza-keppel-accent); } }

        /* --- Game Over --- */
        .win-message { font-family: var(--font-logo); font-size: 2.5rem; margin: 25px 0; color: var(--blyza-orange-primary); -webkit-text-stroke: 2px var(--black-stroke); text-stroke: 2px var(--black-stroke); }
        .winner-trophy { font-size: 5rem; margin: 20px 0 25px; animation: bounceTrophy 2s infinite; color: var(--blyza-sunny-yellow); text-shadow: 0 0 20px var(--blyza-orange-primary), 3px 3px 0 var(--black-stroke); }
        @keyframes bounceTrophy { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        #final-message-details-el { font-size: 1.1rem; margin-bottom: 25px; color: var(--text-medium); font-weight: 600; }
        .game-over-buttons-container { display: flex; justify-content: center; align-items: flex-start; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        
        /* --- Shared Blyza Styles --- */
        .icon-btn { position: absolute; background-color: var(--blyza-purple-secondary); color: var(--text-light); border-radius: 50%; width: 55px; height: 55px; font-size: 1.2rem; cursor: pointer; transition: all 0.1s ease; display: flex; justify-content: center; align-items: center; z-index: 100; text-decoration: none; border: 3px solid var(--black-stroke); box-shadow: var(--shadow-chunky); }
        .icon-btn:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        .icon-btn:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        #settings-btn { top: 20px; right: 20px; }
        #highscore-btn { top: 20px; right: 85px; background-color: var(--blyza-sunny-yellow); }
        #home-menu-btn, #back-btn { top: 20px; left: 20px; }
        
        .modal { position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; animation: fadeInModal 0.3s ease; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background-color: var(--darker-grey-bg); margin: auto; padding: 25px; border: 3px solid var(--black-stroke); border-radius: var(--border-radius-game); width: 90%; max-width: 450px; box-shadow: 8px 8px 0px rgba(0,0,0,0.4); position: relative; color: var(--text-light); text-align: center; }
        .modal-content h2 { font-family: var(--font-logo); color: var(--blyza-orange-primary); -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke); text-align: center; margin-bottom: 25px; font-size: 2rem; }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; }
        .setting-item label { margin-bottom: 10px; font-weight: 600; font-size: 1rem; }
        .close-modal-btn { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-modal-btn:hover { color: var(--text-light); }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: rgba(0,0,0,0.3); border-radius: 5px; border: 2px solid var(--black-stroke); }
        input[type=range]::-webkit-slider-thumb { border: 2px solid var(--black-stroke); height: 22px; width: 22px; border-radius: 50%; background: var(--blyza-orange-primary); cursor: pointer; -webkit-appearance: none; margin-top: -9px; }
        
        #audio-consent-modal .modal-content p { font-family: var(--font-body); font-weight: 600; font-size: 1.1rem; margin-bottom: 25px; color: var(--text-light); }
        #audio-consent-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        
        .feedback-popup { position: fixed; top: 50%; left: 50%; background-color: var(--text-dark); color: white; padding: 25px 40px; border-radius: var(--border-radius-game); font-size: 2.5rem; font-family: var(--font-logo); text-align: center; z-index: 2000; box-shadow: 8px 8px 0px rgba(0,0,0,0.5); opacity: 0; transform: translate(-50%, -50%) scale(0.7); transition: opacity 0.3s ease, transform 0.3s ease; pointer-events: none; border: 3px solid var(--black-stroke); display: none; }
        .feedback-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); display: block; }
        .feedback-popup.correct { color: var(--blyza-keppel-accent); }
        .feedback-popup.incorrect { color: var(--blyza-quickfire-red); }
        .feedback-popup.info { color: var(--blyza-sunny-yellow); }
        .confetti-piece { position: fixed; width: 8px; height: 15px; background-color: var(--blyza-orange-primary); opacity: 0; animation: fallAndFade 3s linear forwards; pointer-events: none; z-index: 3000; }
        @keyframes fallAndFade { 0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(120vh) rotate(720deg); opacity: 0; } }

        /* Responsive */
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
                align-items: flex-start;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .game-container { 
                padding: 45px 15px 15px; 
                max-height: calc(var(--app-height, 100vh) - 40px);
            } 
            h1 { font-size: 2.2rem; margin-top: 5px; }
            .game-mode-selection { flex-direction: column; align-items: center; }
            .mode-option { max-width: 100%; }
            .choice-buttons { flex-direction: column; align-items: center; }
            .choice-btn { width: 90%; max-width: 90%; }
            .game-over-buttons-container { flex-direction: column; align-items: center; width: 100%; }
            .game-over-buttons-container button { width: 90%; }
            .icon-btn { width: 48px; height: 48px; }
            #settings-btn { top: 12px; right: 12px; }
            #highscore-btn { top: 12px; right: 70px; }
            #home-menu-btn, #back-btn { top: 12px; left: 12px; }
            .bg-game-element { display: none; }
        }
    </style>
</head>
<body>
    <div class="hero-background-elements">
        <div class="bg-game-element bg-robot-1"><i class="fas fa-robot"></i></div>
        <div class="bg-game-element bg-brain-1"><i class="fas fa-brain"></i></div>
        <div class="bg-game-element bg-human-1"><i class="fas fa-male"></i></div>
        <div class="bg-game-element bg-camera-1"><i class="fas fa-camera-retro"></i></div>
        <div class="bg-game-element bg-robot-2"><i class="fas fa-robot"></i></div>
        <div class="bg-game-element bg-brain-2"><i class="fas fa-brain"></i></div>
    </div>
    
    <script>
        // THIS SCRIPT MUST RUN FIRST
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>

    <div class="game-container">
       <a href="#" onclick="history.back(); return false;" id="home-menu-btn" class="icon-btn" aria-label="Back to the previous page">
            <i class="fas fa-home"></i>
        </a>
        <button id="back-btn" class="icon-btn" aria-label="Go Back" style="display: none;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="highscore-btn" class="icon-btn" aria-label="Show High Score">
            <i class="fas fa-star"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Real or AI</h1>
            <div class="instructions">
                <p>HOW TO PLAY</p>
                <ul>
                    <li><i class="fas fa-image"></i> You'll see an image or video</li>
                    <li><i class="fas fa-brain"></i> Decide if it's real or AI-generated</li>
                    <li><i class="fas fa-check-circle"></i> Get 1 point for each correct guess</li>
                    <li><i class="fas fa-users"></i> Play solo or with up to 4 teams!</li>
                </ul>
            </div>
            <div class="game-mode-selection">
                <div class="mode-option selected" data-mode="single">
                    <i class="fas fa-user"></i>
                    <h3>Single Player</h3>
                    <p>5 rounds or infinite mode</p>
                </div>
                <div class="mode-option" data-mode="multi">
                    <i class="fas fa-users"></i>
                    <h3>Multiplayer</h3>
                    <p>Up to 4 teams</p>
                </div>
            </div>
            
            <div id="single-player-sub-options" style="margin-top: 15px;">
                <button id="five-rounds-btn" class="btn-primary"><i class="fas fa-list-ol"></i> 5 Rounds</button>
                <button id="infinite-mode-btn" class="btn-primary"><i class="fas fa-infinity"></i> Infinite Mode</button>
            </div>

            <div id="multiplayer-start-area" style="display: none;">
                <div id="team-inputs-container">
                    <div class="team-inputs">
                        <h3>Enter Team Names</h3>
                        <div id="team-names-list">
                            <div class="team-input-wrapper">
                                <input type="text" class="team-name-input" placeholder="Team 1">
                            </div>
                            <div class="team-input-wrapper">
                                <input type="text" class="team-name-input" placeholder="Team 2">
                            </div>
                        </div>
                        <button id="add-team-btn" class="btn-secondary">Add Team</button>
                    </div>
                </div>
                <button id="start-game-btn" class="btn-primary">Start Game <i class="fas fa-play"></i></button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-info">
                <div id="round-info-text">Round <span id="round-number-el">1</span>/5</div>
                <div id="score-info-text">Score: <span id="current-score-el">0</span></div>
            </div>
            <div id="turn-indicator" style="display: none;"></div>
            <div class="item-stage-container">
                <div class="stage-curtains left"></div>
                <div class="stage-curtains right"></div>
                <div class="tv-screen-container">
                    <h3>Is this Real or AI?</h3>
                    <div id="media-description-el" class="media-description">Description</div>
                    <img id="media-image-el" src="" alt="Media to identify" class="media-content">
                    <video id="media-video-el" controls muted loop playsinline class="media-content"></video>
                </div>
            </div>
            <div class="choice-buttons">
                <button id="real-btn" class="choice-btn btn-success"><i class="fas fa-check-circle"></i> Real</button>
                <button id="ai-btn" class="choice-btn btn-danger"><i class="fas fa-robot"></i> AI</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <h1>Round Result</h1>
            <div class="result-item-display">
                <img id="result-image-el" src="" alt="Result media" class="media-content">
                <video id="result-video-el" controls muted loop playsinline class="media-content"></video>
                <div id="answer-display-el" class="answer-display"></div>
                <div id="feedback-summary-el" class="feedback-summary"></div>
            </div>
            <div id="detailed-feedback-area-el" class="detailed-feedback-area" style="display: none;"></div>
            <div id="round-score-display-el" class="score-display"></div>
            <button id="next-round-btn" class="btn-primary">Next Round <i class="fas fa-arrow-right"></i></button>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="screen">
             <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over!</h1>
            <div id="win-message-text-el" class="win-message">Results!</div>
            <div id="winner-trophy-el" class="winner-trophy">üèÜ</div>
            <div id="final-message-details-el">Your final tally.</div>
            <div id="final-score-display-el" class="score-display"></div>
            <div class="game-over-buttons-container">
                <button id="play-again-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                <button id="new-game-menu-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
            </div>
        </div>
    </div>
    
    <!-- Audio Consent Modal -->
    <div id="audio-consent-modal" class="modal">
        <div class="modal-content">
            <h2>Enable Audio?</h2>
            <p>This game has background music and sound effects. Would you like to enable them for the best experience?</p>
            <div id="audio-consent-buttons">
                <button id="audio-consent-yes-btn" class="btn-success"><i class="fas fa-volume-up"></i> Yes, please!</button>
                <button id="audio-consent-no-btn" class="btn-secondary"><i class="fas fa-volume-mute"></i> No, thanks</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal & Feedback Popup -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">√ó</span>
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="bgm-volume-slider">Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>
    <div id="feedback-popup" class="feedback-popup"><span id="feedback-message-text-el"></span></div>
    
    <!-- Audio Elements -->
    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="correct-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="incorrect-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="curtain-sound" src="https://static.wixstatic.com/mp3/9ce3e5_ccd36cdf98bf4e1594cf2e52d5296c51.wav"></audio> 
    <audio id="confetti-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>
    
    <script>
        // --- GAME STATE AND CONSTANTS ---
        const gameState = { gameMode: 'single', singlePlayerSubType: '5rounds', players: [], scores: {}, currentRound: 0, maxRounds: 5, currentMedia: null, usedItems: [], currentPlayerIndexInRound: 0, roundPlayerChoices: {}, singlePlayerChoice: null,
            mediaItems: [
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_d76ca16cd1db4a6da7d6292106a05590~mv2.jpg", description: "Popstar", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_df76be4f583d4f3e9a28dd3bd2c29510~mv2.jpg", description: "Master Oogway", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_8cf5eac3afde48ccab0a4b0c5a98dff6~mv2.png", description: "2.6 Million Dollar Mansion", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_52c88e7ede90479e9a22f96402606ca7~mv2.png", description: "What they lookin at?", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_bf87f7d4df874b408b8951c097206815~mv2.webp", description: "Maroon 5 concert", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_fab2c9bbd5b7483997e21730454bdf91~mv2.png", description: "Street photography", isAI: true }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_dad23f0a7a114f20ae21fe809b01be11/1080p/mp4/file.mp4", description: "Jelly", isAI: true }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_6ad18c17069842519f5ab861d920c365/1080p/mp4/file.mp4", description: "Love the beach", isAI: false }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_e39cfbcaee614f1b90c82cf2a881b7a4/1080p/mp4/file.mp4", description: "YUUMMMM", isAI: true }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_10b41ddbc09f481c8de2bdf59a02cefb/1080p/mp4/file.mp4", description: "Climbed that", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_92ef479506ab405aacddff5802111667~mv2.jpg", description: "Technologia", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_24e52e5bf9a14a7994be19537fb33dd2~mv2.jpg", description: "Sky full of stars", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_3dab047a6fcc4f8d97a73d41bb79c761~mv2.jpg", description: "Post Hike", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_b6a751547d6f48ea9b484f4c05409ad9~mv2.webp", description: "Space Invasion?", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_de96da45b2214773b27a35e58dcd7ea3~mv2.webp", description: "Adorablee", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_5c02118aa9cd4d8eb22e7621c155cd6a~mv2.webp", description: "Yumm", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_9cbcd84aa0634d9bb7d8ef14e3df8d4d~mv2.webp", description: "Future winter Olympian", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_f8226cd46b144ae3af8a91dff52cfcdd~mv2.png", description: "Sunkissed", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_f62a99e9d5b24e5587079d32ab023855~mv2.png", description: "Every wallpaper in 2013", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_160fdd4b9e8748e7ae0322524a350e04~mv2.png", description: "Sahara", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_d785956c74ee4e62b8eb7d80e56499ed~mv2.png", description: "Everybody's childhood crush", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_214a8f44c9b0446bbe197e95185f28de~mv2.png", description: "Oranges", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_e0f42595978145cc926f661e873258e6~mv2.png", description: "Family pic", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_1593625b415c49639afd56cb7589063b~mv2.webp", description: "Golden State", isAI: true }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_64edf447f7c8472db0696145d04d817e/1080p/mp4/file.mp4", description: "Aspiring videographer", isAI: true }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_a287874449c34b02bed1968be7adc58f/1080p/mp4/file.mp4", description: "Bloooom", isAI: true }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_f4dd37888eec481dac346561454c6529/1080p/mp4/file.mp4", description: "I wanna go there", isAI: true }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_9bd6c1e8834b401bbf7aae87c201afa4/1080p/mp4/file.mp4", description: "Bloom Bloom", isAI: false }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_6a0da61044284d8686ae7e8d3bbfa17d/1080p/mp4/file.mp4", description: "where is this?", isAI: false }, { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_2976d3ab2dbd4675bb0b46c506055548/1080p/mp4/file.mp4", description: "Lapsie", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_3eb1495d90d84c33b19fe5c344674f5b~mv2.jpg", description: "Pretty frog", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_02b2a4f6170247709f467fe700452dd4~mv2.jpg", description: "HK Skyline", isAI: false }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_f004a01f1c72414a92588affdb63db75~mv2.jpg", description: "Egyptian Papyrus", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_8e623916fdfe40d2bc495400da325b3b~mv2.jpg", description: "Rocket Launch", isAI: true }, { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_68ff6b1ec9c945e4ad0c9c0192be7e67~mv2.jpg", description: "It's a Pangolin", isAI: true },
             ]
        };
        let sfxEnabled = true, musicVolume = 0.2, audioContextStarted = false, infiniteHighScore = 0;
        let feedbackTimeout;
        
        const screens = { start: document.getElementById('start-screen'), game: document.getElementById('game-screen'), results: document.getElementById('results-screen'), gameOver: document.getElementById('game-over-screen') };
        const homeMenuBtn = document.getElementById('home-menu-btn'), backBtn = document.getElementById('back-btn'), modeOptions = document.querySelectorAll('.mode-option'), teamInputsContainer = document.getElementById('team-inputs-container'), teamNamesList = document.getElementById('team-names-list'), addTeamBtn = document.getElementById('add-team-btn'), startGameBtn = document.getElementById('start-game-btn'), roundInfoText = document.getElementById('round-info-text'), scoreInfoText = document.getElementById('score-info-text'), turnIndicator = document.getElementById('turn-indicator'), roundNumberEl = document.getElementById('round-number-el'), currentScoreEl = document.getElementById('current-score-el'), mediaDescriptionEl = document.getElementById('media-description-el'), mediaImageEl = document.getElementById('media-image-el'), mediaVideoEl = document.getElementById('media-video-el'), realBtn = document.getElementById('real-btn'), aiBtn = document.getElementById('ai-btn'), leftCurtain = document.querySelector('.stage-curtains.left'), rightCurtain = document.querySelector('.stage-curtains.right'), resultImageEl = document.getElementById('result-image-el'), resultVideoEl = document.getElementById('result-video-el'), answerDisplayEl = document.getElementById('answer-display-el'), feedbackSummaryEl = document.getElementById('feedback-summary-el'), detailedFeedbackAreaEl = document.getElementById('detailed-feedback-area-el'), roundScoreDisplayEl = document.getElementById('round-score-display-el'), nextRoundBtn = document.getElementById('next-round-btn'), winMessageTextEl = document.getElementById('win-message-text-el'), winnerTrophyEl = document.getElementById('winner-trophy-el'), finalMessageDetailsEl = document.getElementById('final-message-details-el'), finalScoreDisplayEl = document.getElementById('final-score-display-el'), playAgainBtn = document.getElementById('play-again-btn'), newGameMenuBtn = document.getElementById('new-game-menu-btn'), visitStoreBtn = document.getElementById('visit-store-btn'), settingsBtn = document.getElementById('settings-btn'), settingsModal = document.getElementById('settings-modal'), closeModalBtn = document.getElementById('close-modal-btn'), bgmVolumeSlider = document.getElementById('bgm-volume-slider'), sfxToggleBtn = document.getElementById('sfx-toggle-btn'), backgroundMusic = document.getElementById('background-game-music'), feedbackPopup = document.getElementById('feedback-popup'), feedbackMessageTextEl = document.getElementById('feedback-message-text-el');
        const allSfx = [document.getElementById('start-game-sound'), document.getElementById('interaction-sound'), document.getElementById('correct-answer-sound'), document.getElementById('incorrect-answer-sound'), document.getElementById('curtain-sound'), document.getElementById('confetti-sound')];
        const highscoreBtn = document.getElementById('highscore-btn');
        const singlePlayerSubOptions = document.getElementById('single-player-sub-options');
        const multiplayerStartArea = document.getElementById('multiplayer-start-area');
        const fiveRoundsBtn = document.getElementById('five-rounds-btn');
        const infiniteModeBtn = document.getElementById('infinite-mode-btn');
        const audioConsentModal = document.getElementById('audio-consent-modal'), audioConsentYesBtn = document.getElementById('audio-consent-yes-btn'), audioConsentNoBtn = document.getElementById('audio-consent-no-btn');

        // --- AUDIO & UI FEEDBACK FUNCTIONS ---
        function initAudio() {
            if (audioContextStarted) return;
            backgroundMusic.play().then(() => {
                audioContextStarted = true;
                if (musicVolume <= 0 || document.hidden) {
                    backgroundMusic.pause();
                }
            }).catch(e => { /* Autoplay blocked, wait for user interaction */ });
        }
        function playSound(audio) { if (sfxEnabled && audio && audioContextStarted) { audio.pause(); audio.currentTime = 0; audio.play().catch(e => {}); } }
        function playSoundWithCallback(audio, callback, ...args) { if (sfxEnabled && audio && audioContextStarted) { audio.pause(); audio.currentTime = 0; let cbExecuted = false; const execCb = () => { if (!cbExecuted) { cbExecuted = true; audio.removeEventListener('ended', execCb); if (callback) callback(...args); } }; audio.addEventListener('ended', execCb); audio.play().catch(e => { execCb(); }); } else { if(callback) callback(...args); } }
        function showFeedback(msg, type='info', dur=2200) { feedbackMessageTextEl.textContent=msg; feedbackPopup.className='feedback-popup'; if(type) feedbackPopup.classList.add(type); feedbackPopup.classList.add('show'); clearTimeout(feedbackTimeout); feedbackTimeout=setTimeout(()=>feedbackPopup.classList.remove('show'), dur); }
        function triggerConfetti() { playSound(allSfx[5]); const colors = ['var(--blyza-orange-primary)', 'var(--blyza-purple-secondary)', 'var(--blyza-keppel-accent)']; for (let i=0; i<80; i++) { const c=document.createElement('div'); c.className='confetti-piece'; c.style.left=Math.random()*100+'vw'; c.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)]; const a=Math.random()*2.5+1.5; c.style.animation=`fallAndFade ${a}s linear forwards ${Math.random()*0.8}s`; document.body.appendChild(c); setTimeout(()=>c.remove(), a*1000+1000); } }
        function loadHighScore() { const savedScore = localStorage.getItem('roa_infinite_highscore'); infiniteHighScore = savedScore ? parseInt(savedScore, 10) : 0; }
        function saveHighScore(score) { if (score > infiniteHighScore) { infiniteHighScore = score; localStorage.setItem('roa_infinite_highscore', infiniteHighScore); } }
        function showHighScore() { playSound(allSfx[1]); showFeedback(`Infinite High Score: ${infiniteHighScore}`, 'info', 3000); }
        
        function handleVisibilityChange() {
            if (!audioContextStarted) return;
            if (document.hidden) {
                backgroundMusic.pause();
                mediaVideoEl.pause();
                resultVideoEl.pause();
            } else if (musicVolume > 0) {
                backgroundMusic.play().catch(e => {});
            }
        }
        function handlePageShow(event) {
            if (event.persisted) { // Page restored from bfcache
                setAppHeight(); 
                newGameMenuBtn.click();
            }
        }
        
        function switchScreen(id) { Object.values(screens).forEach(s => s.classList.remove('active')); screens[id].classList.add('active'); const isStart = id === 'start'; homeMenuBtn.style.display = isStart ? 'flex' : 'none'; backBtn.style.display = isStart ? 'none' : 'flex'; }
        
        function startSinglePlayerGame(subType) {
            gameState.singlePlayerSubType = subType; 
            playSoundWithCallback(allSfx[0], actualStartGame);
        }
        
        function actualStartGame() { 
            gameState.currentRound=0; gameState.usedItems=[]; gameState.scores={}; 
            if(gameState.gameMode === 'single') { 
                gameState.players = ['You']; 
            } else { 
                gameState.players = Array.from(teamNamesList.querySelectorAll('.team-name-input')).map((i,idx)=>i.value.trim()||`Team ${idx+1}`); 
                if(gameState.players.length < 2) return showFeedback('Multiplayer needs at least 2 teams!', 'incorrect'); 
            } 
            gameState.players.forEach(p => gameState.scores[p]=0); 
            nextRoundBtn.innerHTML='Next Round <i class="fas fa-arrow-right"></i>'; 
            setupRound(); 
        }

        function setupRound() {
            if (gameState.gameMode === 'single' && gameState.singlePlayerSubType === '5rounds' && gameState.currentRound >= gameState.maxRounds) {
                return showGameOver();
            }
            gameState.currentRound++;
            
            leftCurtain.classList.remove('open'); rightCurtain.classList.remove('open');
            [mediaImageEl, mediaVideoEl, mediaDescriptionEl].forEach(el=>el.classList.remove('visible'));
            
            let available = gameState.mediaItems.filter(i => !gameState.usedItems.includes(i.url));
            if (available.length===0) {
                if (gameState.singlePlayerSubType === 'infinite') {
                    return showGameOver(true); // Beat the game
                }
                gameState.usedItems=[]; 
                available=[...gameState.mediaItems];
            }
            gameState.currentMedia = available[Math.floor(Math.random()*available.length)];
            gameState.usedItems.push(gameState.currentMedia.url);
            
            gameState.singlePlayerChoice=null; gameState.roundPlayerChoices={}; gameState.currentPlayerIndexInRound=0;
            
            if (gameState.gameMode==='single'){
                turnIndicator.style.display='none';
                if (gameState.singlePlayerSubType === 'infinite') {
                    roundInfoText.style.display = 'none';
                    scoreInfoText.style.display = 'block';
                    scoreInfoText.innerHTML = `Score: <span id="current-score-el">${gameState.scores[gameState.players[0]]}</span>`;
                } else {
                    roundInfoText.style.display = 'block';
                    scoreInfoText.style.display = 'block';
                    roundInfoText.innerHTML = `Round <span id="round-number-el">${gameState.currentRound}</span>/${gameState.maxRounds}`;
                    scoreInfoText.innerHTML = `Score: <span id="current-score-el">${gameState.scores[gameState.players[0]]}</span>`;
                }
            } else {
                scoreInfoText.style.display='none';
                turnIndicator.style.display='block';
                roundInfoText.style.display = 'block';
                roundInfoText.innerHTML = `Round <span id="round-number-el">${gameState.currentRound}</span>`;
                updateTurnIndicator();
            }

            mediaDescriptionEl.textContent=gameState.currentMedia.description;
            mediaImageEl.style.display='none'; mediaVideoEl.style.display='none'; mediaVideoEl.pause(); mediaVideoEl.currentTime=0;
            if(gameState.currentMedia.type==='image'){mediaImageEl.src=gameState.currentMedia.url;}else{mediaVideoEl.src=gameState.currentMedia.url;}
            realBtn.disabled=false; aiBtn.disabled=false;
            
            switchScreen('game');
            setTimeout(()=>{playSound(allSfx[4]); leftCurtain.classList.add('open'); rightCurtain.classList.add('open'); setTimeout(()=>{if(gameState.currentMedia.type==='image'){mediaImageEl.style.display='block'; mediaImageEl.classList.add('visible');}else{mediaVideoEl.style.display='block'; mediaVideoEl.classList.add('visible'); if(!document.hidden) mediaVideoEl.play().catch(e=>{});} mediaDescriptionEl.classList.add('visible');}, 700);}, 300);
        }

        function updateTurnIndicator() { if (gameState.gameMode === 'multi') turnIndicator.textContent = `${gameState.players[gameState.currentPlayerIndexInRound]}'s turn:`; }
        function makeChoice(choice) { playSound(allSfx[1]); realBtn.disabled = true; aiBtn.disabled = true; if (gameState.gameMode === 'single') { gameState.singlePlayerChoice = choice; processAndShowResults(); } else { gameState.roundPlayerChoices[gameState.players[gameState.currentPlayerIndexInRound]] = choice; gameState.currentPlayerIndexInRound++; if (gameState.currentPlayerIndexInRound < gameState.players.length) { updateTurnIndicator(); setTimeout(() => { realBtn.disabled=false; aiBtn.disabled=false; showFeedback(`${gameState.players[gameState.currentPlayerIndexInRound]}'s turn`, 'info', 1500); }, 400); } else { processAndShowResults(); } } }
        
        function processAndShowResults() {
            if(gameState.currentMedia.type==='video'){mediaVideoEl.pause(); resultVideoEl.pause();}
            let msg="", type="info", isGameOver = false;
            
            if(gameState.gameMode==='single'){
                const p=gameState.players[0];
                const isCorrect=(gameState.singlePlayerChoice==='real'&&!gameState.currentMedia.isAI)||(gameState.singlePlayerChoice==='ai'&&gameState.currentMedia.isAI);
                if(isCorrect){
                    gameState.scores[p]++;
                    playSound(allSfx[2]); msg="Correct!"; type="correct";
                } else {
                    playSound(allSfx[3]); msg="Incorrect!"; type="incorrect";
                    if (gameState.singlePlayerSubType === 'infinite') {
                        isGameOver = true;
                    }
                }
            } else {
                const correctPlayers=[];
                gameState.players.forEach(p=>{const choice=gameState.roundPlayerChoices[p], isCorrect=(choice==='real'&&!gameState.currentMedia.isAI)||(choice==='ai'&&gameState.currentMedia.isAI); if(isCorrect){gameState.scores[p]++; correctPlayers.push(p);}});
                if(correctPlayers.length > 0) playSound(allSfx[2]); else playSound(allSfx[3]);
                if(correctPlayers.length===gameState.players.length){ msg="Everyone got it right!"; type="correct"; }
                else if(correctPlayers.length > 0){ msg = correctPlayers.length === 1 ? `${correctPlayers[0]} was correct!` : `${correctPlayers.join(' & ')} were correct!`; type="correct"; }
                else{ msg="No one got it right!"; type="incorrect"; }
            }
            
            showFeedback(msg, type);
            populateResults();

            const isMultiplayerGameOver = gameState.gameMode === 'multi' && gameState.currentRound >= gameState.maxRounds;
            const is5RoundsGameOver = gameState.gameMode === 'single' && gameState.singlePlayerSubType === '5rounds' && gameState.currentRound >= gameState.maxRounds;
            if (isGameOver || is5RoundsGameOver || isMultiplayerGameOver) {
                nextRoundBtn.innerHTML = 'See Final Results <i class="fas fa-trophy"></i>';
                nextRoundBtn.onclick = () => showGameOver();
            } else {
                nextRoundBtn.innerHTML = 'Next Round <i class="fas fa-arrow-right"></i>';
                nextRoundBtn.onclick = () => setupRound();
            }
            
            switchScreen('results');
        }

        function populateResults() { [resultImageEl, resultVideoEl].forEach(el=>{el.style.display='none'; el.classList.add('visible');}); resultVideoEl.pause(); resultVideoEl.currentTime=0; if(gameState.currentMedia.type==='image'){resultImageEl.src=gameState.currentMedia.url; resultImageEl.style.display='block';}else{resultVideoEl.src=gameState.currentMedia.url; resultVideoEl.style.display='block'; if(!document.hidden) resultVideoEl.play().catch(e=>{});} answerDisplayEl.className='answer-display'; if(gameState.currentMedia.isAI){answerDisplayEl.innerHTML=`<i class="fas fa-robot"></i> AI-Generated!`; answerDisplayEl.classList.add('answer-ai');}else{answerDisplayEl.innerHTML=`<i class="fas fa-check-circle"></i> Real!`; answerDisplayEl.classList.add('answer-real');} feedbackSummaryEl.style.display='none'; detailedFeedbackAreaEl.style.display='none'; detailedFeedbackAreaEl.innerHTML=''; if(gameState.gameMode==='single'){feedbackSummaryEl.style.display='inline-flex'; feedbackSummaryEl.className='feedback-summary'; const isCorrect=(gameState.singlePlayerChoice==='real'&&!gameState.currentMedia.isAI)||(gameState.singlePlayerChoice==='ai'&&gameState.currentMedia.isAI); if(isCorrect){feedbackSummaryEl.innerHTML=`<i class="fas fa-check-circle"></i> You guessed correctly!`; feedbackSummaryEl.classList.add('feedback-correct');}else{feedbackSummaryEl.innerHTML=`<i class="fas fa-times-circle"></i> Incorrect! You chose ${gameState.singlePlayerChoice}.`; feedbackSummaryEl.classList.add('feedback-incorrect');}}else{detailedFeedbackAreaEl.style.display='block'; gameState.players.forEach(p=>{const choice=gameState.roundPlayerChoices[p]; if(!choice)return; const isCorrect=(choice==='real'&&!gameState.currentMedia.isAI)||(choice==='ai'&&gameState.currentMedia.isAI), entry=document.createElement('div'); entry.className=`player-feedback-entry ${isCorrect?'correct':'incorrect'}`; entry.innerHTML=`<i class="fas fa-${isCorrect?'check':'times'}"></i> <strong>${p}</strong> chose: ${choice}.`; detailedFeedbackAreaEl.appendChild(entry);});} roundScoreDisplayEl.innerHTML=''; gameState.players.forEach(p=>{const scoreCard=document.createElement('div'); scoreCard.className='score-card'; scoreCard.innerHTML=`<h4>${p}</h4><div class="score-value">${gameState.scores[p]}</div><div class="progress-bar"><div class="progress-fill" style="width: ${gameState.scores[p]/gameState.maxRounds*100}%"></div></div>`; roundScoreDisplayEl.appendChild(scoreCard);});}
        
        function showGameOver(beatTheGame = false) {
            finalScoreDisplayEl.innerHTML='';
            let maxScore = -1;
            if(Object.values(gameState.scores).length > 0) {
                maxScore = Math.max(...Object.values(gameState.scores));
            }
            
            gameState.players.forEach(p=>{const card=document.createElement('div'); card.className='score-card'; if(gameState.scores[p]===maxScore&&maxScore>0&&gameState.players.length>1)card.classList.add('winner-glow'); else if(gameState.gameMode==='single' && gameState.singlePlayerSubType === '5rounds' && gameState.scores[p]>=Math.ceil(gameState.maxRounds*0.6))card.classList.add('winner-glow'); card.innerHTML=`<h4>${p}</h4><div class="score-value">${gameState.scores[p]}</div>`; finalScoreDisplayEl.appendChild(card);});
            
            if(gameState.gameMode==='single'){
                const score=gameState.scores[gameState.players[0]];
                if (gameState.singlePlayerSubType === 'infinite') {
                    saveHighScore(score);
                    let isNewHighScore = score > 0 && score === infiniteHighScore;
                    if (beatTheGame) {
                        winMessageTextEl.textContent = "You Beat The Game!";
                        finalMessageDetailsEl.innerHTML = `You correctly identified all ${gameState.mediaItems.length} items! <br>Final Score: ${score}. ${isNewHighScore ? '<strong>New High Score!</strong>' : ''}`;
                        winnerTrophyEl.textContent = 'üëë';
                    } else {
                        winMessageTextEl.textContent="Game Over!";
                        finalMessageDetailsEl.innerHTML = `Your Score: ${score}. ${isNewHighScore ? '<strong>New High Score!</strong>' : `High Score: ${infiniteHighScore}`}`;
                        winnerTrophyEl.textContent = isNewHighScore ? 'üèÜ' : 'üëç';
                    }
                } else { // 5-rounds mode
                    if(score===gameState.maxRounds){winMessageTextEl.textContent="Perfect Score!"; finalMessageDetailsEl.textContent="You're an expert!"; winnerTrophyEl.textContent='üåü';}
                    else if(score>=Math.ceil(gameState.maxRounds*0.6)){winMessageTextEl.textContent="Great Job!"; finalMessageDetailsEl.textContent=`You got ${score} out of ${gameState.maxRounds}.`; winnerTrophyEl.textContent='üèÜ';}
                    else{winMessageTextEl.textContent="Nice Try!"; finalMessageDetailsEl.textContent=`You got ${score} out of ${gameState.maxRounds}.`; winnerTrophyEl.textContent='üëç';}
                }
            } else { // Multiplayer
                const winners=gameState.players.filter(p=>gameState.scores[p]===maxScore&&maxScore>0);
                if(winners.length===1){winMessageTextEl.textContent=`${winners[0]} Wins!`; finalMessageDetailsEl.textContent=`With a top score of ${maxScore}!`;}
                else if(winners.length>1){winMessageTextEl.textContent="It's a Tie!"; finalMessageDetailsEl.textContent=`${winners.join(' & ')} all scored ${maxScore}!`;}
                else{winMessageTextEl.textContent="Game Complete!"; finalMessageDetailsEl.textContent="Better luck next time!";}
                winnerTrophyEl.textContent = winners.length > 0 ? 'üèÜ' : 'üéâ';
            }
            triggerConfetti();
            switchScreen('gameOver');
        }

        document.addEventListener('DOMContentLoaded', () => { 
            loadHighScore();
            const savedVol = localStorage.getItem('musicVolume'), savedSfx = localStorage.getItem('sfxEnabled');
            if(savedVol !== null) musicVolume = parseFloat(savedVol);
            if(savedSfx !== null) sfxEnabled = savedSfx === 'true';
            backgroundMusic.volume = musicVolume; bgmVolumeSlider.value = musicVolume; sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`;
            
            audioConsentModal.style.display = 'flex';
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('pageshow', handlePageShow);
            
            audioConsentYesBtn.addEventListener('click', () => { audioConsentModal.style.display = 'none'; initAudio(); playSound(allSfx[1]); });
            audioConsentNoBtn.addEventListener('click', () => { audioConsentModal.style.display = 'none'; sfxEnabled = false; musicVolume = 0; backgroundMusic.volume = 0; bgmVolumeSlider.value = 0; sfxToggleBtn.textContent = 'SFX: OFF'; localStorage.setItem('sfxEnabled', 'false'); localStorage.setItem('musicVolume', '0'); initAudio(); });
            
            settingsBtn.addEventListener('click', () => { playSound(allSfx[1]); settingsModal.style.display = 'flex'; });
            closeModalBtn.addEventListener('click', () => { playSound(allSfx[1]); settingsModal.style.display = 'none'; });
            bgmVolumeSlider.addEventListener('input', (e) => { musicVolume = parseFloat(e.target.value); backgroundMusic.volume = musicVolume; localStorage.setItem('musicVolume', musicVolume); if (musicVolume > 0 && !document.hidden && audioContextStarted) backgroundMusic.play().catch(e=>{}); else backgroundMusic.pause(); });
            sfxToggleBtn.addEventListener('click', () => { sfxEnabled = !sfxEnabled; sfxToggleBtn.textContent = `SFX: ${sfxEnabled ? 'ON' : 'OFF'}`; playSound(allSfx[1]); localStorage.setItem('sfxEnabled', sfxEnabled); });
            highscoreBtn.addEventListener('click', showHighScore);

            modeOptions.forEach(opt => opt.addEventListener('click', function(){ 
                playSound(allSfx[1]); 
                modeOptions.forEach(o=>o.classList.remove('selected')); 
                this.classList.add('selected'); 
                gameState.gameMode = this.dataset.mode; 
                const isMulti = gameState.gameMode === 'multi';
                multiplayerStartArea.style.display = isMulti ? 'block' : 'none';
                singlePlayerSubOptions.style.display = isMulti ? 'none' : 'block';
                if(isMulti) updateTeamRemoveButtonsState();
            }));
            
            function updateTeamRemoveButtonsState(){
                const wrappers = teamNamesList.querySelectorAll('.team-input-wrapper');
                addTeamBtn.disabled = wrappers.length >= 4;
                wrappers.forEach((wrapper) => {
                    let removeBtn = wrapper.querySelector('.remove-team-btn');
                    if (wrappers.length > 2 && !removeBtn) {
                        const newBtn = document.createElement('button');
                        newBtn.className = 'remove-team-btn';
                        newBtn.innerHTML = '<i class="fas fa-times"></i>';
                        newBtn.onclick = () => { playSound(allSfx[1]); wrapper.remove(); updateTeamRemoveButtonsState(); };
                        wrapper.appendChild(newBtn);
                    } else if (wrappers.length <= 2 && removeBtn) {
                        removeBtn.remove();
                    }
                });
            }

            addTeamBtn.addEventListener('click', () => {
                playSound(allSfx[1]); 
                const teamCount=teamNamesList.children.length; 
                if(teamCount>=4)return; 
                const wrapper=document.createElement('div'); 
                wrapper.className='team-input-wrapper'; 
                wrapper.innerHTML=`<input type="text" class="team-name-input" placeholder="Team ${teamCount+1}">`; 
                teamNamesList.appendChild(wrapper); 
                updateTeamRemoveButtonsState();
            });

            fiveRoundsBtn.addEventListener('click', () => startSinglePlayerGame('5rounds'));
            infiniteModeBtn.addEventListener('click', () => startSinglePlayerGame('infinite'));
            startGameBtn.addEventListener('click', () => playSoundWithCallback(allSfx[0], actualStartGame));
            realBtn.addEventListener('click', () => makeChoice('real'));
            aiBtn.addEventListener('click', () => makeChoice('ai'));
            nextRoundBtn.addEventListener('click', () => { playSound(allSfx[1]); if(gameState.currentMedia.type==='video')resultVideoEl.pause(); setupRound(); });
            playAgainBtn.addEventListener('click', () => playSoundWithCallback(allSfx[0], actualStartGame));
            newGameMenuBtn.addEventListener('click', () => { playSound(allSfx[1]); switchScreen('start'); });
            visitStoreBtn.addEventListener('click', () => { playSound(allSfx[1]); window.location.href = '/store'; });
            backBtn.addEventListener('click', () => { playSound(allSfx[1]); switchScreen('start'); });
            
            updateTeamRemoveButtonsState();
            switchScreen('start');
            modeOptions[0].click(); // Default to single player view
        });

        // --- CUSTOM SCROLL REDIRECTION LOGIC ---
        const gameContainerForScroll = document.querySelector('.game-container');
        let lastTouchY = 0;

        window.addEventListener('wheel', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                gameContainerForScroll.scrollTop += e.deltaY;
            }
        }, { passive: true });

        window.addEventListener('touchstart', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                if (e.touches.length > 0) {
                    lastTouchY = e.touches[0].clientY;
                }
            }
        }, { passive: true });

        window.addEventListener('touchmove', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                e.preventDefault(); 
                if (e.touches.length > 0) {
                    const currentTouchY = e.touches[0].clientY;
                    const deltaY = lastTouchY - currentTouchY;
                    gameContainerForScroll.scrollTop += deltaY;
                    lastTouchY = currentTouchY;
                }
            }
        }, { passive: false });
        // --- END OF CUSTOM SCROLL LOGIC ---
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>
</body>
</html>