<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real or AI - Game Show Edition!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300..700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Styles from "Guess The Price" for Game Show Vibe --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary: #FF8833; /* Blyza Orange */
            --secondary: #CB7AE1; /* Blyza Purple */
            --light: #F2F2F2;
            --success: #00BFA6; /* Blyza Keppel */
            --danger: #ff4b2b;
            --dark: #1a1c20;
            --darker: #0f1012;
            --info: #4ECDC4; 
            --gold: #FFD700; /* Game show gold */
            --stage-bg: #2c3e50; /* Dark blueish stage background */
            --curtain-color: #c0392b; /* Deep red for curtains */
            --spotlight-color: rgba(255, 223, 0, 0.6); /* Gold spotlight */
        }
        
        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .game-container {
            max-width: 800px; 
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px; 
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .brand-logo {
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .brand-logo-prominent {
            display: block;
            margin: 0 auto 20px;
            max-height: 70px; 
        }
        
        h1 { 
            font-family: "Luckiest Guy", cursive;
            font-size: 2.8rem; 
            margin-bottom: 25px;
            color: var(--gold); 
            text-shadow: 
                0 2px 0px #000, 
                0 4px 6px rgba(0, 0, 0, 0.5),
                0 0 30px var(--primary); 
            letter-spacing: 1px;
            margin-top: 10px; 
        }
         h3 { 
             font-size: 1.4rem; 
             margin-bottom: 15px;
             color: var(--light);
             font-weight: 600;
             font-family: "Bungee", cursive; 
         }
        
        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .active {
            display: block;
        }
        
        .instructions {
            font-family: "Quicksand", sans-serif;
            background: rgba(255, 255, 255, 0.05);
            padding: 25px; 
            border-radius: 20px;
            margin: 25px 0;
            line-height: 1.7;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
         .instructions p {
            font-weight: 600;
            font-size: 1.1rem; 
            margin-bottom: 15px;
         }
        .instructions ul {
            list-style-type: none;
            text-align: left;
            padding: 0 15px; 
        }
        .instructions li {
            margin-bottom: 12px; 
            display: flex;
            align-items: center;
            color: var(--light);
            font-size: 1rem; 
        }
        .instructions i {
            margin-right: 12px; 
            font-size: 1.3em; 
            color: var(--primary);
            width: 20px;
            text-align: center;
        }
        
        .game-mode-selection {
            display: flex;
            justify-content: center;
            gap: 20px; 
            margin: 25px 0;
        }
        .mode-option {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px; 
            border-radius: 15px; 
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex: 1;
            max-width: 250px; 
        }
        .mode-option:hover {
            transform: translateY(-4px); 
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2); 
            border-color: var(--secondary);
        }
        .mode-option.selected {
            border: 2px solid var(--primary);
            background: rgba(255, 136, 51, 0.1);
            box-shadow: 0 0 15px rgba(255, 136, 51, 0.2), inset 0 0 8px rgba(255, 136, 51, 0.1); 
        }
        .mode-option i {
            font-size: 2rem; 
            margin-bottom: 10px; 
            color: var(--primary);
        }
        .mode-option h3 { 
            margin-bottom: 8px; 
            font-size: 1.2rem; 
            color: var(--light);
        }
        .mode-option p {
            color: rgba(242, 242, 242, 0.7);
            font-size: 0.9rem; 
        }
        
        .team-inputs {
            margin: 25px 0;
            background: rgba(255, 255, 255, 0.05);
            padding: 25px; 
            border-radius: 15px; 
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .team-input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px; 
            margin-bottom: 12px; 
        }
        .team-input-wrapper input {
            flex-grow: 1;
            padding: 12px 15px; 
            border-radius: 10px; 
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1rem; 
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            transition: all 0.3s ease;
        }
        .team-input-wrapper input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 8px rgba(203, 122, 225, 0.2); 
        }
        .remove-team-btn {
            background: var(--danger);
            color: var(--light);
            border: none;
            border-radius: 6px; 
            padding: 7px 10px; 
            font-size: 0.8rem; 
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .remove-team-btn:hover { background: #cc3c22; }
        .remove-team-btn:disabled { background: rgba(255, 255, 255, 0.1); cursor: not-allowed; opacity: 0.5; }

        .game-info {
             display: flex;
             justify-content: space-between;
             align-items: center; 
             margin-bottom: 20px; 
             background: rgba(0, 0, 0, 0.2);
             padding: 12px 18px; 
             border-radius: 12px; 
             font-size: 1rem; 
             border: 1px solid rgba(255, 255, 255, 0.1);
             font-family: "Orbitron", sans-serif; 
             color: var(--gold);
         }
         .game-info > div { 
            text-shadow: 0 0 5px var(--primary);
         }

         #turn-indicator { 
            font-size: 1.1rem;
            color: var(--secondary);
            margin-top: 10px;
            margin-bottom: 10px;
            font-weight: bold;
            font-family: "Bungee", cursive;
         }

        /* --- GAME SHOW STAGE (from Guess The Price) --- */
        .item-stage-container { 
            background: var(--stage-bg);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 25px;
            border: 3px solid var(--gold);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden; 
        }
        .item-stage-container::before, .item-stage-container::after { 
            content: '';
            position: absolute;
            top: -50px;
            width: 200px;
            height: 300px;
            background: radial-gradient(ellipse at center, var(--spotlight-color) 0%, transparent 70%);
            pointer-events: none;
            opacity: 0.7;
        }
        .item-stage-container::before {
            left: -50px;
            transform: rotate(-30deg);
        }
        .item-stage-container::after {
            right: -50px;
            transform: rotate(30deg);
        }

        .stage-curtains {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            background-color: var(--curtain-color);
            background-image: linear-gradient(rgba(0,0,0,0.2) 50%, transparent 50%),
                              linear-gradient(90deg, rgba(0,0,0,0.2) 50%, transparent 50%);
            background-size: 50px 50px; 
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 5;
        }
        .stage-curtains.left {
            left: 0;
            border-right: 3px solid #a52a20; 
        }
        .stage-curtains.right {
            right: 0;
            border-left: 3px solid #a52a20;
        }
        .stage-curtains.open.left {
            transform: translateX(-100%);
        }
        .stage-curtains.open.right {
            transform: translateX(100%);
        }

        .tv-screen-container { 
            background: #111;
            border: 10px solid #333;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            z-index: 1; 
            min-height: 300px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .media-content { 
            max-width: 100%;
            max-height: 350px; 
            height: auto;
            display: block;
            margin: 0 auto 10px auto; 
            border-radius: 12px; 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3); 
            background-color: rgba(0,0,0,0.3); 
            opacity: 0; /* Initially hidden for smooth fade-in */
            transition: opacity 0.5s 0.2s ease-in-out; /* Fade-in transition with slight delay */
        }
        .media-content.visible { /* Class to trigger visibility */
            opacity: 1;
        }
        
        .media-description { 
            font-style: italic;
            color: var(--secondary);
            margin-bottom: 12px; 
            font-size: 1.1rem; 
            font-weight: 500;
            font-family: 'Quicksand', sans-serif; 
            opacity: 0; /* Initially hidden */
            transition: opacity 0.5s 0.3s ease-in-out; /* Fade-in transition with slight delay */
        }
         .media-description.visible {
            opacity: 1;
        }
        .tv-screen-container h3 { 
            font-family: "Luckiest Guy", cursive;
            color: var(--gold);
            font-size: 1.6rem; 
            margin-bottom: 15px;
            text-shadow: 0 2px 3px #000;
        }
        /* --- END GAME SHOW STAGE --- */
        
         .choice-buttons {
            display: flex;
            justify-content: center;
            gap: 20px; 
            margin-top: 20px; 
         }
         .choice-btn { 
            flex: 1;
            max-width: 220px; 
            padding: 15px 25px; 
            font-size: 1.1rem; 
            font-family: "Bungee", cursive;
            border-radius: 50px;
            text-shadow: 1px 1px 2px #000;
            border: 2px solid var(--darker);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), inset 0 -2px 5px rgba(0,0,0,0.2);
         }
         .choice-btn i {
            margin-right: 8px; 
            font-size: 1.2rem; 
         }

        /* Buttons (General Style - from Guess The Price) */
        button {
            background: linear-gradient(135deg, var(--primary) 0%, #ff7711 100%);
            color: var(--light);
            border: 2px solid var(--darker); 
            padding: 12px 25px; 
            font-size: 1rem; 
            border-radius: 50px; 
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), inset 0 -2px 5px rgba(0,0,0,0.2);
            margin: 8px 4px; 
            font-family: "Bungee", cursive; 
            text-shadow: 1px 1px 2px #000;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px; 
            flex-shrink: 0;
        }
        button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--primary);
        }
        button:active:not(:disabled) { transform: translateY(-1px) scale(1.02); }
        button:disabled { background: rgba(255, 255, 255, 0.1); cursor: not-allowed; opacity: 0.6; }

        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, #ff7711 100%); }
        .btn-primary:hover:not(:disabled) { background: linear-gradient(135deg, #ff7711 0%, var(--primary) 100%); }
        .btn-success { background: linear-gradient(135deg, var(--success) 0%, #00a890 100%); }
        .btn-success:hover:not(:disabled) { background: linear-gradient(135deg, #00a890 0%, var(--success) 100%); box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--success); }
        .btn-danger { background: linear-gradient(135deg, var(--danger) 0%, #ff416c 100%); }
        .btn-danger:hover:not(:disabled) { background: linear-gradient(135deg, #ff416c 0%, var(--danger) 100%); box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--danger); }
        .btn-secondary { background: linear-gradient(135deg, var(--secondary) 0%, #b85cd6 100%); }
        .btn-secondary:hover:not(:disabled) { background: linear-gradient(135deg, #b85cd6 0%, var(--secondary) 100%); box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--secondary); }
        .btn-info { background: linear-gradient(135deg, var(--info) 0%, #3eb7af 100%); }
        .btn-info:hover:not(:disabled) { background: linear-gradient(135deg, #3eb7af 0%, var(--info) 100%); box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--info); }


        /* Results Screen Styling - Adapted from Guess The Price */
        .result-item-display { 
            background: rgba(0,0,0, 0.2); 
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid var(--gold);
            box-shadow: 0 0 15px var(--gold);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
         .result-item-display .media-content { 
            max-height: 250px; 
            margin-bottom: 10px; 
        }

        .answer-display { 
            font-size: 1.5rem; 
            font-weight: bold;
            padding: 12px 18px; 
            border-radius: 10px; 
            margin-top: 15px; 
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; 
            transition: all 0.3s ease;
            font-family: "Luckiest Guy", cursive;
        }
        .answer-display i { font-size: 1.6rem; }
        .answer-real { color: var(--success); background-color: rgba(0, 191, 166, 0.1); border-color: rgba(0, 191, 166, 0.3); text-shadow: 0 0 8px var(--success);}
        .answer-ai { color: var(--primary); background-color: rgba(255, 136, 51, 0.1); border-color: rgba(255, 136, 51, 0.3); text-shadow: 0 0 8px var(--primary);}
        
        .feedback-summary { 
            font-size: 1.2rem; 
            font-weight: bold;
            padding: 10px 15px; 
            border-radius: 8px; 
            margin-top: 10px; 
            border: 2px solid transparent;
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            gap: 8px; 
        }
         .feedback-summary i { font-size: 1.3rem; }
        .feedback-correct { color: var(--success); background-color: rgba(0, 191, 166, 0.15); border-color: var(--success); }
        .feedback-correct i { color: var(--success); animation: bounce 0.6s ease-out; }
        .feedback-incorrect { color: var(--danger); background-color: rgba(255, 75, 43, 0.15); border-color: var(--danger); }
        .feedback-incorrect i { color: var(--danger); animation: shake 0.5s ease-out; }
        
        .detailed-feedback-area { 
            margin-top: 20px;
            text-align: left;
        }
        .player-feedback-entry {
            background: rgba(255, 255, 255, 0.03);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            font-size: 0.9rem;
        }
        .player-feedback-entry.correct { border-left: 4px solid var(--success); color: var(--success); }
        .player-feedback-entry.incorrect { border-left: 4px solid var(--danger); color: var(--danger); }

        /* Score Display Styles (from Guess The Price) */
        .score-display {
            display: grid;
            gap: 15px; 
            margin: 25px 0;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
        }
        .score-card {
            background: rgba(0,0,0, 0.3);
            padding: 18px; 
            border-radius: 15px; 
            border: 2px solid var(--gold);
            transition: all 0.3s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
            text-align: center;
        }
         .score-card h4 { 
            font-size: 1.1rem; 
            margin-bottom: 8px; 
            font-weight: 600;
            color: var(--light);
            font-family: "Bungee", cursive; 
         }
         .score-value { 
            font-size: 2rem; 
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 12px; 
            font-family: "Orbitron", sans-serif; 
         }
        .progress-bar {
            height: 8px; 
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px; 
            margin-top: 12px; 
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--gold) 100%);
            border-radius: 4px; 
            transition: width 0.5s ease;
            box-shadow: 0 0 8px var(--primary);
        }
        .score-card.winner-glow { 
            animation: winnerGlow 2s infinite alternate;
            border: 2px solid var(--success);
        }
        @keyframes winnerGlow {
            from { box-shadow: 0 0 15px rgba(0, 191, 166, 0.2), 0 0 10px var(--gold); }
            to { box-shadow: 0 0 25px rgba(0, 191, 166, 0.4), 0 0 15px var(--gold); }
        }


        /* Game Over Screen - Styling from Guess The Price */
         .win-message { 
            font-family: "Luckiest Guy", cursive; 
            font-size: 2.5rem; 
            margin: 25px 0; 
            color: var(--gold);
            text-shadow: 0 3px 0px #000, 0 0 20px var(--primary);
         }
         .winner-trophy { 
            font-size: 5rem; 
            margin: 20px 0 25px 0; 
            animation: bounceTrophy 2s infinite; 
            color: var(--gold);
            text-shadow: 0 0 20px var(--gold), 0 0 30px var(--primary);
         }
         #final-message-details-el { 
            font-size: 1.1rem; 
            margin-bottom: 25px; 
            color: rgba(242, 242, 242, 0.9);
         }
         #game-over-screen .score-card { max-width: 300px; margin-left: auto; margin-right: auto; }
         #game-over-screen .score-value { font-size: 2.5rem; }


         /* Animations from Guess The Price */
        @keyframes bounce { 
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes bounceTrophy { 
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.05); } 
        }


        /* Settings Icon & Modal Styles (from Guess The Price) */
        .icon-btn {
            position: absolute;
            background: rgba(0,0,0, 0.3);
            color: var(--light);
            border: 1px solid var(--gold);
            border-radius: 50%;
            width: 40px; height: 40px; 
            font-size: 1.1rem; 
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; justify-content: center; align-items: center;
            z-index: 100;
        }
        .icon-btn#settings-btn { top: 15px; right: 15px; }
        .icon-btn#back-btn { top: 15px; left: 15px; display: none; /* Initially hidden */ }
        .icon-btn:hover { background: rgba(0,0,0, 0.5); transform: scale(1.1) rotate(15deg); box-shadow: 0 0 10px var(--gold); }
        .icon-btn#back-btn:hover { transform: scale(1.1) rotate(-5deg); }


        .modal {
            position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: var(--darker); margin: auto; padding: 25px; 
            border: 2px solid var(--gold); border-radius: 15px; 
            width: 80%; max-width: 450px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.6), 0 0 20px var(--primary);
            position: relative; color: var(--light);
        }
        .modal-content h2 {
            font-family: "Bungee", cursive; color: var(--primary);
            text-align: center; margin-bottom: 20px; 
            font-size: 1.5rem; 
        }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; } 
        .setting-item label { margin-bottom: 7px; font-weight: 600; font-size: 0.9rem; } 
        .setting-item input[type="range"] { width: 100%; cursor: pointer; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; margin-top: -6px; box-shadow: 0 0 8px var(--primary); } 
        input[type=range]::-moz-range-thumb { height: 18px; width: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; border: none; box-shadow: 0 0 8px var(--primary); } 
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 5px; cursor: pointer; background: rgba(255,255,255,0.2); border-radius: 2.5px; border: 1px solid rgba(0,0,0,0.2);} 
        input[type=range]::-moz-range-track { width: 100%; height: 5px; cursor: pointer; background: rgba(255,255,255,0.2); border-radius: 2.5px; border: 1px solid rgba(0,0,0,0.2);} 
        .close-modal-btn {
            color: #aaa; position: absolute; top: 10px; right: 15px; 
            font-size: 24px; font-weight: bold; cursor: pointer; 
        }
        .close-modal-btn:hover, .close-modal-btn:focus { color: var(--light); text-decoration: none; }


        /* Feedback Pop-up Styles (from Guess The Price) */
        .feedback-popup {
            position: fixed; top: 50%; left: 50%;
            background-color: rgba(15, 16, 18, 0.97); 
            color: white; padding: 25px 40px; 
            border-radius: 15px; 
            font-size: 2.2rem; 
            font-family: "Luckiest Guy", cursive; 
            text-align: center;
            z-index: 2000; box-shadow: 0 15px 40px rgba(0,0,0,0.7);
            opacity: 0; transform: translate(-50%, -50%) scale(0.7);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none; border: 3px solid var(--gold); 
            display: none; /* Start hidden, JS toggles .show */
        }
        .feedback-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; display: block; }
        .feedback-popup.correct { color: var(--success); border-color: var(--success); text-shadow: 0 0 10px var(--success); } 
        .feedback-popup.incorrect { color: var(--danger); border-color: var(--danger); text-shadow: 0 0 10px var(--danger); } 
        .feedback-popup.info { color: var(--info); border-color: var(--info); text-shadow: 0 0 10px var(--info); } 


        /* Confetti Styles (from Guess The Price) */
        .confetti-piece {
            position: fixed; width: 8px; height: 15px; 
            background-color: var(--primary); opacity: 0;
            animation-timing-function: linear; animation-fill-mode: forwards;
            pointer-events: none; z-index: 3000;
        }
        @keyframes fallAndFade {
            0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(120vh) rotate(720deg); opacity: 0; }
        }
        
        /* Game Over Button Container & Treat Yourself (from Guess The Price) */
        .game-over-buttons-container {
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin-top: 20px; 
        }
        .game-over-button-wrapper { 
            position: relative; 
            display: flex;
            flex-direction: column; 
            align-items: center;
        }

        .treat-yourself-callout {
            margin-bottom: 8px; 
            background-color: var(--gold);
            color: var(--darker);
            padding: 8px 15px;
            border-radius: 20px; 
            font-family: "Bungee", cursive;
            font-size: 0.9rem;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(255,215,0,0.5);
            display: none; 
            align-items: center; 
            gap: 8px;
            z-index: 10;
        }
        .treat-yourself-callout i { 
            font-size: 1.2em;
            animation: bounceArrow 1s infinite;
        }
        @keyframes bounceArrow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
        

        /* Responsive */
        @media (max-width: 768px) {
            .game-container { padding: 20px; } 
            h1 { font-size: 2.2rem; margin-top: 5px;}
            h3 { font-size: 1.2rem; }
            .game-mode-selection { flex-direction: column; align-items: center; gap: 15px; }
            .mode-option { max-width: 90%; }
            .instructions li { font-size: 0.9rem; }
            .choice-buttons { flex-direction: column; align-items: center; gap: 12px; }
            .choice-btn { max-width: 80%; width: 100%; font-size: 1rem; padding: 12px 18px;}
            .choice-btn i { font-size: 1.1rem; }
            .answer-display, .feedback-summary { font-size: 1.1rem; padding: 10px 12px;}
            .answer-display i, .feedback-summary i { font-size: 1.2rem; }
            .score-card { max-width: 100%; } 
            .score-value { font-size: 1.8rem; }
            .win-message { font-size: 1.8rem; }
            .winner-trophy { font-size: 3.5rem; }
            #final-message-details-el { font-size: 1rem; }
            .feedback-popup { font-size: 1.8rem; padding: 20px 30px; width: 85%;} 
            .modal-content { padding: 20px; }
             .game-over-buttons-container { 
                flex-direction: column; 
                align-items: center;
            }
            .game-over-buttons-container .game-over-button-wrapper { 
                width: 80%; 
                margin-bottom: 5px; 
            }
            .game-over-buttons-container .game-over-button-wrapper button {
                width: 100%; 
            }

            .item-stage-container::before, .item-stage-container::after { display: none; } 
            .tv-screen-container { padding: 10px; border-width: 5px; }
            .media-content { max-height: 250px; } 
            .tv-screen-container h3 { font-size: 1.4rem; } 
            .treat-yourself-callout { font-size: 0.8rem; padding: 6px 12px; }
             .icon-btn#settings-btn { top: 10px; right: 10px; width: 38px; height: 38px; font-size: 1rem;}
             .icon-btn#back-btn { top: 10px; left: 10px; width: 38px; height: 38px; font-size: 1rem;}
        }
         @media (max-width: 480px) {
              h1 { font-size: 1.8rem; } 
              .game-container { padding: 15px; }
               .game-info { font-size: 0.9rem; padding: 8px 12px;}
               .tv-screen-container h3 { font-size: 1.2rem; }
               .media-description { font-size: 0.9rem;}
               .choice-btn { max-width: 90%; font-size: 0.9rem; padding: 10px 15px;}
               .answer-display, .feedback-summary { font-size: 1rem; }
               .icon-btn { top: 10px; right: 10px; width: 35px; height: 35px; font-size: 1rem; }
               .feedback-popup { font-size: 1.5rem; }
         }

    </style>
</head>
<body>
    <div class="game-container">
        <button id="back-btn" class="icon-btn" aria-label="Go Back" style="display: none;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Real or AI</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY:</strong></p>
                <ul>
                    <li><i class="fas fa-image"></i> You'll see an image or video.</li>
                    <li><i class="fas fa-brain"></i> Decide if it's real or AI-generated.</li>
                    <li><i class="fas fa-check-circle"></i> Get 1 point for each correct guess.</li>
                    <li><i class="fas fa-users"></i> Play solo or with up to 4 teams!</li>
                    <li><i class="fas fa-trophy"></i> 5 rounds - highest score wins!</li>
                </ul>
            </div>

            <div class="game-mode-selection">
                <div class="mode-option selected" data-mode="single">
                    <i class="fas fa-user"></i>
                    <h3>Single Player</h3>
                    <p>Play 5 rounds alone</p>
                </div>
                <div class="mode-option" data-mode="multi">
                    <i class="fas fa-users"></i>
                    <h3>Multiplayer</h3>
                    <p>Up to 4 teams</p>
                </div>
            </div>

            <div id="team-inputs-container" style="display: none;">
                <div class="team-inputs">
                    <h3>Enter Team Names</h3>
                    <div id="team-names-list">
                        <div class="team-input-wrapper">
                            <input type="text" class="team-name-input" placeholder="Team 1">
                        </div>
                        <div class="team-input-wrapper">
                            <input type="text" class="team-name-input" placeholder="Team 2">
                        </div>
                    </div>
                    <button id="add-team-btn" class="btn-secondary">Add Team</button>
                </div>
            </div>

            <button id="start-game-btn" class="btn-primary">Start Game <i class="fas fa-play"></i></button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-info">
                <div id="round-info-text">
                    Round <span id="round-number-el">1</span>/5 
                </div>
                <div id="score-info-text">
                    Score: <span id="current-score-el">0</span> 
                </div>
            </div>
            <div id="turn-indicator" style="display: none;"></div>
            
            <div class="item-stage-container">
                <div class="stage-curtains left"></div>
                <div class="stage-curtains right"></div>
                <div class="tv-screen-container">
                    <h3>Is this Real or AI?</h3>
                    <div id="media-description-el" class="media-description">Description</div> 
                    <img id="media-image-el" src="" alt="Media to identify" class="media-content"> 
                    <video id="media-video-el" controls muted loop playsinline class="media-content"></video> 
                </div>
            </div>

            <div class="choice-buttons">
                <button id="real-btn" class="choice-btn btn-success">
                    <i class="fas fa-check-circle"></i> Real
                </button>
                <button id="ai-btn" class="choice-btn btn-danger"> 
                    <i class="fas fa-robot"></i> AI
                </button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <h1>Round Result</h1>
            <div class="result-item-display">
                <img id="result-image-el" src="" alt="Result media" class="media-content"> 
                <video id="result-video-el" controls muted loop playsinline class="media-content"></video> 
            </div>
            <div id="answer-display-el" class="answer-display"></div> 
            <div id="feedback-summary-el" class="feedback-summary"></div> 
            <div id="detailed-feedback-area-el" class="detailed-feedback-area" style="display: none;"></div> 

            <div id="round-score-display-el" class="score-display"></div> 

            <button id="next-round-btn" class="btn-primary">Next Round <i class="fas fa-arrow-right"></i></button>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="screen">
             <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over!</h1>
            <div id="win-message-text-el" class="win-message">Results!</div> 
            <div id="winner-trophy-el" class="winner-trophy">🏆</div> 
            <div id="final-message-details-el">Your final tally.</div> 

            <div id="final-score-display-el" class="score-display"></div> 

            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                    <button id="play-again-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                </div>
                <div class="game-over-button-wrapper">
                     <button id="new-game-menu-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper-id"> 
                    <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">×</span>
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="bgm-volume-slider">Background Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>

    <!-- Feedback Pop-up -->
    <div id="feedback-popup" class="feedback-popup"> 
        <span id="feedback-message-text-el"></span>
    </div>

    <!-- Audio elements -->
    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="correct-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="incorrect-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="curtain-sound" src="https://static.wixstatic.com/mp3/9ce3e5_ccd36cdf98bf4e1594cf2e52d5296c51.wav"></audio> 
    <audio id="confetti-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>


       <script>
        const gameState = {
            gameMode: 'single', 
            players: [], 
            scores: {}, 
            currentRound: 0, 
            maxRounds: 5,
            currentMedia: null,
            usedItems: [],
            currentPlayerIndexInRound: 0,
            roundPlayerChoices: {}, 
            singlePlayerChoice: null,
            sfxEnabled: true,
            musicVolume: 0.2,
            mediaItems: [
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_d76ca16cd1db4a6da7d6292106a05590~mv2.jpg", description: "Popstar", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_df76be4f583d4f3e9a28dd3bd2c29510~mv2.jpg", description: "Master Oogway", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_8cf5eac3afde48ccab0a4b0c5a98dff6~mv2.png", description: "2.6 Million Dollar Mansion", isAI: true },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_52c88e7ede90479e9a22f96402606ca7~mv2.png", description: "What they lookin at?", isAI: true },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_bf87f7d4df874b408b8951c097206815~mv2.webp", description: "Maroon 5 concert", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_fab2c9bbd5b7483997e21730454bdf91~mv2.png", description: "Street photography", isAI: true },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_dad23f0a7a114f20ae21fe809b01be11/1080p/mp4/file.mp4", description: "Jelly", isAI: true },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_6ad18c17069842519f5ab861d920c365/1080p/mp4/file.mp4", description: "Love the beach", isAI: false },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_e39cfbcaee614f1b90c82cf2a881b7a4/1080p/mp4/file.mp4", description: "YUUMMMM", isAI: true },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_10b41ddbc09f481c8de2bdf59a02cefb/1080p/mp4/file.mp4", description: "Climbed that", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_92ef479506ab405aacddff5802111667~mv2.jpg", description: "Technologia", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_24e52e5bf9a14a7994be19537fb33dd2~mv2.jpg", description: "Sky full of stars", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_3dab047a6fcc4f8d97a73d41bb79c761~mv2.jpg", description: "Post Hike", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_b6a751547d6f48ea9b484f4c05409ad9~mv2.webp", description: "Space Invasion?", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_de96da45b2214773b27a35e58dcd7ea3~mv2.webp", description: "Adorablee", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_5c02118aa9cd4d8eb22e7621c155cd6a~mv2.webp", description: "Yumm", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_9cbcd84aa0634d9bb7d8ef14e3df8d4d~mv2.webp", description: "Future winter Olympian", isAI: false },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_f8226cd46b144ae3af8a91dff52cfcdd~mv2.png", description: "Sunkissed", isAI: true },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_f62a99e9d5b24e5587079d32ab023855~mv2.png", description: "Every wallpaper in 2013", isAI: true },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_160fdd4b9e8748e7ae0322524a350e04~mv2.png", description: "Sahara", isAI: true },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_d785956c74ee4e62b8eb7d80e56499ed~mv2.png", description: "Everybody's childhood crush", isAI: true },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_214a8f44c9b0446bbe197e95185f28de~mv2.png", description: "Oranges", isAI: true },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_e0f42595978145cc926f661e873258e6~mv2.png", description: "Family pic", isAI: true },
                 { type: "image", url: "https://static.wixstatic.com/media/9ce3e5_1593625b415c49639afd56cb7589063b~mv2.webp", description: "Golden State", isAI: true },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_64edf447f7c8472db0696145d04d817e/1080p/mp4/file.mp4", description: "Aspiring videographer", isAI: true },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_a287874449c34b02bed1968be7adc58f/1080p/mp4/file.mp4", description: "Bloooom", isAI: true },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_f4dd37888eec481dac346561454c6529/1080p/mp4/file.mp4", description: "I wanna go there", isAI: true },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_9bd6c1e8834b401bbf7aae87c201afa4/1080p/mp4/file.mp4", description: "Bloom Bloom", isAI: false },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_6a0da61044284d8686ae7e8d3bbfa17d/1080p/mp4/file.mp4", description: "where is this?", isAI: false },
                 { type: "video", url: "https://video.wixstatic.com/video/9ce3e5_2976d3ab2dbd4675bb0b46c506055548/1080p/mp4/file.mp4", description: "Lapsie", isAI: false },
             ]
        };

        const screens = {
            start: document.getElementById('start-screen'),
            game: document.getElementById('game-screen'),
            results: document.getElementById('results-screen'),
            gameOver: document.getElementById('game-over-screen')
        };

        // Start Screen elements
        const modeOptions = document.querySelectorAll('.mode-option');
        const teamInputsContainer = document.getElementById('team-inputs-container');
        const teamNamesList = document.getElementById('team-names-list');
        const addTeamBtn = document.getElementById('add-team-btn');
        const startGameBtn = document.getElementById('start-game-btn');

        // Game Screen elements
        const roundInfoText = document.getElementById('round-info-text');
        const scoreInfoText = document.getElementById('score-info-text');
        const turnIndicator = document.getElementById('turn-indicator');
        const roundNumberEl = document.getElementById('round-number-el'); 
        const currentScoreEl = document.getElementById('current-score-el'); 
        const mediaDescriptionEl = document.getElementById('media-description-el'); 
        const mediaImageEl = document.getElementById('media-image-el'); 
        const mediaVideoEl = document.getElementById('media-video-el'); 
        const realBtn = document.getElementById('real-btn');
        const aiBtn = document.getElementById('ai-btn');

        // Stage curtain elements 
        const leftCurtain = document.querySelector('.stage-curtains.left');
        const rightCurtain = document.querySelector('.stage-curtains.right');


        // Results Screen elements
        const resultImageEl = document.getElementById('result-image-el'); 
        const resultVideoEl = document.getElementById('result-video-el'); 
        const answerDisplayEl = document.getElementById('answer-display-el'); 
        const feedbackSummaryEl = document.getElementById('feedback-summary-el'); 
        const detailedFeedbackAreaEl = document.getElementById('detailed-feedback-area-el'); 
        const roundScoreDisplayEl = document.getElementById('round-score-display-el'); 
        const nextRoundBtn = document.getElementById('next-round-btn');

        // Game Over elements
        const winMessageTextEl = document.getElementById('win-message-text-el'); 
        const winnerTrophyEl = document.getElementById('winner-trophy-el'); 
        const finalMessageDetailsEl = document.getElementById('final-message-details-el'); 
        const finalScoreDisplayEl = document.getElementById('final-score-display-el'); 
        const playAgainBtn = document.getElementById('play-again-btn');
        const newGameMenuBtn = document.getElementById('new-game-menu-btn');
        const visitStoreBtn = document.getElementById('visit-store-btn');
        const storeButtonWrapper = document.getElementById('store-button-wrapper-id'); 


        // Settings elements
        const settingsBtn = document.getElementById('settings-btn');
        const backBtn = document.getElementById('back-btn'); // Added back button
        const settingsModal = document.getElementById('settings-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const bgmVolumeSlider = document.getElementById('bgm-volume-slider');
        const sfxToggleBtn = document.getElementById('sfx-toggle-btn');

        // Audio elements
        const backgroundMusic = document.getElementById('background-game-music');
        const startGameSound = document.getElementById('start-game-sound');
        const interactionSound = document.getElementById('interaction-sound');
        const correctAnswerSound = document.getElementById('correct-answer-sound');
        const incorrectAnswerSound = document.getElementById('incorrect-answer-sound');
        const curtainSound = document.getElementById('curtain-sound'); 
        const confettiSound = document.getElementById('confetti-sound');

        // Feedback Pop-up elements
        const feedbackPopup = document.getElementById('feedback-popup');
        const feedbackMessageTextEl = document.getElementById('feedback-message-text-el');
        let feedbackTimeout;
        let treatYourselfElement = null;


        // --- Sound Functions ---
        function playSound(audioElement, delayMilliseconds = 0) { 
            if (gameState.sfxEnabled && audioElement) {
                if (delayMilliseconds > 0) {
                    setTimeout(() => {
                        audioElement.currentTime = 0;
                        audioElement.volume = 0.7; 
                        audioElement.play().catch(e => console.error("SFX play error:", e, audioElement.src));
                    }, delayMilliseconds);
                } else {
                    audioElement.currentTime = 0;
                    audioElement.volume = 0.7;
                    audioElement.play().catch(e => console.error("SFX play error:", e, audioElement.src));
                }
            }
        }
        function playSoundWithCallback(audioElement, callback, delayMilliseconds = 0, ...args) { 
            if (gameState.sfxEnabled && audioElement) {
                setTimeout(() => { 
                    audioElement.currentTime = 0;
                    audioElement.volume = 0.7;
                    let callbackExecuted = false;
                    const executeCallback = () => {
                        if (!callbackExecuted) {
                            callbackExecuted = true;
                            audioElement.removeEventListener('ended', executeCallback); 
                            if (timeoutId) clearTimeout(timeoutId);
                            if (callback) callback(...args);
                        }
                    };
                    audioElement.addEventListener('ended', executeCallback); 
                    let soundDurationMs = 500; 
                    if (audioElement.duration && isFinite(audioElement.duration) && audioElement.duration > 0) {
                        soundDurationMs = audioElement.duration * 1000;
                    } else {
                        audioElement.onloadedmetadata = () => {
                            if (audioElement.duration && isFinite(audioElement.duration) && audioElement.duration > 0) {
                                soundDurationMs = audioElement.duration * 1000;
                            }
                        };
                    }
                    const timeoutId = setTimeout(executeCallback, soundDurationMs + 200); 
                    audioElement.play().catch(e => {
                        console.error("SFX play error:", e, audioElement.src);
                        executeCallback(); 
                    });
                }, delayMilliseconds); 
            } else {
                if (delayMilliseconds > 0 && callback) {
                    setTimeout(() => { callback(...args); }, delayMilliseconds);
                } else if (callback) {
                    callback(...args);
                }
            }
        }
        function initBackgroundMusic() {
            backgroundMusic.volume = gameState.musicVolume;
            backgroundMusic.play().catch(e => console.log("BGM autoplay prevented. User interaction needed."));
        }

        // --- Feedback Pop-up Function ---
        function showFeedbackMessage(message, type = 'info', duration = 2200) { 
            feedbackMessageTextEl.textContent = message;
            feedbackPopup.className = 'feedback-popup'; 
            if (type) feedbackPopup.classList.add(type);
            feedbackPopup.classList.add('show'); 

            clearTimeout(feedbackTimeout);
            feedbackTimeout = setTimeout(() => {
                feedbackPopup.classList.remove('show'); 
            }, duration);
        }

        // --- Confetti Function ---
        function triggerConfetti() {
            playSound(confettiSound); 
            const confettiCount = 80; 
            const colors = ['var(--primary)', 'var(--secondary)', 'var(--success)', 'var(--info)', '#FFD700'];
            for (let i = 0; i < confettiCount; i++) {
                const confettiPiece = document.createElement('div');
                confettiPiece.classList.add('confetti-piece');
                confettiPiece.style.left = Math.random() * 100 + 'vw';
                confettiPiece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                const animDuration = Math.random() * 2.5 + 1.5; 
                confettiPiece.style.animationName = 'fallAndFade';
                confettiPiece.style.animationDuration = animDuration + 's';
                confettiPiece.style.animationDelay = Math.random() * 0.8 + 's'; 
                confettiPiece.style.width = Math.random() * 4 + 4 + 'px'; 
                confettiPiece.style.height = Math.random() * 8 + 8 + 'px'; 
                document.body.appendChild(confettiPiece);
                setTimeout(() => confettiPiece.remove(), (animDuration + parseFloat(confettiPiece.style.animationDelay || 0)) * 1000 + 500);
            }
        }

        // --- Screen Switching ---
        function switchScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            screens[screenId].classList.add('active');
            backBtn.style.display = (screenId !== 'start') ? 'flex' : 'none';
            settingsBtn.style.display = 'flex'; // Always show settings button
        }

        // --- Settings Logic ---
        settingsBtn.addEventListener('click', () => { playSound(interactionSound); settingsModal.style.display = 'flex'; });
        closeModalBtn.addEventListener('click', () => { playSound(interactionSound); settingsModal.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target === settingsModal) { playSound(interactionSound); settingsModal.style.display = 'none'; } });
        bgmVolumeSlider.addEventListener('input', (e) => { gameState.musicVolume = parseFloat(e.target.value); backgroundMusic.volume = gameState.musicVolume; });
        sfxToggleBtn.addEventListener('click', () => {
            playSound(interactionSound);
            gameState.sfxEnabled = !gameState.sfxEnabled;
            sfxToggleBtn.textContent = `SFX: ${gameState.sfxEnabled ? 'ON' : 'OFF'}`;
            sfxToggleBtn.classList.toggle('btn-success', gameState.sfxEnabled);
            sfxToggleBtn.classList.toggle('btn-danger', !gameState.sfxEnabled);
        });

        // --- Back Button Logic ---
        backBtn.addEventListener('click', () => {
            playSound(interactionSound);
            // Go back to start screen, effectively resetting the current game progress
            if (gameState.currentMedia && gameState.currentMedia.type === 'video') { // Stop videos if playing
                mediaVideoEl.pause();
                resultVideoEl.pause();
            }
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            screens.start.classList.add('active');
            backBtn.style.display = 'none'; 
            if (treatYourselfElement) treatYourselfElement.style.display = 'none'; 
            if (backgroundMusic.paused) initBackgroundMusic(); 
        });


        // --- Start Screen Logic ---
        modeOptions.forEach(option => {
            option.addEventListener('click', function() {
                playSound(interactionSound);
                modeOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                gameState.gameMode = this.dataset.mode;
                teamInputsContainer.style.display = gameState.gameMode === 'multi' ? 'block' : 'none';
                if (gameState.gameMode === 'multi') updateTeamRemoveButtonsState();
            });
        });

        addTeamBtn.addEventListener('click', () => {
            playSound(interactionSound);
            const teamCount = teamNamesList.querySelectorAll('.team-input-wrapper').length;
            if (teamCount >= 4) return;

            const wrapper = document.createElement('div');
            wrapper.className = 'team-input-wrapper';
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'team-name-input';
            input.placeholder = `Team ${teamCount + 1}`;
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-team-btn';
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            removeBtn.onclick = function() { playSound(interactionSound); wrapper.remove(); updateTeamRemoveButtonsState(); };
            wrapper.appendChild(input);
            wrapper.appendChild(removeBtn);
            teamNamesList.appendChild(wrapper);
            updateTeamRemoveButtonsState();
        });

        function updateTeamRemoveButtonsState() {
            const teamWrappers = teamNamesList.querySelectorAll('.team-input-wrapper');
            const teamCount = teamWrappers.length;
            addTeamBtn.disabled = teamCount >= 4;
            teamWrappers.forEach((wrapper, index) => {
                const removeBtn = wrapper.querySelector('.remove-team-btn');
                if (removeBtn) removeBtn.disabled = teamCount <= 2;
            });
        }
        updateTeamRemoveButtonsState(); 

        startGameBtn.addEventListener('click', () => {
            if (backgroundMusic.paused) { 
                initBackgroundMusic();
            }
            playSoundWithCallback(startGameSound, actualStartGame);
        });

        function actualStartGame() {
            gameState.currentRound = 0; 
            gameState.usedItems = [];
            gameState.scores = {};

            if (gameState.gameMode === 'single') {
                gameState.players = ['You'];
            } else {
                gameState.players = Array.from(teamNamesList.querySelectorAll('.team-name-input'))
                    .map((input, index) => input.value.trim() || `Team ${index + 1}`)
                    .filter(name => name !== '');
                if (gameState.players.length < 2) {
                    showFeedbackMessage('Multiplayer needs at least 2 teams!', 'danger');
                    return;
                }
            }
            gameState.players.forEach(player => gameState.scores[player] = 0);

            nextRoundBtn.innerHTML = 'Next Round <i class="fas fa-arrow-right"></i>';
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            setupRound(); 
        }


        // --- Game Logic ---
        function setupRound() {
            gameState.currentRound++;
            if (gameState.currentRound > gameState.maxRounds) {
                 showGameOver();
                 return;
            }
            
            leftCurtain.classList.remove('open');
            rightCurtain.classList.remove('open');
            mediaImageEl.classList.remove('visible'); // For smooth fade-in
            mediaVideoEl.classList.remove('visible');
            mediaDescriptionEl.classList.remove('visible');


            let availableItems = gameState.mediaItems.filter(item => !gameState.usedItems.includes(item.url));
            if (availableItems.length === 0) { 
                gameState.usedItems = [];
                availableItems = [...gameState.mediaItems];
            }
            const randomIndex = Math.floor(Math.random() * availableItems.length);
            gameState.currentMedia = availableItems[randomIndex];
            gameState.usedItems.push(gameState.currentMedia.url);

            gameState.singlePlayerChoice = null;
            gameState.roundPlayerChoices = {};
            gameState.currentPlayerIndexInRound = 0;

            roundNumberEl.textContent = gameState.currentRound;
            if (gameState.gameMode === 'single') {
                scoreInfoText.style.display = 'block';
                currentScoreEl.textContent = gameState.scores[gameState.players[0]];
                turnIndicator.style.display = 'none';
            } else {
                scoreInfoText.style.display = 'none'; 
                turnIndicator.style.display = 'block';
                updateTurnIndicator();
            }

            mediaDescriptionEl.textContent = gameState.currentMedia.description;
            mediaImageEl.style.display = 'none'; // Hide first
            mediaVideoEl.style.display = 'none'; // Hide first
            mediaVideoEl.pause();
            mediaVideoEl.currentTime = 0;

            if (gameState.currentMedia.type === 'image') {
                mediaImageEl.src = gameState.currentMedia.url;
            } else {
                mediaVideoEl.src = gameState.currentMedia.url;
            }
            realBtn.disabled = false;
            aiBtn.disabled = false;
            switchScreen('game'); 

            setTimeout(() => {
                playSound(curtainSound);
                leftCurtain.classList.add('open');
                rightCurtain.classList.add('open');
                setTimeout(() => { // This timeout ensures content fades in after curtains start opening
                    if (gameState.currentMedia.type === 'image') {
                        mediaImageEl.style.display = 'block';
                        mediaImageEl.classList.add('visible');
                    } else {
                        mediaVideoEl.style.display = 'block';
                        mediaVideoEl.classList.add('visible');
                        mediaVideoEl.play().catch(error => console.log("Autoplay prevented in setupRound:", error));
                    }
                    mediaDescriptionEl.classList.add('visible');
                }, 700); // Delay slightly less than curtain animation for overlap
            }, 300); // Delay before curtains start opening
        }

        function updateTurnIndicator() {
            if (gameState.gameMode === 'multi' && gameState.players.length > 0) {
                const currentPlayerName = gameState.players[gameState.currentPlayerIndexInRound];
                turnIndicator.textContent = `${currentPlayerName}'s turn:`;
            }
        }

        realBtn.addEventListener('click', () => makeChoice('real'));
        aiBtn.addEventListener('click', () => makeChoice('ai'));

        function makeChoice(choice) {
            playSound(interactionSound);
            realBtn.disabled = true; 
            aiBtn.disabled = true;

            if (gameState.gameMode === 'single') {
                gameState.singlePlayerChoice = choice;
                processAndShowResults();
            } else { 
                const currentPlayerName = gameState.players[gameState.currentPlayerIndexInRound];
                gameState.roundPlayerChoices[currentPlayerName] = choice;
                gameState.currentPlayerIndexInRound++;

                if (gameState.currentPlayerIndexInRound < gameState.players.length) {
                    updateTurnIndicator();
                    setTimeout(() => {
                        realBtn.disabled = false;
                        aiBtn.disabled = false;
                    }, 300);
                } else { 
                    processAndShowResults();
                }
            }
        }

        function processAndShowResults() {
            if (gameState.currentMedia.type === 'video') {
                mediaVideoEl.pause();
                resultVideoEl.pause(); 
            }

            let feedbackMsg = "";
            let feedbackType = "info"; // Default feedback type

            if (gameState.gameMode === 'single') {
                const player = gameState.players[0];
                const isCorrect = (gameState.singlePlayerChoice === 'real' && !gameState.currentMedia.isAI) ||
                                  (gameState.singlePlayerChoice === 'ai' && gameState.currentMedia.isAI);
                if (isCorrect) {
                    gameState.scores[player]++;
                    playSound(correctAnswerSound);
                    feedbackMsg = "Correct!";
                    feedbackType = "correct";
                } else {
                    playSound(incorrectAnswerSound);
                    feedbackMsg = "Incorrect!";
                    feedbackType = "incorrect";
                }
            } else { 
                const correctPlayersThisRound = [];
                gameState.players.forEach(player => {
                    const playerChoice = gameState.roundPlayerChoices[player];
                    const isCorrect = (playerChoice === 'real' && !gameState.currentMedia.isAI) ||
                                      (playerChoice === 'ai' && gameState.currentMedia.isAI);
                    if (isCorrect) {
                        gameState.scores[player]++;
                        correctPlayersThisRound.push(player);
                    }
                });

                if (correctPlayersThisRound.length > 0) {
                    playSound(correctAnswerSound);
                    if (correctPlayersThisRound.length === 1) {
                        feedbackMsg = `${correctPlayersThisRound[0]} got it right!`;
                    } else if (correctPlayersThisRound.length === gameState.players.length) {
                        feedbackMsg = `Everyone got it right!`;
                    }
                    else {
                        feedbackMsg = `${correctPlayersThisRound.join(' & ')} got it right!`;
                    }
                    feedbackType = "correct";
                } else {
                    playSound(incorrectAnswerSound);
                    feedbackMsg = "No one got it right!";
                    feedbackType = "incorrect";
                }
            }

            showFeedbackMessage(feedbackMsg, feedbackType, 2200); 
            populateResultsScreenDOM(); 
            switchScreen('results');
        }

        function populateResultsScreenDOM() {
            resultImageEl.style.display = 'none';
            resultVideoEl.style.display = 'none';
            resultVideoEl.pause();
            resultVideoEl.currentTime = 0;
            // Make media visible immediately on results screen
            resultImageEl.classList.add('visible'); 
            resultVideoEl.classList.add('visible');
            
            if (gameState.currentMedia.type === 'image') {
                resultImageEl.src = gameState.currentMedia.url;
                resultImageEl.style.display = 'block';
            } else {
                resultVideoEl.src = gameState.currentMedia.url;
                resultVideoEl.style.display = 'block';
                resultVideoEl.play().catch(error => console.log("Result screen autoplay prevented:", error));
            }

            answerDisplayEl.classList.remove('answer-real', 'answer-ai');
            if (gameState.currentMedia.isAI) {
                answerDisplayEl.innerHTML = `<i class="fas fa-robot"></i> This was AI-Generated!`;
                answerDisplayEl.classList.add('answer-ai');
            } else {
                answerDisplayEl.innerHTML = `<i class="fas fa-check-circle"></i> This was Real!`;
                answerDisplayEl.classList.add('answer-real');
            }

            feedbackSummaryEl.style.display = 'none';
            detailedFeedbackAreaEl.style.display = 'none';
            detailedFeedbackAreaEl.innerHTML = ''; 

            if (gameState.gameMode === 'single') {
                feedbackSummaryEl.style.display = 'flex'; 
                feedbackSummaryEl.classList.remove('feedback-correct', 'feedback-incorrect');
                const choice = gameState.singlePlayerChoice;
                const isCorrect = (choice === 'real' && !gameState.currentMedia.isAI) || (choice === 'ai' && gameState.currentMedia.isAI);
                if (isCorrect) {
                    feedbackSummaryEl.innerHTML = `<i class="fas fa-check-circle"></i> You guessed correctly!`;
                    feedbackSummaryEl.classList.add('feedback-correct');
                } else {
                    const correctChoiceText = gameState.currentMedia.isAI ? 'AI' : 'Real';
                    feedbackSummaryEl.innerHTML = `<i class="fas fa-times-circle"></i> Incorrect! You chose ${choice}, it was ${correctChoiceText}.`;
                    feedbackSummaryEl.classList.add('feedback-incorrect');
                }
            } else { 
                detailedFeedbackAreaEl.style.display = 'block';
                gameState.players.forEach(player => {
                    const choice = gameState.roundPlayerChoices[player];
                    if (choice === undefined) return; 
                    const isCorrect = (choice === 'real' && !gameState.currentMedia.isAI) || (choice === 'ai' && gameState.currentMedia.isAI);
                    const entry = document.createElement('div');
                    entry.classList.add('player-feedback-entry');
                    entry.classList.toggle('correct', isCorrect);
                    entry.classList.toggle('incorrect', !isCorrect);
                    const icon = isCorrect ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>';
                    entry.innerHTML = `${icon} <strong>${player}</strong> chose: ${choice}. (${isCorrect ? 'Correct' : 'Incorrect'})`;
                    detailedFeedbackAreaEl.appendChild(entry);
                });
            }

            roundScoreDisplayEl.innerHTML = ''; 
            gameState.players.forEach(player => {
                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card';
                const score = gameState.scores[player];
                const progressWidth = (score / gameState.maxRounds) * 100;
                scoreCard.innerHTML = `
                    <h4>${player}</h4>
                    <div class="score-value">${score}</div>
                    <div class="progress-bar"><div class="progress-fill" style="width: ${progressWidth}%"></div></div>
                `;
                roundScoreDisplayEl.appendChild(scoreCard);
            });

            if (gameState.currentRound >= gameState.maxRounds) {
                nextRoundBtn.innerHTML = 'See Final Results <i class="fas fa-trophy"></i>';
            } else {
                nextRoundBtn.innerHTML = 'Next Round <i class="fas fa-arrow-right"></i>';
            }
        }

        nextRoundBtn.addEventListener('click', () => {
            playSound(interactionSound);
            if (gameState.currentMedia && gameState.currentMedia.type === 'video') resultVideoEl.pause();

            if (gameState.currentRound >= gameState.maxRounds) {
                showGameOver();
            } else {
                setupRound(); 
            }
        });

        // --- Game Over Logic ---
        function showGameOver() {
            finalScoreDisplayEl.innerHTML = ''; 
            let maxScore = -1;
            if (gameState.players.length > 0) {
                const numericScores = gameState.players.map(p => Number(gameState.scores[p]) || 0);
                if (numericScores.length > 0) maxScore = Math.max(...numericScores);
            }

            gameState.players.forEach(player => {
                const scoreCard = document.createElement('div');
                scoreCard.className = 'score-card';
                const score = Number(gameState.scores[player]) || 0;
                if (score === maxScore && maxScore > 0 && gameState.players.length > 1) { 
                    scoreCard.classList.add('winner-glow');
                } else if (gameState.gameMode === 'single' && score >= Math.ceil(gameState.maxRounds * 0.6) && score > 0) {
                     scoreCard.classList.add('winner-glow'); 
                }
                scoreCard.innerHTML = `
                    <h4>${player}</h4>
                    <div class="score-value">${score}</div>
                `;
                finalScoreDisplayEl.appendChild(scoreCard);
            });

            if (gameState.gameMode === 'single') {
                const score = Number(gameState.scores[gameState.players[0]]) || 0;
                if (score === gameState.maxRounds) {
                    winMessageTextEl.textContent = "Perfect Score!";
                    finalMessageDetailsEl.textContent = "You're an expert at spotting AI! Amazing!";
                    winnerTrophyEl.textContent = '🌟';
                } else if (score >= Math.ceil(gameState.maxRounds * 0.6)) { 
                    winMessageTextEl.textContent = "Great Job!";
                    finalMessageDetailsEl.textContent = `You correctly identified ${score} out of ${gameState.maxRounds}. Well done!`;
                    winnerTrophyEl.textContent = '🏆';
                } else {
                    winMessageTextEl.textContent = "Nice Try!";
                    finalMessageDetailsEl.textContent = `You got ${score} out of ${gameState.maxRounds}. Keep practicing!`;
                    winnerTrophyEl.textContent = '👍';
                }
            } else { 
                const winners = gameState.players.filter(p => (Number(gameState.scores[p]) || 0) === maxScore && maxScore > 0);
                 if (winners.length === 1) {
                    winMessageTextEl.textContent = `${winners[0]} Wins!`;
                    finalMessageDetailsEl.textContent = `Congratulations on the highest score of ${maxScore}!`;
                } else if (winners.length > 1) {
                    winMessageTextEl.textContent = "It's a Tie!";
                    finalMessageDetailsEl.textContent = `${winners.join(' and ')} all scored ${maxScore}!`;
                } else { 
                    winMessageTextEl.textContent = "Game Complete!";
                    finalMessageDetailsEl.textContent = "Better luck next time! Check scores below.";
                }
                winnerTrophyEl.textContent = '🎉';
            }
            
            if (!treatYourselfElement) {
                treatYourselfElement = document.createElement('div');
                treatYourselfElement.className = 'treat-yourself-callout';
                treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`;
                storeButtonWrapper.insertBefore(treatYourselfElement, visitStoreBtn); 
            }
            treatYourselfElement.style.display = 'flex'; 

            triggerConfetti();
            switchScreen('gameOver');
        }

        playAgainBtn.addEventListener('click', () => {
            playSoundWithCallback(startGameSound, actualStartGame); 
        });
        newGameMenuBtn.addEventListener('click', () => {
            playSound(interactionSound);
            teamNamesList.innerHTML = `
                <div class="team-input-wrapper"><input type="text" class="team-name-input" placeholder="Team 1"></div>
                <div class="team-input-wrapper"><input type="text" class="team-name-input" placeholder="Team 2"></div>
            `;
            updateTeamRemoveButtonsState();
            if (modeOptions.length > 0) modeOptions[0].click(); 
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            switchScreen('start');
        });
       visitStoreBtn.addEventListener('click', () => {
    playSound(interactionSound);
    // Change this line to navigate to the /store route oo
    window.location.href = '/store'; 
}); 

        // Initial Setup on Load
        document.addEventListener('DOMContentLoaded', () => {
            sfxToggleBtn.classList.toggle('btn-success', gameState.sfxEnabled);
            sfxToggleBtn.classList.toggle('btn-danger', !gameState.sfxEnabled);
            sfxToggleBtn.textContent = `SFX: ${gameState.sfxEnabled ? 'ON' : 'OFF'}`; // Set initial text
            bgmVolumeSlider.value = gameState.musicVolume;
            if (modeOptions.length > 0) modeOptions[0].click(); 
            updateTeamRemoveButtonsState();
            switchScreen('start');
        });

    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>
</body>
</html>