<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Point Pursuit - Game Show Edition!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300..700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles from Guess The Price */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary: #FF8833; /* Blyza Orange */
            --secondary: #CB7AE1; /* Blyza Purple */
            --light: #F2F2F2;
            --success: #00BFA6; /* Blyza Keppel */
            --danger: #ff4b2b;
            --dark: #1a1c20;
            --darker: #0f1012;
            --info: #4ECDC4;
            --gold: #FFD700; /* Game show gold */
            --stage-bg: #2c3e50; /* Dark blueish stage background for question reveal */
            --curtain-color: #c0392b; /* Deep red for curtains */
            --spotlight-color: rgba(255, 223, 0, 0.6); /* Gold spotlight */
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1000px; /* Can be wider for Jeopardy board */
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 1px rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .brand-logo {
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .brand-logo-prominent {
            display: block;
            margin: 0 auto 20px;
            max-height: 80px; /* Match GTP */
        }

        h1 { /* Main Game Title */
            font-family: "Luckiest Guy", cursive;
            font-size: 3rem; /* Match GTP */
            margin-bottom: 25px;
            color: var(--gold);
            text-shadow:
                0 2px 0px #000,
                0 4px 6px rgba(0, 0, 0, 0.5),
                0 0 30px var(--primary);
            letter-spacing: 1px;
            margin-top: 10px;
        }
         h2 { /* Screen Titles like "Set Up Your Teams" */
            font-family: "Bungee", cursive;
            font-size: 1.8rem; /* Match GTP */
            margin-bottom: 20px;
            color: var(--primary); /* Use primary or gold for more prominence */
            text-shadow: 0 1px 2px #000;
         }


        /* Screen Styles */
        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .active { display: block; }

        /* Instructions Section - GTP Style */
        .instructions {
            font-family: "Quicksand", sans-serif;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            line-height: 1.8;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            text-align: left;
        }
        .instructions p {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--light);
        }
         .instructions p strong { color: var(--primary); font-family: "Bungee", cursive; }

        /* Team Setup - GTP Style */
        .team-setup-controls {
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1); /* Softer border */
        }
        .team-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Wider inputs */
            gap: 20px;
            margin-bottom: 20px;
        }
        .team-input-container input {
            width: 100%;
            padding: 15px 20px; /* Match GTP team-input */
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            transition: all 0.3s ease;
            font-family: 'Quicksand', sans-serif;
        }
        .team-input-container input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 10px rgba(203, 122, 225, 0.2);
        }
        .team-add-remove-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        /* Small buttons like Add/Remove Team (inherits main button, then override) */
        .team-add-remove-buttons button {
            padding: 10px 20px !important;
            font-size: 0.9rem !important;
        }


        /* Game Board - Jeopardy Style with GTP aesthetics */
        .game-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 categories */
            gap: 10px; /* Increased gap */
            margin: 30px 0;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            border: 2px solid var(--gold);
            box-shadow: 0 0 20px rgba(var(--gold-rgb), 0.3); /* Assuming --gold-rgb is defined or use var(--gold) */
        }
        .category-header {
            background: var(--dark);
            color: var(--gold);
            padding: 15px 10px;
            font-weight: 700;
            font-size: 1rem; /* Responsive sizing handled later */
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 80px; /* Increased height */
            font-family: "Bungee", cursive;
            border: 1px solid var(--gold);
            text-shadow: 0 1px 2px #000;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
        }
        .value-cell {
            background: linear-gradient(135deg, var(--primary) 0%, #ff7711 80%);
            color: var(--light);
            padding: 15px 10px;
            font-size: 1.8rem; /* Larger points */
            cursor: pointer;
            min-height: 80px; /* Increased height */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            border: 2px solid var(--darker);
            transition: all 0.3s ease;
            font-family: "Bungee", cursive; /* For the numbers */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3), inset 0 -2px 4px rgba(0,0,0,0.2);
        }
        .value-cell:hover:not(.used) {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4), inset 0 -2px 4px rgba(0,0,0,0.2), 0 0 15px var(--primary);
        }
        .value-cell.used {
            background: rgba(255, 255, 255, 0.03);
            color: rgba(242, 242, 242, 0.2);
            border-color: rgba(255,255,255,0.1);
            cursor: not-allowed;
            pointer-events: none;
            text-shadow: none;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Question Screen - GTP Stage Style */
        .question-screen-content {
            background: var(--stage-bg); /* Match GTP stage */
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
            border: 3px solid var(--gold);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden; /* For curtains and spotlights */
        }
        /* Spotlights for question stage */
        .question-screen-content::before, .question-screen-content::after {
            content: '';
            position: absolute;
            top: -50px;
            width: 200px;
            height: 300px;
            background: radial-gradient(ellipse at center, var(--spotlight-color) 0%, transparent 70%);
            pointer-events: none;
            opacity: 0.7;
            z-index: 0; /* Behind content */
        }
        .question-screen-content::before { left: -50px; transform: rotate(-30deg); }
        .question-screen-content::after { right: -50px; transform: rotate(30deg); }

        .question-category-value {
            font-family: "Bungee", cursive;
            color: var(--gold);
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-shadow: 0 1px 2px #000;
            position: relative; z-index: 2;
        }
        /* Container for curtains and question text */
        .question-reveal-area {
            background: #111; /* TV Screen BG */
            border: 10px solid #333;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            z-index: 1;
            min-height: 150px; /* Ensure space for question */
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            overflow: hidden; /* Important for curtains */
        }
        .stage-curtains {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            background-color: var(--curtain-color);
            background-image: linear-gradient(rgba(0,0,0,0.2) 50%, transparent 50%),
                              linear-gradient(90deg, rgba(0,0,0,0.2) 50%, transparent 50%);
            background-size: 50px 50px;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            transition: transform 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 5; /* Above question text initially */
        }
        .stage-curtains.left { left: 0; border-right: 3px solid #a52a20; }
        .stage-curtains.right { right: 0; border-left: 3px solid #a52a20; }
        .stage-curtains.open.left { transform: translateX(-100%); }
        .stage-curtains.open.right { transform: translateX(100%); }

        .question-text-display {
            font-size: 1.4em; /* Slightly smaller to fit better */
            color: var(--light);
            font-weight: 600;
            text-align: center;
            padding: 10px;
            opacity: 0; /* Hidden until curtains open */
            transition: opacity 0.5s ease-in 0.7s; /* Fade in after curtains start opening */
            position: relative; z-index: 2;
        }
        .question-text-display.visible { opacity: 1; }


        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 options per row */
            gap: 15px;
            margin: 25px 0;
            position: relative; z-index: 2;
        }
        .option-btn {
            /* Inherits general button style, specific overrides below */
            background: linear-gradient(135deg, rgba(var(--secondary-rgb, 203,122,225),0.6) 0%, rgba(var(--secondary-rgb, 203,122,225),0.4) 100%);
            border: 2px solid rgba(var(--secondary-rgb, 203,122,225),0.8);
            color: var(--light);
            font-family: "Quicksand", sans-serif; /* Options use Quicksand */
            font-weight: 600;
            text-shadow: none; /* Remove Bungee shadow */
        }
        .option-btn i { margin-right: 10px; }

        .option-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--secondary) 0%, #b85cd6 100%);
            border-color: var(--secondary);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--secondary);
        }
        .option-btn.correct-answer-reveal {
            background: linear-gradient(135deg, var(--success) 0%, #00a890 100%) !important;
            border-color: var(--success) !important;
            box-shadow: 0 0 15px rgba(0, 191, 166, 0.3);
        }
         .option-btn.selected-wrong {
             background: linear-gradient(135deg, var(--danger) 0%, #ff416c 100%) !important;
             border-color: var(--danger) !important;
         }
        #continue-game-btn { position: relative; z-index: 2; }


        /* Team Display (Scoreboard) - GTP Style */
        .team-display {
            display: flex;
            justify-content: space-around;
            gap: 15px; /* Slightly reduced gap */
            margin: 25px 0;
            flex-wrap: wrap;
        }
        .team-card {
            background: rgba(0,0,0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--gold);
            transition: all 0.3s ease;
            min-width: 160px; /* Adjusted size */
            text-align: center;
            flex-basis: 200px; /* Control size better */
            flex-grow: 1;
            max-width: 230px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        .team-card.active {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 136, 51, 0.3), 0 0 10px var(--gold),
                        inset 0 0 10px rgba(255, 136, 51, 0.1);
            transform: scale(1.05);
            background: rgba(var(--primary-rgb, 255,136,51), 0.1);
        }
        .team-name { /* Team name on card */
            font-family: "Bungee", cursive;
            font-weight: normal; /* Bungee is bold */
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--primary);
        }
        .team-score { /* Score on card */
            font-family: "Orbitron", sans-serif; /* Match GTP price display */
            font-size: 2rem;
            color: var(--light);
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.4), 0 0 10px var(--gold);
        }
        #question-screen-team-display .team-card { /* For the single team card on question screen */
            margin-left: auto;
            margin-right: auto;
            max-width: 300px; /* Wider for focus */
            border-color: var(--primary); /* Always highlight */
        }
        #question-screen-team-display .team-name { color: var(--gold); }


        /* Feedback Pop-up - GTP Style */
        .feedback-popup {
            position: fixed; top: 50%; left: 50%;
            background-color: rgba(15, 16, 18, 0.97);
            color: white; padding: 30px 50px;
            border-radius: 20px;
            font-size: 2.8rem;
            font-family: "Luckiest Guy", cursive; text-align: center;
            z-index: 2000; box-shadow: 0 15px 40px rgba(0,0,0,0.7);
            opacity: 0; transform: translate(-50%, -50%) scale(0.7);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none; border: 3px solid var(--gold);
            display: none; /* JS toggles .show */
        }
        .feedback-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; display: block; }
        .feedback-popup.correct { color: var(--success); border-color: var(--success); text-shadow: 0 0 15px var(--success); }
        .feedback-popup.incorrect { color: var(--danger); border-color: var(--danger); text-shadow: 0 0 15px var(--danger); }
        .feedback-popup.info { color: var(--info); border-color: var(--info); text-shadow: 0 0 15px var(--info); }


        /* Buttons - GTP Style */
        button {
            background: linear-gradient(135deg, var(--primary) 0%, #ff7711 100%);
            color: var(--light);
            border: 2px solid var(--darker);
            padding: 15px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: normal; /* Bungee is bold */
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), inset 0 -2px 5px rgba(0,0,0,0.2);
            margin: 10px 5px;
            font-family: "Bungee", cursive;
            text-shadow: 1px 1px 2px #000;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-shrink: 0;
        }
        button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--primary);
            background: linear-gradient(135deg, #ff7711 0%, var(--primary) 100%);
        }
        button:active:not(:disabled) { transform: translateY(-1px) scale(1.02); }
        button:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed; opacity: 0.6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transform: none; border-color: rgba(0,0,0,0.5);
        }

        .btn-primary {} /* Default */
        .btn-secondary { background: linear-gradient(135deg, var(--secondary) 0%, #b85cd6 100%); }
        .btn-secondary:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--secondary); }
        .btn-success { background: linear-gradient(135deg, var(--success) 0%, #00a890 100%); }
        .btn-success:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--success); }
        .btn-danger { background: linear-gradient(135deg, var(--danger) 0%, #ff416c 100%); }
        .btn-danger:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--danger); }
        .btn-info { background: linear-gradient(135deg, var(--info) 0%, #3eb7af 100%); }
        .btn-info:hover:not(:disabled) { box-shadow: 0 8px 25px rgba(0,0,0,0.4), inset 0 -2px 5px rgba(0,0,0,0.2), 0 0 10px var(--info); }


        /* Win Screen Specifics - GTP Style */
        .win-message {
            font-size: 3rem;
            margin: 30px 0;
            color: var(--gold);
            text-shadow: 0 3px 0px #000, 0 0 20px var(--primary);
            font-family: "Luckiest Guy", cursive;
        }
        .winner-trophy {
            font-size: 6rem;
            margin: 20px 0 30px 0;
            animation: bounce 1.5s infinite ease-in-out;
            color: var(--gold);
            text-shadow: 0 0 20px var(--gold), 0 0 30px var(--primary);
        }
        @keyframes bounce { /* GTP bounce */
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-35px) scale(1.1); }
        }
        /* Game Over Buttons & Treat Yourself - GTP Style */
        .game-over-buttons-container {
            display: flex; justify-content: center; align-items: flex-start;
            flex-wrap: wrap; gap: 10px; margin-top: 20px;
        }
        .game-over-button-wrapper {
            position: relative; display: flex; flex-direction: column; align-items: center;
        }
        .treat-yourself-callout {
            margin-bottom: 8px; background-color: var(--gold); color: var(--darker);
            padding: 8px 15px; border-radius: 20px; font-family: "Bungee", cursive;
            font-size: 0.9rem; white-space: nowrap; box-shadow: 0 2px 10px rgba(255,215,0,0.5);
            display: none; align-items: center; gap: 8px; z-index: 10;
        }
        .treat-yourself-callout i { font-size: 1.2em; animation: bounceArrow 1s infinite; }
        @keyframes bounceArrow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }


        /* Settings Icon Button - GTP Style */
        .icon-btn {
            position: absolute;
            background: rgba(0,0,0, 0.3); color: var(--light);
            border: 1px solid var(--gold); border-radius: 50%;
            width: 40px; height: 40px; font-size: 1.1rem;
            cursor: pointer; transition: all 0.3s ease;
            display: flex; justify-content: center; align-items: center;
            z-index: 100; padding: 0; margin: 0;
            box-shadow: none; text-shadow: none; /* Remove general button styles */
        }
        .icon-btn#settings-btn { top: 15px; right: 15px; }
        .icon-btn:hover {
            background: rgba(0,0,0, 0.5); transform: scale(1.1) rotate(15deg);
            box-shadow: 0 0 10px var(--gold);
        }
        .icon-btn i { margin: 0; }


        /* Modal Styles - GTP Style */
        .modal {
            position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: var(--darker); margin: auto; padding: 30px;
            border: 2px solid var(--gold); border-radius: 15px;
            width: 80%; max-width: 450px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6), 0 0 20px var(--primary);
            position: relative; color: var(--light);
        }
        .modal-content h2 {
            font-family: "Bungee", cursive; color: var(--primary);
            text-align: center; margin-bottom: 25px; font-size: 1.8rem;
        }
        .setting-item { margin-bottom: 20px; display: flex; flex-direction: column; }
        .setting-item label { margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;}
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
          -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
          background: var(--primary); cursor: pointer; margin-top: -7px;
          box-shadow: 0 0 8px var(--primary);
        }
        input[type=range]::-moz-range-thumb {
          height: 20px; width: 20px; border-radius: 50%; background: var(--primary);
          cursor: pointer; border: none; box-shadow: 0 0 8px var(--primary);
        }
        input[type=range]::-webkit-slider-runnable-track {
          width: 100%; height: 6px; cursor: pointer; background: rgba(255,255,255,0.2);
          border-radius: 3px; border: 1px solid rgba(0,0,0,0.2);
        }
        input[type=range]::-moz-range-track {
          width: 100%; height: 6px; cursor: pointer; background: rgba(255,255,255,0.2);
          border-radius: 3px; border: 1px solid rgba(0,0,0,0.2);
        }
        .close-modal-btn {
            color: #aaa; position: absolute; top: 15px; right: 20px;
            font-size: 28px; font-weight: bold; cursor: pointer;
        }
        .close-modal-btn:hover, .close-modal-btn:focus { color: var(--light); text-decoration: none; }

        /* Confetti Styles */
        .confetti-piece {
            position: fixed; width: 10px; height: 20px; /* Match GTP */
            background-color: var(--primary); opacity: 0;
            animation-timing-function: linear; animation-fill-mode: forwards;
            pointer-events: none; z-index: 3000;
        }
        @keyframes fallAndFade { /* Match GTP */
            0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(120vh) rotate(720deg); opacity: 0; }
        }


        /* Responsive - adapted from GTP and Point Pursuit Original */
        @media (max-width: 800px) { /* Wider breakpoint for board */
            .game-container { padding: 20px; }
            h1 { font-size: 2.5rem; }
            h2 { font-size: 1.6rem; }
            .game-board { grid-template-columns: repeat(3, 1fr); gap: 8px;} /* Test 3 columns */
            .category-header { font-size: 0.8rem; min-height: 65px; padding: 8px 5px;}
            .value-cell { font-size: 1.5em; min-height: 65px; padding: 10px 5px;}
            .options-container { grid-template-columns: 1fr; } /* Stack options on smaller screens */
            .team-display { flex-direction: column; align-items: center; }
            .team-card { min-width: 220px; max-width: 90%; margin-bottom: 10px;}
        }
        @media (max-width: 600px) {
            h1 { font-size: 2.2rem; }
            .game-board { grid-template-columns: repeat(2, 1fr); gap: 6px;} /* Test 2 columns */
            .category-header { font-size: 0.7rem; min-height: 55px;}
            .value-cell { font-size: 1.3em; min-height: 55px;}
            .question-text-display { font-size: 1.2em; padding: 15px; min-height: 120px;}
            .feedback-popup { font-size: 2rem; padding: 25px 35px; width: 90%; }
            .modal-content { padding: 20px; }
            .options-container { gap: 10px; } /* Tighter gap for stacked options */
            .option-btn { font-size: 0.9rem; padding: 12px 15px; }
            .game-over-buttons-container { flex-direction: column; align-items: center; }
            .game-over-buttons-container .game-over-button-wrapper { width: 90%; margin: 5px auto; }
            .game-over-buttons-container .game-over-button-wrapper button { width: 100%; }
            .question-screen-content::before, .question-screen-content::after { display: none; } /* Hide spotlights on small */
        }
         @media (max-width: 420px) {
             h1 { font-size: 2rem; }
             .game-board { grid-template-columns: 1fr; } /* Single column for smallest */
             .category-header, .value-cell { min-height: 50px; font-size: 1.2em; }
             .icon-btn { top: 10px; right: 10px; width: 35px; height: 35px; font-size: 1rem; }
             .team-input-container input { padding: 12px 15px; font-size: 1rem;}
             .team-add-remove-buttons button { padding: 8px 15px !important; font-size: 0.8rem !important;}
             .win-message { font-size: 2.2rem; }
             .winner-trophy { font-size: 5rem; }
         }

    </style>
</head>
<body>
    <div class="game-container">
        <img id="corner-logo-static" class="brand-logo" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot" style="position: absolute; top: 20px; left: 20px; max-height: 40px; opacity: 0.7; display: none;">
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Start Screen -->
        <div class="screen active" id="start-screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Point Pursuit</h1>
            <div class="instructions">
                <p><strong>Welcome to Point Pursuit!</strong> Test your knowledge in this Jeopardy-style game.</p>
                <p>Select a category and point value. Answer correctly to earn points. Wrong answers will deduct half the points! Choose your teams and let the battle of wits begin!</p>
            </div>
            <button id="setup-teams-btn" class="btn-primary">
                <i class="fas fa-users"></i> Setup Teams
            </button>
        </div>

        <!-- Team Setup Screen -->
        <div class="screen" id="team-setup-screen">
            <h2>Set Up Your Teams</h2>
            <div class="team-setup-controls">
                <p class="info-text" style="font-size: 0.9rem; margin-top: -15px; margin-bottom: 20px; color: var(--light_dim);">(2-4 Teams)</p>
                <div class="team-inputs" id="team-inputs-container">
                    <div class="team-input-container">
                        <input type="text" class="team-name-input" placeholder="Team 1 Name">
                    </div>
                    <div class="team-input-container">
                        <input type="text" class="team-name-input" placeholder="Team 2 Name">
                    </div>
                </div>
                <div class="team-add-remove-buttons">
                    <button id="add-team-btn" class="btn-secondary">
                        <i class="fas fa-plus-circle"></i> Add Team
                    </button>
                    <button id="remove-team-btn" class="btn-danger">
                        <i class="fas fa-minus-circle"></i> Remove Team
                    </button>
                </div>
            </div>
            <button id="begin-game-btn" class="btn-primary">
                <i class="fas fa-play"></i> Begin Game
            </button>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="game-screen">
            <h1>Point Pursuit</h1>
            <div class="team-display" id="team-display-board"></div>
            <div class="game-board" id="game-board-display"></div>
        </div>

        <!-- Question Screen -->
        <div class="screen" id="question-screen">
            <!-- Team display first for context -->
            <div class="team-display" id="question-screen-team-display"></div>
            <div class="question-screen-content">
                <div id="question-category-value-text" class="question-category-value">Category - $Value</div>
                <div class="question-reveal-area">
                    <div class="stage-curtains left" id="question-curtain-left"></div>
                    <div class="stage-curtains right" id="question-curtain-right"></div>
                    <div class="question-text-display" id="question-text-area">Question text...</div>
                </div>
                <div class="options-container" id="options-container-display">
                    <!-- Options will be generated by JS -->
                </div>
                <button class="btn-secondary" id="continue-game-btn" style="display: none;">
                    <i class="fas fa-arrow-right"></i> Continue
                </button>
            </div>
        </div>


        <!-- Final Results Screen -->
        <div class="screen" id="final-results-screen">
             <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Final Results</h1>
            <div class="win-message" id="win-message-text">Winner Message!</div>
            <div class="winner-trophy">🏆</div>
            <div class="team-display" id="final-team-display-area" style="margin-bottom: 30px;"></div>

            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                    <button id="play-again-btn" class="btn-success">
                        <i class="fas fa-redo"></i> Play Again
                    </button>
                </div>
                 <div class="game-over-button-wrapper">
                    <button id="main-menu-btn" class="btn-secondary">
                        <i class="fas fa-home"></i> Main Menu
                    </button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper">
                    <!-- Treat Yourself callout will be inserted here -->
                    <button id="visit-store-btn" class="btn-info">
                        <i class="fas fa-store"></i> Visit Store
                    </button>
                </div>
            </div>
        </div>

        <!-- Feedback Pop-up (used for correct/wrong answers) -->
        <div id="feedback-popup" class="feedback-popup"> <!-- display:none is default in CSS, .show class handles visibility -->
            <span id="feedback-message-text-el"></span>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <span id="close-modal-btn" class="close-modal-btn">×</span>
                <h2>Settings</h2>
                <div class="setting-item">
                    <label for="bgm-volume-slider">Background Music Volume:</label>
                    <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2">
                </div>
                <div class="setting-item">
                    <label for="sfx-toggle-btn">Sound Effects:</label>
                    <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio elements -->
    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="question-select-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="correct-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="wrong-answer-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="curtain-sound" src="https://static.wixstatic.com/mp3/9ce3e5_ccd36cdf98bf4e1594cf2e52d5296c51.wav"></audio>
    <audio id="confetti-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>


    <script>
        const gameConfig = {
            sfxEnabled: true,
            musicVolume: 0.2,
            minTeams: 2,
            maxTeams: 4
        };

        const gameState = {
            teams: [],
            categories: ["General Knowledge", "Pop Culture", "Science", "Sports", "History"],
            values: [100, 200, 300, 400, 500],
            questions: {}, // Populated from questionsDatabase
            currentQuestionData: null,
            currentTeamIndex: 0,
            usedQuestions: [] // Stores "category-value" strings
        };

        // ... (Keep your extensive questionsDatabase here)
        const questionsDatabase = {
            "General Knowledge": {
                100: [ { question: "Who painted the Mona Lisa?", options: ["Leonardo da Vinci", "Vincent van Gogh", "Pablo Picasso", "Michelangelo"], answer: 0 }, { question: "Which planet is known as the Red Planet?", options: ["Venus", "Mars", "Jupiter", "Saturn"], answer: 1 }, { question: "What is the longest river in the world?", options: ["Indus", "Amazon", "Nile", "Danube"], answer: 2 } ],
                200: [ { question: "What is the capital of Canada?", options: ["Montreal", "Toronto", "Vancouver", "Ottawa"], answer: 3 }, { question: "What is the national language of Brazil?", options: ["Spanish", "Brazillian", "Portuguese", "English"], answer: 2 }, { question: "What is the chemical symbol for Potassium?", options: ["Au", "K", "Pt", "P"], answer: 1 } ],
                300: [ { question: "Which one of the following countries has an Airport?", options: ["Vatican", "Palau", "Andorra", "Monaco"], answer: 1 }, { question: "When did World War 1 end", options: ["1915", "1916", "1917", "1918"], answer: 3 }, { question: "How many prime numbers are there between 1 - 100?", options: ["23", "24", "25", "26"], answer: 2 } ],
                400: [ { question: "Who was the first woman to win a Nobel Prize?", options: ["Irène Curie", "Marie Curie", "Mother Teresa", "Malala Yousafzai"], answer: 1 }, { question: "Which country gifted the Statue of Liberty to the US?", options: ["England", "France", "Spain", "Italy"], answer: 1 }, { question: "Which ancient civilization built Machu Picchu?", options: ["Inca", "Egyptian", "Indus", "Paracas"], answer: 0 } ],
                500: [ { question: "Which country has the most Pyramids?", options: ["Sudan", "Egypt", "Jordan", "El Salvador"], answer: 0 }, { question: "What is the oldest University in the wrold?", options: ["The University of Bologna", "University of Salamanca ", "University of Oxford", "University of Al Quaraouiyine"], answer: 3 }, { question: "What is the mean annual temperature of the interior in Antarctica?", options: ["-35°C", "-43.5°C", "-48.5°C", "-55°C"], answer: 1 } ]
            },
            "Pop Culture": {
                100: [ { question: "Who is known as the 'Queen of Pop'?", options: ["Beyoncé", "Madonna", "Lady Gaga", "Taylor Swift"], answer: 1 }, { question: "Which actor played the lead role in the Pirates of the Caribbean movies?", options: ["Robert Downey Jr.", "Johnny Depp", "Tom Hanks", "Matt Damon"], answer: 1 }, { question: "When did the Titanic release?", options: ["1990", "1998", "2002", "2005"], answer: 1 } ],
                200: [ { question: "What was the first Disney animated feature film?", options: ["Lion King", "Toy Story 1", "Snow White and the Seven Dwarfs", "Pinocchio"], answer: 2 }, { question: "What reality show made Harry Styles famous?", options: ["Britan's Got Talent", "The Voice", "Fear Factor", "X Factor"], answer: 3 }, { question: "Who was the first person to reach 100 million followers on Instagram?", options: ["Selena Gomez", "Katy Perry", "Cristiano Ronaldo", "Lady Gaga"], answer: 0 } ],
                300: [ { question: "What year did Meta acquire Instagram?", options: ["2010", "2011", "2012", "2013"], answer: 2 }, { question: "How many Youtube channels have over 10 million subscribers?", options: ["1100", "1600", "1900", "2100"], answer: 3 }, { question: "What was Twitter's total revenue in 2017?", options: ["2.2B", "2.4B", "2.7B", "3.5B"], answer: 3 } ],
                400: [ { question: "What is the real name of The Weeknd?", options: ["Abel Tesfaye", "Abel Fred", "Abel Myrtle", "Weekday"], answer: 0 }, { question: "What was the name of Ross and Rachel's baby in Friends?", options: ["Jack", "Ben", "Chloe", "Emma"], answer: 3 }, { question: "Who was the most subscriber streamer on Twitch in 2019?", options: ["Ninja", "TFue", "Kai Cenat", "Ludwig"], answer: 1 } ],
                500: [ { question: "What was the first music video to air on MTV?", options: ["Thriller - Michael Jackson", "Video Killed the Radio Star - The Buggles", "Like a Virgin - Madonna", "Billie Jean - Michael Jackson"], answer: 1 }, { question: "What song holds the record for most weeks at #1 on Billboard Hot 100?", options: ["Old Town Road", "Gods Plan", "Shape of You", "Despacito"], answer: 0 }, { question: "What is the name of Ariana Grande’s perfume line?", options: ["Sky", "Air", "Blue", "Cloud"], answer: 3 } ]
            },
            "Science": {
                100: [ { question: "What is the most abundant gas on Earth?", options: ["Nitrogen", "Oxygen", "Carbon Dioxide", "Hellium"], answer: 0 }, { question: "Who discovered gravity?", options: ["Albert Einstein", "Thomas Edison", "Isaac Newton", "Charles Darwin"], answer: 2 }, { question: "Largest planet in our Solar System?", options: ["Earth", "Jupiter", "Neptune", "Uranus"], answer: 1 } ],
                200: [ { question: "What is the approximate speed of light?", options: ["300,000,000 m/s", "300,000,000 km/s", "300,000,000 miles/s", "300,000,000 feet/s"], answer: 0 }, { question: "Which part of the plant conducts photosynthesis?", options: ["Stem", "Root", "Flower", "Leave"], answer: 3 }, { question: "What particle has a negative charge?", options: ["Proton", "Electron", "Neutron", "Atom"], answer: 1 } ],
                300: [ { question: "What’s the main gas on the Sun?", options: ["Carbon", "Nitrogen", "Hydrogen", "Helium"], answer: 2 }, { question: "According to Newton's 2nd Law, what is the formula for Force?", options: ["Mass/Acceleration", "Acceleration/Mass", "Mass x Acceleration", "Gravitaional pull x Volume"], answer: 2 }, { question: "What is the name of the phenomenon where light bends as it passes from one medium to another?", options: ["Scattering", "Reflection", "Mirage", "Refraction"], answer: 3 } ],
                400: [ { question: "What’s the heaviest naturally occurring element (by atomic mass)?", options: ["Uranium", "Tungsten", "Titanium", "Platinum"], answer: 0 }, { question: "What is the study of fossils called?", options: ["Geology", "Paleontology", "Archaeology", "Anthropology"], answer: 1 }, { question: "What is the study of earthquakes called?", options: ["Geology", "Paleontology", "Anthropology", "Seismology"], answer: 3 } ],
                500: [ { question: "Which blood type is a universal donor?", options: ["O Negative", "O Positive", "B Positive", "B Negative"], answer: 0 }, { question: "How do you spell Science?", options: ["Sceince", "Scince", "Science", "Sciense"], answer: 2 }, { question: "Which of the following is not found inside a Human body?", options: ["Brain", "Heart", "Liver", "GMC Terrain 2016 model"], answer: 3 } ]
            },
            "Sports": {
                100: [ { question: "How many players are on a basketball team?", options: ["5", "6", "7", "8"], answer: 0 }, { question: "In which sport would you perform a slam dunk?", options: ["Football", "Basketball", "Tennis", "Baseball"], answer: 1 }, { question: "How many rings are on the Olympic flag?", options: ["8", "7", "6", "5"], answer: 3 } ],
                200: [ { question: "Which country won the 2010 FIFA World Cup?", options: ["Germany", "Brazil", "France", "Spain"], answer: 3 }, { question: "What is the national sport of Japan?", options: ["Kendo", "Sumo", "Judo", "Karate"], answer: 1 }, { question: "How long is a Marathon?", options: ["26 km", "50 km", "42 km", "34 km"], answer: 2 } ],
                300: [ { question: "Who has won the most Grand Slam titles in men’s tennis?", options: ["Roger Federer", "Novak Djokovic", "Rafael Nadal", "Andy Murray"], answer: 1 }, { question: "Which country hosted the 2004 Summer Olympics?", options: ["France", "Japan", "Greece", "Portugal"], answer: 2 }, { question: "Which athlete has won the most Olympic gold medals?", options: ["Michael Phelps", "Usain Bolt", "Larisa Latynina", "Simone Biles"], answer: 0 } ],
                400: [ { question: "Whats the max achievable score in a single turn of Darts", options: ["150", "180", "200", "240"], answer: 1 }, { question: "Which country has won the most ICC Worlc Cups?", options: ["India", "Pakistan", "South Africa", "Australia"], answer: 3 }, { question: "Who currently has the longest win streak in the UFC?", options: ["Islam Makachev", "Khabib Nurmagomedov", "Jon Jones", "Conor Mcregor"], answer: 2 } ],
                500: [ { question: "What is the diameter of a basketball hoop in inches?", options: ["16", "18", "20", "24"], answer: 1 }, { question: "What country invented table Tennis?", options: ["Thailand", "Phillipines", "China", "England"], answer: 3 }, { question: "Which proffesional Boxer holds the record for the most Knockouts?", options: ["Billy Bird", "Mike Tyson", "Sugar Ray Robinson", "Buck Smith"], answer: 0 } ]
            },
            "History": {
                100: [ { question: "In what year did World War II end?", options: ["1943", "1945", "1947", "1950"], answer: 1 }, { question: "Who was the first president of the United States?", options: ["Thomas Jefferson", "John Adams", "George Washington", "Abraham Lincoln"], answer: 2 }, { question: "Who was the famous queen of Egypt who had a relationship with Julius Caesar and Mark Antony?", options: ["Cleopatra", "Tutankhamun", "Ankhsenamun", "Queen Tiye"], answer: 0 } ],
                200: [ { question: "Which ancient civilization built the pyramids?", options: ["Greeks", "Romans", "Egyptians", "Mayans"], answer: 2 }, { question: "What was the name of the ship that brought the Pilgrims to America?", options: ["Santa Maria", "Mayflower", "Pinta", "Nina"], answer: 1 }, { question: "Who was the British Prime Minister during most of WWII?", options: ["Clement Attlee", "Tony Blair", "Margaret Thatcher", "Winston Churchill"], answer: 3 } ],
                300: [ { question: "Who wrote the Declaration of Independence?", options: ["Benjamin Franklin", "Thomas Jefferson", "John Adams", "George Washington"], answer: 1 }, { question: "When was the Internet made?", options: ["1983", "1988", "1991", "1993"], answer: 0 }, { question: "Who was the first emperor of Rome?", options: ["Julius", "Marcus", "Augustus", "Maximian"], answer: 2 } ],
                400: [ { question: "Who was the first female Prime Minister of the United Kingdom?", options: ["Theresa May", "Margaret Thatcher", "Angela Merkel", "Indira Gandhi"], answer: 1 }, { question: "What was the name of the ancient trade route that connected China to the Mediterranean?", options: ["The Incense Route", "The Silk Road", "The Amber Road", "The Tea Route"], answer: 1 }, { question: "Who was the first man in Space", options: ["Yuri Gagaran", "Neil Armstrong", "Buzz Aldrin", "Buzz Lightyear"], answer: 0 } ],
                500: [ { question: "What country experienced a genocide under the Khmer Rouge?", options: ["Mongolia", "Laos", "Indonesia", "Cambodia"], answer: 3 }, { question: "What was the name of the period of cultural and intellectual rebirth in Europe?", options: ["Enlightenment", "Reformation", "Renaissance", "Industrial Revolution"], answer: 2 }, { question: "Price of 1 oz of gold today is $3200. What was the price in 2001", options: ["$252", "$271", "$293", "$299"], answer: 1 } ]
            }
        };


        // DOM elements
        const screens = {
            start: document.getElementById("start-screen"),
            teamSetup: document.getElementById("team-setup-screen"),
            game: document.getElementById("game-screen"),
            question: document.getElementById("question-screen"),
            results: document.getElementById("final-results-screen")
        };
        const cornerLogoEl = document.getElementById('corner-logo-static');
        const setupTeamsBtnEl = document.getElementById("setup-teams-btn");
        const teamInputsContainerEl = document.getElementById("team-inputs-container");
        const addTeamBtnEl = document.getElementById("add-team-btn");
        const removeTeamBtnEl = document.getElementById("remove-team-btn");
        const beginGameBtnEl = document.getElementById("begin-game-btn");
        const teamDisplayBoardEl = document.getElementById("team-display-board");
        const gameBoardDisplayEl = document.getElementById("game-board-display");

        const questionScreenTeamDisplayEl = document.getElementById("question-screen-team-display");
        const questionCategoryValueTextEl = document.getElementById("question-category-value-text");
        const questionCurtainLeftEl = document.getElementById("question-curtain-left");
        const questionCurtainRightEl = document.getElementById("question-curtain-right");
        const questionTextAreaEl = document.getElementById("question-text-area");
        const optionsContainerDisplayEl = document.getElementById("options-container-display");
        const continueGameBtnEl = document.getElementById("continue-game-btn");

        const finalTeamDisplayAreaEl = document.getElementById("final-team-display-area");
        const winMessageTextEl = document.getElementById("win-message-text");
        const storeButtonWrapperEl = document.getElementById("store-button-wrapper");
        let treatYourselfElement = null; // For the "Treat Yourself" callout
        const playAgainBtnEl = document.getElementById("play-again-btn");
        const mainMenuBtnEl = document.getElementById("main-menu-btn");
        const visitStoreBtnEl = document.getElementById("visit-store-btn");

        const feedbackPopupEl = document.getElementById("feedback-popup");
        const feedbackMessageTextPopupEl = document.getElementById("feedback-message-text-el");
        let feedbackTimeoutId;

        const settingsBtnEl = document.getElementById('settings-btn');
        const settingsModalEl = document.getElementById('settings-modal');
        const closeModalBtnEl = document.getElementById('close-modal-btn');
        const bgmVolumeSliderEl = document.getElementById('bgm-volume-slider');
        const sfxToggleBtnEl = document.getElementById('sfx-toggle-btn');

        const backgroundMusicAudioEl = document.getElementById('background-game-music');
        const startGameSoundAudioEl = document.getElementById('start-game-sound');
        const interactionSoundAudioEl = document.getElementById('interaction-sound');
        const questionSelectSoundAudioEl = document.getElementById('question-select-sound');
        const correctAnswerSoundAudioEl = document.getElementById('correct-answer-sound');
        const wrongAnswerSoundAudioEl = document.getElementById('wrong-answer-sound');
        const curtainSoundAudioEl = document.getElementById('curtain-sound');
        const confettiSoundAudioEl = document.getElementById('confetti-sound');


        // --- Sound Functions ---
        function playSound(audioElement) {
            if (gameConfig.sfxEnabled && audioElement) {
                audioElement.currentTime = 0;
                audioElement.volume = 0.7;
                audioElement.play().catch(e => console.error("SFX play error:", e));
            }
        }
         function playSoundWithCallback(audioElement, callback, ...args) {
            if (gameConfig.sfxEnabled && audioElement) {
                audioElement.currentTime = 0;
                audioElement.volume = 0.7;
                let callbackExecuted = false;
                const executeCallback = () => {
                    if (!callbackExecuted) {
                        callbackExecuted = true;
                        audioElement.removeEventListener('ended', executeCallback);
                        if (soundTimeoutId) clearTimeout(soundTimeoutId);
                        if (callback) callback(...args);
                    }
                };
                audioElement.addEventListener('ended', executeCallback);
                const soundDurationMs = (audioElement.duration && isFinite(audioElement.duration)) ? audioElement.duration * 1000 : 500;
                const soundTimeoutId = setTimeout(executeCallback, soundDurationMs + 200);
                audioElement.play().catch(e => { console.error("SFX play error:", e); executeCallback(); });
            } else {
                if (callback) callback(...args);
            }
        }
        function initBackgroundMusic() {
            backgroundMusicAudioEl.volume = gameConfig.musicVolume;
            backgroundMusicAudioEl.play().catch(e => {
                console.log("Background music autoplay failed. User interaction required.", e);
            });
        }

        // --- Feedback Pop-up Function ---
        function showFeedbackMessage(message, type = 'info', duration = 2500) { // Matched GTP duration
            feedbackMessageTextPopupEl.textContent = message;
            feedbackPopupEl.className = 'feedback-popup';
            if (type) feedbackPopupEl.classList.add(type);
            feedbackPopupEl.classList.add('show');
            // feedbackPopupEl.style.display = 'block'; // .show handles this

            clearTimeout(feedbackTimeoutId);
            feedbackTimeoutId = setTimeout(() => {
                feedbackPopupEl.classList.remove('show');
                // setTimeout(() => { feedbackPopupEl.style.display = 'none'; }, 300); // .show handles this
            }, duration);
        }

        // --- Confetti Function ---
        function triggerConfetti() {
            playSound(confettiSoundAudioEl);
            const confettiCount = 100;
            const colors = ['var(--primary)', 'var(--secondary)', 'var(--success)', 'var(--gold)', 'var(--info)'];
            for (let i = 0; i < confettiCount; i++) {
                const confettiPiece = document.createElement('div');
                confettiPiece.classList.add('confetti-piece');
                confettiPiece.style.left = Math.random() * 100 + 'vw';
                confettiPiece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                const animDuration = Math.random() * 3 + 2; // Match GTP
                confettiPiece.style.animationName = 'fallAndFade';
                confettiPiece.style.animationDuration = animDuration + 's';
                confettiPiece.style.animationDelay = Math.random() * 1 + 's'; // Match GTP
                document.body.appendChild(confettiPiece);
                setTimeout(() => confettiPiece.remove(), (animDuration + parseFloat(confettiPiece.style.animationDelay || 0)) * 1000 + 500);
            }
        }


        // Switch between screens
        function switchScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.remove("active"));
            screens[screenId].classList.add("active");
            cornerLogoEl.style.display = (screenId !== 'start') ? 'block' : 'none';
            if (treatYourselfElement) { // Hide treat yourself if not on results screen
                treatYourselfElement.style.display = (screenId === 'results') ? 'flex' : 'none';
            }
        }

        setupTeamsBtnEl.addEventListener("click", () => {
            playSound(interactionSoundAudioEl);
            switchScreen("teamSetup");
        });

        addTeamBtnEl.addEventListener("click", () => {
            playSound(interactionSoundAudioEl);
            const teamCount = teamInputsContainerEl.children.length;
            if (teamCount < gameConfig.maxTeams) {
                const newTeamInput = document.createElement("div");
                newTeamInput.className = "team-input-container";
                newTeamInput.innerHTML = `<input type="text" class="team-name-input" placeholder="Team ${teamCount + 1} Name">`;
                teamInputsContainerEl.appendChild(newTeamInput);
            } else {
                showFeedbackMessage(`Maximum of ${gameConfig.maxTeams} teams!`, "info", 2000);
            }
            updateTeamButtonsState();
        });

        removeTeamBtnEl.addEventListener("click", () => {
            playSound(interactionSoundAudioEl);
            if (teamInputsContainerEl.children.length > gameConfig.minTeams) {
                teamInputsContainerEl.removeChild(teamInputsContainerEl.lastChild);
            } else {
                showFeedbackMessage(`Minimum of ${gameConfig.minTeams} teams!`, "info", 2000);
            }
            updateTeamButtonsState();
        });

        function updateTeamButtonsState() {
            const teamCount = teamInputsContainerEl.children.length;
            addTeamBtnEl.disabled = teamCount >= gameConfig.maxTeams;
            removeTeamBtnEl.disabled = teamCount <= gameConfig.minTeams;
        }


        beginGameBtnEl.addEventListener("click", () => {
            if (backgroundMusicAudioEl.paused) initBackgroundMusic();
            playSoundWithCallback(startGameSoundAudioEl, startGame);
        });


        function startGame() {
            gameState.teams = [];
            const teamNameInputs = teamInputsContainerEl.querySelectorAll(".team-name-input");
            teamNameInputs.forEach((input, index) => {
                const teamName = input.value.trim() || `Team ${index + 1}`;
                if (teamName.length > 15) { // Basic validation
                     showFeedbackMessage("Team names too long!", "danger");
                     gameState.teams = []; // Prevent game start
                     return;
                }
                gameState.teams.push({ name: teamName, score: 0 });
            });

            if (gameState.teams.length < gameConfig.minTeams || gameState.teams.length > gameConfig.maxTeams ) {
                // This condition might be redundant if validation above clears teams array
                if (gameState.teams.length > 0) { // Only show if not already caught by name length
                     showFeedbackMessage(`Need ${gameConfig.minTeams}-${gameConfig.maxTeams} teams!`, "danger");
                }
                return;
            }

            initializeGame();
            buildGameBoard();
            updateTeamDisplays();
            switchScreen("game");
        }

        function initializeGame() {
            // Deep copy of questions to allow modifications (like splicing) per game
            gameState.questions = JSON.parse(JSON.stringify(questionsDatabase));
            gameState.usedQuestions = [];
            gameState.currentTeamIndex = 0;
            updateTeamButtonsState();
        }

        function buildGameBoard() {
            gameBoardDisplayEl.innerHTML = "";
            gameState.categories.forEach(category => {
                const header = document.createElement("div");
                header.className = "category-header";
                header.textContent = category;
                gameBoardDisplayEl.appendChild(header);
            });

            gameState.values.forEach(value => {
                gameState.categories.forEach(category => {
                    const cell = document.createElement("div");
                    cell.className = "value-cell";
                    cell.textContent = `$${value}`;
                    cell.dataset.category = category;
                    cell.dataset.value = value;
                    const questionKey = `${category}-${value}`;
                    if (gameState.usedQuestions.includes(questionKey)) {
                        cell.classList.add("used");
                    }
                    cell.addEventListener("click", () => selectQuestion(category, value, cell));
                    gameBoardDisplayEl.appendChild(cell);
                });
            });
        }

        function selectQuestion(category, value, cellElement) {
            playSound(questionSelectSoundAudioEl);
            const questionKey = `${category}-${value}`;
            if (gameState.usedQuestions.includes(questionKey)) return; // Should be prevented by .used class but good failsafe

            // Ensure category and value exist and have questions
            const questionsForValue = gameState.questions[category] && gameState.questions[category][value]
                                     ? gameState.questions[category][value]
                                     : undefined;

            if (!questionsForValue || questionsForValue.length === 0) {
                cellElement.classList.add("used");
                if(!gameState.usedQuestions.includes(questionKey)) gameState.usedQuestions.push(questionKey);
                showFeedbackMessage("No more questions here!", "info", 1500);
                if (checkIfAllBoardCellsUsed()) showFinalResults();
                return;
            }

            const randomIndex = Math.floor(Math.random() * questionsForValue.length);
            gameState.currentQuestionData = questionsForValue.splice(randomIndex, 1)[0]; // Remove question
            gameState.currentQuestionData.category = category;
            gameState.currentQuestionData.value = parseInt(value);

            cellElement.classList.add("used");
            gameState.usedQuestions.push(questionKey);
            showQuestionScreen();
        }

        function openQuestionCurtains() {
            questionCurtainLeftEl.classList.add('open');
            questionCurtainRightEl.classList.add('open');
            questionTextAreaEl.classList.add('visible');
            playSound(curtainSoundAudioEl);
        }
        function closeQuestionCurtains() {
            questionCurtainLeftEl.classList.remove('open');
            questionCurtainRightEl.classList.remove('open');
            questionTextAreaEl.classList.remove('visible');
        }

        function showQuestionScreen() {
            closeQuestionCurtains(); // Ensure curtains are closed initially
            questionTextAreaEl.textContent = gameState.currentQuestionData.question;
            questionCategoryValueTextEl.textContent = `${gameState.currentQuestionData.category} - $${gameState.currentQuestionData.value}`;

            optionsContainerDisplayEl.innerHTML = "";
            gameState.currentQuestionData.options.forEach((option, index) => {
                const optionBtn = document.createElement("button");
                optionBtn.className = "option-btn"; // General styling from main button, specific from .option-btn
                optionBtn.innerHTML = `<i class="far fa-circle"></i> ${option}`;
                optionBtn.onclick = () => { playSound(interactionSoundAudioEl); answerQuestion(index, optionBtn); };
                optionsContainerDisplayEl.appendChild(optionBtn);
            });

            continueGameBtnEl.style.display = "none";
            updateQuestionTeamDisplay();
            switchScreen("question");
            setTimeout(openQuestionCurtains, 300); // Open curtains after a slight delay
        }

                // ... (rest of your existing JavaScript code above this) ...

        function answerQuestion(selectedIndex, selectedButton) {
            const currentTeam = gameState.teams[gameState.currentTeamIndex];
            const isCorrect = selectedIndex === gameState.currentQuestionData.answer;
            const value = gameState.currentQuestionData.value;

            // --- MODIFICATION START ---
            // Show feedback immediately, then play sound
            if(isCorrect) {
                showFeedbackMessage("That's Right!", "correct"); // Show feedback now
                playSound(correctAnswerSoundAudioEl);           // Play sound concurrently
            } else {
                showFeedbackMessage("Wrong Answer!", "incorrect"); // Show feedback now
                playSound(wrongAnswerSoundAudioEl);            // Play sound concurrently
            }
            // --- MODIFICATION END ---

            const optionsButtons = optionsContainerDisplayEl.querySelectorAll('.option-btn');
            optionsButtons.forEach((btn, index) => {
                btn.disabled = true;
                const iconClass = index === selectedIndex ? (isCorrect ? 'fa-check-circle' : 'fa-times-circle') : 'fa-circle';
                // Construct the innerHTML carefully to avoid issues if options contain HTML entities
                let optionText = gameState.currentQuestionData.options[index];
                // Basic text sanitization for display (more robust might be needed for complex inputs)
                optionText = optionText.replace(/</g, "<").replace(/>/g, ">"); 
                
                btn.innerHTML = `<i class="fas ${iconClass}"></i> ${optionText}`;

                if (btn === selectedButton && !isCorrect) {
                    btn.classList.add('selected-wrong');
                }
                if (index === gameState.currentQuestionData.answer) {
                    btn.classList.add('correct-answer-reveal');
                     // Ensure checkmark if it was the correct answer but not selected
                    if (btn !== selectedButton) {
                         btn.innerHTML = `<i class="fas fa-check-circle"></i> ${optionText}`;
                    }
                }
            });

            if (isCorrect) {
                currentTeam.score += value;
            } else {
                currentTeam.score -= Math.floor(value / 2);
            }
            updateQuestionTeamDisplay(); // Update score immediately
            continueGameBtnEl.style.display = "inline-flex";
        }

        // ... (rest of your existing JavaScript code below this) ...

        continueGameBtnEl.addEventListener("click", () => {
            playSound(interactionSoundAudioEl);
            continueToNextQuestion();
        });

        function continueToNextQuestion() {
            gameState.currentTeamIndex = (gameState.currentTeamIndex + 1) % gameState.teams.length;
            if (checkIfAllBoardCellsUsed()) {
                 showFinalResults();
            } else {
                switchScreen("game");
                updateTeamDisplays(); // Update main game board team display
            }
        }
        function checkIfAllBoardCellsUsed() {
             const allCells = gameBoardDisplayEl.querySelectorAll('.value-cell');
             const usedCells = gameBoardDisplayEl.querySelectorAll('.value-cell.used');
             return allCells.length > 0 && allCells.length === usedCells.length;
         }


        function updateTeamDisplays() { // For main game screen
            teamDisplayBoardEl.innerHTML = "";
            gameState.teams.forEach((team, index) => {
                const teamCard = document.createElement("div");
                teamCard.className = `team-card ${index === gameState.currentTeamIndex ? "active" : ""}`;
                teamCard.innerHTML = `
                    <div class="team-name">${team.name}</div>
                    <div class="team-score">$${team.score}</div>
                `;
                teamDisplayBoardEl.appendChild(teamCard);
            });
        }

        function updateQuestionTeamDisplay() { // For question screen
            questionScreenTeamDisplayEl.innerHTML = "";
            const currentTeam = gameState.teams[gameState.currentTeamIndex];
            if (currentTeam) {
                const teamCard = document.createElement("div");
                teamCard.className = "team-card active"; // Always active style on question screen
                teamCard.innerHTML = `
                    <div class="team-name">${currentTeam.name}'s Turn</div>
                    <div class="team-score">$${currentTeam.score}</div>
                `;
                questionScreenTeamDisplayEl.appendChild(teamCard);
            }
        }

        function showFinalResults() {
            finalTeamDisplayAreaEl.innerHTML = "";
            gameState.teams.forEach(team => {
                const teamCard = document.createElement("div");
                teamCard.className = "team-card";
                teamCard.innerHTML = `
                    <div class="team-name">${team.name}</div>
                    <div class="team-score">$${team.score}</div>
                `;
                finalTeamDisplayAreaEl.appendChild(teamCard);
            });

            let highScore = -Infinity;
            // Find the highest score, can be negative
            gameState.teams.forEach(team => {
                if (team.score > highScore) highScore = team.score;
            });

            // Winners are those who achieved this high score
            const winners = gameState.teams.filter(team => team.score === highScore);

            if (winners.length > 1) {
                winMessageTextEl.textContent = "It's a Tie!";
            } else if (winners.length === 1) {
                winMessageTextEl.textContent = `${winners[0].name} Wins!`;
                triggerConfetti();
            } else { // Should not happen if there's at least one team, but good fallback
                 winMessageTextEl.textContent = "Game Over!";
            }

            // "Treat Yourself" callout
            if (!treatYourselfElement) {
                treatYourselfElement = document.createElement('div');
                treatYourselfElement.className = 'treat-yourself-callout';
                treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`;
                storeButtonWrapperEl.insertBefore(treatYourselfElement, visitStoreBtnEl);
            }
            treatYourselfElement.style.display = 'flex';

            switchScreen("results");
        }

        playAgainBtnEl.addEventListener("click", () => {
            playSoundWithCallback(startGameSoundAudioEl, resetGameForPlayAgain);
        });
        mainMenuBtnEl.addEventListener("click", () => {
            playSound(interactionSoundAudioEl);
            goToMainMenu();
        });
        visitStoreBtnEl.addEventListener("click", () => {
            playSound(interactionSoundAudioEl);
            window.open('https://www.example.com/store', '_blank');
        });

        function resetGameForPlayAgain() {
            gameState.teams.forEach(team => team.score = 0);
            initializeGame();
            buildGameBoard();
            updateTeamDisplays();
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            switchScreen("game");
        }

         function goToMainMenu() {
            teamInputsContainerEl.innerHTML = `
                <div class="team-input-container">
                    <input type="text" class="team-name-input" placeholder="Team 1 Name">
                </div>
                <div class="team-input-container">
                    <input type="text" class="team-name-input" placeholder="Team 2 Name">
                </div>`;
            updateTeamButtonsState();
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            if (backgroundMusicAudioEl.paused) initBackgroundMusic();
            switchScreen('start');
         }

        // Settings Listeners
        settingsBtnEl.addEventListener('click', () => { playSound(interactionSoundAudioEl); settingsModalEl.style.display = 'flex'; });
        closeModalBtnEl.addEventListener('click', () => { playSound(interactionSoundAudioEl); settingsModalEl.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target === settingsModalEl) { playSound(interactionSoundAudioEl); settingsModalEl.style.display = 'none'; } });
        bgmVolumeSliderEl.addEventListener('input', (e) => { gameConfig.musicVolume = parseFloat(e.target.value); backgroundMusicAudioEl.volume = gameConfig.musicVolume; });
        sfxToggleBtnEl.addEventListener('click', () => {
            playSound(interactionSoundAudioEl);
            gameConfig.sfxEnabled = !gameConfig.sfxEnabled;
            sfxToggleBtnEl.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`;
            sfxToggleBtnEl.classList.toggle('btn-success', gameConfig.sfxEnabled);
            sfxToggleBtnEl.classList.toggle('btn-danger', !gameConfig.sfxEnabled);
        });


        document.addEventListener('DOMContentLoaded', () => {
            sfxToggleBtnEl.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`;
            sfxToggleBtnEl.classList.toggle('btn-success', gameConfig.sfxEnabled);
            sfxToggleBtnEl.classList.toggle('btn-danger', !gameConfig.sfxEnabled);
            bgmVolumeSliderEl.value = gameConfig.musicVolume;
            initBackgroundMusic();
            updateTeamButtonsState();
            switchScreen("start");
        });

    </script>
</body>
</html>