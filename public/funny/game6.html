<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paranoia - Blyza Game Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- START: BRAND IDENTITY & ROOT VARIABLES --- */
        :root {
            --blyza-orange-primary: #FF8833;
            --blyza-purple-secondary: #cb7ae1;
            --blyza-keppel-accent: #00BFA6;
            --blyza-sunny-yellow: #FFDF00;
            --blyza-quickfire-red: #EA2027;

            --darker-grey-bg: #4A4A4A;
            --text-light: #FDFEFE;
            --text-dark: #2C3A47;
            --text-medium: #535c68;
            --black-stroke: #1A1A1A;

            --font-logo: "Luckiest Guy", cursive;
            --font-heading-alt: "Bungee", cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-radius-game: 12px;
            --shadow-chunky: 4px 4px 0px var(--black-stroke);
        }
        /* --- END: BRAND IDENTITY & ROOT VARIABLES --- */

        /* --- Basic Reset & Body --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }

        /* --- CUSTOM SCROLLING BODY --- */
        body {
            font-family: var(--font-body);
            color: var(--text-light);
            background: linear-gradient(135deg, var(--blyza-orange-primary) 0%, var(--blyza-purple-secondary) 100%);
            line-height: 1.6;
            overflow: hidden; /* Body does not scroll */
            position: relative;
            height: var(--app-height, 100vh); /* Full screen height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- Floating Background Elements --- */
        .hero-background-elements { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
        .bg-game-element {
            position: absolute; opacity: 0.1; color: var(--text-light);
            animation: floatSimple 20s infinite ease-in-out alternate;
            user-select: none;
        }
        .bg-question-1 { font-size: 150px; top: 10%; left: 5%; --initial-rotate: -15deg; animation-duration: 22s; }
        .bg-eye-1 { font-size: 100px; top: 65%; right: 8%; --initial-rotate: 10deg; animation-duration: 18s; }
        .bg-user-1 { font-size: 120px; top: 70%; left: 15%; --initial-rotate: 5deg; animation-duration: 25s; opacity: 0.08; }
        .bg-thought-1 { font-size: 130px; top: 15%; right: 10%; --initial-rotate: 20deg; animation-duration: 16s; }
        .bg-question-2 { font-size: 80px; top: 80%; right: 25%; --initial-rotate: 25deg; animation-duration: 15s; }
        .bg-eye-2 { font-size: 120px; bottom: 5%; left: 3%; --initial-rotate: -5deg; animation-duration: 28s; }
        .bg-user-2 { font-size: 90px; top: 20%; left: 20%; --initial-rotate: 15deg; animation-duration: 20s; }
        .bg-bolt-1 { font-size: 70px; top: 5%; right: 30%; --initial-rotate: -10deg; animation-duration: 24s; }
        .bg-user-secret-1 { font-size: 110px; bottom: 10%; right: 4%; --initial-rotate: 12deg; animation-duration: 19s; }
        .bg-question-3 { font-size: 60px; top: 50%; left: 1%; --initial-rotate: 20deg; animation-duration: 26s; }


        @keyframes floatSimple {
            0% { transform: translateY(0px) rotate(var(--initial-rotate, 0deg)); }
            50% { transform: translateY(-25px) rotate(calc(var(--initial-rotate, 0deg) + 8deg)); }
            100% { transform: translateY(0px) rotate(calc(var(--initial-rotate, 0deg) - 8deg)); }
        }
        
        /* --- CUSTOM SCROLLING CONTAINER --- */
        .game-container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(145deg, #fdfefe, #e9ecef);
            color: var(--text-dark);
            border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke);
            box-shadow: 8px 8px 0px var(--black-stroke);
            padding: 30px; 
            text-align: center;
            position: relative;
            z-index: 2;
            max-height: calc(var(--app-height, 100vh) - 40px); /* Make container scrollable */
            overflow-y: auto;
        }

        .brand-logo { object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .brand-logo-prominent { display: block; margin: 0 auto 15px; max-height: 80px; }
        
        h1 {
            font-family: var(--font-logo);
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
            text-shadow: 3px 3px 0px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            line-height: 1.1;
        }
        
        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .active { display: block; }
        
        /* --- Instructions & Info Panels --- */
        .instructions, .player-inputs {
            background: rgba(0,0,0, 0.04);
            padding: 20px; border-radius: 10px; margin: 25px 0;
            border: 2px dashed var(--text-medium);
        }
        .instructions p, .player-inputs h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 600;
            font-family: var(--font-heading-alt);
        }
        .player-inputs h3 {
             font-size: 1.4rem;
             margin-bottom: 5px;
        }
        .instructions ul { list-style-type: none; text-align: left; padding: 0 10px; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: center; }
        .instructions li a {
            color: var(--blyza-orange-primary);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            transition: color 0.3s ease;
        }
        .instructions li a:hover { color: var(--blyza-purple-secondary); text-decoration: underline; }
        .instructions i { margin-right: 15px; font-size: 1.3em; color: var(--blyza-purple-secondary); width: 20px; text-align: center;}
        
        /* --- Buttons --- */
        button, .btn-primary, .btn-secondary, .btn-success, .btn-danger, .btn-info {
            font-family: var(--font-heading-alt); font-size: 1.1rem; padding: 0.7em 1.5em;
            border: 3px solid var(--black-stroke); border-radius: 8px;
            text-transform: uppercase; text-decoration: none; display: inline-flex;
            align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            letter-spacing: 1px; cursor: pointer; color: var(--text-dark);
            margin: 8px 5px;
            box-shadow: var(--shadow-chunky);
        }
        button:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        button:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        button:disabled { background: var(--text-medium); color: var(--text-light); cursor: not-allowed; opacity: 0.7; box-shadow: var(--shadow-chunky); }

        .btn-primary, #start-game-btn, #pick-player-btn, #next-round-btn { background-color: var(--blyza-sunny-yellow); }
        .btn-secondary, #add-player-btn, #main-menu-btn { background-color: var(--blyza-purple-secondary); color: var(--text-light); }
        .btn-success, #play-again-btn { background-color: var(--blyza-keppel-accent); color: var(--text-light); }
        .btn-danger { background-color: var(--blyza-quickfire-red); color: var(--text-light); }
        .btn-info, #visit-store-btn { background-color: #4ECDC4; color: var(--text-dark); }

        /* --- Player Input Styles --- */
        .player-input-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .player-input-wrapper input {
            width: 100%; padding: 12px 18px; border-radius: 8px;
            border: 3px solid var(--black-stroke); background: var(--text-light);
            color: var(--text-dark); font-size: 1rem; transition: all 0.3s ease;
            font-family: var(--font-body); font-weight: 600;
        }
        .player-input-wrapper input:focus { outline: none; border-color: var(--blyza-orange-primary); box-shadow: 0 0 0 3px var(--blyza-sunny-yellow); }
        .remove-player-btn {
            padding: 0.5em 0.8em; font-size: 0.8rem; flex-shrink: 0; min-width: auto;
        }

        /* --- Game Screen --- */
        .round-info-display {
            display: inline-block;
            margin-bottom: 20px;
            padding: 12px 25px;
            background: rgba(0,0,0,0.1);
            border-radius: 8px;
            font-size: 1.1rem;
            font-family: var(--font-heading-alt);
            color: var(--text-dark);
            border: 2px solid var(--black-stroke);
        }

        /* --- Slot Machine (TV Screen Style) --- */
        .slot-machine {
            background: #111; border: 10px solid #333; border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            position: relative; height: 160px;
            margin: 20px auto; overflow: hidden;
            width: 95%; max-width: 600px;
        }
        .slot-window {
            height: 50px; width: 100%; position: absolute;
            top: 50%; transform: translateY(-50%);
            border-top: 3px solid var(--blyza-sunny-yellow);
            border-bottom: 3px solid var(--blyza-sunny-yellow);
            box-shadow: 0 0 15px var(--blyza-sunny-yellow); z-index: 1;
        }
        .slot-items-container {
            position: absolute; width: 100%; top: 0;
            transition: transform 3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .slot-item {
            height: 50px; display: flex; align-items: center; justify-content: center;
            font-size: 1.6rem; color: var(--text-light);
            font-family: var(--font-heading-alt);
            -webkit-text-stroke: 1px var(--black-stroke);
            text-stroke: 1px var(--black-stroke);
            text-transform: uppercase;
        }

        /* --- Question Display --- */
        .question-display-area {
            background: rgba(0,0,0, 0.04);
            padding: 20px; border-radius: 10px; margin: 25px 0;
            border: 2px dashed var(--text-medium);
            cursor: pointer;
        }
        .selected-player-name {
            font-family: var(--font-heading-alt);
            font-size: 1.6rem; color: var(--blyza-orange-primary);
        }
        .reveal-instruction-text {
            font-size: 0.9rem; color: var(--text-medium); font-style: italic;
        }
        .question-text-element {
            font-size: 1.3rem; margin-top: 15px;
            font-weight: 600; line-height: 1.5; color: var(--text-dark);
            filter: blur(8px); transition: filter 0.3s ease-in-out;
            user-select: none; min-height: 90px;
            display: flex; align-items: center; justify-content: center;
        }
        .question-text-element.revealed { filter: blur(0); }

        /* --- Game Over --- */
        .game-over-message {
            font-family: var(--font-logo); font-size: 3rem; margin: 20px 0;
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
        }
        .game-over-trophy {
            font-size: 6rem; margin: 20px 0; animation: bounce 1.5s infinite ease-in-out;
            color: var(--blyza-sunny-yellow);
            text-shadow: 0 0 20px var(--blyza-orange-primary), 3px 3px 0 var(--black-stroke);
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }
        
        .game-over-buttons-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .game-over-button-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
        .treat-yourself-callout {
            margin-bottom: 8px; background-color: var(--blyza-sunny-yellow); color: var(--text-dark);
            padding: 8px 15px; border-radius: 20px; font-family: var(--font-heading-alt);
            font-size: 0.9rem; white-space: nowrap; box-shadow: var(--shadow-chunky);
            display: none; align-items: center; gap: 8px; z-index: 10;
            border: 2px solid var(--black-stroke);
        }
        .treat-yourself-callout i { font-size: 1.2em; animation: bounceArrow 1s infinite; }
        @keyframes bounceArrow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }

        /* --- Floating Icon Buttons --- */
        .icon-btn {
            position: absolute; background-color: var(--blyza-purple-secondary);
            color: var(--text-light); border-radius: 50%; width: 55px; height: 55px;
            font-size: 1.2rem; cursor: pointer; transition: all 0.1s ease;
            display: flex; justify-content: center; align-items: center; z-index: 100;
            text-decoration: none; border: 3px solid var(--black-stroke);
            box-shadow: 4px 4px 0px var(--black-stroke);
        }
        .icon-btn:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        .icon-btn:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        #settings-btn { top: 20px; right: 20px; }
        #home-menu-btn, #back-btn { top: 20px; left: 20px; }
        #back-btn { display: none; }
        
        /* --- Modal Styles --- */
        .modal {
            position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center; animation: fadeInModal 0.3s ease;
        }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        .modal-content {
            background-color: var(--darker-grey-bg); margin: auto; padding: 25px;
            border: 3px solid var(--black-stroke); border-radius: var(--border-radius-game);
            width: 90%; max-width: 450px; box-shadow: 8px 8px 0px rgba(0,0,0,0.4);
            position: relative; color: var(--text-light); text-align: center;
        }
        .modal-content h2 {
            font-family: var(--font-logo); color: var(--blyza-orange-primary);
            -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke);
            text-align: center; margin-bottom: 25px; font-size: 2rem;
        }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; }
        .setting-item label { margin-bottom: 10px; font-weight: 600; font-size: 1rem; }
        .close-modal-btn { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-modal-btn:hover { color: var(--text-light); }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: rgba(0,0,0,0.3); border-radius: 5px; border: 2px solid var(--black-stroke); }
        input[type=range]::-webkit-slider-thumb { border: 2px solid var(--black-stroke); height: 22px; width: 22px; border-radius: 50%; background: var(--blyza-orange-primary); cursor: pointer; -webkit-appearance: none; margin-top: -9px; }
        
        #audio-consent-modal .modal-content p { font-family: var(--font-body); font-weight: 600; font-size: 1.1rem; margin-bottom: 25px; color: var(--text-light); }
        #audio-consent-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }

        /* --- Feedback Popup --- */
        .feedback-popup {
            position: fixed; top: 50%; left: 50%;
            background-color: var(--text-dark); color: white;
            padding: 25px 40px; border-radius: var(--border-radius-game);
            font-size: 2.5rem; font-family: var(--font-logo); text-align: center;
            z-index: 2000; box-shadow: 8px 8px 0px rgba(0,0,0,0.5);
            opacity: 0; transform: translate(-50%, -50%) scale(0.7);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none; border: 3px solid var(--black-stroke);
            display: none;
        }
        .feedback-popup.show { opacity: 1; transform: translate(-50%, -50%) scale(1); display: block; }
        .feedback-popup.info { color: var(--blyza-sunny-yellow); }
        .feedback-popup.danger { color: var(--blyza-quickfire-red); }
        .feedback-popup.correct { color: var(--blyza-keppel-accent); }
        
        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
                align-items: flex-start;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .game-container { 
                padding: 45px 15px 15px; 
                max-height: calc(var(--app-height, 100vh) - 40px);
            } 
            h1 { font-size: 2.2rem; margin-top: 5px; }
            .instructions, .player-inputs { padding: 15px; }
            .icon-btn { width: 48px; height: 48px; }
            #settings-btn { top: 12px; right: 12px; }
            #home-menu-btn, #back-btn { top: 12px; left: 12px; }
            .feedback-popup { font-size: 2rem; padding: 20px 30px; width: 90%; }
            .modal-content { padding: 20px; }
            .game-over-buttons-container { flex-direction: column; align-items: center; }
            .game-over-buttons-container .game-over-button-wrapper { width: 90%; }
            .game-over-buttons-container .game-over-button-wrapper button { width: 100%; }
            .game-over-message { font-size: 2.2rem; }
            .bg-game-element { display: none; }
            .slot-machine { height: 140px; }
            .slot-item { font-size: 1.4rem; }
            .question-text-element { font-size: 1.2rem; min-height: 80px; }
            .selected-player-name { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Floating background elements -->
    <div class="hero-background-elements">
        <div class="bg-game-element bg-question-1"><i class="fas fa-question-circle"></i></div>
        <div class="bg-game-element bg-eye-1"><i class="fas fa-eye"></i></div>
        <div class="bg-game-element bg-user-1"><i class="fas fa-user"></i></div>
        <div class="bg-game-element bg-thought-1"><i class="fas fa-comment-dots"></i></div>
        <div class="bg-game-element bg-question-2"><i class="fas fa-question-circle"></i></div>
        <div class="bg-game-element bg-eye-2"><i class="fas fa-eye"></i></div>
        <div class="bg-game-element bg-user-2"><i class="fas fa-user"></i></div>
        <div class="bg-game-element bg-bolt-1"><i class="fas fa-bolt"></i></div>
        <div class="bg-game-element bg-user-secret-1"><i class="fas fa-user-secret"></i></div>
        <div class="bg-game-element bg-question-3"><i class="fas fa-question-circle"></i></div>
    </div>

    <script>
        // THIS SCRIPT MUST RUN FIRST
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>

    <div class="game-container">
       <a href="#" onclick="history.back(); return false;" id="home-menu-btn" class="icon-btn" aria-label="Back to the previous page">
            <i class="fas fa-home"></i>
        </a>
        <button id="back-btn" class="icon-btn" aria-label="Go Back" style="display: none;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Paranoia</h1>
            <div class="instructions">
                <p><strong>HOW TO PLAY:</strong></p>
                <ul>
                    <li><i class="fas fa-users"></i> A random player is given a secret question that only they can see!</li>
                    <li><i class="fas fa-bullseye"></i> The answer to this question must be the name of another player in the game (not themselves) </li>
                    <li><i class="fas fa-dice"></i> The player who received the question and the player named as the answer then play any mini-game of their choice!</li>
                    <li><i class="fas fa-question"></i> If the player who got the question wins the mini-game, the current round ends and game moves to next round</li>
                    <li><i class="fas fa-trophy"></i> If the player who was the answer wins the mini-game, the secret question is revealed to all players!</li>
                     <li>
                        <a href="https://youtu.be/x5LgEbbLDPQ" target="_blank" rel="noopener noreferrer">
                            <i class="fab fa-youtube"></i> Watch a video on how to play!
                        </a>
                    </li>
                </ul>
            </div>
            <div class="player-inputs">
                <h3>Enter Player Names</h3>
                <p style="font-size:0.9rem; margin-top:-10px; margin-bottom:15px; color: var(--text-medium);">(3-12 players)</p>
                <div id="player-names-list"></div>
                <button id="add-player-btn" class="btn-secondary"><i class="fas fa-plus"></i> Add Player</button>
            </div>
            <button id="start-game-btn" class="btn-primary">Start Game <i class="fas fa-play"></i></button>
        </div>

        <!-- Player Selection Screen -->
        <div id="selection-screen" class="screen">
            <div class="round-info-display">
                Round <span id="current-round-text">1</span>/<span id="total-rounds-text">5</span>
            </div>
            <div class="slot-machine">
                <div class="slot-window"></div>
                <div id="slot-items-container" class="slot-items-container"></div>
            </div>
            <button id="pick-player-btn" class="btn-primary">Pick Player <i class="fas fa-random"></i></button>
        </div>

        <!-- Question Screen -->
        <div id="question-screen" class="screen">
             <div class="round-info-display">
                Round <span id="question-screen-round-text">1</span>/<span id="question-screen-total-rounds-text">5</span>
            </div>
            <div class="question-display-area">
                <div class="selected-player-name" id="selected-player-display"></div>
                <div class="question-text-element" id="question-text-display"></div>
                <div class="reveal-instruction-text">(Tap question to reveal)</div>
            </div>
            <button id="next-round-btn" class="btn-primary">Next Round <i class="fas fa-arrow-right"></i></button>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over!</h1>
            <div class="game-over-message">Thanks for playing!</div>
            <div class="game-over-trophy">🎉</div>
            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                    <button id="play-again-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                </div>
                <div class="game-over-button-wrapper">
                     <button id="main-menu-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper">
                    <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Consent Modal -->
    <div id="audio-consent-modal" class="modal">
        <div class="modal-content">
            <h2>Enable Audio?</h2>
            <p>This game has background music and sound effects. Would you like to enable them for the best experience?</p>
            <div id="audio-consent-buttons">
                <button id="audio-consent-yes-btn" class="btn-success"><i class="fas fa-volume-up"></i> Yes, please!</button>
                <button id="audio-consent-no-btn" class="btn-secondary"><i class="fas fa-volume-mute"></i> No, thanks</button>
            </div>
        </div>
    </div>

     <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">×</span>
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="bgm-volume-slider">Background Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>

    <!-- Feedback Pop-up -->
    <div id="feedback-popup" class="feedback-popup">
        <span id="feedback-message-text-el"></span>
    </div>

    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="slot-spin-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="player-selected-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="question-reveal-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="game-over-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>


       <script>
        const gameConfig = { sfxEnabled: true, musicVolume: 0.2, minPlayers: 3, maxPlayers: 12, totalRounds: 5, slotSpinDuration: 4500, slotItemHeight: 50 };
        const gameState = { players: [], currentRound: 1, selectedPlayerName: null, questions: [ "Who here do you think is the most attractive?", "Who here do you think is the least attractive?", "Who here would you trust with your deepest secret?", "Who here do you think is the least trustowrthy?", "Who here would you want to be stranded on a desert island with?", "Who here do you think is the most intelligent?", "Who here do you think is the dumbest?", "Who here do you think is the most charismatic?", "Who here would you never want as your roommate?", "Who here do you think is the least reliable?", "Who’s most likely to make out with a stranger at a party?", "Who gives off the most “main character” energy?", "Who do you think has the best-looking body?", "Who's most likely to ghost someone after a first date?", "Who looks like they’d be amazing in bed?", "Who looks like they’d be horrible in bed?", "Who would you most want to kiss right now?", "Who gives off the strongest “walking red flag” energy?", "Who’s most likely to get back with a toxic ex?", "Who’s most likely to pretend they’re innocent but really aren't?", "Who do you think has the worst music taste?", "Who’s most likely to betray someone for personal gain?", "Who's most likely to throw someone under the bus at work or school?", "Who do you think would fake being sick to get out of plans?", "Who's most likely to take credit for someone else's work?", "Who do you secretly think is way too fake in group settings?", "Who’s most likely to act like a victim when they were the problem?", "Who is the best at gaslighting someone?", "Who’s most likely to talk big online and be quiet in person?", "Who tries too hard to be liked by everyone?", "Who's most likely to exaggerate everything they say?" ], usedQuestionsThisGame: [] };
        
        const screens = { start: document.getElementById('start-screen'), selection: document.getElementById('selection-screen'), question: document.getElementById('question-screen'), gameOver: document.getElementById('game-over-screen') };
        const homeMenuBtnEl = document.getElementById('home-menu-btn');
        const backBtnEl = document.getElementById('back-btn');
        const settingsBtnEl = document.getElementById('settings-btn');
        const playerNamesListDiv = document.getElementById('player-names-list');
        const addPlayerBtnEl = document.getElementById('add-player-btn');
        const startGameBtnEl = document.getElementById('start-game-btn');
        const pickPlayerBtnEl = document.getElementById('pick-player-btn');
        const nextRoundBtnEl = document.getElementById('next-round-btn');
        const playAgainBtnEl = document.getElementById('play-again-btn');
        const mainMenuBtnEl = document.getElementById('main-menu-btn');
        const visitStoreBtnEl = document.getElementById('visit-store-btn');
        const currentRoundTextEl = document.getElementById('current-round-text');
        const totalRoundsTextEl = document.getElementById('total-rounds-text');
        const questionScreenRoundTextEl = document.getElementById('question-screen-round-text');
        const questionScreenTotalRoundsTextEl = document.getElementById('question-screen-total-rounds-text');
        const selectedPlayerDisplayEl = document.getElementById('selected-player-display');
        const questionTextDisplayEl = document.getElementById('question-text-display');
        const slotItemsContainerEl = document.getElementById('slot-items-container');
        const storeButtonWrapperEl = document.getElementById("store-button-wrapper");
        let treatYourselfElement = null;
        const settingsModalEl = document.getElementById('settings-modal');
        const closeModalBtnEl = document.getElementById('close-modal-btn');
        const bgmVolumeSliderEl = document.getElementById('bgm-volume-slider');
        const sfxToggleBtnEl = document.getElementById('sfx-toggle-btn');
        const backgroundMusicAudioEl = document.getElementById('background-game-music');
        const feedbackPopupEl = document.getElementById('feedback-popup');
        const feedbackMessageTextPopupEl = document.getElementById('feedback-message-text-el');
        const audioConsentModalEl = document.getElementById('audio-consent-modal');
        const audioConsentYesBtnEl = document.getElementById('audio-consent-yes-btn');
        const audioConsentNoBtnEl = document.getElementById('audio-consent-no-btn');

        const allSfx = [ document.getElementById('start-game-sound'), document.getElementById('interaction-sound'), document.getElementById('slot-spin-sound'), document.getElementById('player-selected-sound'), document.getElementById('question-reveal-sound'), document.getElementById('game-over-sound') ];
        let feedbackTimeoutId, audioContextStarted = false;

        function initAudio() {
            if (audioContextStarted) return;
            backgroundMusicAudioEl.play().then(() => {
                audioContextStarted = true;
                if (gameConfig.musicVolume <= 0 || document.hidden) {
                    backgroundMusicAudioEl.pause();
                }
            }).catch(e => { /* Autoplay blocked, wait for user interaction */ });
        }
        function playSound(audioElement) { if (gameConfig.sfxEnabled && audioElement && audioContextStarted) { audioElement.pause(); audioElement.currentTime = 0; audioElement.play().catch(e => {}); } }
        function playSoundWithCallback(audioElement, callback, ...args) { if (gameConfig.sfxEnabled && audioElement && audioContextStarted) { audioElement.pause(); audioElement.currentTime = 0; let cbExecuted = false; const execCb = () => { if (!cbExecuted) { cbExecuted = true; audioElement.removeEventListener('ended', execCb); if (callback) callback(...args); } }; audioElement.addEventListener('ended', execCb); audioElement.play().catch(e => { execCb(); }); } else { if (callback) callback(...args); } }
        function showFeedbackMessage(message, type = 'info', duration = 2500) { feedbackMessageTextPopupEl.textContent = message; feedbackPopupEl.className = 'feedback-popup'; if (type) feedbackPopupEl.classList.add(type); feedbackPopupEl.classList.add('show'); clearTimeout(feedbackTimeoutId); feedbackTimeoutId = setTimeout(() => { feedbackPopupEl.classList.remove('show'); }, duration); }
        function loadAudioSettings() { const savedVol = localStorage.getItem('musicVolume'), savedSfx = localStorage.getItem('sfxEnabled'); if (savedVol !== null) gameConfig.musicVolume = parseFloat(savedVol); if (savedSfx !== null) gameConfig.sfxEnabled = savedSfx === 'true'; backgroundMusicAudioEl.volume = gameConfig.musicVolume; bgmVolumeSliderEl.value = gameConfig.musicVolume; sfxToggleBtnEl.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`; }
        function handleVisibilityChange() {
            if (!audioContextStarted) return;
            if (document.hidden) {
                backgroundMusicAudioEl.pause();
            } else if (gameConfig.musicVolume > 0) {
                backgroundMusicAudioEl.play().catch(e => {});
            }
        }
        function handlePageShow(event) {
            if (event.persisted) {
                setAppHeight(); 
                mainMenu();
            }
        }
        
        function switchScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            screens[screenId].classList.add('active');
            
            const isStartOrGameOver = screenId === 'start' || screenId === 'gameOver';
            homeMenuBtnEl.style.display = isStartOrGameOver ? 'flex' : 'none';
            backBtnEl.style.display = isStartOrGameOver ? 'none' : 'flex';

            if (treatYourselfElement) {
                treatYourselfElement.style.display = (screenId === 'gameOver') ? 'flex' : 'none';
            }
        }
        
        backBtnEl.addEventListener('click', () => { playSound(allSfx[1]); mainMenu(); });
        addPlayerBtnEl.addEventListener('click', () => { playSound(allSfx[1]); addPlayerInput(); });
        startGameBtnEl.addEventListener('click', () => { playSoundWithCallback(allSfx[0], startGame); });
        pickPlayerBtnEl.addEventListener('click', () => { startPlayerSelection(); });
        nextRoundBtnEl.addEventListener('click', () => { playSound(allSfx[1]); nextRound(); });
        playAgainBtnEl.addEventListener('click', () => { playSoundWithCallback(allSfx[0], playAgain); });
        mainMenuBtnEl.addEventListener('click', () => { playSound(allSfx[1]); mainMenu(); });
        visitStoreBtnEl.addEventListener('click', () => { playSound(allSfx[1]); window.location.href = '/store'; });
        questionTextDisplayEl.parentElement.addEventListener('click', () => { if (!questionTextDisplayEl.classList.contains('revealed')) { playSound(allSfx[4]); questionTextDisplayEl.classList.add('revealed'); } });
        settingsBtnEl.addEventListener('click', () => { playSound(allSfx[1]); settingsModalEl.style.display = 'flex'; });
        closeModalBtnEl.addEventListener('click', () => { playSound(allSfx[1]); settingsModalEl.style.display = 'none'; });
        bgmVolumeSliderEl.addEventListener('input', (e) => { gameConfig.musicVolume = parseFloat(e.target.value); backgroundMusicAudioEl.volume = gameConfig.musicVolume; localStorage.setItem('musicVolume', gameConfig.musicVolume); if (gameConfig.musicVolume > 0 && !document.hidden && audioContextStarted) backgroundMusicAudioEl.play().catch(e=>{}); else backgroundMusicAudioEl.pause(); });
        sfxToggleBtnEl.addEventListener('click', () => { gameConfig.sfxEnabled = !gameConfig.sfxEnabled; sfxToggleBtnEl.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`; playSound(allSfx[1]); localStorage.setItem('sfxEnabled', gameConfig.sfxEnabled); });

        function createPlayerInputField(playerNumber) {
            const wrapper = document.createElement('div');
            wrapper.className = 'player-input-wrapper';
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'player-name-input';
            input.placeholder = `Player ${playerNumber}`;
            wrapper.appendChild(input);
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-player-btn btn-danger';
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            removeBtn.onclick = function() { playSound(allSfx[1]); wrapper.remove(); updateAddRemovePlayerButtons(); };
            wrapper.appendChild(removeBtn);
            return wrapper;
        }

        function addPlayerInput() {
            const playerCount = playerNamesListDiv.querySelectorAll('.player-input-wrapper').length;
            if (playerCount >= gameConfig.maxPlayers) { showFeedbackMessage(`Maximum of ${gameConfig.maxPlayers} players.`, "info", 2000); return; }
            playerNamesListDiv.appendChild(createPlayerInputField(playerCount + 1));
            updateAddRemovePlayerButtons();
        }

        function updateAddRemovePlayerButtons() {
            const playerInputWrappers = playerNamesListDiv.querySelectorAll('.player-input-wrapper');
            const playerCount = playerInputWrappers.length;
            addPlayerBtnEl.disabled = playerCount >= gameConfig.maxPlayers;
            playerInputWrappers.forEach(wrapper => {
                const removeBtn = wrapper.querySelector('.remove-player-btn');
                if (removeBtn) removeBtn.disabled = playerCount <= gameConfig.minPlayers;
            });
        }

        function startGame() {
            gameState.players = Array.from(playerNamesListDiv.querySelectorAll('.player-name-input')).map((input, index) => input.value.trim() || `Player ${index + 1}`).filter(name => name !== '');
            if (gameState.players.some(name => name.length > 15)) { showFeedbackMessage("Player names max 15 chars!", "danger"); return; }
            if (new Set(gameState.players.map(p => p.toLowerCase())).size !== gameState.players.length) { showFeedbackMessage("Player names must be unique!", "danger"); return; }
            if (gameState.players.length < gameConfig.minPlayers) { showFeedbackMessage(`Need at least ${gameConfig.minPlayers} players!`, 'danger'); return; }
            gameState.currentRound = 1;
            gameState.selectedPlayerName = null;
            gameState.usedQuestionsThisGame = [];
            currentRoundTextEl.textContent = gameState.currentRound;
            questionScreenRoundTextEl.textContent = gameState.currentRound;
            setupSlotMachine();
            switchScreen('selection');
        }

        function setupSlotMachine() {
            pickPlayerBtnEl.disabled = false;
            slotItemsContainerEl.innerHTML = '';
            slotItemsContainerEl.style.transition = 'none';
            slotItemsContainerEl.style.transform = 'translateY(0px)';
            const repetitions = 50; 
            const listForReel = [];
            for (let i = 0; i < repetitions; i++) {
                const shuffledPlayers = [...gameState.players].sort(() => Math.random() - 0.5);
                listForReel.push(...shuffledPlayers);
            }
            listForReel.forEach(player => {
                const item = document.createElement('div');
                item.className = 'slot-item';
                item.textContent = player;
                slotItemsContainerEl.appendChild(item);
            });
            void slotItemsContainerEl.offsetWidth; 
        }

        function startPlayerSelection() {
            if (pickPlayerBtnEl.disabled) return;
            pickPlayerBtnEl.disabled = true;
            playSound(allSfx[2]); // slot spin
            const reelItems = Array.from(slotItemsContainerEl.children);
            const actualPlayerIndex = Math.floor(Math.random() * gameState.players.length);
            gameState.selectedPlayerName = gameState.players[actualPlayerIndex];
            
            const minLandingIndex = reelItems.length / 2;
            let targetIndexInReel = -1;
            for (let i = reelItems.length - gameState.players.length - 1; i >= minLandingIndex; i--) {
                if (reelItems[i].textContent === gameState.selectedPlayerName) {
                    targetIndexInReel = i;
                    break;
                }
            }
            if (targetIndexInReel === -1) { targetIndexInReel = Math.floor(reelItems.length / 2); }

            const slotMachineHeight = slotItemsContainerEl.parentElement.clientHeight;
            const yOffset = (targetIndexInReel * gameConfig.slotItemHeight) - (slotMachineHeight / 2) + (gameConfig.slotItemHeight / 2);
            slotItemsContainerEl.style.transition = `transform ${gameConfig.slotSpinDuration / 1000}s cubic-bezier(0.23, 1, 0.32, 1)`;
            slotItemsContainerEl.style.transform = `translateY(-${yOffset}px)`;
            
            setTimeout(() => {
                playSound(allSfx[3]); // player selected
                selectedPlayerDisplayEl.textContent = `Question for: ${gameState.selectedPlayerName}`;
                let questionPool = gameState.questions.filter(q => !gameState.usedQuestionsThisGame.includes(q));
                if (questionPool.length === 0) { gameState.usedQuestionsThisGame = []; questionPool = [...gameState.questions]; }
                const randomQuestion = questionPool[Math.floor(Math.random() * questionPool.length)];
                gameState.usedQuestionsThisGame.push(randomQuestion);
                questionTextDisplayEl.textContent = randomQuestion;
                questionTextDisplayEl.classList.remove('revealed');
                switchScreen('question');
            }, gameConfig.slotSpinDuration + 200);
        }

        function nextRound() {
            if (gameState.currentRound >= gameConfig.totalRounds) {
                playSound(allSfx[5]); // game over
                showGameOver();
            } else {
                gameState.currentRound++;
                currentRoundTextEl.textContent = gameState.currentRound;
                questionScreenRoundTextEl.textContent = gameState.currentRound;
                questionTextDisplayEl.classList.remove('revealed');
                setupSlotMachine();
                switchScreen('selection');
            }
        }

        function showGameOver() {
            if (!treatYourselfElement) {
                treatYourselfElement = document.createElement('div');
                treatYourselfElement.className = 'treat-yourself-callout';
                treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`;
                storeButtonWrapperEl.insertBefore(treatYourselfElement, visitStoreBtnEl);
            }
            switchScreen('gameOver');
        }

        function playAgain() { 
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            startGame(); 
        }
        function mainMenu() {
            playerNamesListDiv.innerHTML = '';
            for (let i = 0; i < gameConfig.minPlayers; i++) { playerNamesListDiv.appendChild(createPlayerInputField(i + 1)); }
            updateAddRemovePlayerButtons();
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            switchScreen('start');
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadAudioSettings();
            audioConsentModalEl.style.display = 'flex';
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('pageshow', handlePageShow);
            
            audioConsentYesBtnEl.addEventListener('click', () => { audioConsentModalEl.style.display = 'none'; initAudio(); playSound(allSfx[1]); });
            audioConsentNoBtnEl.addEventListener('click', () => { audioConsentModalEl.style.display = 'none'; gameConfig.sfxEnabled = false; gameConfig.musicVolume = 0; backgroundMusicAudioEl.volume = 0; bgmVolumeSliderEl.value = 0; sfxToggleBtnEl.textContent = 'SFX: OFF'; localStorage.setItem('sfxEnabled', 'false'); localStorage.setItem('musicVolume', '0'); initAudio(); });

            totalRoundsTextEl.textContent = gameConfig.totalRounds;
            questionScreenTotalRoundsTextEl.textContent = gameConfig.totalRounds;
            mainMenu();
        });

        // --- CUSTOM SCROLL REDIRECTION LOGIC ---
        const gameContainerForScroll = document.querySelector('.game-container');
        let lastTouchY = 0;

        window.addEventListener('wheel', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                gameContainerForScroll.scrollTop += e.deltaY;
            }
        }, { passive: true });

        window.addEventListener('touchstart', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                if (e.touches.length > 0) {
                    lastTouchY = e.touches[0].clientY;
                }
            }
        }, { passive: true });

        window.addEventListener('touchmove', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                e.preventDefault(); 
                if (e.touches.length > 0) {
                    const currentTouchY = e.touches[0].clientY;
                    const deltaY = lastTouchY - currentTouchY;
                    gameContainerForScroll.scrollTop += deltaY;
                    lastTouchY = currentTouchY;
                }
            }
        }, { passive: false });
        // --- END OF CUSTOM SCROLL LOGIC ---
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>
</body>
</html>