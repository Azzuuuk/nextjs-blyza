<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5 Seconds Frenzy - Blyza Game Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Luckiest+Guy&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- START: BRAND IDENTITY & ROOT VARIABLES --- */
        :root {
            --blyza-orange-primary: #FF8833;
            --blyza-purple-secondary: #cb7ae1;
            --blyza-keppel-accent: #00BFA6;
            --blyza-sunny-yellow: #FFDF00;
            --blyza-quickfire-red: #EA2027;

            --darker-grey-bg: #4A4A4A;
            --text-light: #FDFEFE;
            --text-dark: #2C3A47;
            --text-medium: #535c68;
            --black-stroke: #1A1A1A;

            --font-logo: "Luckiest Guy", cursive;
            --font-heading-alt: "Bungee", cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-radius-game: 12px;
            --shadow-chunky: 4px 4px 0px var(--black-stroke);
        }
        /* --- END: BRAND IDENTITY & ROOT VARIABLES --- */

        /* --- Basic Reset & Body --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-body);
            color: var(--text-light);
            background: linear-gradient(135deg, var(--blyza-orange-primary) 0%, var(--blyza-purple-secondary) 100%);
            line-height: 1.6;
            overflow: hidden; /* Body does not scroll */
            position: relative;
            height: var(--app-height, 100vh); /* Full screen height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- Floating Background Elements --- */
        .hero-background-elements { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
        .bg-game-element {
            position: absolute; opacity: 0.1; color: var(--text-light);
            animation: floatSimple 20s infinite ease-in-out alternate;
            user-select: none;
        }
        .bg-stopwatch-1 { font-size: 150px; top: 10%; left: 5%; --initial-rotate: -15deg; animation-duration: 22s; }
        .bg-5-1 { font-size: 100px; top: 65%; right: 8%; --initial-rotate: 10deg; animation-duration: 18s; font-family: var(--font-heading-alt); }
        .bg-bolt-1 { font-size: 120px; top: 70%; left: 15%; --initial-rotate: 5deg; animation-duration: 25s; opacity: 0.08; }
        .bg-question-1 { font-size: 130px; top: 15%; right: 10%; --initial-rotate: 20deg; animation-duration: 16s; }
        .bg-stopwatch-2 { font-size: 80px; top: 80%; right: 25%; --initial-rotate: 25deg; animation-duration: 15s; }
        .bg-5-2 { font-size: 120px; bottom: 5%; left: 3%; --initial-rotate: -5deg; animation-duration: 28s; font-family: var(--font-heading-alt);}
        .bg-bolt-2 { font-size: 90px; top: 20%; left: 20%; --initial-rotate: 15deg; animation-duration: 20s; }
        .bg-check-1 { font-size: 70px; top: 5%; right: 30%; --initial-rotate: -10deg; animation-duration: 24s; }
        .bg-trophy-1 { font-size: 110px; bottom: 10%; right: 4%; --initial-rotate: 12deg; animation-duration: 19s; }
        .bg-times-1 { font-size: 60px; top: 50%; left: 1%; --initial-rotate: 20deg; animation-duration: 26s; }

        @keyframes floatSimple {
            0% { transform: translateY(0px) rotate(var(--initial-rotate, 0deg)); }
            50% { transform: translateY(-25px) rotate(calc(var(--initial-rotate, 0deg) + 8deg)); }
            100% { transform: translateY(0px) rotate(calc(var(--initial-rotate, 0deg) - 8deg)); }
        }
        
        /* --- Main Game Container --- */
        .game-container {
            max-width: 900px;
            width: 100%;
            background: linear-gradient(145deg, #fdfefe, #e9ecef);
            color: var(--text-dark);
            border-radius: var(--border-radius-game);
            border: 3px solid var(--black-stroke);
            box-shadow: 8px 8px 0px var(--black-stroke);
            padding: 30px; 
            text-align: center;
            position: relative;
            z-index: 2;
            max-height: calc(var(--app-height, 100vh) - 40px);
            overflow-y: auto;
        }

        .brand-logo { object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .brand-logo-prominent { display: block; margin: 0 auto 15px; max-height: 80px; }
        
        h1, h2 {
            font-family: var(--font-logo);
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
            text-shadow: 3px 3px 0px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            line-height: 1.1;
        }
        h1 { font-size: clamp(2.5rem, 6vw, 3.5rem); }
        h2 { font-size: clamp(2rem, 5vw, 2.5rem); }
        
        .screen { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .active-screen, .active { display: block; }
        
        /* --- Instructions & Info Panels --- */
        .instructions, .team-inputs {
            background: rgba(0,0,0, 0.04);
            padding: 20px; border-radius: 10px; margin: 25px 0;
            border: 2px dashed var(--text-medium);
        }
        .instructions p { font-size: 1.1rem; margin-bottom: 15px; font-weight: 600; font-family: var(--font-heading-alt); }
        .instructions ul { list-style-type: none; text-align: left; padding: 0 10px; }
        .instructions li { margin-bottom: 10px; display: flex; align-items: center; }
        .instructions i { margin-right: 15px; font-size: 1.3em; color: var(--blyza-purple-secondary); width: 20px; text-align: center; }
        .instructions strong { font-family: var(--font-heading-alt); color: var(--blyza-purple-secondary); }
        
        /* --- Buttons --- */
        button, .btn-primary, .btn-secondary, .btn-success, .btn-danger, .btn-info {
            font-family: var(--font-heading-alt); font-size: 1.1rem; padding: 0.7em 1.5em;
            border: 3px solid var(--black-stroke); border-radius: 8px;
            text-transform: uppercase; text-decoration: none; display: inline-flex;
            align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            letter-spacing: 1px; cursor: pointer; color: var(--text-dark);
            margin: 8px 5px;
            box-shadow: var(--shadow-chunky);
        }
        button:hover:not(:disabled) { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        button:active:not(:disabled) { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        button:disabled { background: var(--text-medium); color: var(--text-light); cursor: not-allowed; opacity: 0.7; box-shadow: var(--shadow-chunky); }

        .btn-primary { background-color: var(--blyza-sunny-yellow); }
        .btn-secondary { background-color: var(--blyza-purple-secondary); color: var(--text-light); }
        .btn-success { background-color: var(--blyza-keppel-accent); color: var(--text-light); }
        .btn-danger { background-color: var(--blyza-quickfire-red); color: var(--text-light); }
        .btn-info { background-color: #4ECDC4; color: var(--text-dark); }
        
        /* --- Team Setup --- */
        .team-input { margin-bottom: 20px; }
        .team-input label {
            display: block; margin-bottom: 8px; font-weight: 700;
            font-size: 1.2rem; font-family: var(--font-heading-alt);
        }
        .team-input input {
            width: 100%; max-width: 400px; padding: 12px 18px; border-radius: 8px;
            border: 3px solid var(--black-stroke); background: var(--text-light);
            color: var(--text-dark); font-size: 1rem; transition: all 0.3s ease;
            font-family: var(--font-body); font-weight: 600;
        }
        .team-input input:focus { outline: none; border-color: var(--blyza-orange-primary); box-shadow: 0 0 0 3px var(--blyza-sunny-yellow); }

        /* --- Game Screen Elements --- */
        .team-display { display: flex; justify-content: space-around; gap: 20px; margin-bottom: 25px; flex-wrap: wrap; }
        .team-card {
            background: rgba(0,0,0,0.05); padding: 20px; border-radius: 10px;
            border: 3px solid var(--black-stroke); transition: all 0.3s ease;
            box-shadow: var(--shadow-chunky); text-align: center;
            flex: 1; min-width: 220px;
        }
        .team-card.active-turn {
            border-color: var(--blyza-orange-primary);
            box-shadow: 6px 6px 0 var(--blyza-orange-primary);
            transform: scale(1.03);
        }
        .team-name { font-family: var(--font-heading-alt); font-size: 1.4rem; color: var(--blyza-orange-primary); }
        .team-score { font-family: var(--font-heading-alt); font-size: 2.5rem; margin-top: 5px; }
        
        .gameplay-area {
            background: #111; border: 10px solid #333; border-radius: 15px; padding: 25px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7), inset 0 0 10px rgba(0,0,0,0.5);
            margin: 25px 0;
        }
        .question-display-area {
            font-size: clamp(1.4rem, 4vw, 2rem); min-height: 120px;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-light); line-height: 1.4;
            font-family: var(--font-body); font-weight: 700;
        }
        .question-hidden-text { font-style: italic; color: var(--text-medium); font-size: 1.5rem; }
        .timer-display-area {
            font-family: var(--font-logo);
            font-size: 6rem;
            -webkit-text-stroke: 3px var(--black-stroke); text-stroke: 3px var(--black-stroke);
            color: var(--text-light);
            margin: 15px 0;
            transition: color 0.3s ease;
        }
        .button-controls-area {
            margin-top: 25px; display: flex; flex-direction: column;
            align-items: center; gap: 15px;
        }
        .result-buttons-container { display: none; justify-content: center; gap: 20px; flex-wrap: wrap; width: 100%; }

        /* --- Win Screen --- */
        .win-message-text {
            font-family: var(--font-logo); font-size: 3rem; margin: 20px 0;
            color: var(--blyza-orange-primary);
            -webkit-text-stroke: 2px var(--black-stroke);
            text-stroke: 2px var(--black-stroke);
        }
        .winner-trophy-icon {
            font-size: 6rem; margin: 20px 0; animation: bounce 1.5s infinite ease-in-out;
            color: var(--blyza-sunny-yellow);
            text-shadow: 0 0 20px var(--blyza-orange-primary), 3px 3px 0 var(--black-stroke);
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }

        /* --- Time Up Pop-up --- */
        .time-up-popup {
            position: fixed; top: 50%; left: 50%;
            background-color: var(--blyza-quickfire-red);
            color: white; padding: 30px 50px;
            border-radius: var(--border-radius-game);
            font-size: 3rem; font-family: var(--font-logo);
            z-index: 2000; box-shadow: 8px 8px 0px rgba(0,0,0,0.5);
            border: 3px solid var(--black-stroke);
            animation: timeUpPopAnim 1.5s forwards;
            display: none;
        }
        @keyframes timeUpPopAnim{
            0%{ opacity:0; transform:translate(-50%,-50%) scale(.7); }
            20%{ opacity:1; transform:translate(-50%,-50%) scale(1.1); }
            80%{ opacity:1; transform:translate(-50%,-50%) scale(1.1); }
            100%{ opacity:0; transform:translate(-50%,-50%) scale(.7); }
        }

        /* --- Icon Buttons --- */
        .icon-btn {
            position: absolute; background-color: var(--blyza-purple-secondary);
            color: var(--text-light); border-radius: 50%; width: 55px; height: 55px;
            font-size: 1.2rem; cursor: pointer; transition: all 0.1s ease;
            display: flex; justify-content: center; align-items: center; z-index: 100;
            text-decoration: none; border: 3px solid var(--black-stroke);
            box-shadow: 4px 4px 0px var(--black-stroke);
        }
        .icon-btn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--black-stroke); }
        .icon-btn:active { transform: translate(4px, 4px); box-shadow: 0px 0px 0px var(--black-stroke); }
        #settings-btn, #home-menu-btn, #back-btn { display: flex; }
        #settings-btn { top: 20px; right: 20px; }
        #home-menu-btn, #back-btn { top: 20px; left: 20px; }
        
        /* --- Modal & Feedback Styles --- */
        .modal { position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; animation: fadeInModal 0.3s ease; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background-color: var(--darker-grey-bg); margin: auto; padding: 25px; border: 3px solid var(--black-stroke); border-radius: var(--border-radius-game); width: 90%; max-width: 450px; box-shadow: 8px 8px 0px rgba(0,0,0,0.4); position: relative; color: var(--text-light); text-align: center; }
        .modal-content h2 { font-family: var(--font-logo); color: var(--blyza-orange-primary); -webkit-text-stroke: 1.5px var(--black-stroke); text-stroke: 1.5px var(--black-stroke); text-align: center; margin-bottom: 25px; font-size: 2rem; }
        .setting-item { margin-bottom: 18px; display: flex; flex-direction: column; }
        .setting-item label { margin-bottom: 10px; font-weight: 600; font-size: 1rem; }
        .close-modal-btn { color: #aaa; position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-modal-btn:hover { color: var(--text-light); }
        .modal-content button#sfx-toggle-btn { font-size: 1rem; padding: 10px 20px; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: rgba(0,0,0,0.3); border-radius: 5px; border: 2px solid var(--black-stroke); }
        input[type=range]::-webkit-slider-thumb { border: 2px solid var(--black-stroke); height: 22px; width: 22px; border-radius: 50%; background: var(--blyza-orange-primary); cursor: pointer; -webkit-appearance: none; margin-top: -9px; }
        #audio-consent-modal .modal-content p { font-family: var(--font-body); font-weight: 600; font-size: 1.1rem; margin-bottom: 25px; color: var(--text-light); }
        #audio-consent-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }

        /* --- Confetti & Game Over Buttons --- */
        .confetti-piece { position: fixed; width: 10px; height: 20px; background-color: var(--blyza-orange-primary); opacity: 0; animation-timing-function: linear; animation-fill-mode: forwards; pointer-events: none; z-index: 3000; }
        @keyframes fallAndFade { 0% { transform: translateY(-20vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(120vh) rotate(720deg); opacity: 0; } }
        .game-over-buttons-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .game-over-button-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
        .treat-yourself-callout { margin-bottom: 8px; background-color: var(--blyza-sunny-yellow); color: var(--text-dark); padding: 8px 15px; border-radius: 20px; font-family: var(--font-heading-alt); font-size: 0.9rem; white-space: nowrap; box-shadow: var(--shadow-chunky); display: none; align-items: center; gap: 8px; z-index: 10; border: 2px solid var(--black-stroke); }
        .treat-yourself-callout i { font-size: 1.2em; animation: bounceArrow 1s infinite; }
        @keyframes bounceArrow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        
        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            body { 
                padding: 10px; 
                align-items: flex-start;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .game-container { 
                padding: 45px 15px 15px; 
                max-height: calc(var(--app-height, 100vh) - 40px);
            } 
            h1 { font-size: 2.5rem; } h2 { font-size: 2rem; }
            .instructions { padding: 15px; }
            .team-display { flex-direction: column; align-items: center; }
            .team-card { min-width: 90%; }
            .icon-btn { width: 48px; height: 48px; }
            #settings-btn { top: 12px; right: 12px; }
            #home-menu-btn, #back-btn { top: 12px; left: 12px; }
            .modal-content { padding: 20px; }
            .game-over-buttons-container { flex-direction: column; align-items: center; }
            .game-over-buttons-container .game-over-button-wrapper { width: 90%; }
            .game-over-buttons-container .game-over-button-wrapper button { width: 100%; }
            .win-message-text { font-size: 2.2rem; }
            .time-up-popup { font-size: 2.2rem; }
            .timer-display-area { font-size: 5rem; }
            .bg-game-element { display: none; }
        }
    </style>
</head>
<body>
    <!-- Floating background elements -->
    <div class="hero-background-elements">
        <div class="bg-game-element bg-stopwatch-1"><i class="fas fa-stopwatch-20"></i></div>
        <div class="bg-game-element bg-5-1">5</div>
        <div class="bg-game-element bg-bolt-1"><i class="fas fa-bolt"></i></div>
        <div class="bg-game-element bg-question-1"><i class="fas fa-question-circle"></i></div>
        <div class="bg-game-element bg-stopwatch-2"><i class="fas fa-stopwatch-20"></i></div>
        <div class="bg-game-element bg-5-2">5</div>
        <div class="bg-game-element bg-bolt-2"><i class="fas fa-bolt"></i></div>
        <div class="bg-game-element bg-check-1"><i class="fas fa-check-circle"></i></div>
        <div class="bg-game-element bg-trophy-1"><i class="fas fa-trophy"></i></div>
        <div class="bg-game-element bg-times-1"><i class="fas fa-times-circle"></i></div>
    </div>

    <script>
        // THIS SCRIPT MUST RUN FIRST
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        setAppHeight();
    </script>
    
    <div class="game-container">
       <a href="#" onclick="history.back(); return false;" id="home-menu-btn" class="icon-btn" aria-label="Back to the previous page">
            <i class="fas fa-home"></i>
        </a>
        <button id="back-btn" class="icon-btn" aria-label="Go Back" style="display: none;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <button id="settings-btn" class="icon-btn" aria-label="Open Settings">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Start Screen -->
        <div id="start-screen" class="screen active-screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>5 Seconds Frenzy</h1>
            <div class="instructions">
                <p>HOW TO PLAY</p>
                <ul>
                    <li><i class="fas fa-user-group"></i> Teams take turns playing </li>
                    <li><i class="fas fa-shuffle"></i> A random category appears (e.g., "Name 3 Animals"), and the team has 5 seconds to shout out three valid answers!</li>
                    <li><i class="fas fa-circle-check"></i> If they succeed, they earn a point. If they fail, the opposing team automatically gets the point!</li>
                    <li><i class="fas fa-trophy"></i> First to 5 points wins!</li>
                </ul>
            </div>
            <button id="setup-teams-btn" class="btn-primary">Start Setup <i class="fas fa-users"></i></button>
        </div>

        <!-- Team Setup Screen -->
        <div id="team-setup-screen" class="screen">
            <h2>Enter Team Names</h2>
            <div class="team-inputs">
                <div class="team-input">
                    <label for="team1-name-input">Team 1 Name:</label>
                    <input type="text" id="team1-name-input" placeholder="Team 1">
                </div>
                <div class="team-input">
                    <label for="team2-name-input">Team 2 Name:</label>
                    <input type="text" id="team2-name-input" placeholder="Team 2">
                </div>
            </div>
            <button id="begin-game-btn" class="btn-primary">Begin Game <i class="fas fa-play"></i></button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="team-display">
                <div class="team-card" id="team1-card-display">
                    <div class="team-name" id="team1-name-text">Team 1</div>
                    <div class="team-score" id="team1-score-text">0</div>
                </div>
                <div class="team-card" id="team2-card-display">
                    <div class="team-name" id="team2-name-text">Team 2</div>
                    <div class="team-score" id="team2-score-text">0</div>
                </div>
            </div>
            <div class="gameplay-area">
                <div class="question-display-area" id="question-display-text">Press Start Timer...</div>
                <div class="timer-display-area" id="timer-display-text">5.00</div>
            </div>
            <div class="button-controls-area">
                 <button id="start-timer-reveal-btn" class="btn-secondary">
                     <i class="fas fa-play-circle"></i> Start Timer & Reveal
                 </button>
                 <button id="completed-early-btn" class="btn-info" style="display: none;">
                    <i class="fas fa-check-double"></i> Completed!
                 </button>
                 <div class="result-buttons-container" id="result-buttons-div">
                    <button class="btn-success" id="pass-result-btn">
                        <i class="fas fa-check"></i> Pass (+1)
                    </button>
                    <button class="btn-danger" id="fail-result-btn">
                        <i class="fas fa-times"></i> Fail (+1 Other)
                    </button>
                 </div>
            </div>
        </div>

        <!-- Win Screen -->
        <div id="win-screen" class="screen">
            <img class="brand-logo brand-logo-prominent" src="https://static.wixstatic.com/shapes/9ce3e5_4f0149a89dd841859da02f59247b5b6b.svg" alt="Blyza Mascot">
            <h1>Game Over!</h1>
            <div class="win-message-text" id="win-message-content">Team Wins!</div>
            <div class="winner-trophy-icon">üèÜ</div>
            <div class="game-over-buttons-container">
                <div class="game-over-button-wrapper">
                     <button id="play-again-game-btn" class="btn-success"><i class="fas fa-redo"></i> Play Again</button>
                </div>
                <div class="game-over-button-wrapper">
                     <button id="main-menu-nav-btn" class="btn-secondary"><i class="fas fa-home"></i> Main Menu</button>
                </div>
                <div class="game-over-button-wrapper" id="store-button-wrapper">
                     <button id="visit-store-btn" class="btn-info"><i class="fas fa-store"></i> Visit Store</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Audio Consent Modal -->
    <div id="audio-consent-modal" class="modal">
        <div class="modal-content">
            <h2>Enable Audio?</h2>
            <p>This game has background music and sound effects. Would you like to enable them for the best experience?</p>
            <div id="audio-consent-buttons">
                <button id="audio-consent-yes-btn" class="btn-success"><i class="fas fa-volume-up"></i> Yes, please!</button>
                <button id="audio-consent-no-btn" class="btn-secondary"><i class="fas fa-volume-mute"></i> No, thanks</button>
            </div>
        </div>
    </div>

     <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal-btn" class="close-modal-btn">√ó</span>
            <h2>Settings</h2>
            <div class="setting-item">
                <label for="bgm-volume-slider">Background Music Volume:</label>
                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0.2">
            </div>
            <div class="setting-item">
                <label for="sfx-toggle-btn">Sound Effects:</label>
                <button id="sfx-toggle-btn" class="btn-secondary">SFX: ON</button>
            </div>
        </div>
    </div>

    <!-- Time Up Pop-up -->
    <div id="time-up-popup-element" class="time-up-popup" style="display:none;">TIME'S UP!</div>

    <audio id="background-game-music" loop src="https://static.wixstatic.com/mp3/9ce3e5_380adfaea802407b9a4cebc67f12a216.mp3"></audio>
    <audio id="start-game-sound" src="https://static.wixstatic.com/mp3/9ce3e5_1b9151238aec4e29ab14f1526e9c1334.mp3"></audio>
    <audio id="interaction-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="timer-start-sound" src="https://static.wixstatic.com/mp3/9ce3e5_fc326aa1760c485dbac083ec55c2bfcb.wav"></audio>
    <audio id="timer-tick-sound" loop src="https://static.wixstatic.com/mp3/9ce3e5_6c1a8581e268482283a2168921822c95.mp3"></audio>
    <audio id="timer-up-sound" src="https://static.wixstatic.com/mp3/9ce3e5_16ac679126354f7db8a0f93c9f4fa7a1.wav"></audio>
    <audio id="pass-sound" src="https://static.wixstatic.com/mp3/9ce3e5_76691a6fefcd4536aa403ada111e886a.mp3"></audio>
    <audio id="fail-sound" src="https://static.wixstatic.com/mp3/9ce3e5_277f814439064d1bbe5c0342241b23e4.mp3"></audio>
    <audio id="confetti-sound" src="https://static.wixstatic.com/mp3/9ce3e5_5d7fcfc389734cf7994f5d37de621e3d.mp3"></audio>

    <script>
        const gameConfig = { sfxEnabled: true, musicVolume: 0.2, winningScore: 5, timerDuration: 5 };
        const gameState = { team1: { name: "Team 1", score: 0 }, team2: { name: "Team 2", score: 0 }, currentQuestion: "", questionTextToReveal: "", currentTeam: 1, timerInterval: null, timerEndTime: 0, timeLeft: gameConfig.timerDuration, usedQuestions: [] };
        const categories = [ "friends that are not funny", "people you wouldn't trust", "objects you can swallow", "things you can't do in a church", "things men have that women don't", "people you can knock out", "types of diseases", "people you find unattractive", "people you find attractive", "presidents", "capital cities", "countries in Europe", "countries in Asia", "of your favourite websites", "types of milk", "different crimes", "items in your bathroom", "ethnicities", "halloween cosplays", "things that you rub", "things smaller than your nose", "F1 teams", "currencies", "different Apple products", "sports without a ball", "Airlines", "different phobias", "mario characters", "female celebrities", "male celebrities", "designer brands", "types of trees", "animated characters", "football teams", "brands of water", "brands of chocolates", "types of cheese", "things you can't live without", "south american countries", "different seas", "periodic elements", "characters from the show Friends", "animals you could beat up", "flavours of milkshake", "types of pasta", "members of one direction", "mobile games", "different planets", "states in the USA", "things that are yellow", "female musicians", "male musicians", "types of milk", "types of seasoning", "band instruments", "things that are purple", "things that are soft", "types of fish", "types of haircuts", "types of coffee drinks", "monuments", "pre downloaded phone apps", "types of jewellery", "different languages", "things you wear under your clothes", "things in a cinema", "things you do before sleeping", "animals sounds", "things that green", "things you wouldn't want to find in your house" ];
        
        const screens = { start: document.getElementById("start-screen"), teamSetup: document.getElementById("team-setup-screen"), game: document.getElementById("game-screen"), win: document.getElementById("win-screen") };
        const homeMenuBtnEl = document.getElementById('home-menu-btn');
        const backBtnEl = document.getElementById('back-btn');
        const settingsBtnEl = document.getElementById('settings-btn');
        const setupTeamsBtnEl = document.getElementById("setup-teams-btn");
        const team1NameInputEl = document.getElementById("team1-name-input");
        const team2NameInputEl = document.getElementById("team2-name-input");
        const beginGameBtnEl = document.getElementById("begin-game-btn");
        const playAgainGameBtnEl = document.getElementById("play-again-game-btn");
        const passResultBtnEl = document.getElementById("pass-result-btn");
        const failResultBtnEl = document.getElementById("fail-result-btn");
        const startTimerRevealBtnEl = document.getElementById("start-timer-reveal-btn");
        const completedEarlyBtnEl = document.getElementById("completed-early-btn"); // New button element
        const questionDisplayTextEl = document.getElementById("question-display-text");
        const timerDisplayTextEl = document.getElementById("timer-display-text");
        const resultButtonsDivEl = document.getElementById("result-buttons-div");
        const mainMenuNavBtnEl = document.getElementById("main-menu-nav-btn");
        const storeButtonWrapperEl = document.getElementById("store-button-wrapper");
        let treatYourselfElement = null;
        const visitStoreBtnEl = document.getElementById("visit-store-btn");
        const team1NameTextEl = document.getElementById("team1-name-text");
        const team2NameTextEl = document.getElementById("team2-name-text");
        const team1ScoreTextEl = document.getElementById("team1-score-text");
        const team2ScoreTextEl = document.getElementById("team2-score-text");
        const team1CardDisplayEl = document.getElementById("team1-card-display");
        const team2CardDisplayEl = document.getElementById("team2-card-display");
        const winMessageContentEl = document.getElementById("win-message-content");
        const timeUpPopupElement = document.getElementById("time-up-popup-element");
        const settingsModalEl = document.getElementById('settings-modal');
        const closeModalBtnEl = document.getElementById('close-modal-btn');
        const bgmVolumeSliderEl = document.getElementById('bgm-volume-slider');
        const sfxToggleBtnEl = document.getElementById('sfx-toggle-btn');
        const audioConsentModalEl = document.getElementById('audio-consent-modal');
        const audioConsentYesBtnEl = document.getElementById('audio-consent-yes-btn');
        const audioConsentNoBtnEl = document.getElementById('audio-consent-no-btn');
        const backgroundMusicAudioEl = document.getElementById('background-game-music');
        
        const allSfx = [ document.getElementById('start-game-sound'), document.getElementById('interaction-sound'), document.getElementById('timer-start-sound'), document.getElementById('timer-tick-sound'), document.getElementById('timer-up-sound'), document.getElementById('pass-sound'), document.getElementById('fail-sound'), document.getElementById('confetti-sound') ];
        let audioContextStarted = false;

        function initAudio() {
            if (audioContextStarted) return;
            backgroundMusicAudioEl.play().then(() => {
                audioContextStarted = true;
                if (gameConfig.musicVolume <= 0 || document.hidden) {
                    backgroundMusicAudioEl.pause();
                }
            }).catch(e => { console.warn("Audio autoplay blocked, waiting for user interaction.", e); });
        }
        
        function playSound(audioElement) { 
            if (gameConfig.sfxEnabled && audioElement && audioContextStarted) { 
                audioElement.pause();
                audioElement.currentTime = 0; 
                audioElement.play().catch(e => {}); 
            } 
        }
        
        function stopSound(audioElement) {
             if (audioElement && audioContextStarted) { 
                audioElement.pause();
                audioElement.currentTime = 0; 
            } 
        }

        function playSoundWithCallback(audioElement, callback, ...args) { 
            if (gameConfig.sfxEnabled && audioElement && audioContextStarted) {
                audioElement.pause();
                audioElement.currentTime = 0;
                let cbExecuted = false;
                const execCb = () => {
                    if (!cbExecuted) {
                        cbExecuted = true;
                        audioElement.removeEventListener('ended', execCb);
                        if (callback) callback(...args);
                    }
                };
                audioElement.addEventListener('ended', execCb);
                audioElement.play().catch(e => { execCb(); });
            } else { 
                if (callback) callback(...args);
            }
        }

        function loadAudioSettings() { const savedVol = localStorage.getItem('musicVolume'), savedSfx = localStorage.getItem('sfxEnabled'); if (savedVol !== null) gameConfig.musicVolume = parseFloat(savedVol); if (savedSfx !== null) gameConfig.sfxEnabled = savedSfx === 'true'; backgroundMusicAudioEl.volume = gameConfig.musicVolume; bgmVolumeSliderEl.value = gameConfig.musicVolume; sfxToggleBtnEl.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`; }
        function triggerConfetti() { playSound(allSfx[7]); const colors = ['var(--blyza-orange-primary)', 'var(--blyza-purple-secondary)', 'var(--blyza-keppel-accent)', 'var(--blyza-sunny-yellow)']; for (let i = 0; i < 100; i++) { const piece = document.createElement('div'); piece.classList.add('confetti-piece'); piece.style.left = Math.random() * 100 + 'vw'; piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]; const animDur = Math.random() * 3 + 2; piece.style.animationName = 'fallAndFade'; piece.style.animationDuration = animDur + 's'; piece.style.animationDelay = Math.random() * 1 + 's'; document.body.appendChild(piece); setTimeout(() => piece.remove(), (animDur + 1.1) * 1000); } }
        
        function handleVisibilityChange() {
            if (!audioContextStarted) return;
            if (document.hidden) {
                backgroundMusicAudioEl.pause();
                stopSound(allSfx[3]); // Stop timer tick sound
            } else if (gameConfig.musicVolume > 0) {
                backgroundMusicAudioEl.play().catch(e => {});
            }
        }
        
        function handlePageShow(event) {
            if (event.persisted) {
                console.log("Page restored from bfcache. Re-initializing...");
                setAppHeight(); 
                goToMainMenu();
            }
        }

        function switchScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.remove('active-screen', 'active'));
            screens[screenId].classList.add('active-screen', 'active');
            
            const isStartScreen = screenId === 'start';
            homeMenuBtnEl.style.display = isStartScreen ? 'flex' : 'none';
            backBtnEl.style.display = isStartScreen ? 'none' : 'flex';

            if (screenId === 'win') backBtnEl.style.display = 'none';

            if (treatYourselfElement) treatYourselfElement.style.display = (screenId === 'win') ? 'flex' : 'none';
        }

        function goToMainMenu() {
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            if(audioContextStarted && gameConfig.musicVolume > 0) backgroundMusicAudioEl.play().catch(()=>{});
            stopSound(allSfx[3]);
            switchScreen('start');
        }

        setupTeamsBtnEl.addEventListener("click", () => { playSound(allSfx[1]); switchScreen('teamSetup'); });
        backBtnEl.addEventListener("click", () => { playSound(allSfx[1]); goToMainMenu(); });
        beginGameBtnEl.addEventListener("click", () => { playSoundWithCallback(allSfx[0], startGame); });
        startTimerRevealBtnEl.addEventListener("click", handleStartTimer);
        passResultBtnEl.addEventListener("click", () => { playSound(allSfx[5]); handleResult(true); });
        failResultBtnEl.addEventListener("click", () => { playSound(allSfx[6]); handleResult(false); });
        playAgainGameBtnEl.addEventListener("click", () => { playSoundWithCallback(allSfx[0], resetGame); });
        mainMenuNavBtnEl.addEventListener("click", () => { playSound(allSfx[1]); goToMainMenu(); });
        visitStoreBtnEl.addEventListener("click", () => { playSound(allSfx[1]); window.location.href = '/store'; });
        completedEarlyBtnEl.addEventListener("click", () => { playSound(allSfx[1]); handleCompletedEarly(); }); // New event listener

        settingsBtnEl.addEventListener('click', () => { playSound(allSfx[1]); settingsModalEl.style.display = 'flex'; });
        closeModalBtnEl.addEventListener('click', () => { playSound(allSfx[1]); settingsModalEl.style.display = 'none'; });
        bgmVolumeSliderEl.addEventListener('input', (e) => { gameConfig.musicVolume = parseFloat(e.target.value); backgroundMusicAudioEl.volume = gameConfig.musicVolume; localStorage.setItem('musicVolume', gameConfig.musicVolume); if (gameConfig.musicVolume > 0 && !document.hidden && audioContextStarted) backgroundMusicAudioEl.play().catch(e=>{}); else backgroundMusicAudioEl.pause(); });
        sfxToggleBtnEl.addEventListener('click', () => { gameConfig.sfxEnabled = !gameConfig.sfxEnabled; sfxToggleBtnEl.textContent = `SFX: ${gameConfig.sfxEnabled ? 'ON' : 'OFF'}`; playSound(allSfx[1]); localStorage.setItem('sfxEnabled', String(gameConfig.sfxEnabled)); });

        function startGame() {
            gameState.team1.name = team1NameInputEl.value.trim() || "Team 1";
            gameState.team2.name = team2NameInputEl.value.trim() || "Team 2";
            if (gameState.team1.name.length > 15 || gameState.team2.name.length > 15) { alert("Team names too long!"); return; }
            if (gameState.team1.name.toLowerCase() === gameState.team2.name.toLowerCase()) { alert("Team names must be different!"); return; }
            resetGame();
        }

        function resetGame() {
            gameState.team1.score = 0; gameState.team2.score = 0;
            gameState.currentTeam = 1; gameState.timeLeft = gameConfig.timerDuration;
            gameState.usedQuestions = [];
            updateTeamDisplays();
            prepareTurn();
            if (treatYourselfElement) treatYourselfElement.style.display = 'none';
            switchScreen('game');
        }

        function updateTeamDisplays() {
            team1NameTextEl.textContent = gameState.team1.name;
            team2NameTextEl.textContent = gameState.team2.name;
            team1ScoreTextEl.textContent = gameState.team1.score;
            team2ScoreTextEl.textContent = gameState.team2.score;
            team1CardDisplayEl.classList.toggle("active-turn", gameState.currentTeam === 1);
            team2CardDisplayEl.classList.toggle("active-turn", gameState.currentTeam === 2);
        }

        function prepareTurn() {
            stopSound(allSfx[3]);
            let availableCategories = categories.filter(cat => !gameState.usedQuestions.includes(cat));
            if (availableCategories.length === 0) { gameState.usedQuestions = []; availableCategories = [...categories]; }
            const randomCategory = availableCategories[Math.floor(Math.random() * availableCategories.length)];
            gameState.usedQuestions.push(randomCategory);
            
            gameState.questionTextToReveal = `Name 3 ${randomCategory}...`;
            questionDisplayTextEl.innerHTML = `<span class="question-hidden-text">Press Start Timer...</span>`;
            gameState.timeLeft = gameConfig.timerDuration;
            timerDisplayTextEl.textContent = gameState.timeLeft.toFixed(2);
            timerDisplayTextEl.style.color = 'var(--text-light)';
            startTimerRevealBtnEl.style.display = "inline-flex";
            startTimerRevealBtnEl.disabled = false;
            completedEarlyBtnEl.style.display = "none"; // Hide completed button
            resultButtonsDivEl.style.display = "none";
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = null;
        }

        function handleStartTimer() {
            if (gameState.timerInterval) return;
            playSound(allSfx[2]);
            playSound(allSfx[3]); // timer tick
            startTimerRevealBtnEl.style.display = "none";
            completedEarlyBtnEl.style.display = "inline-flex"; // Show completed button
            questionDisplayTextEl.textContent = gameState.questionTextToReveal;
            
            gameState.timerEndTime = Date.now() + gameConfig.timerDuration * 1000;
            
            timerDisplayTextEl.style.color = 'var(--blyza-quickfire-red)';
            gameState.timerInterval = setInterval(updateTimer, 16); // ~60fps for smooth update
        }

        function updateTimer() {
            const remainingMs = gameState.timerEndTime - Date.now();
            gameState.timeLeft = Math.max(0, remainingMs / 1000);
            timerDisplayTextEl.textContent = gameState.timeLeft.toFixed(2);

            if (gameState.timeLeft <= 0) {
                stopSound(allSfx[3]);
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
                timerDisplayTextEl.textContent = "0.00";
                playSound(allSfx[4]);
                showTimeUpAnimation();
                resultButtonsDivEl.style.display = "flex";
                completedEarlyBtnEl.style.display = "none"; // Hide completed button
                startTimerRevealBtnEl.disabled = true;
            }
        }
        
        function handleCompletedEarly() {
            stopSound(allSfx[3]);
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = null;
            resultButtonsDivEl.style.display = "flex";
            completedEarlyBtnEl.style.display = "none"; // Hide self
            startTimerRevealBtnEl.disabled = true;
        }

        function showTimeUpAnimation() {
            timeUpPopupElement.style.display = "block";
            timeUpPopupElement.style.animation = 'none';
            timeUpPopupElement.offsetHeight;
            timeUpPopupElement.style.animation = 'timeUpPopAnim 1.5s forwards';
        }

        function handleResult(passed) {
             stopSound(allSfx[3]);
             clearInterval(gameState.timerInterval);
             gameState.timerInterval = null;
             resultButtonsDivEl.style.display = "none";
             completedEarlyBtnEl.style.display = "none"; // Ensure it's hidden
            if (passed) {
                if (gameState.currentTeam === 1) gameState.team1.score++; else gameState.team2.score++;
            } else {
                if (gameState.currentTeam === 1) gameState.team2.score++; else gameState.team1.score++;
            }
            updateTeamDisplays();
            if (gameState.team1.score >= gameConfig.winningScore || gameState.team2.score >= gameConfig.winningScore) {
                showWinScreen();
            } else {
                gameState.currentTeam = gameState.currentTeam === 1 ? 2 : 1;
                prepareTurn();
                updateTeamDisplays();
            }
        }

        function showWinScreen() {
            stopSound(allSfx[3]);
            const winner = gameState.team1.score >= gameConfig.winningScore ? gameState.team1.name : gameState.team2.name;
            winMessageContentEl.textContent = `${winner} Wins!`;
             if (!treatYourselfElement) {
                treatYourselfElement = document.createElement('div');
                treatYourselfElement.className = 'treat-yourself-callout';
                treatYourselfElement.innerHTML = `<span>Treat Yourself!</span> <i class="fas fa-arrow-down"></i>`;
                storeButtonWrapperEl.insertBefore(treatYourselfElement, visitStoreBtnEl);
            }
            switchScreen('win');
            triggerConfetti();
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadAudioSettings();
            audioConsentModalEl.style.display = 'flex';
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('pageshow', handlePageShow);
            goToMainMenu();
        });

        audioConsentYesBtnEl.addEventListener('click', () => {
            audioConsentModalEl.style.display = 'none';
            initAudio(); // This user tap unlocks the audio context
            playSound(allSfx[1]);
        });
        
        audioConsentNoBtnEl.addEventListener('click', () => {
            audioConsentModalEl.style.display = 'none';
            gameConfig.sfxEnabled = false;
            gameConfig.musicVolume = 0;
            backgroundMusicAudioEl.volume = 0;
            bgmVolumeSliderEl.value = 0;
            sfxToggleBtnEl.textContent = 'SFX: OFF';
            localStorage.setItem('sfxEnabled', 'false'); 
            localStorage.setItem('musicVolume', '0'); 
            initAudio(); // Still call this to set the audioContextStarted flag
        });

        // --- CUSTOM SCROLL REDIRECTION LOGIC ---
        const gameContainerForScroll = document.querySelector('.game-container');
        let lastTouchY = 0;

        window.addEventListener('wheel', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                gameContainerForScroll.scrollTop += e.deltaY;
            }
        }, { passive: true });

        window.addEventListener('touchstart', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                if (e.touches.length > 0) {
                    lastTouchY = e.touches[0].clientY;
                }
            }
        }, { passive: true });

        window.addEventListener('touchmove', e => {
            if (document.querySelector('.modal[style*="display: flex"]')) return;
            if (!gameContainerForScroll.contains(e.target)) {
                e.preventDefault(); 
                if (e.touches.length > 0) {
                    const currentTouchY = e.touches[0].clientY;
                    const deltaY = lastTouchY - currentTouchY;
                    gameContainerForScroll.scrollTop += deltaY;
                    lastTouchY = currentTouchY;
                }
            }
        }, { passive: false });
        // --- END OF CUSTOM SCROLL LOGIC ---
    </script>
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>
</body>
</html>